# ğŸš€ ä¸‹ä¸€æ­¥ï¼šæµ‹è¯•å’Œéƒ¨ç½²ç”Ÿäº§æ¨¡å¼

## âœ… **æµ‹è¯•æ¨¡å¼å·²å®Œæˆï¼**

æ‰€æœ‰é…ç½®å·²å®Œæˆå¹¶éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒï¼š
- âœ… æœˆè´¹å’Œå¹´è´¹äº§å“ï¼ˆè‹±æ–‡åç§°ï¼‰
- âœ… æ”¯æŒ 6 ç§è´§å¸ï¼ˆHKD, USD, GBP, JPY, KRW, EURï¼‰
- âœ… æŒ‰é‡è®¡è´¹åŠŸèƒ½
- âœ… ç»­è´¹è‡ªåŠ¨æ¸…é›¶
- âœ… ä¸¤ä¸ªæµ‹è¯•æŒ‰é’®éƒ½å·²å¯ç”¨

---

## ğŸ§ª **ç«‹å³æµ‹è¯•**

### **æµ‹è¯•ç½‘å€**ï¼š
https://vaultcaddy.com/billing.html

---

### **æµ‹è¯• 1ï¼šæœˆè´¹è®¢é˜…ï¼ˆå¤šè´§å¸ï¼‰**

1. **ç‚¹å‡»æœˆè´¹çš„ "ğŸ§ª æ¸¬è©¦ Get Started" æŒ‰é’®**

2. **åœ¨ Stripe Checkout é¡µé¢**ï¼š
   - æŸ¥çœ‹é»˜è®¤æ˜¾ç¤ºçš„è´§å¸
   - å°è¯•åˆ‡æ¢è´§å¸ï¼š
     - HKD: HK$58.00/æœˆ
     - USD: $7.48/æœˆ
     - GBP: Â£5.58/æœˆ
     - JPY: Â¥1,158/æœˆ
     - KRW: â‚©10,888/ì›”
     - EUR: â‚¬6.28/æœˆ
   - ä½¿ç”¨æµ‹è¯•å¡å·ï¼š`4242 4242 4242 4242`
   - å®Œæˆæ”¯ä»˜

3. **éªŒè¯ç»“æœ**ï¼š
   - è®¿é—®ï¼šhttps://vaultcaddy.com/account.html
   - æŸ¥çœ‹ Credits æ˜¯å¦å¢åŠ  100
   - æŸ¥çœ‹ planType æ˜¯å¦ä¸º "Pro Plan"
   - æŸ¥çœ‹ resetDate æ˜¯å¦ä¸º 1 ä¸ªæœˆå

---

### **æµ‹è¯• 2ï¼šå¹´è´¹è®¢é˜…ï¼ˆèŠ‚çœ 20%ï¼‰**

1. **é‡ç½® Credits**ï¼š
   - åœ¨ Firestore ä¸­å°† Credits è®¾ä¸º 0

2. **ç‚¹å‡»å¹´è´¹çš„ "ğŸ§ª æ¸¬è©¦ Get Started" æŒ‰é’®**

3. **åœ¨ Stripe Checkout é¡µé¢**ï¼š
   - æŸ¥çœ‹å¹´è´¹ä»·æ ¼ï¼ˆåº”è¯¥æ›´ä¾¿å®œï¼ŒèŠ‚çœ 20%ï¼‰
   - å°è¯•åˆ‡æ¢è´§å¸ï¼š
     - HKD: HK$557.00/å¹´
     - USD: $71.81/å¹´
     - GBP: Â£53.57/å¹´
     - JPY: Â¥11,117/å¹´
     - KRW: â‚©104,525/ë…„
     - EUR: â‚¬60.29/å¹´
   - å®Œæˆæ”¯ä»˜

4. **éªŒè¯ç»“æœ**ï¼š
   - Credits å¢åŠ  1,200
   - resetDate ä¸º 1 å¹´å

---

### **æµ‹è¯• 3ï¼šæŒ‰é‡è®¡è´¹**

1. **è®¾ç½®åˆå§‹ Credits**ï¼š
   - åœ¨ Firestore ä¸­ï¼Œå°†ç”¨æˆ·çš„ `credits` è®¾ä¸º `5`

2. **ä½¿ç”¨ 6 æ¬¡**ï¼š
   - è¿›è¡Œ 6 æ¬¡æ–‡æ¡£è½¬æ¢

3. **éªŒè¯ç»“æœ**ï¼š
   - Firestore ä¸­ `credits` åº”è¯¥æ˜¯ `-1`
   - Firebase Functions æ—¥å¿—æ˜¾ç¤ºï¼š
     ```
     ğŸ’° Pro Plan ç”¨æˆ·è¶…å‡ºæœˆåº¦é¢åº¦ï¼Œå¯åŠ¨æŒ‰é‡æ”¶è´¹
     ğŸ“¡ å‡†å¤‡å‘ Stripe æŠ¥å‘Šè¶…é¢ä½¿ç”¨é‡: 1 Credits
     âœ… ä½¿ç”¨é‡å·²æŠ¥å‘Šç»™ Stripe
     ```

4. **æŸ¥çœ‹ Stripe Dashboard**ï¼š
   - æ‰“å¼€ï¼šhttps://dashboard.stripe.com/test/subscriptions
   - ç‚¹å‡»æµ‹è¯•ç”¨æˆ·çš„è®¢é˜…
   - åœ¨ "Usage" æ ‡ç­¾ä¸‹ï¼ŒæŸ¥çœ‹ä½¿ç”¨é‡
   - åœ¨ "Upcoming invoice" ä¸­ï¼ŒæŸ¥çœ‹è¶…é¢è´¹ç”¨

---

## ğŸš€ **é…ç½®ç”Ÿäº§æ¨¡å¼ï¼ˆæµ‹è¯•æˆåŠŸåï¼‰**

### **æ­¥éª¤ 1ï¼šè¿è¡Œè„šæœ¬åˆ›å»ºç”Ÿäº§äº§å“**

1. **è·å–ç”Ÿäº§æ¨¡å¼å¯†é’¥**ï¼š
   - åœ¨ Stripe Dashboard å³ä¸Šè§’ï¼Œå…³é—­ "æµ‹è¯•æ¨¡å¼"
   - å‰å¾€ï¼šhttps://dashboard.stripe.com/apikeys
   - å¤åˆ¶ Secret keyï¼ˆä»¥ `sk_live_` å¼€å¤´ï¼‰

2. **è¿è¡Œè„šæœ¬**ï¼š
   ```bash
   cd /Users/cavlinyeung/ai-bank-parser
   node setup-stripe-products.js <ç”Ÿäº§æ¨¡å¼å¯†é’¥>
   ```

3. **è„šæœ¬ä¼šåˆ›å»º**ï¼š
   - ç”Ÿäº§æ¨¡å¼çš„æœˆè´¹å’Œå¹´è´¹äº§å“
   - æ‰€æœ‰è´§å¸çš„ Price
   - æŒ‰é‡è®¡è´¹ Price
   - ä¿å­˜é…ç½®åˆ° `stripe-config-en-live.json`

---

### **æ­¥éª¤ 2ï¼šæ›´æ–° Firebase Functions**

åœ¨ `firebase-functions/index.js` ä¸­æ›´æ–°ç”Ÿäº§æ¨¡å¼çš„ Price IDsï¼š

```javascript
// ğŸ¯ å®šç¾©åƒ¹æ ¼ IDï¼ˆç”Ÿç”¢æ¨¡å¼ï¼‰
const productionPriceMapping = {
    monthly: {
        basePriceId: '<ä» stripe-config-en-live.json å¤åˆ¶>',
        usagePriceId: '<ä» stripe-config-en-live.json å¤åˆ¶>'
    },
    yearly: {
        basePriceId: '<ä» stripe-config-en-live.json å¤åˆ¶>',
        usagePriceId: '<ä» stripe-config-en-live.json å¤åˆ¶>'
    }
};
```

---

### **æ­¥éª¤ 3ï¼šæ›´æ–°ç”Ÿäº§æ¨¡å¼ Webhook**

1. **æ‰“å¼€ç”Ÿäº§æ¨¡å¼ Webhook é…ç½®**ï¼š
   https://dashboard.stripe.com/webhooks

2. **åˆ›å»ºæˆ–æ›´æ–° Webhook**ï¼š
   - URL: `https://us-central1-vaultcaddy-production-cbbe2.cloudfunctions.net/stripeWebhook`
   - ç›‘å¬äº‹ä»¶ï¼š
     - âœ… checkout.session.completed
     - âœ… customer.subscription.created
     - âœ… customer.subscription.updated
     - âœ… customer.subscription.deleted
     - âœ… invoice.paid

3. **å¤åˆ¶ Webhook ç­¾åå¯†é’¥**ï¼ˆä»¥ `whsec_` å¼€å¤´ï¼‰

4. **é…ç½®åˆ° Firebase**ï¼š
   ```bash
   firebase functions:config:set stripe.live_webhook_secret="whsec_xxxxx"
   firebase deploy --only functions
   ```

---

### **æ­¥éª¤ 4ï¼šæ›´æ–° billing.html çš„ç”Ÿäº§æŒ‰é’®**

å¯ç”¨ç´«è‰²çš„ "Get Started" æŒ‰é’®ï¼ˆéæµ‹è¯•æ¨¡å¼ï¼‰ã€‚

---

## âš ï¸ **ç”Ÿäº§æ¨¡å¼éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•**

### **å¿…é¡»ç¡®è®¤**ï¼š

- [ ] âœ… æµ‹è¯•æ¨¡å¼ä¸­æ‰€æœ‰åŠŸèƒ½éƒ½æ­£å¸¸
- [ ] âœ… æœˆè´¹è®¢é˜…æ­£ç¡®æ·»åŠ  100 Credits
- [ ] âœ… å¹´è´¹è®¢é˜…æ­£ç¡®æ·»åŠ  1,200 Credits
- [ ] âœ… æŒ‰é‡è®¡è´¹æ­£å¸¸å·¥ä½œ
- [ ] âœ… ç»­è´¹æ¸…é›¶æ­£å¸¸å·¥ä½œ
- [ ] âœ… Pro Plan å’Œ resetDate æ˜¾ç¤ºæ­£ç¡®
- [ ] âœ… å¤šè´§å¸åˆ‡æ¢æ­£å¸¸
- [ ] âœ… æ‰€æœ‰ä»·æ ¼éƒ½æ˜¯æ•´æ•°

### **ç”Ÿäº§æ¨¡å¼é…ç½®**ï¼š

- [ ] â³ åˆ›å»ºç”Ÿäº§äº§å“å’Œä»·æ ¼
- [ ] â³ æ›´æ–° Firebase Functions
- [ ] â³ é…ç½®ç”Ÿäº§ Webhook
- [ ] â³ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- [ ] â³ æœ€ç»ˆæµ‹è¯•

---

## ğŸ“Š **é…ç½®æ–‡ä»¶**

### **æµ‹è¯•æ¨¡å¼é…ç½®**ï¼š
- æ–‡ä»¶ï¼š`stripe-config-test.json`
- åŒ…å«ï¼šæœˆè´¹å’Œå¹´è´¹çš„æ‰€æœ‰ Price IDs

### **ç”Ÿäº§æ¨¡å¼é…ç½®**ï¼š
- æ–‡ä»¶ï¼š`stripe-config-en-live.json`ï¼ˆè¿è¡Œè„šæœ¬åç”Ÿæˆï¼‰
- åŒ…å«ï¼šç”Ÿäº§æ¨¡å¼çš„æ‰€æœ‰ Price IDs

---

## ğŸ¯ **å½“å‰ä»»åŠ¡**

1. âœ… **ç«‹å³æµ‹è¯•æµ‹è¯•æ¨¡å¼**
   - æµ‹è¯•æœˆè´¹è®¢é˜…
   - æµ‹è¯•å¹´è´¹è®¢é˜…
   - æµ‹è¯•å¤šè´§å¸åˆ‡æ¢
   - æµ‹è¯•æŒ‰é‡è®¡è´¹

2. â³ **ç¡®è®¤ä¸€åˆ‡æ­£å¸¸**
   - æ‰€æœ‰åŠŸèƒ½éƒ½æ­£å¸¸å·¥ä½œ
   - æ²¡æœ‰é”™è¯¯æˆ–bug

3. â³ **éƒ¨ç½²ç”Ÿäº§æ¨¡å¼**
   - è¿è¡Œè„šæœ¬åˆ›å»ºç”Ÿäº§äº§å“
   - æ›´æ–° Firebase Functions
   - éƒ¨ç½²åˆ°çº¿ä¸Š

---

## ğŸ“ **å¦‚æœé‡åˆ°é—®é¢˜**

è¯·æä¾›ï¼š
- é”™è¯¯æˆªå›¾
- Firebase Functions æ—¥å¿—
- Firestore æ•°æ®æˆªå›¾
- Stripe Dashboard æˆªå›¾

æˆ‘ä¼šç«‹å³å¸®æ‚¨è§£å†³ï¼ ğŸš€

