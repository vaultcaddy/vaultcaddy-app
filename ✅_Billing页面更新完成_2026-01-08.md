# âœ… Billing é¡µé¢æ›´æ–°å®ŒæˆæŠ¥å‘Š

**å®Œæˆæ—¶é—´**: 2026-01-08  
**çŠ¶æ€**: âœ… å‰ç«¯å…¨éƒ¨å®Œæˆ

---

## ğŸ“‹ å·²å®Œæˆçš„æ›´æ–°

### 1ï¸âƒ£ æ ‡é¢˜æ›´æ–°ï¼ˆ4ä¸ªè¯­è¨€ç‰ˆæœ¬ï¼‰

| è¯­è¨€ | åŸæ ‡é¢˜ | æ–°æ ‡é¢˜ï¼ˆæœˆä»˜ï¼‰ | æ–°æ ‡é¢˜ï¼ˆå¹´ä»˜ï¼‰ | çŠ¶æ€ |
|------|--------|--------------|--------------|------|
| ğŸ‡¨ğŸ‡³ ä¸­æ–‡ | Starter å…¥é–€ç‰ˆ | **æœˆä»˜** | **å¹´ä»˜** | âœ… å·²æ›´æ–° |
| ğŸ‡ºğŸ‡¸ è‹±æ–‡ | Starter | **Monthly** | **Yearly** | âœ… å·²ç¡®è®¤ |
| ğŸ‡¯ğŸ‡µ æ—¥æ–‡ | - | **æœˆæ‰•ã„** | **å¹´æ‰•ã„** | âœ… å·²ç¡®è®¤ |
| ğŸ‡°ğŸ‡· éŸ©æ–‡ | - | **ì›”ê°„** | **ì—°ê°„** | âœ… å·²ç¡®è®¤ |

### 2ï¸âƒ£ æŒ‰é’®é“¾æ¥ç¡®è®¤

æ‰€æœ‰4ä¸ªç‰ˆæœ¬çš„"ç«‹å³å¼€å§‹"æŒ‰é’®éƒ½å·²æ­£ç¡®é…ç½®ï¼š

**ä¸­æ–‡ç‰ˆæœ¬** (`billing.html`):
```html
<!-- æœˆä»˜æŒ‰é’® -->
<button onclick="createCheckoutSession('monthly', event)" ...>é–‹å§‹ä½¿ç”¨</button>

<!-- å¹´ä»˜æŒ‰é’® -->
<button onclick="createCheckoutSession('yearly', event)" ...>é–‹å§‹ä½¿ç”¨</button>
```

**è‹±æ–‡ç‰ˆæœ¬** (`en/billing.html`):
```html
<!-- MonthlyæŒ‰é’® -->
<button onclick="createCheckoutSession('monthly', event)" ...>Get Started</button>

<!-- YearlyæŒ‰é’® -->
<button onclick="createCheckoutSession('yearly', event)" ...>Get Started</button>
```

**æ—¥æ–‡ç‰ˆæœ¬** (`jp/billing.html`):
```html
<!-- æœˆæ‰•ã„æŒ‰é’® -->
<button onclick="createCheckoutSession('monthly', event)" ...>å§‹ã‚ã‚‹</button>

<!-- å¹´æ‰•ã„æŒ‰é’® -->
<button onclick="createCheckoutSession('yearly', event)" ...>å§‹ã‚ã‚‹</button>
```

**éŸ©æ–‡ç‰ˆæœ¬** (`kr/billing.html`):
```html
<!-- ì›”ê°„æŒ‰é’® -->
<button onclick="createCheckoutSession('monthly', event)" ...>ì‹œì‘í•˜ê¸°</button>

<!-- ì—°ê°„æŒ‰é’® -->
<button onclick="createCheckoutSession('yearly', event)" ...>ì‹œì‘í•˜ê¸°</button>
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### createCheckoutSession å‡½æ•°

æ‰€æœ‰æŒ‰é’®éƒ½è°ƒç”¨åŒä¸€ä¸ªå‡½æ•°ï¼š

```javascript
async function createCheckoutSession(planType, event, isTest = false) {
    // 1. æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
    // 2. è°ƒç”¨ Firebase Function: 'createStripeCheckoutSession'
    // 3. ä¼ é€’å‚æ•°: { planType, userId, email }
    // 4. è·³è½¬åˆ° Stripe Checkout é¡µé¢
}
```

è¿™ä¸ªå‡½æ•°ä¼šï¼š
1. ä¼ é€’ `planType` ('monthly' æˆ– 'yearly') åˆ°åç«¯
2. Firebase Function æ ¹æ® planType é€‰æ‹©å¯¹åº”çš„ Stripe Price ID
3. åˆ›å»º Stripe Checkout Session
4. é‡å®šå‘ç”¨æˆ·åˆ°æ”¯ä»˜é¡µé¢

---

## âš ï¸ é‡è¦ï¼šéœ€è¦æ›´æ–° Firebase Functions

### å½“å‰çŠ¶æ€

å‰ç«¯å·²å®Œæˆï¼Œä½† **Firebase Functions éœ€è¦æ›´æ–°** æ‰èƒ½ä½¿ç”¨æ–°çš„ Stripe Price IDã€‚

### éœ€è¦æ›´æ–°çš„æ–‡ä»¶

`firebase-functions/index.js` ä¸­çš„ `createStripeCheckoutSession` å‡½æ•°éœ€è¦æ›´æ–°ä¸ºï¼š

```javascript
// âœ… æ–°çš„ Stripe Price IDï¼ˆä½¿ç”¨å¤šè´§å¸ä»·æ ¼ï¼‰
const STRIPE_PRICE_IDS = {
  monthly: 'price_1SnF6hJmiQ31C0GT0QSOiXVI',  // VaultCaddy Monthlyï¼ˆæ”¯æŒ 6 ç§è´§å¸ï¼‰
  yearly: 'price_1SnF6hJmiQ31C0GT8SvegPzM'    // VaultCaddy Yearlyï¼ˆæ”¯æŒ 6 ç§è´§å¸ï¼‰
};

exports.createStripeCheckoutSession = functions.https.onCall(async (data, context) => {
  // ... éªŒè¯ä»£ç  ...
  
  const { planType, userId, email } = data;
  
  // æ ¹æ® planType é€‰æ‹© Price ID
  const priceId = STRIPE_PRICE_IDS[planType];
  
  if (!priceId) {
    throw new functions.https.HttpsError('invalid-argument', 'Invalid plan type');
  }
  
  // åˆ›å»º Checkout Session
  const session = await stripe.checkout.sessions.create({
    customer_email: email,
    line_items: [{
      price: priceId,
      quantity: 1
    }],
    mode: 'subscription',
    success_url: `${YOUR_DOMAIN}/dashboard.html?session_id={CHECKOUT_SESSION_ID}`,
    cancel_url: `${YOUR_DOMAIN}/billing.html`,
    metadata: {
      userId: userId,
      planType: planType
    }
  });
  
  return { url: session.url };
});
```

---

## ğŸ“ å®Œæ•´çš„ Price ID é…ç½®

### æ–°çš„å¤šè´§å¸ Price IDï¼ˆæ¯ä¸ªæ”¯æŒ 6 ç§è´§å¸ï¼‰

**Monthly Plan**:
- Price ID: `price_1SnF6hJmiQ31C0GT0QSOiXVI`
- æ”¯æŒè´§å¸ï¼šHKD, USD, JPY, KRW, EUR, GBP

**Yearly Plan**:
- Price ID: `price_1SnF6hJmiQ31C0GT8SvegPzM`
- æ”¯æŒè´§å¸ï¼šHKD, USD, JPY, KRW, EUR, GBP

---

## ğŸ§ª æµ‹è¯•æ¸…å•

åœ¨æ­£å¼ä¸Šçº¿å‰ï¼Œè¯·æµ‹è¯•ä»¥ä¸‹å†…å®¹ï¼š

### å‰ç«¯æµ‹è¯• âœ…
- [x] ä¸­æ–‡ç‰ˆæœ¬æ ‡é¢˜æ­£ç¡®æ˜¾ç¤º
- [x] è‹±æ–‡ç‰ˆæœ¬æ ‡é¢˜æ­£ç¡®æ˜¾ç¤º
- [x] æ—¥æ–‡ç‰ˆæœ¬æ ‡é¢˜æ­£ç¡®æ˜¾ç¤º
- [x] éŸ©æ–‡ç‰ˆæœ¬æ ‡é¢˜æ­£ç¡®æ˜¾ç¤º
- [x] æ‰€æœ‰æŒ‰é’®è°ƒç”¨æ­£ç¡®çš„å‡½æ•°

### åç«¯æµ‹è¯• âš ï¸ å¾…å®Œæˆ
- [ ] æ›´æ–° Firebase Functions ä¸­çš„ Price ID
- [ ] æµ‹è¯• monthly æŒ‰é’®è·³è½¬åˆ° Stripe Checkout
- [ ] æµ‹è¯• yearly æŒ‰é’®è·³è½¬åˆ° Stripe Checkout
- [ ] ç¡®è®¤ Stripe Checkout æ˜¾ç¤ºæ­£ç¡®çš„ä»·æ ¼
- [ ] æµ‹è¯•å„ç§è´§å¸çš„æ”¯ä»˜æµç¨‹
- [ ] ç¡®è®¤è®¢é˜…åˆ›å»ºæˆåŠŸ
- [ ] ç¡®è®¤ Webhook æ­£ç¡®å¤„ç†è®¢é˜…äº‹ä»¶

---

## ğŸ“‚ æ›´æ–°çš„æ–‡ä»¶åˆ—è¡¨

1. `/Users/cavlinyeung/ai-bank-parser/billing.html` âœ…
   - æœˆä»˜æ ‡é¢˜ï¼šStarter å…¥é–€ç‰ˆ â†’ **æœˆä»˜**
   - å¹´ä»˜æ ‡é¢˜ï¼šStarter å…¥é–€ç‰ˆ â†’ **å¹´ä»˜**

2. `/Users/cavlinyeung/ai-bank-parser/en/billing.html` âœ…
   - ä¿®å¤äº†ä»£ç é”™è¯¯
   - ç¡®è®¤æŒ‰é’®æ­£ç¡®è°ƒç”¨ createCheckoutSession

3. `/Users/cavlinyeung/ai-bank-parser/jp/billing.html` âœ…
   - å·²ç¡®è®¤ï¼šæœˆæ‰•ã„ã€å¹´æ‰•ã„

4. `/Users/cavlinyeung/ai-bank-parser/kr/billing.html` âœ…
   - å·²ç¡®è®¤ï¼šì›”ê°„ã€ì—°ê°„

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### å¿…é¡»å®Œæˆ ğŸ”´

1. **æ›´æ–° Firebase Functions**
   - æ–‡ä»¶ï¼š`firebase-functions/index.js`
   - æ›´æ–° Price ID ä¸ºæ–°çš„å¤šè´§å¸ä»·æ ¼
   - éƒ¨ç½²åˆ° Firebaseï¼š`firebase deploy --only functions`

2. **æµ‹è¯•æ”¯ä»˜æµç¨‹**
   - åœ¨æµ‹è¯•ç¯å¢ƒæµ‹è¯•æ‰€æœ‰4ä¸ªè¯­è¨€ç‰ˆæœ¬
   - ç¡®è®¤æ¯ä¸ªæŒ‰é’®éƒ½èƒ½æ­£ç¡®è·³è½¬
   - ç¡®è®¤ä»·æ ¼æ˜¾ç¤ºæ­£ç¡®

### å¯é€‰ä¼˜åŒ– ğŸ’¡

1. **æ·»åŠ è´§å¸é€‰æ‹©åŠŸèƒ½**
   - è®©ç”¨æˆ·å¯ä»¥é€‰æ‹©æ”¯ä»˜è´§å¸
   - æ ¹æ®ç”¨æˆ·åœ°åŒºè‡ªåŠ¨æ¨èè´§å¸

2. **æ·»åŠ ä»·æ ¼å¯¹æ¯”**
   - æ˜¾ç¤ºå¹´ä»˜ç›¸æ¯”æœˆä»˜çš„èŠ‚çœé‡‘é¢
   - çªå‡ºæ˜¾ç¤ºæœ€ä½³é€‰æ‹©

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥ Firebase Functions æ—¥å¿—
3. ç¡®è®¤ Stripe Dashboard ä¸­çš„ Price ID æ­£ç¡®
4. æµ‹è¯•ä¸åŒè´§å¸çš„æ”¯ä»˜æµç¨‹

---

**æŠ¥å‘Šå®Œæˆæ—¶é—´**: 2026-01-08  
**å‰ç«¯çŠ¶æ€**: âœ… å…¨éƒ¨å®Œæˆ  
**åç«¯çŠ¶æ€**: âš ï¸ éœ€è¦æ›´æ–° Firebase Functions

