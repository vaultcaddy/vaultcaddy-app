<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- èµ„æºé¢„è¿æ¥ - æ€§èƒ½ä¼˜åŒ– -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://www.gstatic.com">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">

    <meta charset="UTF-8">
    <!-- æ€§èƒ½ä¼˜åŒ–ï¼šå…³é”®CSSå†…è” -->
    <style>
        /* å…³é”®CSS - é¦–å±æ¸²æŸ“å¿…éœ€ */
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;line-height:1.6;color:#1f2937}
        .vaultcaddy-navbar{position:fixed;top:0;width:100%;background:#fff;box-shadow:0 2px 4px rgba(0,0,0,0.1);z-index:1000}
        .hero-section{min-height:100vh;display:flex;align-items:center;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff}
        .container{max-width:1200px;margin:0 auto;padding:0 1rem}
        .loading{opacity:0.5}
    </style>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" type="image/png" href="favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•è¶…é¢è®¡è´¹ï¼ˆé€šè¿‡å‘ç¥¨ï¼‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 2rem;
        }

        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: 4px;
        }

        .step {
            background: #f8f9fa;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .step h3 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 0.5rem;
            font-weight: bold;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .success {
            color: #28a745;
            font-weight: bold;
        }

        .error {
            color: #dc3545;
            font-weight: bold;
        }

        .button {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-block;
            text-decoration: none;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }

        .button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .button-danger {
            background: #dc3545;
        }

        .button-danger:hover {
            background: #c82333;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .timeline {
            position: relative;
            padding-left: 2rem;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 1rem;
            border-left: 2px solid #667eea;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .timeline-item::before {
            content: 'âœ“';
            position: absolute;
            left: -12px;
            top: 0;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .timeline-item.pending::before {
            content: 'â—‹';
            background: #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ æµ‹è¯•è¶…é¢è®¡è´¹ï¼ˆé€šè¿‡å‘ç¥¨ï¼‰</h1>
        
        <div class="warning">
            <strong>âš ï¸ é‡è¦ï¼š</strong> è¦æµ‹è¯•è¶…é¢è®¡è´¹ï¼Œå¿…é¡»è®© Stripe <strong>ç”Ÿæˆå‘ç¥¨</strong>ï¼
            <br>ä½¿ç”¨"ç«‹å³å–æ¶ˆ"ä¸ä¼šç”Ÿæˆå‘ç¥¨ï¼Œå› æ­¤æ— æ³•æµ‹è¯•è¶…é¢è®¡è´¹åŠŸèƒ½ã€‚
        </div>

        <div class="step">
            <h3><span class="step-number">1</span>å‡†å¤‡æµ‹è¯•æ•°æ®</h3>
            <p>åœ¨ Firestore ä¸­è®¾ç½®ç”¨æˆ·çš„è¶…é¢ä½¿ç”¨ï¼š</p>
            <div class="code-block">
users â†’ 1234@gmail.com â†’ æ›´æ–°å­—æ®µï¼š
{
  currentCredits: -50,
  credits: -50
}
            </div>
            <a href="https://console.firebase.google.com/project/vaultcaddy-production-cbbe2/firestore/data/~2Fusers~2F3bLhZuU9H0b3ExhwFCJuN4vZeGb2" 
               class="button" target="_blank">
                æ‰“å¼€ Firestore
            </a>
        </div>

        <div class="step">
            <h3><span class="step-number">2</span>æ–¹æ³• Aï¼šæœŸæœ«å–æ¶ˆè®¢é˜…ï¼ˆæ¨èï¼‰</h3>
            <p><strong class="success">âœ… è¿™ä¸ªæ–¹æ³•ä¼šç”Ÿæˆæœ€ç»ˆå‘ç¥¨ï¼</strong></p>
            
            <ol style="margin: 1rem 0; padding-left: 2rem;">
                <li>æ‰“å¼€ Stripe è®¢é˜…é¡µé¢</li>
                <li>ç‚¹å‡»ã€Œå–æ¶ˆè®¢é˜…ã€æˆ–ã€ŒCancel subscriptionã€</li>
                <li><strong>é€‰æ‹©ã€ŒæœŸæœ«å–æ¶ˆã€æˆ–ã€ŒCancel at period endã€</strong></li>
                <li>ç¡®è®¤å–æ¶ˆ</li>
            </ol>

            <a href="https://dashboard.stripe.com/test/subscriptions" 
               class="button" target="_blank">
                æ‰“å¼€ Stripe è®¢é˜…åˆ—è¡¨
            </a>

            <div class="info-box">
                <strong>å·¥ä½œæµç¨‹ï¼š</strong><br>
                1. è®¢é˜…ç»§ç»­åˆ°è®¡è´¹å‘¨æœŸç»“æŸ<br>
                2. Stripe åœ¨å‘¨æœŸç»“æŸæ—¶ç”Ÿæˆæœ€ç»ˆå‘ç¥¨<br>
                3. è§¦å‘ <code>invoice.created</code> webhook<br>
                4. æˆ‘ä»¬çš„ä»£ç æŠ¥å‘Šè¶…é¢ä½¿ç”¨<br>
                5. Stripe å°†è¶…é¢è´¹ç”¨æ·»åŠ åˆ°å‘ç¥¨<br>
                6. å‘ç¥¨æ”¯ä»˜å®Œæˆ
            </div>
        </div>

        <div class="step">
            <h3><span class="step-number">3</span>æ–¹æ³• Bï¼šæ‰‹åŠ¨åˆ›å»ºå‘ç¥¨ï¼ˆå³æ—¶æµ‹è¯•ï¼‰</h3>
            <p><strong class="success">âœ… è¿™ä¸ªæ–¹æ³•å¯ä»¥ç«‹å³æµ‹è¯•ï¼</strong></p>
            
            <ol style="margin: 1rem 0; padding-left: 2rem;">
                <li>æ‰“å¼€ Stripe Dashboard</li>
                <li>æ‰¾åˆ°æµ‹è¯•å®¢æˆ·ï¼ˆ1234@gmail.comï¼‰</li>
                <li>ç‚¹å‡»ã€Œåˆ›å»ºå‘ç¥¨ã€æˆ–ã€ŒCreate invoiceã€</li>
                <li>é€‰æ‹©å…³è”çš„è®¢é˜…</li>
                <li>ç‚¹å‡»ã€ŒReview invoiceã€</li>
                <li>Stripe ä¼šè‡ªåŠ¨åŒ…å«è¶…é¢è´¹ç”¨</li>
                <li>ç‚¹å‡»ã€ŒFinalize and sendã€</li>
            </ol>

            <a href="https://dashboard.stripe.com/test/customers" 
               class="button" target="_blank">
                æ‰“å¼€ Stripe å®¢æˆ·åˆ—è¡¨
            </a>
        </div>

        <div class="step">
            <h3><span class="step-number">4</span>æ–¹æ³• Cï¼šä½¿ç”¨ Stripe CLI è§¦å‘ webhook</h3>
            <p><strong>âš¡ æœ€å¿«çš„æµ‹è¯•æ–¹æ³•ï¼</strong></p>
            
            <div class="code-block">
# 1. å®‰è£… Stripe CLIï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
brew install stripe/stripe-cli/stripe

# 2. ç™»å½•
stripe login

# 3. è§¦å‘ invoice.created webhook
stripe trigger invoice.created

# 4. æŸ¥çœ‹ Firebase æ—¥å¿—
            </div>

            <a href="https://console.cloud.google.com/logs/query;query=resource.type%3D%22cloud_function%22%0Aresource.labels.function_name%3D%22stripeWebhook%22%0Ajsonpayload.message%3D~%22invoice.created%22?project=vaultcaddy-production-cbbe2" 
               class="button" target="_blank">
                æŸ¥çœ‹ Firebase æ—¥å¿—
            </a>
        </div>

        <div class="step">
            <h3><span class="step-number">5</span>é¢„æœŸçš„æ­£ç¡®æ—¥å¿—</h3>
            <p>å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ åº”è¯¥åœ¨ Firebase æ—¥å¿—ä¸­çœ‹åˆ°ï¼š</p>
            
            <div class="timeline">
                <div class="timeline-item">
                    <strong>ğŸ“ ç™¼ç¥¨å‰µå»º (æ¸¬è©¦æ¨¡å¼): in_xxxxx</strong>
                </div>
                <div class="timeline-item">
                    <strong>ğŸ” æŸ¥æ‰¾å®¢æˆ¶: cus_xxxxx</strong>
                </div>
                <div class="timeline-item">
                    <strong class="success">âœ… æ‰¾åˆ°ç”¨æˆ¶: 1234@gmail.com</strong>
                </div>
                <div class="timeline-item">
                    <strong>ğŸ“Š ç•¶å‰ Credits: -50</strong>
                </div>
                <div class="timeline-item">
                    <strong class="success">âš ï¸ æª¢æ¸¬åˆ°è¶…é¡ä½¿ç”¨: 50 Credits</strong>
                </div>
                <div class="timeline-item">
                    <strong>ğŸ“Š åŒ…å«é¡åº¦: 100, ç¸½ä½¿ç”¨é‡: 150</strong>
                </div>
                <div class="timeline-item">
                    <strong class="success">âœ… æˆåŠŸå ±å‘Šç¸½ä½¿ç”¨é‡çµ¦ Stripe: usr_xxxxx</strong>
                </div>
                <div class="timeline-item">
                    <strong class="success">ğŸ’µ é æœŸ Stripe æœƒåœ¨æ­¤ç™¼ç¥¨ä¸­æ”¶å–: HK$25.00</strong>
                </div>
            </div>
        </div>

        <div class="step">
            <h3><span class="step-number">6</span>éªŒè¯å‘ç¥¨</h3>
            <p>æœ€åï¼Œåœ¨ Stripe ä¸­éªŒè¯å‘ç¥¨åŒ…å«è¶…é¢è´¹ç”¨ï¼š</p>
            
            <div class="info-box">
                <strong>å‘ç¥¨åº”è¯¥åŒ…å«ï¼š</strong><br>
                â€¢ è®¢é˜…è´¹ç”¨ï¼šHK$58.00/æœˆ<br>
                â€¢ <strong>è¶…é¢ä½¿ç”¨ï¼šHK$25.00ï¼ˆ50 credits Ã— HK$0.50ï¼‰</strong><br>
                â€¢ <strong>æ€»è®¡ï¼šHK$83.00</strong>
            </div>

            <a href="https://dashboard.stripe.com/test/invoices" 
               class="button" target="_blank">
                æŸ¥çœ‹ Stripe å‘ç¥¨
            </a>
        </div>

        <div class="warning">
            <h3>ğŸ› å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ”¶è´¹ï¼Ÿ</h3>
            <p>è¯·æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
            <ol style="margin: 1rem 0; padding-left: 2rem;">
                <li><strong>ç”¨æˆ·æ•°æ®ï¼š</strong>ç¡®è®¤ Firestore ä¸­ credits = -50</li>
                <li><strong>è®¢é˜…ä¿¡æ¯ï¼š</strong>ç¡®è®¤ç”¨æˆ·æœ‰ meteredSubscriptionItemId</li>
                <li><strong>Webhook é…ç½®ï¼š</strong>ç¡®è®¤ invoice.created å·²æ·»åŠ å¹¶ä¿å­˜</li>
                <li><strong>æ—¥å¿—ï¼š</strong>æŸ¥çœ‹ Firebase æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯</li>
                <li><strong>å–æ¶ˆæ–¹å¼ï¼š</strong>ç¡®ä¿ä¸æ˜¯ä½¿ç”¨"ç«‹å³å–æ¶ˆ"</li>
            </ol>
        </div>
    </div>

    <script>
        console.log('ğŸ¯ è¶…é¢è®¡è´¹æµ‹è¯•å·¥å…·å·²åŠ è½½');
        console.log('ğŸ’¡ æç¤ºï¼šä½¿ç”¨ã€ŒæœŸæœ«å–æ¶ˆã€æˆ–ã€Œæ‰‹åŠ¨åˆ›å»ºå‘ç¥¨ã€æ¥æµ‹è¯•è¶…é¢è®¡è´¹åŠŸèƒ½');
    </script>
</body>
</html>

