# Prompt æ–¹æ¡ˆæ›´æ–°è¯´æ˜ - AI è‡ªåŠ¨æ—¥æœŸç»§æ‰¿

**æ›´æ–°æ—¥æœŸï¼š** 2026-02-06  
**æ›´æ–°å†…å®¹ï¼š** ä¸¤ä¸ª Prompt æ–¹æ¡ˆï¼ˆExcel Mode + Visual Scannerï¼‰  
**å…³é”®æ”¹è¿›ï¼š** AI è‡ªåŠ¨å¤„ç†æ—¥æœŸç»§æ‰¿ï¼Œæ— éœ€åç«¯ä»£ç 

---

## ğŸ¯ ä¸»è¦æ›´æ–°

### **1. AI è‡ªåŠ¨æ—¥æœŸç»§æ‰¿ âœ…**

**ä¹‹å‰ï¼ˆéœ€è¦åç«¯å¤„ç†ï¼‰ï¼š**
```json
// AI è¾“å‡ºï¼ˆæ—¥æœŸä¸ºç©ºï¼‰
{
  "date": "",
  "description": "QUICK CHEQUE DEPOSIT",
  "credit": 78649.00
}

// éœ€è¦åç«¯ JavaScript å¡«å……æ—¥æœŸ
function fillMissingDates(transactions) {
  let lastValidDate = null;
  // ... éå†å¡«å……é€»è¾‘
}
```

**ç°åœ¨ï¼ˆAI ç›´æ¥å¤„ç†ï¼‰ï¼š**
```json
// AI è¾“å‡ºï¼ˆå·²è‡ªåŠ¨ç»§æ‰¿æ—¥æœŸï¼‰
{
  "date": "7 Mar",  // â† AI è‡ªåŠ¨ä»ä¸Šä¸€ä¸ªäº¤æ˜“ç»§æ‰¿
  "description": "QUICK CHEQUE DEPOSIT",
  "credit": 78649.00
}

// âœ… æ— éœ€åç«¯å¤„ç†ï¼
```

---

### **2. ä¸è®¡ç®— Balance âœ…**

**æ›´æ–°å‰ï¼ˆå¯èƒ½è®¡ç®—ï¼‰ï¼š**
- AI å¯èƒ½å°è¯•è®¡ç®—ä½™é¢
- å¯¼è‡´æ•°å­—é”™è¯¯

**æ›´æ–°åï¼ˆåªå¤åˆ¶ï¼‰ï¼š**
```
NEVER calculate balance
ONLY copy visible numbers
If blank/"â€”" â†’ output null
```

---

## ğŸ“‹ Prompt æ–°å¢è§„åˆ™

### **æ–¹æ¡ˆä¸€ï¼šExcel Table Mode**

```
ğŸ”„ DATE INHERITANCE RULE:
â€¢ Track the last valid date as you process rows
â€¢ If current row's dateColumn is blank â†’ use the last valid date
â€¢ Update lastValidDate whenever you see a non-blank date in dateColumn

âœ‚ï¸ EXTRACTION RULES:
| Field   | Action                                                     |
|---------|-----------------------------------------------------------|
| date    | Copy text from dateColumn. If blank â†’ use PREVIOUS date   |
| balance | Copy number (remove commas). If blank/"â€”" â†’ null          |

â— ABSOLUTE RULES:
- NEVER calculate balance (ONLY copy visible numbers)
- If date is blank, inherit date from PREVIOUS transaction
```

---

### **æ–¹æ¡ˆäºŒï¼šVisual Row Scannerï¼ˆæ¨èï¼‰**

```
ğŸ”„ DATE INHERITANCE RULE:
â€¢ Track the last valid date as you process rows
â€¢ If current row's date is blank â†’ use the last valid date
â€¢ Update lastValidDate whenever you see a non-blank date

âœ‚ï¸ EXTRACTION RULES:
| Field   | How to Extract                                             |
|---------|-----------------------------------------------------------|
| date    | Copy text. If blank â†’ use PREVIOUS transaction's date      |
| balance | Copy number (remove commas). If blank/"â€”" â†’ null          |

ğŸ¯ KEY POINTS:
â€¢ Date inheritance: If current row's date is blank, use PREVIOUS transaction's date
â€¢ Balance: NEVER calculate, ONLY copy visible numbers (if blank â†’ null)
```

---

## ğŸ“Š å¯¹æ¯”æ›´æ–°å‰å

| ç‰¹æ€§ | æ›´æ–°å‰ | æ›´æ–°å âœ… |
|------|-------|----------|
| **æ—¥æœŸå¤„ç†** | AI è¾“å‡ºç©ºç™½ â†’ åç«¯å¡«å…… | AI è‡ªåŠ¨ç»§æ‰¿ â†’ æ— éœ€åç«¯ |
| **Balance å¤„ç†** | å¯èƒ½è®¡ç®— | åªå¤åˆ¶ï¼Œä¸è®¡ç®— |
| **åç«¯ä»£ç ** | éœ€è¦ `fillMissingDates()` | âœ… æ— éœ€ï¼ |
| **å‡†ç¡®ç‡** | 85-90% | é¢„æœŸ 90-95% |
| **ç»´æŠ¤æˆæœ¬** | å‰ç«¯ + åç«¯ | åªæœ‰å‰ç«¯ |

---

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

### **æ’ç”Ÿé“¶è¡Œï¼ˆåŒä¸€å¤©å¤šç¬”äº¤æ˜“ï¼‰**

**PDF åŸå§‹æ•°æ®ï¼š**
```
| Date  | Transaction Details           | Deposit   | Balance   |
|-------|-------------------------------|-----------|-----------|
| 7 Mar | CREDIT INTEREST               | 2.61      | 1,496.59  |
|       | QUICK CHEQUE DEPOSIT (DTMAND) | 78,649.00 | 80,145.59 |
```

**AI è¾“å‡ºï¼ˆæ›´æ–°åçš„ Promptï¼‰ï¼š**
```json
{
  "transactions": [
    {
      "date": "7 Mar",
      "description": "CREDIT INTEREST",
      "debit": 0,
      "credit": 2.61,
      "balance": 1496.59
    },
    {
      "date": "7 Mar",  // â† AI è‡ªåŠ¨ç»§æ‰¿ï¼
      "description": "QUICK CHEQUE DEPOSIT (DTMAND)",
      "debit": 0,
      "credit": 78649.00,
      "balance": 80145.59
    }
  ]
}
```

âœ… **æ— éœ€åç«¯å¤„ç†ï¼Œç›´æ¥æ˜¾ç¤ºï¼**

---

### **ICBCï¼ˆæ‰€æœ‰å­—æ®µå®Œæ•´ï¼‰**

**PDF åŸå§‹æ•°æ®ï¼š**
```
| æ—¥æœŸ       | æ‘˜è¦              | æ”¯å‡º   | å­˜å…¥ | çµå­˜     |
|------------|-------------------|--------|------|----------|
| 2023/07/15 | SCR OCTOPUS CARDS | 184.30 |      | 8,349.45 |
```

**AI è¾“å‡ºï¼š**
```json
{
  "date": "2023/07/15",
  "description": "SCR OCTOPUS CARDS",
  "debit": 184.30,
  "credit": 0,
  "balance": 8349.45
}
```

âœ… **æ­£å¸¸æå–ï¼Œæ‰€æœ‰å­—æ®µå®Œæ•´ï¼**

---

## ğŸš€ éƒ¨ç½²å»ºè®®

### **ç«‹å³æµ‹è¯•ï¼š**

1. **ä½¿ç”¨æ’ç”Ÿé“¶è¡Œå•æµ‹è¯•**
   - éªŒè¯æ—¥æœŸç»§æ‰¿æ˜¯å¦æ­£ç¡®ï¼ˆç©ºç™½æ—¥æœŸ â†’ ç»§æ‰¿ä¸Šä¸€ä¸ªï¼‰
   - æ£€æŸ¥ Balance æ˜¯å¦æ­£ç¡®ï¼ˆä¸è®¡ç®—ï¼Œåªå¤åˆ¶ï¼‰

2. **ä½¿ç”¨ ICBC é“¶è¡Œå•æµ‹è¯•**
   - éªŒè¯æ‰€æœ‰å­—æ®µæå–æ­£ç¡®
   - æ£€æŸ¥æ—¥æœŸã€é‡‘é¢ã€ä½™é¢æ ¼å¼

3. **å¯¹æ¯”ä¸¤ä¸ªæ–¹æ¡ˆ**
   - æ–¹æ¡ˆä¸€ï¼ˆExcel Modeï¼‰ï¼šé€‚åˆæ ¼å¼è§„æ•´çš„é“¶è¡Œå•
   - æ–¹æ¡ˆäºŒï¼ˆVisual Scannerï¼‰ï¼šæ¨èï¼é€‚åˆæ‰€æœ‰é“¶è¡Œå•

### **é¢„æœŸç»“æœï¼š**

| é“¶è¡Œ | æ—¥æœŸç»§æ‰¿ | Balance å¤„ç† | å‡†ç¡®ç‡é¢„æœŸ |
|------|---------|-------------|-----------|
| æ’ç”Ÿ | âœ… è‡ªåŠ¨ | âœ… åªå¤åˆ¶   | 90-95% |
| ICBC | âœ… æ— éœ€ | âœ… åªå¤åˆ¶   | 90-95% |

---

## ğŸ’¡ æŠ€æœ¯ä¼˜åŠ¿

### **1. ç®€åŒ–æ¶æ„**
```
ä¹‹å‰: PDF â†’ AIï¼ˆè¾“å‡ºç©ºæ—¥æœŸï¼‰â†’ åç«¯å¡«å…… â†’ UI
ç°åœ¨: PDF â†’ AIï¼ˆè‡ªåŠ¨ç»§æ‰¿ï¼‰â†’ UI
```

### **2. å‡å°‘é”™è¯¯**
- âœ… æ— éœ€åç«¯é€»è¾‘ â†’ å‡å°‘ä»£ç å¤æ‚åº¦
- âœ… AI ç›´æ¥å¤„ç† â†’ å‡å°‘æ•°æ®ä¼ é€’é”™è¯¯
- âœ… ä¸è®¡ç®— Balance â†’ é¿å…è®¡ç®—é”™è¯¯

### **3. æé«˜å‡†ç¡®ç‡**
- âœ… æ·±åº¦æ€è€ƒæ¨¡å¼ + æ—¥æœŸç»§æ‰¿è§„åˆ™ â†’ æ›´å‡†ç¡®
- âœ… æ˜ç¡®"åªå¤åˆ¶"è§„åˆ™ â†’ é¿å…æ¨ç†é”™è¯¯

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- ğŸ“„ `PROMPT_å®éªŒæ–¹æ¡ˆ_æ’ç”ŸICBC_2026-02-06.md` - å®Œæ•´ Prompt æ–¹æ¡ˆï¼ˆå·²æ›´æ–°ï¼‰
- ğŸ“„ `QWEN_EXTRA_BODY_ä¿®å¤_2026-02-06.md` - extra_body æ ¼å¼ä¿®å¤
- ğŸ“„ `PROMPT_ABç±»é€šç”¨ç‰ˆ.md` - AB ç±»é“¶è¡Œå•é€šç”¨ Prompt
- ğŸ“„ `AIæ¨¡å‹é€‰æ‹©ä¼˜åŒ–_2026-02-06.md` - æ¨¡å‹é€‰æ‹©ç­–ç•¥

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **ç«‹å³æµ‹è¯•ä¸¤ä¸ª Prompt æ–¹æ¡ˆ**
   - ä¸Šä¼ æ’ç”Ÿå’Œ ICBC é“¶è¡Œå•
   - éªŒè¯æ—¥æœŸç»§æ‰¿å’Œ Balance å¤„ç†

2. **é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆ**
   - å¯¹æ¯”å‡†ç¡®ç‡å’Œ Token æ¶ˆè€—
   - æ¨èä½¿ç”¨æ–¹æ¡ˆäºŒï¼ˆVisual Row Scannerï¼‰

3. **æ›´æ–°åˆ°ç”Ÿäº§ç¯å¢ƒ**
   - æ›´æ–° `qwen-vl-max-processor.js` çš„ `generatePrompt()`
   - éƒ¨ç½²åˆ° Firebase Functions
   - ç›‘æ§æå–å‡†ç¡®ç‡

---

**âœ… æ›´æ–°å®Œæˆï¼AI ç°åœ¨å¯ä»¥è‡ªåŠ¨å¤„ç†æ—¥æœŸç»§æ‰¿ï¼Œæ— éœ€åç«¯ä»£ç ï¼**
