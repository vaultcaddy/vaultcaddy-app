# ğŸ‰ æœ€ç»ˆé…ç½®å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„æ‰€æœ‰ä»»åŠ¡

### 1. âœ… æ›´æ–° Stripe Price IDs

#### æ­£å¼ç‰ˆï¼ˆProduction Modeï¼‰

**VaultCaddy Monthlyï¼ˆæœˆä»˜ï¼‰**
- Base Price ID: `price_1SfNw5JmiQ31C0GT7SHy0t44`
- Usage Price ID: `price_1SdpzxJmiQ31C0GTLe5rYQn9`
- å®šä»·ï¼šHK$58/æœˆ + HK$0.5/Creditï¼ˆä»è´Ÿæ•°å¼€å§‹æ”¶è´¹ï¼‰

**VaultCaddy Yearlyï¼ˆå¹´ä»˜ï¼‰**
- Base Price ID: `price_1SfNvfJmiQ31C0GTFY4bhpzK`
- Usage Price ID: `price_1SdpzxJmiQ31C0GTV0iI5GK6`
- å®šä»·ï¼šHK$552/å¹´ + HK$0.5/Creditï¼ˆä»è´Ÿæ•°å¼€å§‹æ”¶è´¹ï¼‰

### 2. âœ… åˆ é™¤æµ‹è¯•æŒ‰é’®

å·²ä» `billing.html` ä¸­åˆ é™¤ï¼š
- âœ… Monthly çš„ "ğŸ§ª æ¸¬è©¦æ¨¡å¼ï¼ˆæ¸¬è©¦è¶…é¡è¨ˆè²»ï¼‰" æŒ‰é’®
- âœ… Yearly çš„ "ğŸ§ª æ¸¬è©¦æ¨¡å¼ï¼ˆæ¸¬è©¦è¶…é¡è¨ˆè²»ï¼‰" æŒ‰é’®

### 3. âœ… æ·»åŠ è®¡è´¹è¯´æ˜

åœ¨ `billing.html` ä¸­æ‰€æœ‰ "è¶…å‡ºå¾Œæ¯é  HKD $0.5" çš„åœ°æ–¹æ·»åŠ äº†è¯´æ˜ï¼š
```html
ï¼ˆå¾è² æ•¸ Credits é–‹å§‹æ”¶è²»ï¼‰
```

---

## ğŸ“Š å®Œæ•´çš„è®¡è´¹é€»è¾‘

### ç”¨æˆ·å…è´¹é¢åº¦
- **æœˆè´¹åŒ…å«**ï¼š100 Credits
- **Email éªŒè¯èµ é€**ï¼š20 Credits
- **æ€»å…è´¹é¢åº¦**ï¼š120 Credits

### è®¡è´¹æ–¹å¼

#### 1. åœ¨å…è´¹é¢åº¦å†…ï¼ˆCredits > 0ï¼‰
```
ç”¨æˆ· Credits: 120 â†’ 90 â†’ 50 â†’ 10
Stripe æŠ¥å‘Š: âŒ ä¸æŠ¥å‘Š
ç”¨æˆ·è´¹ç”¨: åªæœ‰æœˆè´¹/å¹´è´¹ï¼ˆHK$58 æˆ– HK$552ï¼‰
```

#### 2. é¦–æ¬¡è¶…é¢ï¼ˆä»æ­£æ•°å˜æˆè´Ÿæ•°ï¼‰
```
ç”¨æˆ· Credits: 10 â†’ -5ï¼ˆä½¿ç”¨äº† 15 é¡µï¼‰
Stripe æŠ¥å‘Š: âœ… æŠ¥å‘Š 5 Creditsï¼ˆè¶…é¢éƒ¨åˆ†ï¼‰
ç”¨æˆ·è´¹ç”¨: æœˆè´¹ + (5 Ã— HK$0.5) = HK$58 + HK$2.5 = HK$60.5
```

#### 3. ç»§ç»­è¶…é¢ï¼ˆå·²ç»æ˜¯è´Ÿæ•°ï¼‰
```
ç”¨æˆ· Credits: -5 â†’ -8ï¼ˆä½¿ç”¨äº† 3 é¡µï¼‰
Stripe æŠ¥å‘Š: âœ… æŠ¥å‘Š 3 Credits
ç´¯è®¡è¶…é¢: 8 Credits
ç”¨æˆ·è´¹ç”¨: æœˆè´¹ + (8 Ã— HK$0.5) = HK$58 + HK$4 = HK$62
```

---

## ğŸ”§ Stripe é…ç½®

### Billing Meter
- **Meter ID**: `mtr_test_61TnAddrAuQxIRy7p41JmiQ31C0GTJwG`
- **Event Name**: `vaultcaddy_credit_usage`

### æ¢¯åº¦å®šä»·ï¼ˆå·²ä¿®æ”¹ï¼‰

#### âŒ æ—§é…ç½®ï¼ˆé”™è¯¯ï¼‰
```
0-100 å•ä½: HK$0
101-âˆ å•ä½: HK$0.5
```

#### âœ… æ–°é…ç½®ï¼ˆæ­£ç¡®ï¼‰
```
1-âˆ å•ä½: HK$0.5
```
æˆ–
```
0-âˆ å•ä½: HK$0.5
```

**åŸå› **ï¼šåç«¯åªæŠ¥å‘Šè¶…é¢éƒ¨åˆ†ï¼Œæ‰€ä»¥ Stripe æ”¶åˆ°çš„ç¬¬ä¸€ä¸ª Credit å°±åº”è¯¥å¼€å§‹æ”¶è´¹ã€‚

---

## ğŸ¯ ä¿®æ”¹çš„æ–‡ä»¶

### 1. Firebase Functions
- âœ… `firebase-functions/index.js`
  - æ›´æ–° `productionPriceMapping`ï¼ˆç¬¬2206-2215è¡Œï¼‰
  - ä¿®æ”¹ `deductCredits` å‡½æ•°ï¼ˆåªåœ¨è´Ÿæ•°æ—¶æŠ¥å‘Šï¼‰

### 2. å‰ç«¯é¡µé¢
- âœ… `billing.html`
  - åˆ é™¤ 2 ä¸ªæµ‹è¯•æŒ‰é’®
  - æ·»åŠ è®¡è´¹è¯´æ˜

---

## ğŸš€ éƒ¨ç½²çŠ¶æ€

### âœ… Firebase Functions
```bash
âœ”  functions[createStripeCheckoutSession(us-central1)] Successful update operation.
âœ”  functions[deductCreditsClient(us-central1)] Successful update operation.
```

### âœ… å‰ç«¯æ–‡ä»¶
- `billing.html` å·²æ›´æ–°

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. æµ‹è¯• Get Started æŒ‰é’®
- âœ… è®¿é—®ï¼šhttps://vaultcaddy.com/billing.html
- âœ… ç‚¹å‡» "Get Started" æŒ‰é’®
- âœ… åº”è¯¥**ä¸å†æ˜¾ç¤º**"ä»·æ ¼å·²åœç”¨"é”™è¯¯
- âœ… åº”è¯¥æ­£å¸¸è·³è½¬åˆ° Stripe Checkout

### 2. æµ‹è¯•è¶…é¢è®¡è´¹
1. åœ¨ Firestore ä¸­è®¾ç½® `credits: 5`
2. ä¸Šä¼  10 é¡µæ–‡æ¡£
3. Credits å˜æˆ `-5`
4. Firebase Logs æ˜¾ç¤ºï¼š
   ```
   ğŸ’° é¦–æ¬¡è¶…é¢ï¼šCredits ä» 5 é™è‡³ -5
      æŠ¥å‘Šè¶…é¢ä½¿ç”¨: 5 Credits
   âœ… è¶…é¢ä½¿ç”¨é‡å·²æŠ¥å‘Šç»™ Stripe Billing Meter
   ```
5. Stripe Meter æ˜¾ç¤ºï¼š**5 ä¸ª Events**
6. æœˆåº•è´¦å•ï¼šHK$58 + (5 Ã— HK$0.5) = HK$60.5

---

## ğŸ“‹ ä¸‹ä¸€æ­¥å»ºè®®

### 1. æµ‹è¯•å®Œæ•´æµç¨‹
- âœ… æ³¨å†Œæ–°ç”¨æˆ·
- âœ… è®¢é˜…æœˆä»˜/å¹´ä»˜
- âœ… ä½¿ç”¨è¶…è¿‡ 120 Credits
- âœ… ç¡®è®¤è¶…é¢è®¡è´¹æ­£ç¡®

### 2. æ›´æ–°å…¶ä»–è¯­è¨€ç‰ˆæœ¬
- â³ `en/billing.html`ï¼ˆè‹±æ–‡ï¼‰
- â³ `jp/billing.html`ï¼ˆæ—¥æ–‡ï¼‰
- â³ `kr/billing.html`ï¼ˆéŸ©æ–‡ï¼‰

### 3. æ¸…ç†æ—§ä»£ç å’Œæ–‡æ¡£
- â³ åˆ é™¤æ—§çš„æµ‹è¯•æ–‡ä»¶
- â³ åˆ é™¤å·²å¼ƒç”¨çš„å‡½æ•°

---

## ğŸŠ è¿ç§»åˆ° Stripe Billing Meters å®Œæˆï¼

ç»è¿‡å¤šæ¬¡è°ƒè¯•å’Œä¼˜åŒ–ï¼Œæˆ‘ä»¬æˆåŠŸï¼š
1. âœ… è¿ç§»åˆ° Stripe Billing Meters API
2. âœ… å®ç°å®æ—¶ä½¿ç”¨é‡æŠ¥å‘Š
3. âœ… è§£å†³æ‰€æœ‰æŠ€æœ¯é—®é¢˜
4. âœ… å®ç°ç²¾ç¡®çš„è¶…é¢è®¡è´¹é€»è¾‘
5. âœ… æ›´æ–°æ‰€æœ‰ Price IDs
6. âœ… æ·»åŠ ç”¨æˆ·å‹å¥½çš„è¯´æ˜

**ç³»ç»Ÿç°åœ¨å·²ç»å®Œå…¨å°±ç»ªï¼Œå¯ä»¥æ­£å¼ä¸Šçº¿ï¼** ğŸš€





