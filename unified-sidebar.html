<!-- âœ… çµ±ä¸€å·¦å´æ¬„ - Dashboard/FirstProject/Account/Billing å…±ç”¨ -->
<aside id="unified-sidebar" style="width: 280px; background: #ffffff; border-right: 1px solid #e5e7eb; padding: 1.5rem; padding-top: calc(1.5rem + 10pt); position: fixed; left: 0; top: 60px; height: calc(100vh - 60px); overflow-y: auto; z-index: 100; display: flex; flex-direction: column;">
    
    <!-- æœç´¢æ¬„ -->
    <div style="margin-bottom: 1.5rem;">
        <input type="text" id="sidebar-project-search" placeholder="ç¯©é¸æ–‡æª”åç¨±..." style="width: 100%; padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 0.875rem; color: #6b7280; outline: none; transition: border 0.2s;" onfocus="this.style.borderColor='#2563eb'" onblur="this.style.borderColor='#e5e7eb'">
    </div>
    
    <!-- Project å€å¡Š -->
    <div style="flex: 1; margin-bottom: 1.5rem;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.75rem;">
            <span style="font-size: 0.875rem; font-weight: 500; color: #6b7280;">project</span>
            <button onclick="if(window.openCreateProjectModal) window.openCreateProjectModal()" style="background: none; border: none; color: #6b7280; cursor: pointer; font-size: 1.25rem; padding: 0; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;">+</button>
        </div>
        <div id="sidebar-projects-list">
            <!-- é …ç›®åˆ—è¡¨å°‡å‹•æ…‹è¼‰å…¥ -->
            <div style="padding: 2rem 1rem; text-align: center; color: #9ca3af;">
                <i class="fas fa-folder-open" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
                <div style="font-size: 0.875rem;">è¼‰å…¥ä¸­...</div>
            </div>
        </div>
    </div>
    
    <!-- é…ç½®å€å¡Š (åº•éƒ¨) -->
    <div style="border-top: 1px solid #e5e7eb; padding-top: 1rem;">
        <h3 style="font-size: 0.75rem; font-weight: 600; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.05em; margin: 0 0 0.75rem 0;">é…ç½®</h3>
        <div onclick="window.location.href='/account.html'" id="sidebar-link-account" class="sidebar-nav-link" style="display: flex; align-items: center; padding: 0.5rem; color: #6b7280; cursor: pointer; border-radius: 4px; transition: background 0.2s; margin-bottom: 0.25rem;" onmouseover="this.style.background='#f3f4f6'" onmouseout="if(!this.classList.contains('active')) this.style.background='transparent'">
            <i class="fas fa-user" style="margin-right: 0.5rem; font-size: 1rem; width: 20px;"></i>
            <span style="font-size: 0.875rem;">å¸³æˆ¶</span>
        </div>
        <div onclick="window.location.href='/billing.html'" id="sidebar-link-billing" class="sidebar-nav-link" style="display: flex; align-items: center; padding: 0.5rem; color: #6b7280; cursor: pointer; border-radius: 4px; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="if(!this.classList.contains('active')) this.style.background='transparent'">
            <i class="fas fa-credit-card" style="margin-right: 0.5rem; font-size: 1rem; width: 20px;"></i>
            <span style="font-size: 0.875rem;">è¨ˆè²»</span>
        </div>
    </div>
</aside>

<script>
    (function() {
        'use strict';
        
        console.log('ğŸ”µ unified-sidebar.html loaded (simple design)');
        
        // è¼‰å…¥é …ç›®åˆ—è¡¨
        async function loadProjects() {
            try {
                if (window.simpleDataManager && window.simpleDataManager.initialized) {
                    const projects = await window.simpleDataManager.getProjects();
                    const projectsList = document.getElementById('sidebar-projects-list');
                    
                    if (!projectsList) return;
                    
                    if (projects && projects.length > 0) {
                        const urlParams = new URLSearchParams(window.location.search);
                        const currentProjectId = urlParams.get('project');
                        
                        projectsList.innerHTML = projects.map(project => {
                            const isActive = currentProjectId === project.id;
                            return `
                                <div class="project-item sidebar-project-item" onclick="window.location.href='/firstproject.html?project=${project.id}'" data-project-name="${project.name}" style="display: flex; align-items: center; padding: 0.5rem; color: ${isActive ? '#2563eb' : '#6b7280'}; cursor: pointer; border-radius: 4px; transition: background 0.2s; margin-bottom: 0.25rem; ${isActive ? 'background: #eff6ff; border-left: 3px solid #2563eb; margin-left: -1.5rem; padding-left: calc(0.5rem + 1.5rem - 3px);' : ''}">
                                    <i class="fas fa-folder" style="margin-right: 0.5rem; font-size: 1rem;"></i>
                                    <span class="project-name" style="font-size: 0.875rem;">${project.name}</span>
                                </div>
                            `;
                        }).join('');
                        
                        console.log('âœ… é …ç›®åˆ—è¡¨å·²è¼‰å…¥:', projects.length);
                    } else {
                        projectsList.innerHTML = `
                            <div style="padding: 2rem 1rem; text-align: center; color: #9ca3af;">
                                <i class="fas fa-folder-open" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
                                <div style="font-size: 0.875rem;">æ²’æœ‰é …ç›®</div>
                            </div>
                        `;
                    }
                } else {
                    console.warn('âš ï¸ SimpleDataManager æœªåˆå§‹åŒ–');
                }
            } catch (error) {
                console.error('âŒ è¼‰å…¥é …ç›®åˆ—è¡¨å¤±æ•—:', error);
            }
        }
        
        // æœç´¢åŠŸèƒ½
        const searchInput = document.getElementById('sidebar-project-search');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase().trim();
                const projectItems = document.querySelectorAll('.sidebar-project-item');
                
                projectItems.forEach(item => {
                    const projectName = item.getAttribute('data-project-name').toLowerCase();
                    if (searchTerm === '' || projectName.includes(searchTerm)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        }
        
        // é«˜äº®ç•¶å‰é é¢
        function highlightCurrentPage() {
            const currentPath = window.location.pathname;
            const isAccountPage = currentPath.includes('account.html');
            const isBillingPage = currentPath.includes('billing.html');
            
            const accountLink = document.getElementById('sidebar-link-account');
            const billingLink = document.getElementById('sidebar-link-billing');
            
            if (isAccountPage && accountLink) {
                accountLink.classList.add('active');
                accountLink.style.background = '#eff6ff';
                accountLink.style.borderLeft = '3px solid #2563eb';
                accountLink.style.marginLeft = '-1.5rem';
                accountLink.style.paddingLeft = 'calc(0.5rem + 1.5rem - 3px)';
                accountLink.style.color = '#2563eb';
                accountLink.querySelector('i').style.color = '#2563eb';
            }
            
            if (isBillingPage && billingLink) {
                billingLink.classList.add('active');
                billingLink.style.background = '#eff6ff';
                billingLink.style.borderLeft = '3px solid #2563eb';
                billingLink.style.marginLeft = '-1.5rem';
                billingLink.style.paddingLeft = 'calc(0.5rem + 1.5rem - 3px)';
                billingLink.style.color = '#2563eb';
                billingLink.querySelector('i').style.color = '#2563eb';
            }
        }
        
        // åˆå§‹åŒ–
        async function init() {
            // ç­‰å¾… SimpleDataManager å°±ç·’
            let attempts = 0;
            const maxAttempts = 50; // 5 ç§’
            
            while (attempts < maxAttempts) {
                if (window.simpleDataManager && window.simpleDataManager.initialized) {
                    console.log('âœ… SimpleDataManager å·²å°±ç·’');
                    await loadProjects();
                    highlightCurrentPage();
                    
                    // ç›£è½é …ç›®è®ŠåŒ–
                    window.addEventListener('projectCreated', loadProjects);
                    window.addEventListener('projectDeleted', loadProjects);
                    
                    break;
                }
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
            }
            
            if (attempts >= maxAttempts) {
                console.warn('âš ï¸ SimpleDataManager åˆå§‹åŒ–è¶…æ™‚');
            }
        }
        
        // è§¸ç™¼å´é‚Šæ¬„è¼‰å…¥äº‹ä»¶
        window.dispatchEvent(new Event('sidebar-loaded'));
        
        // DOM è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
        
        console.log('âœ… Simple sidebar initialized');
        
    })();
</script>
