# ğŸ”´ æ§åˆ¶å°é”™è¯¯ - å®Œæ•´è§£å†³æ–¹æ¡ˆ

**åˆ†ææ—¥æœŸ**: 2026-01-02  
**é”™è¯¯æ¥æº**: document-detail é¡µé¢

---

## ğŸ“Š é”™è¯¯æ€»ç»“

ä»æ‚¨çš„æˆªå›¾ä¸­å‘ç° **4 ç±»ä¸»è¦é”™è¯¯**ï¼š

| é”™è¯¯ç±»å‹ | ä¸¥é‡ç¨‹åº¦ | çŠ¶æ€ | å½±å“ |
|---------|---------|------|------|
| Firebase æƒé™é”™è¯¯ | ğŸ”´ é«˜ | â³ å¾…ä¿®å¤ | æ ¸å¿ƒåŠŸèƒ½æ— æ³•ä½¿ç”¨ |
| SyntaxError: BannerClicks | ğŸ”´ é«˜ | ğŸ” éœ€æ’æŸ¥ | å¯èƒ½å¯¼è‡´é¡µé¢å´©æºƒ |
| dataLayer.push é”™è¯¯ | ğŸŸ¡ ä¸­ | âœ… å·²ä¿®å¤ | Analytics å¤±æ•ˆ |
| 404 èµ„æºé”™è¯¯ | ğŸŸ¡ ä¸­ | ğŸ” éœ€æ’æŸ¥ | å¯¼å‡ºåŠŸèƒ½å¯èƒ½å—å½±å“ |

---

## ğŸ”¥ é—®é¢˜ 1: Firebase æƒé™é”™è¯¯ï¼ˆæœ€ä¸¥é‡ï¼ï¼‰

### é”™è¯¯ä¿¡æ¯
```
FirebaseError: Missing or insufficient permissions
```

### ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé”™è¯¯ï¼Ÿ

**åŸå› **:
- Firestore å®‰å…¨è§„åˆ™é˜»æ­¢äº†æ•°æ®è®¿é—®
- å½“å‰ç”¨æˆ·æ— æƒè¯»å–/å†™å…¥é¡¹ç›®å’Œæ–‡æ¡£æ•°æ®

**è¡¨ç°**:
- é¡µé¢æ— æ³•åŠ è½½æ–‡æ¡£åˆ—è¡¨
- æ— æ³•æŸ¥çœ‹æ–‡æ¡£è¯¦æƒ…
- ä¿å­˜æ“ä½œå¤±è´¥

### âœ… è§£å†³æ–¹æ¡ˆ

#### æ­¥éª¤ 1: ç™»å½• Firebase Console
1. è®¿é—®: https://console.firebase.google.com/
2. é€‰æ‹©é¡¹ç›®: **vaultcaddy-production-cbbe2**

#### æ­¥éª¤ 2: ä¿®æ”¹ Firestore è§„åˆ™
1. å·¦ä¾§èœå• â†’ **Firestore Database**
2. é¡¶éƒ¨æ ‡ç­¾ â†’ **è§„åˆ™ (Rules)**

#### æ­¥éª¤ 3: æ›´æ–°å®‰å…¨è§„åˆ™

**å¤åˆ¶ä»¥ä¸‹è§„åˆ™å¹¶æ›¿æ¢ç°æœ‰å†…å®¹**:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ===== ç”¨æˆ·æ•°æ®ç»“æ„ =====
    match /users/{userId} {
      // ç”¨æˆ·å¯ä»¥è¯»å†™è‡ªå·±çš„åŸºæœ¬ä¿¡æ¯
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // ç”¨æˆ·çš„é¡¹ç›®
      match /projects/{projectId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
        
        // é¡¹ç›®ä¸­çš„æ–‡æ¡£
        match /documents/{documentId} {
          allow read, write: if request.auth != null && request.auth.uid == userId;
        }
      }
    }
    
    // ===== é¡¶å±‚ Projects é›†åˆï¼ˆå¦‚æœä½¿ç”¨ï¼‰=====
    match /projects/{projectId} {
      // æ‰€æœ‰è®¤è¯ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®ï¼ˆæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ï¼‰
      allow read, write: if request.auth != null;
      
      match /documents/{documentId} {
        allow read, write: if request.auth != null;
      }
    }
  }
}
```

#### æ­¥éª¤ 4: å‘å¸ƒè§„åˆ™
- ç‚¹å‡»å³ä¸Šè§’è“è‰² **"å‘å¸ƒ"** æŒ‰é’®
- ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆé€šå¸¸ < 10 ç§’ï¼‰

#### æ­¥éª¤ 5: éªŒè¯
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
2. åˆ·æ–° document-detail é¡µé¢
3. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦è¿˜æœ‰ Firebase æƒé™é”™è¯¯

---

## âš ï¸ é—®é¢˜ 2: SyntaxError - BannerClicks

### é”™è¯¯ä¿¡æ¯
```
Uncaught SyntaxError: Unexpected identifier 'BannerClicks'
at gtag (document-detail.html)
```

### å¯èƒ½åŸå› 

1. **Google Analytics äº‹ä»¶é…ç½®é”™è¯¯**
2. **ga-event-tracking.js æ–‡ä»¶è¯­æ³•é”™è¯¯**
3. **å­—ç¬¦ä¸²æœªæ­£ç¡®å¼•ç”¨**

### ğŸ” æ’æŸ¥æ­¥éª¤

#### 1. æ£€æŸ¥ ga-event-tracking.js

éœ€è¦æŸ¥æ‰¾ `BannerClicks` ç›¸å…³ä»£ç ï¼Œå¯èƒ½çš„é”™è¯¯æ¨¡å¼ï¼š

```javascript
// âŒ é”™è¯¯ç¤ºä¾‹ 1: ç¼ºå°‘å¼•å·
gtag('event', BannerClicks, { ... });

// âœ… æ­£ç¡®å†™æ³•
gtag('event', 'BannerClicks', { ... });

// âŒ é”™è¯¯ç¤ºä¾‹ 2: å¯¹è±¡å±æ€§æœªå¼•ç”¨
const events = {
    BannerClicks: 'banner_click'  // å¯èƒ½ç¼ºå°‘å¼•å·
};

// âœ… æ­£ç¡®å†™æ³•
const events = {
    'BannerClicks': 'banner_click'
};
```

#### 2. ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

å¦‚æœä¸æ€¥éœ€ Analytics åŠŸèƒ½ï¼Œå¯ä»¥æš‚æ—¶æ³¨é‡Šæ‰ç›¸å…³ä»£ç ï¼š

```javascript
// åœ¨ document-detail.html ä¸­æ³¨é‡Šæ‰
// <script src="/ga-event-tracking.js"></script>
```

---

## ğŸ“ é—®é¢˜ 3: 404 èµ„æºåŠ è½½é”™è¯¯

### é”™è¯¯ä¿¡æ¯
```
Failed to load resources: 404 (Not Found)
- bank-statement-export.js
- invoice-export.js
```

### æ£€æŸ¥ç»“æœ
âœ… æ–‡ä»¶å­˜åœ¨äºæ ¹ç›®å½•
âš ï¸  å¯èƒ½æ˜¯è·¯å¾„å¼•ç”¨é—®é¢˜

### ğŸ” æ’æŸ¥æ–¹æ¡ˆ

#### æ–¹æ¡ˆ 1: æ£€æŸ¥æ–‡ä»¶è·¯å¾„

**åœ¨ document-detail.html ä¸­æŸ¥æ‰¾**:
```html
<!-- è¡Œ 1397-1398 -->
<script defer src="bank-statement-export.js"></script>
<script defer src="invoice-export.js"></script>
```

**å¯èƒ½çš„é—®é¢˜**:
- å¦‚æœé¡µé¢åœ¨ `/en/document-detail.html`
- ç›¸å¯¹è·¯å¾„ `src="bank-statement-export.js"` ä¼šå°è¯•åŠ è½½ `/en/bank-statement-export.js`
- ä½†æ–‡ä»¶å®é™…åœ¨ `/bank-statement-export.js`

**è§£å†³æ–¹æ¡ˆ**:
```html
<!-- æ”¹ä¸ºç»å¯¹è·¯å¾„ -->
<script defer src="/bank-statement-export.js"></script>
<script defer src="/invoice-export.js"></script>
```

#### æ–¹æ¡ˆ 2: æ£€æŸ¥æ–‡ä»¶æ˜¯å¦çœŸçš„éœ€è¦

å¦‚æœè¿™äº›æ–‡ä»¶çš„åŠŸèƒ½å·²ç»è¢«å…¶ä»–è„šæœ¬å®ç°ï¼Œå¯ä»¥ç›´æ¥ç§»é™¤å¼•ç”¨ï¼š

```html
<!-- æ³¨é‡Šæˆ–åˆ é™¤ -->
<!-- <script defer src="bank-statement-export.js"></script> -->
<!-- <script defer src="invoice-export.js"></script> -->
```

---

## âœ… é—®é¢˜ 4: dataLayer.push é”™è¯¯ï¼ˆå·²ä¿®å¤ï¼‰

### é”™è¯¯ä¿¡æ¯
```
TypeError: dataLayer.push is not a function
```

### ä¿®å¤çŠ¶æ€
âœ… **å·²ä¿®å¤** - ä¹‹å‰çš„è„šæœ¬å·²æ·»åŠ åˆå§‹åŒ–ä»£ç 

### éªŒè¯æ–¹æ³•

æ¸…é™¤ç¼“å­˜åï¼Œåœ¨æ§åˆ¶å°è¾“å…¥ï¼š
```javascript
console.log(window.dataLayer);
// åº”è¯¥çœ‹åˆ°: [] (ç©ºæ•°ç»„)
// è€Œä¸æ˜¯: undefined
```

---

## ğŸ¯ ä¿®å¤ä¼˜å…ˆçº§å’Œæ—¶é—´ä¼°ç®—

### ç«‹å³ä¿®å¤ï¼ˆ< 15 åˆ†é’Ÿï¼‰

1. **Firebase æƒé™** (5 åˆ†é’Ÿ)
   - æœ€é‡è¦ï¼å½±å“æ ¸å¿ƒåŠŸèƒ½
   - æŒ‰ç…§ä¸Šè¿°æ­¥éª¤æ›´æ–° Firebase è§„åˆ™å³å¯

2. **404 èµ„æºè·¯å¾„** (5 åˆ†é’Ÿ)
   - å°†ç›¸å¯¹è·¯å¾„æ”¹ä¸ºç»å¯¹è·¯å¾„
   - æˆ–ç§»é™¤ä¸éœ€è¦çš„è„šæœ¬å¼•ç”¨

### éœ€è¦æ’æŸ¥ï¼ˆ15-30 åˆ†é’Ÿï¼‰

3. **BannerClicks è¯­æ³•é”™è¯¯** (15 åˆ†é’Ÿ)
   - éœ€è¦æ‰¾åˆ°å…·ä½“é”™è¯¯ä½ç½®
   - å¯èƒ½éœ€è¦æŸ¥çœ‹å¤šä¸ªæ–‡ä»¶
   - å¦‚ä¸æ€¥ç”¨ GAï¼Œå¯æš‚æ—¶æ³¨é‡Š

---

## ğŸ§ª ä¿®å¤åéªŒè¯æ¸…å•

### 1. Firebase æƒé™ä¿®å¤éªŒè¯

- [ ] é¡µé¢èƒ½æ­£å¸¸åŠ è½½æ–‡æ¡£åˆ—è¡¨
- [ ] èƒ½æŸ¥çœ‹æ–‡æ¡£è¯¦æƒ…
- [ ] èƒ½ç¼–è¾‘å’Œä¿å­˜æ–‡æ¡£
- [ ] æ§åˆ¶å°æ—  Firebase æƒé™é”™è¯¯

### 2. 404 é”™è¯¯ä¿®å¤éªŒè¯

- [ ] æ§åˆ¶å°æ—  404 é”™è¯¯
- [ ] Export åŠŸèƒ½æ­£å¸¸
- [ ] æ‰€æœ‰è„šæœ¬éƒ½æ­£å¸¸åŠ è½½

### 3. JavaScript é”™è¯¯ä¿®å¤éªŒè¯

- [ ] æ§åˆ¶å°æ— çº¢è‰²é”™è¯¯
- [ ] é¡µé¢åŠŸèƒ½å®Œå…¨æ­£å¸¸
- [ ] Google Analytics äº‹ä»¶æ­£å¸¸è§¦å‘ï¼ˆå¦‚æœå¯ç”¨ï¼‰

---

## ğŸ’¡ é¢„é˜²æªæ–½

### 1. å¼€å‘ç¯å¢ƒæµ‹è¯•

**å»ºè®®**: åœ¨ä¿®æ”¹å‰åœ¨å¼€å‘ç¯å¢ƒæµ‹è¯•

```javascript
// åœ¨æ§åˆ¶å°è¿è¡Œï¼Œæ£€æŸ¥å½“å‰çŠ¶æ€
console.log({
    auth: firebase.auth().currentUser,
    dataLayer: window.dataLayer,
    scriptsLoaded: {
        bankExport: typeof exportBankStatement !== 'undefined',
        invoiceExport: typeof exportInvoice !== 'undefined'
    }
});
```

### 2. é”™è¯¯ç›‘æ§

**å»ºè®®**: é›†æˆé”™è¯¯è¿½è¸ªæœåŠ¡

```javascript
// æ·»åŠ å…¨å±€é”™è¯¯å¤„ç†
window.addEventListener('error', function(event) {
    console.error('Global error:', {
        message: event.message,
        source: event.filename,
        line: event.lineno,
        column: event.colno,
        error: event.error
    });
    
    // å¯é€‰: å‘é€åˆ°é”™è¯¯è¿½è¸ªæœåŠ¡
    // sendToErrorTracking(event);
});
```

### 3. Firebase è§„åˆ™æµ‹è¯•

**å»ºè®®**: åœ¨ Firebase Console ä½¿ç”¨è§„åˆ™æ¨¡æ‹Ÿå™¨æµ‹è¯•

```
Firestore Database â†’ è§„åˆ™ â†’ è§„åˆ™æ¨¡æ‹Ÿå™¨
```

æµ‹è¯•åœºæ™¯ï¼š
- å·²è®¤è¯ç”¨æˆ·è®¿é—®è‡ªå·±çš„é¡¹ç›® âœ… åº”å…è®¸
- å·²è®¤è¯ç”¨æˆ·è®¿é—®å…¶ä»–äººçš„é¡¹ç›® âŒ åº”æ‹’ç»
- æœªè®¤è¯ç”¨æˆ·è®¿é—®ä»»ä½•æ•°æ® âŒ åº”æ‹’ç»

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæŒ‰ç…§ä¸Šè¿°æ­¥éª¤ä¿®å¤åä»æœ‰é—®é¢˜ï¼š

### æ”¶é›†ä¿¡æ¯

1. **æˆªå›¾æ§åˆ¶å°å®Œæ•´é”™è¯¯**
   - F12 â†’ Console æ ‡ç­¾
   - å±•å¼€æ‰€æœ‰çº¢è‰²é”™è¯¯
   - æˆªå›¾é”™è¯¯è¯¦æƒ…

2. **æ£€æŸ¥ Firebase é…ç½®**
   ```javascript
   // åœ¨æ§åˆ¶å°è¿è¡Œ
   console.log({
       authInitialized: !!firebase.auth,
       firestoreInitialized: !!firebase.firestore,
       currentUser: firebase.auth().currentUser?.email,
       projectId: firebase.app().options.projectId
   });
   ```

3. **æ£€æŸ¥æ–‡ä»¶åŠ è½½çŠ¶æ€**
   - F12 â†’ Network æ ‡ç­¾
   - åˆ·æ–°é¡µé¢
   - ç­›é€‰å¤±è´¥çš„è¯·æ±‚ï¼ˆçº¢è‰²ï¼‰
   - æˆªå›¾å¹¶è®°å½• URL

### åé¦ˆæ ¼å¼

```
é—®é¢˜æè¿°: [ç®€è¦è¯´æ˜]
å·²å°è¯•çš„ä¿®å¤: [åˆ—å‡ºæ­¥éª¤]
å½“å‰é”™è¯¯: [ç²˜è´´é”™è¯¯ä¿¡æ¯]
ç¯å¢ƒä¿¡æ¯:
  - æµè§ˆå™¨: [Chrome/Safari/...]
  - ç‰ˆæœ¬: [ç‰ˆæœ¬å·]
  - é¡µé¢ URL: [å®Œæ•´ URL]
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Firebase å®‰å…¨è§„åˆ™æ–‡æ¡£](https://firebase.google.com/docs/firestore/security/get-started)
- [Google Analytics äº‹ä»¶è¿½è¸ª](https://developers.google.com/analytics/devguides/collection/gtagjs/events)
- [Chrome DevTools è°ƒè¯•æŒ‡å—](https://developer.chrome.com/docs/devtools/)

---

**æœ€åæ›´æ–°**: 2026-01-02  
**ä¿®å¤çŠ¶æ€**: 
- âœ… dataLayer åˆå§‹åŒ– - å·²ä¿®å¤
- â³ Firebase æƒé™ - å¾…ç”¨æˆ·åœ¨ Firebase Console æ›´æ–°
- ğŸ” BannerClicks é”™è¯¯ - éœ€è¿›ä¸€æ­¥æ’æŸ¥
- ğŸ” 404 é”™è¯¯ - éœ€æ£€æŸ¥æ–‡ä»¶è·¯å¾„



