# âœ… æ³¨å†ŒéªŒè¯å’ŒCreditsé—®é¢˜ä¿®å¤ - å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ å·²å®Œæˆçš„ä¿®æ”¹

### 1. âœ… æ–‡æ¡ˆä¿®æ”¹
**æ–‡ä»¶ï¼š** `auth.html`

**ä¿®æ”¹å†…å®¹ï¼š**
```html
ä¿®æ”¹å‰ï¼šè¨»å†Šå³é€10å€‹Creditsï¼
ä¿®æ”¹åï¼šè¨»å†ŠåŠé©—è­‰å³é€20å€‹Creditsï¼
```

**æ•ˆæœï¼š**
- âœ… æ›´å‡†ç¡®åœ°è¯´æ˜éœ€è¦éªŒè¯åæ‰èƒ½è·å¾—Credits
- âœ… Creditsæ•°é‡ä»10ä¸ªæ›´æ–°ä¸º20ä¸ª

---

### 2. âœ… ä¿®å¤ Firestore ç”¨æˆ·æ–‡æ¡£åˆ›å»ºï¼ˆå…³é”®ä¿®å¤ï¼ï¼‰

**æ–‡ä»¶ï¼š** `simple-auth.js`

**é—®é¢˜æ ¹æºï¼š**
- âŒ åŸä»£ç åªåˆ›å»ºäº† Firebase Auth ç”¨æˆ·
- âŒ æ²¡æœ‰åˆ›å»º Firestore ç”¨æˆ·æ–‡æ¡£
- âŒ éªŒè¯æ—¶æŸ¥æ‰¾ä¸åˆ°ç”¨æˆ·æ–‡æ¡£ï¼Œæ— æ³•æ·»åŠ  Credits

**ä¿®æ”¹å†…å®¹ï¼š**
```javascript
// åœ¨ registerWithEmail æ–¹æ³•ä¸­æ·»åŠ 
// ğŸ¯ å‰µå»º Firestore ç”¨æˆ¶æ–‡æª”ï¼ˆé‡è¦ï¼é©—è­‰å¾Œéœ€è¦é€™å€‹æ–‡æª”ä¾†æ·»åŠ  Creditsï¼‰
try {
    const db = firebase.firestore();
    await db.collection('users').doc(result.user.uid).set({
        email: email,
        displayName: displayName || '',
        credits: 0,  // åˆå§‹ç‚º 0ï¼Œé©—è­‰å¾ŒæœƒåŠ  20
        currentCredits: 0,
        emailVerified: false,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    console.log('âœ… Firestore ç”¨æˆ¶æ–‡æª”å·²å‰µå»º');
} catch (firestoreError) {
    console.error('âŒ å‰µå»º Firestore ç”¨æˆ¶æ–‡æª”å¤±æ•—:', firestoreError);
    // ä¸æ‹‹å‡ºéŒ¯èª¤ï¼Œå› ç‚º Auth ç”¨æˆ¶å·²ç¶“å‰µå»ºæˆåŠŸ
}
```

**æ•ˆæœï¼š**
- âœ… æ³¨å†Œæ—¶åˆ›å»º Firebase Auth ç”¨æˆ·
- âœ… åŒæ—¶åˆ›å»º Firestore ç”¨æˆ·æ–‡æ¡£
- âœ… éªŒè¯æˆåŠŸåå¯ä»¥æ­£ç¡®æ·»åŠ  20 ä¸ª Credits

---

## ğŸ” ä¿®å¤é€»è¾‘è¯´æ˜

### å®Œæ•´æ³¨å†Œæµç¨‹ï¼š

**æ­¥éª¤1ï¼šç”¨æˆ·å¡«å†™æ³¨å†Œè¡¨å•**
```
ç”¨æˆ·è¾“å…¥ï¼š
- åå­—
- å§“æ°
- é‚®ç®±
- å¯†ç 
```

**æ­¥éª¤2ï¼šåˆ›å»º Firebase Auth ç”¨æˆ·**
```javascript
const result = await this.auth.createUserWithEmailAndPassword(email, password);
```

**æ­¥éª¤3ï¼šåˆ›å»º Firestore ç”¨æˆ·æ–‡æ¡£ï¼ˆæ–°å¢ï¼ï¼‰**
```javascript
await db.collection('users').doc(result.user.uid).set({
    email: email,
    displayName: displayName,
    credits: 0,  // â† åˆå§‹ä¸º0
    currentCredits: 0,
    emailVerified: false,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
});
```

**æ­¥éª¤4ï¼šå‘é€éªŒè¯ç é‚®ä»¶**
```javascript
const sendCodeFunc = functions.httpsCallable('sendVerificationCode');
await sendCodeFunc({ email: email, displayName: displayName });
```

**æ­¥éª¤5ï¼šç”¨æˆ·è¾“å…¥éªŒè¯ç **
```
ç”¨æˆ·åœ¨ verify-email.html è¾“å…¥6ä½éªŒè¯ç 
```

**æ­¥éª¤6ï¼šéªŒè¯æˆåŠŸåèµ é€ Creditsï¼ˆFirebase Functionsï¼‰**
```javascript
// firebase-functions/index.js
const usersSnapshot = await db.collection('users')
    .where('email', '==', email)
    .limit(1)
    .get();

if (!usersSnapshot.empty) {  // â† ç°åœ¨å¯ä»¥æ‰¾åˆ°ç”¨æˆ·æ–‡æ¡£äº†ï¼
    const newCredits = currentCredits + 20;
    transaction.update(userRef, {
        credits: newCredits,  // â† 0 + 20 = 20
        currentCredits: newCredits,
        emailVerified: true,
        ...
    });
}
```

---

## ğŸ“Š æ•°æ®æµå›¾

```
æ³¨å†Œæµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å¡«å†™æ³¨å†Œè¡¨å•   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Firebase Auth â”‚
â”‚    åˆ›å»ºç”¨æˆ·       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â† ğŸ¯ æ–°å¢ï¼å…³é”®ä¿®å¤
â”‚ 3. Firestore     â”‚
â”‚    åˆ›å»ºç”¨æˆ·æ–‡æ¡£   â”‚
â”‚    credits: 0    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å‘é€éªŒè¯ç      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç”¨æˆ·è¾“å…¥éªŒè¯ç  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. éªŒè¯æˆåŠŸ       â”‚
â”‚    credits: 0â†’20 â”‚  â† ç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œï¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æµ‹è¯•1ï¼šæ–°ç”¨æˆ·æ³¨å†Œ

1. **æ‰“å¼€æ³¨å†Œé¡µé¢**
   ```
   https://vaultcaddy.com/auth.html
   ```

2. **å¡«å†™æ³¨å†Œè¡¨å•**
   ```
   åå­—ï¼šTest
   å§“æ°ï¼šUser
   é‚®ç®±ï¼štest@example.com
   å¯†ç ï¼šTest12345678
   ```

3. **æ£€æŸ¥æ§åˆ¶å°**
   ```
   åº”è¯¥çœ‹åˆ°ï¼š
   âœ… Firestore ç”¨æˆ¶æ–‡æª”å·²å‰µå»º
   âœ… è¨»å†ŠæˆåŠŸ
   ```

4. **æ£€æŸ¥ Firebase Console**
   ```
   Firestore Database â†’ users é›†åˆ
   åº”è¯¥æœ‰æ–°æ–‡æ¡£ï¼š
   {
     email: "test@example.com",
     displayName: "Test User",
     credits: 0,
     currentCredits: 0,
     emailVerified: false,
     createdAt: [timestamp]
   }
   ```

---

### æµ‹è¯•2ï¼šéªŒè¯ç å‘é€

1. **æ³¨å†ŒæˆåŠŸå**
   ```
   åº”è¯¥çœ‹åˆ°ï¼šè¨»å†ŠæˆåŠŸï¼é©—è­‰ç¢¼å·²ç™¼é€åˆ°æ‚¨çš„éƒµç®±
   ```

2. **æ£€æŸ¥é‚®ç®±**
   ```
   æ£€æŸ¥æ³¨å†Œé‚®ç®±ï¼ˆåŒ…æ‹¬åƒåœ¾é‚®ä»¶ï¼‰
   åº”è¯¥æ”¶åˆ°éªŒè¯ç é‚®ä»¶
   ```

3. **å¦‚æœæ²¡æ”¶åˆ°é‚®ä»¶**
   ```
   é—®é¢˜ï¼šFirebase Functions Email é…ç½®
   å‚è€ƒï¼šğŸ”§_æ³¨å†ŒéªŒè¯å’ŒCreditsé—®é¢˜ä¿®å¤æŒ‡å—.txt
   ```

---

### æµ‹è¯•3ï¼šéªŒè¯ç éªŒè¯

1. **è¾“å…¥éªŒè¯ç **
   ```
   åœ¨ verify-email.html è¾“å…¥6ä½éªŒè¯ç 
   ç‚¹å‡»"éªŒè¯"
   ```

2. **æ£€æŸ¥æ§åˆ¶å°**
   ```
   åº”è¯¥çœ‹åˆ°ï¼š
   âœ… é©—è­‰çµæœ: { success: true, message: 'é©—è­‰æˆåŠŸï¼å·²è´ˆé€ 20 å€‹ Credits' }
   é©—è­‰æˆåŠŸï¼æ­£åœ¨è·³è½‰...
   ```

3. **æ£€æŸ¥ Firestore**
   ```
   ç”¨æˆ·æ–‡æ¡£åº”è¯¥æ›´æ–°ä¸ºï¼š
   {
     email: "test@example.com",
     displayName: "Test User",
     credits: 20,  // â† åº”è¯¥æ˜¯ 20ï¼
     currentCredits: 20,
     emailVerified: true,
     emailVerifiedAt: [timestamp],
     updatedAt: [timestamp]
   }
   ```

---

### æµ‹è¯•4ï¼šç™»å½•æŸ¥çœ‹ Credits

1. **éªŒè¯æˆåŠŸåç™»å½•**
   ```
   è®¿é—®ï¼šhttps://vaultcaddy.com/auth.html
   ç™»å½•åˆšæ‰æ³¨å†Œçš„è´¦å·
   ```

2. **æŸ¥çœ‹ Credits ä½™é¢**
   ```
   ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å¤´åƒ
   åº”è¯¥æ˜¾ç¤ºï¼šCredits: 20
   ```

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### Firebase Console æ£€æŸ¥ï¼š

- [ ] **Authentication**
  - Email/Password æä¾›å•†å·²å¯ç”¨

- [ ] **Firestore Database**
  - users é›†åˆå¯å†™
  - verificationCodes é›†åˆå¯å†™

- [ ] **Functions**
  - sendVerificationCode å·²éƒ¨ç½²
  - verifyCode å·²éƒ¨ç½²

- [ ] **Functions Configï¼ˆé‡è¦ï¼ï¼‰**
  - email.user å·²é…ç½®
  - email.password å·²é…ç½®

---

### ä»£ç ä¿®æ”¹æ£€æŸ¥ï¼š

- [x] **auth.html** - æ–‡æ¡ˆå·²ä¿®æ”¹
- [x] **simple-auth.js** - Firestore ç”¨æˆ·æ–‡æ¡£åˆ›å»ºå·²æ·»åŠ 

---

### æµ‹è¯•æ£€æŸ¥ï¼š

- [ ] æ³¨å†ŒæˆåŠŸåˆ›å»º Auth ç”¨æˆ·
- [ ] æ³¨å†ŒæˆåŠŸåˆ›å»º Firestore æ–‡æ¡£
- [ ] éªŒè¯ç é‚®ä»¶å‘é€æˆåŠŸ
- [ ] éªŒè¯ç éªŒè¯æˆåŠŸ
- [ ] Credits æ­£ç¡®æ›´æ–°ä¸º 20
- [ ] ç™»å½•åæ˜¾ç¤º Credits: 20

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1ï¼šä¸Šä¼ ä¿®æ”¹çš„æ–‡ä»¶

**éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆ2ä¸ªï¼‰ï¼š**
```
1. auth.html - æ–‡æ¡ˆä¿®æ”¹
2. simple-auth.js - Firestore ç”¨æˆ·æ–‡æ¡£åˆ›å»ºä¿®å¤
```

---

### æ­¥éª¤2ï¼šæ£€æŸ¥ Firebase Functions

**å¦‚æœ Functions æœªéƒ¨ç½²æˆ– Email é…ç½®ç¼ºå¤±ï¼š**

```bash
# è¿›å…¥ firebase-functions ç›®å½•
cd firebase-functions

# é…ç½® Emailï¼ˆå¦‚æœè¿˜æ²¡é…ç½®ï¼‰
firebase functions:config:set email.user="vaultcaddy@gmail.com"
firebase functions:config:set email.password="your-gmail-app-password"

# æŸ¥çœ‹é…ç½®
firebase functions:config:get

# éƒ¨ç½² Functions
firebase deploy --only functions

# æˆ–åªéƒ¨ç½²éªŒè¯ç›¸å…³å‡½æ•°
firebase deploy --only functions:sendVerificationCode,functions:verifyCode
```

**è·å– Gmail App Passwordï¼š**
```
1. è®¿é—®ï¼šhttps://myaccount.google.com/apppasswords
2. é€‰æ‹©åº”ç”¨ï¼šMail
3. é€‰æ‹©è®¾å¤‡ï¼šOther
4. è¾“å…¥åç§°ï¼šVaultCaddy
5. ç”Ÿæˆå¯†ç 
6. å¤åˆ¶å¯†ç ï¼ˆ16ä½ï¼Œä¸åŒ…å«ç©ºæ ¼ï¼‰
7. ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤é…ç½®
```

---

### æ­¥éª¤3ï¼šæµ‹è¯•å®Œæ•´æµç¨‹

**å®Œæ•´æµ‹è¯•ï¼š**
1. âœ… æ³¨å†Œæ–°è´¦å·
2. âœ… æ”¶åˆ°éªŒè¯ç é‚®ä»¶
3. âœ… éªŒè¯æˆåŠŸ
4. âœ… Credits æ˜¾ç¤º 20
5. âœ… å¯ä»¥æ­£å¸¸ç™»å½•

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q1ï¼šæ³¨å†Œå Firestore æ²¡æœ‰ç”¨æˆ·æ–‡æ¡£ï¼Ÿ

**åŸå› ï¼š**
- Firestore è§„åˆ™å¯èƒ½ä¸å…è®¸å†™å…¥
- simple-auth.js æ²¡æœ‰æ­£ç¡®ä¸Šä¼ 

**è§£å†³ï¼š**
1. æ£€æŸ¥ Firestore è§„åˆ™
2. é‡æ–°ä¸Šä¼  simple-auth.js
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

---

### Q2ï¼šéªŒè¯ç é‚®ä»¶æ²¡æœ‰æ”¶åˆ°ï¼Ÿ

**åŸå› ï¼š**
- Firebase Functions æœªéƒ¨ç½²
- Email é…ç½®æœªè®¾ç½®
- Gmail SMTP æƒé™é—®é¢˜

**è§£å†³ï¼š**
1. éƒ¨ç½² Functions
2. é…ç½® Emailï¼ˆemail.user, email.passwordï¼‰
3. ä½¿ç”¨ Gmail App Password

**è°ƒè¯•ï¼š**
```bash
firebase functions:log --only sendVerificationCode
```

---

### Q3ï¼šéªŒè¯æˆåŠŸä½† Credits è¿˜æ˜¯ 0ï¼Ÿ

**åŸå› ï¼š**
- Firestore ç”¨æˆ·æ–‡æ¡£ä¸å­˜åœ¨
- Transaction å¤±è´¥

**è§£å†³ï¼š**
1. ç¡®ä¿ simple-auth.js å·²æ›´æ–°
2. é‡æ–°æ³¨å†Œä¸€ä¸ªæ–°è´¦å·æµ‹è¯•
3. æ£€æŸ¥ Functions æ—¥å¿—

**è°ƒè¯•ï¼š**
```bash
firebase functions:log --only verifyCode
```

---

### Q4ï¼šå¦‚ä½•æ‰‹åŠ¨æ·»åŠ  Credits æµ‹è¯•ï¼Ÿ

**Firebase Consoleï¼š**
```
1. Firestore Database â†’ users
2. é€‰æ‹©ç”¨æˆ·æ–‡æ¡£
3. ç¼–è¾‘å­—æ®µï¼š
   - credits: 20
   - currentCredits: 20
   - emailVerified: true
4. ä¿å­˜
```

---

## ğŸŠ ä¿®å¤æ€»ç»“

### é—®é¢˜1ï¼šæ–‡æ¡ˆä¿®æ”¹
- âœ… å·²å®Œæˆ
- "è¨»å†Šå³é€10å€‹Creditsï¼" â†’ "è¨»å†ŠåŠé©—è­‰å³é€20å€‹Creditsï¼"

### é—®é¢˜2ï¼šæ³¨å†Œåè‡ªåŠ¨å‘é€éªŒè¯ç 
- âœ… ä»£ç é€»è¾‘æ­£å¸¸
- âš ï¸ éœ€è¦ç¡®ä¿ Firebase Functions å·²éƒ¨ç½²å’Œé…ç½®

### é—®é¢˜3ï¼šéªŒè¯åæ²¡æœ‰ Credits
- âœ… å·²ä¿®å¤ï¼
- ğŸ¯ å…³é”®ï¼šæ·»åŠ äº† Firestore ç”¨æˆ·æ–‡æ¡£åˆ›å»ºé€»è¾‘

---

## ğŸ“„ ç›¸å…³æ–‡æ¡£

1. **ğŸ”§_æ³¨å†ŒéªŒè¯å’ŒCreditsé—®é¢˜ä¿®å¤æŒ‡å—.txt**
   - è¯¦ç»†çš„é—®é¢˜è¯Šæ–­å’Œä¿®å¤æ­¥éª¤

2. **FirebaseæˆæƒåŸŸåé…ç½®æŒ‡å—.txt**
   - Google ç™»å½•åŸŸåé…ç½®

3. **Stripeæ¸¬è©¦æ”¯ä»˜æŒ‡å—.txt**
   - Stripe æ”¯ä»˜æµ‹è¯•

---

ğŸ¯ **ä¸‹ä¸€æ­¥ï¼š**
1. âœ… ä¸Šä¼  auth.html
2. âœ… ä¸Šä¼  simple-auth.js
3. âš ï¸ æ£€æŸ¥ Firebase Functions éƒ¨ç½²
4. âš ï¸ é…ç½® Email SMTP
5. âœ… æµ‹è¯•å®Œæ•´æ³¨å†Œæµç¨‹

---

ğŸ‰ **å…³é”®ä¿®å¤å·²å®Œæˆï¼ç°åœ¨æ³¨å†Œâ†’éªŒè¯â†’è·å¾—20ä¸ªCreditsçš„æµç¨‹åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼**
