# ✅ Stripe 价格更新指南

**日期**: 2026-01-08  
**产品**: prod_Tb2443GvCbe4Pp, prod_Tb24SiE4usHRDS

---

## 📋 重要说明

**⚠️ Stripe 不允许直接修改现有 Price 的价格**

在 Stripe 中，Price 对象一旦创建，其 `unit_amount`（价格）是不可变的。要更新价格，需要：

1. **创建新的 Price**（使用新价格）
2. **停用旧的 Price**（可选，建议保留用于历史记录）
3. **更新代码中的 Price ID**

---

## 🚀 使用方法

### 步骤 1: 查看当前价格

运行脚本查看两个产品的当前价格：

```bash
node view-and-update-stripe-prices.js <stripe_secret_key> prod_Tb2443GvCbe4Pp prod_Tb24SiE4usHRDS
```

**示例**:
```bash
node view-and-update-stripe-prices.js sk_live_xxx prod_Tb2443GvCbe4Pp prod_Tb24SiE4usHRDS
```

### 步骤 2: 脚本会自动创建新价格

脚本会为每个产品创建以下新价格：

| 货币 | 月付 | 年付 |
|------|------|------|
| HKD | $28/月 | $264/年 ($22/月) |
| USD | $3.88/月 | $34.56/年 ($2.88/月) |
| JPY | ¥599/月 | ¥5,748/年 (¥479/月) |
| KRW | ₩5,588/월 | ₩53,616/년 (₩4,468/월) |

**每个产品会创建 8 个新价格**（4 种货币 × 2 种周期）

---

## 📊 新价格配置

### HKD 价格
- **月付**: $28.00 HKD/月
- **年付**: $264.00 HKD/年 (每月 $22)

### USD 价格
- **月付**: $3.88 USD/月
- **年付**: $34.56 USD/年 (每月 $2.88)

### JPY 价格
- **月付**: ¥599 JPY/月
- **年付**: ¥5,748 JPY/年 (每月 ¥479)

### KRW 价格
- **月付**: ₩5,588 KRW/월
- **年付**: ₩53,616 KRW/년 (每月 ₩4,468)

---

## 📝 更新代码

创建新价格后，需要更新以下文件中的 Price ID：

### 1. `firebase-functions/index.js`

更新 `createStripeCheckoutSession` 函数中的价格映射：

```javascript
const productionPriceMapping = {
    monthly: {
        basePriceId: 'price_NEW_MONTHLY_HKD_ID',  // 新的 HKD 月付 Price ID
        usagePriceId: 'price_EXISTING_USAGE_ID'  // 保持现有的用量计费 Price ID
    },
    yearly: {
        basePriceId: 'price_NEW_YEARLY_HKD_ID',  // 新的 HKD 年付 Price ID
        usagePriceId: 'price_EXISTING_USAGE_ID'  // 保持现有的用量计费 Price ID
    }
};
```

### 2. `billing.html` 和相关文件

如果直接使用 Price ID，需要更新所有语言版本的 `billing.html`。

---

## 🔍 查看产品信息

如果需要单独查看产品信息，可以使用 Stripe CLI：

```bash
# 查看产品 1
stripe products retrieve prod_Tb2443GvCbe4Pp

# 查看产品 1 的所有价格
stripe prices list --product prod_Tb2443GvCbe4Pp

# 查看产品 2
stripe products retrieve prod_Tb24SiE4usHRDS

# 查看产品 2 的所有价格
stripe prices list --product prod_Tb24SiE4usHRDS
```

---

## ⚠️ 注意事项

1. **不要删除旧价格**: 保留旧价格用于历史记录和现有订阅
2. **测试新价格**: 创建新价格后，先在测试环境测试支付流程
3. **更新文档**: 记录新的 Price ID，方便后续维护
4. **监控订阅**: 确保现有订阅不受影响

---

## 📞 需要帮助

如果遇到问题：

1. **检查 Stripe Secret Key**: 确保使用的是正确的密钥（测试/生产）
2. **检查产品 ID**: 确认产品 ID 正确
3. **查看错误信息**: 脚本会显示详细的错误信息
4. **参考 Stripe 文档**: https://stripe.com/docs/api/prices

---

**创建时间**: 2026-01-08  
**最后更新**: 2026-01-08

