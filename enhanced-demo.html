<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VaultCaddy å¢å¼·ç‰ˆæ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 2rem;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .feature-card {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            border-color: #4f46e5;
            transform: translateY(-2px);
        }
        
        .feature-card h3 {
            color: #1e293b;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .feature-card .icon {
            font-size: 1.5rem;
        }
        
        .upload-section {
            background: #f1f5f9;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .upload-zone {
            border: 3px dashed #cbd5e1;
            border-radius: 12px;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-zone:hover {
            border-color: #4f46e5;
            background: #f8fafc;
        }
        
        .upload-zone.dragover {
            border-color: #4f46e5;
            background: #eef2ff;
        }
        
        .upload-icon {
            font-size: 3rem;
            color: #64748b;
            margin-bottom: 1rem;
        }
        
        .upload-text {
            font-size: 1.2rem;
            color: #475569;
            margin-bottom: 1rem;
        }
        
        .upload-hint {
            color: #64748b;
            font-size: 0.9rem;
        }
        
        .browse-btn {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 1rem;
            transition: background 0.3s ease;
        }
        
        .browse-btn:hover {
            background: #4338ca;
        }
        
        .processing-section {
            display: none;
            background: #fef3c7;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .processing-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
        }
        
        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 20px;
            right: -50%;
            width: 100%;
            height: 2px;
            background: #e5e7eb;
        }
        
        .step.active::after {
            background: #4f46e5;
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #6b7280;
        }
        
        .step.active .step-circle {
            background: #4f46e5;
            color: white;
        }
        
        .step.completed .step-circle {
            background: #10b981;
            color: white;
        }
        
        .results-section {
            display: none;
            background: #f0fdf4;
            border-radius: 12px;
            padding: 2rem;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .result-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .result-card h4 {
            color: #1e293b;
            margin-bottom: 1rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .stat-item {
            text-align: center;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 6px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4f46e5;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #64748b;
            margin-top: 0.25rem;
        }
        
        .export-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .export-btn {
            background: #059669;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .export-btn:hover {
            background: #047857;
        }
        
        .log-section {
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        
        .engine-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .engine-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .engine-option:hover {
            border-color: #4f46e5;
        }
        
        .engine-option.selected {
            border-color: #4f46e5;
            background: #eef2ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ VaultCaddy å¢å¼·ç‰ˆ</h1>
            <p>æ™ºèƒ½OCR + æ•¸æ“šåˆ†æ + å¤šæ ¼å¼å°å‡º</p>
        </div>
        
        <div class="content">
            <!-- åŠŸèƒ½ä»‹ç´¹ -->
            <div class="feature-grid">
                <div class="feature-card">
                    <h3><span class="icon">ğŸ§ </span>æ™ºèƒ½OCRé¸æ“‡</h3>
                    <p>è‡ªå‹•é¸æ“‡æœ€é©åˆçš„OCRå¼•æ“ï¼ˆGoogle AI æˆ– Tesseract.jsï¼‰ï¼Œæ ¹æ“šæ–‡æª”é¡å‹ã€æ–‡ä»¶å¤§å°å’Œè™•ç†éœ€æ±‚æ™ºèƒ½åˆ‡æ›ã€‚</p>
                </div>
                
                <div class="feature-card">
                    <h3><span class="icon">ğŸ“Š</span>é«˜ç´šæ•¸æ“šåˆ†æ</h3>
                    <p>é¡ä¼¼pandasçš„æ•¸æ“šè™•ç†åŠŸèƒ½ï¼Œæä¾›çµ±è¨ˆåˆ†æã€è¶¨å‹¢è­˜åˆ¥å’Œæ™ºèƒ½æ´å¯Ÿï¼Œå¹«åŠ©æ‚¨æ›´å¥½åœ°ç†è§£è²¡å‹™æ•¸æ“šã€‚</p>
                </div>
                
                <div class="feature-card">
                    <h3><span class="icon">ğŸ”’</span>éš±ç§ä¿è­·æ¨¡å¼</h3>
                    <p>æ”¯æ´å®Œå…¨é›¢ç·šè™•ç†ï¼Œä½¿ç”¨Tesseract.jsåœ¨æœ¬åœ°è™•ç†æ•æ„Ÿæ–‡æª”ï¼Œç„¡éœ€ä¸Šå‚³åˆ°é›²ç«¯æœå‹™ã€‚</p>
                </div>
                
                <div class="feature-card">
                    <h3><span class="icon">ğŸ“ˆ</span>å¤šæ ¼å¼å°å‡º</h3>
                    <p>æ”¯æ´CSVã€Excelã€JSONç­‰å¤šç¨®æ ¼å¼å°å‡ºï¼Œä¸¦æä¾›è©³ç´°çš„æ•¸æ“šåˆ†æå ±å‘Šå’Œå¯è¦–åŒ–åœ–è¡¨ã€‚</p>
                </div>
            </div>
            
            <!-- OCRå¼•æ“é¸æ“‡ -->
            <div class="upload-section">
                <h3 style="margin-bottom: 1rem;">é¸æ“‡è™•ç†æ¨¡å¼</h3>
                <div class="engine-selector">
                    <div class="engine-option selected" data-mode="balanced">
                        <input type="radio" name="ocrMode" value="balanced" checked>
                        <span>ğŸ¯ æ™ºèƒ½å¹³è¡¡</span>
                    </div>
                    <div class="engine-option" data-mode="accuracy">
                        <input type="radio" name="ocrMode" value="accuracy">
                        <span>ğŸ¯ æº–ç¢ºåº¦å„ªå…ˆ</span>
                    </div>
                    <div class="engine-option" data-mode="speed">
                        <input type="radio" name="ocrMode" value="speed">
                        <span>âš¡ é€Ÿåº¦å„ªå…ˆ</span>
                    </div>
                    <div class="engine-option" data-mode="privacy">
                        <input type="radio" name="ocrMode" value="privacy">
                        <span>ğŸ”’ éš±ç§æ¨¡å¼</span>
                    </div>
                    <div class="engine-option" data-mode="budget">
                        <input type="radio" name="ocrMode" value="budget">
                        <span>ğŸ’° é ç®—æ¨¡å¼</span>
                    </div>
                </div>
                
                <!-- æ–‡ä»¶ä¸Šå‚³å€ -->
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">ğŸ“„</div>
                    <div class="upload-text">æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤è™•æˆ–é»æ“Šä¸Šå‚³</div>
                    <div class="upload-hint">æ”¯æ´ PDFã€JPGã€PNG æ ¼å¼ (æœ€å¤§ 20MB)</div>
                    <button class="browse-btn" onclick="document.getElementById('fileInput').click()">
                        ç€è¦½æ–‡ä»¶
                    </button>
                    <input type="file" id="fileInput" multiple accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
                </div>
            </div>
            
            <!-- è™•ç†é€²åº¦ -->
            <div class="processing-section" id="processingSection">
                <h3 style="margin-bottom: 1rem;">è™•ç†é€²åº¦</h3>
                <div class="processing-steps">
                    <div class="step" data-step="upload">
                        <div class="step-circle">1</div>
                        <span>æ–‡ä»¶ä¸Šå‚³</span>
                    </div>
                    <div class="step" data-step="ocr">
                        <div class="step-circle">2</div>
                        <span>OCRè­˜åˆ¥</span>
                    </div>
                    <div class="step" data-step="analysis">
                        <div class="step-circle">3</div>
                        <span>æ•¸æ“šåˆ†æ</span>
                    </div>
                    <div class="step" data-step="complete">
                        <div class="step-circle">4</div>
                        <span>è™•ç†å®Œæˆ</span>
                    </div>
                </div>
                
                <div class="log-section" id="logSection">
                    <div>ç­‰å¾…æ–‡ä»¶ä¸Šå‚³...</div>
                </div>
            </div>
            
            <!-- è™•ç†çµæœ -->
            <div class="results-section" id="resultsSection">
                <h3 style="margin-bottom: 1rem;">è™•ç†çµæœ</h3>
                <div class="results-grid">
                    <div class="result-card">
                        <h4>ğŸ“Š è™•ç†çµ±è¨ˆ</h4>
                        <div class="stats-grid" id="statsGrid">
                            <!-- å‹•æ…‹å¡«å…… -->
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <h4>ğŸ¯ è³ªé‡è©•åˆ†</h4>
                        <div id="qualityInfo">
                            <!-- å‹•æ…‹å¡«å…… -->
                        </div>
                    </div>
                </div>
                
                <div class="export-buttons">
                    <button class="export-btn" onclick="exportData('csv')">ğŸ“„ å°å‡º CSV</button>
                    <button class="export-btn" onclick="exportData('excel')">ğŸ“Š å°å‡º Excel</button>
                    <button class="export-btn" onclick="exportData('json')">ğŸ”§ å°å‡º JSON</button>
                    <button class="export-btn" onclick="viewInsights()">ğŸ’¡ æŸ¥çœ‹æ´å¯Ÿ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- è¼‰å…¥å¿…è¦çš„åº« -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- è¼‰å…¥è™•ç†å™¨ -->
    <script src="config.js"></script>
    <script src="google-ai-integration.js"></script>
    <script src="tesseract-ocr-processor.js"></script>
    <script src="data-processor.js"></script>
    <script src="intelligent-ocr-processor.js"></script>
    <script src="unified-document-processor.js"></script>
    
    <script>
        let currentResult = null;
        let processor = null;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            log('ğŸš€ VaultCaddy å¢å¼·ç‰ˆåˆå§‹åŒ–ä¸­...');
            
            try {
                // ç­‰å¾…è™•ç†å™¨è¼‰å…¥
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // èª¿è©¦ä¿¡æ¯
                log(`ğŸ” æª¢æŸ¥å¯ç”¨çš„è™•ç†å™¨:`);
                log(`- window.GoogleAIProcessor: ${typeof window.GoogleAIProcessor}`);
                log(`- window.googleAIProcessor: ${typeof window.googleAIProcessor}`);
                log(`- window.UnifiedDocumentProcessor: ${typeof window.UnifiedDocumentProcessor}`);
                log(`- window.IntelligentOCRProcessor: ${typeof window.IntelligentOCRProcessor}`);
                
                if (window.UnifiedDocumentProcessor) {
                    processor = window.UnifiedDocumentProcessor;
                    log('âœ… çµ±ä¸€è™•ç†å™¨å·²è¼‰å…¥');
                    
                    // æª¢æŸ¥è™•ç†å™¨çš„å­çµ„ä»¶
                    if (processor.processors) {
                        log(`ğŸ” è™•ç†å™¨å­çµ„ä»¶ç‹€æ…‹:`);
                        Object.keys(processor.processors).forEach(key => {
                            log(`- ${key}: ${processor.processors[key] ? 'âœ…' : 'âŒ'}`);
                        });
                    }
                } else {
                    log('âŒ çµ±ä¸€è™•ç†å™¨è¼‰å…¥å¤±æ•—');
                }
                
                setupEventListeners();
                log('âœ… åˆå§‹åŒ–å®Œæˆ');
                
            } catch (error) {
                log(`âŒ åˆå§‹åŒ–å¤±æ•—: ${error.message}`);
                console.error('åˆå§‹åŒ–éŒ¯èª¤:', error);
            }
        });
        
        // è¨­ç½®äº‹ä»¶ç›£è½
        function setupEventListeners() {
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('fileInput');
            
            // æ‹–æ”¾äº‹ä»¶
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });
            
            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });
            
            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });
            
            // æ–‡ä»¶é¸æ“‡äº‹ä»¶
            fileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });
            
            // å¼•æ“é¸æ“‡äº‹ä»¶
            document.querySelectorAll('.engine-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('.engine-option').forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    option.querySelector('input').checked = true;
                });
            });
        }
        
        // è™•ç†æ–‡ä»¶
        async function handleFiles(files) {
            if (files.length === 0) return;
            
            const file = files[0];
            log(`ğŸ“ é¸æ“‡æ–‡ä»¶: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`);
            
            // é¡¯ç¤ºè™•ç†å€åŸŸ
            document.getElementById('processingSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            
            // ç²å–è™•ç†é¸é …
            const mode = document.querySelector('input[name="ocrMode"]:checked').value;
            const options = getProcessingOptions(mode);
            
            log(`ğŸ¯ è™•ç†æ¨¡å¼: ${mode}`);
            log(`âš™ï¸ è™•ç†é¸é …: ${JSON.stringify(options)}`);
            
            try {
                // æ­¥é©Ÿ1: ä¸Šå‚³
                updateStep('upload', 'active');
                await new Promise(resolve => setTimeout(resolve, 500));
                updateStep('upload', 'completed');
                
                // æ­¥é©Ÿ2: OCRè™•ç†
                updateStep('ocr', 'active');
                log('ğŸ”„ é–‹å§‹OCRè™•ç†...');
                
                const result = await processor.processFile(file, 'receipt', options);
                
                updateStep('ocr', 'completed');
                
                // æ­¥é©Ÿ3: æ•¸æ“šåˆ†æ
                updateStep('analysis', 'active');
                log('ğŸ“Š é€²è¡Œæ•¸æ“šåˆ†æ...');
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                updateStep('analysis', 'completed');
                
                // æ­¥é©Ÿ4: å®Œæˆ
                updateStep('complete', 'active');
                log('âœ… è™•ç†å®Œæˆ!');
                
                currentResult = result;
                displayResults(result);
                
                setTimeout(() => {
                    updateStep('complete', 'completed');
                    document.getElementById('resultsSection').style.display = 'block';
                }, 500);
                
            } catch (error) {
                log(`âŒ è™•ç†å¤±æ•—: ${error.message}`);
                console.error('è™•ç†éŒ¯èª¤:', error);
            }
        }
        
        // ç²å–è™•ç†é¸é …
        function getProcessingOptions(mode) {
            const options = {};
            
            switch (mode) {
                case 'accuracy':
                    options.qualityPriority = 'accuracy';
                    break;
                case 'speed':
                    options.qualityPriority = 'speed';
                    break;
                case 'privacy':
                    options.privacyMode = true;
                    options.forceOffline = true;
                    break;
                case 'budget':
                    options.budgetMode = true;
                    break;
                case 'balanced':
                default:
                    options.qualityPriority = 'balanced';
                    break;
            }
            
            return options;
        }
        
        // æ›´æ–°è™•ç†æ­¥é©Ÿ
        function updateStep(stepName, status) {
            const step = document.querySelector(`[data-step="${stepName}"]`);
            if (step) {
                step.className = `step ${status}`;
            }
        }
        
        // é¡¯ç¤ºçµæœ
        function displayResults(result) {
            // é¡¯ç¤ºçµ±è¨ˆä¿¡æ¯
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-item">
                    <div class="stat-value">${result.processingTime}ms</div>
                    <div class="stat-label">è™•ç†æ™‚é–“</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${result.ocrEngine}</div>
                    <div class="stat-label">OCRå¼•æ“</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${result.ocrConfidence || 0}%</div>
                    <div class="stat-label">è­˜åˆ¥ç½®ä¿¡åº¦</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${result.qualityScore || 0}/100</div>
                    <div class="stat-label">è³ªé‡è©•åˆ†</div>
                </div>
            `;
            
            // é¡¯ç¤ºè³ªé‡ä¿¡æ¯
            const qualityInfo = document.getElementById('qualityInfo');
            const qualityScore = result.qualityScore || 0;
            let qualityText = 'æœªçŸ¥';
            let qualityColor = '#6b7280';
            
            if (qualityScore >= 80) {
                qualityText = 'å„ªç§€';
                qualityColor = '#10b981';
            } else if (qualityScore >= 60) {
                qualityText = 'è‰¯å¥½';
                qualityColor = '#f59e0b';
            } else if (qualityScore >= 40) {
                qualityText = 'ä¸€èˆ¬';
                qualityColor = '#ef4444';
            } else {
                qualityText = 'éœ€è¦æ”¹é€²';
                qualityColor = '#dc2626';
            }
            
            qualityInfo.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 2rem; color: ${qualityColor}; margin-bottom: 0.5rem;">
                        ${qualityScore}/100
                    </div>
                    <div style="color: ${qualityColor}; font-weight: bold;">
                        ${qualityText}
                    </div>
                </div>
            `;
            
            log(`ğŸ“Š çµæœçµ±è¨ˆ: è™•ç†æ™‚é–“ ${result.processingTime}ms, å¼•æ“ ${result.ocrEngine}, è³ªé‡ ${qualityScore}/100`);
        }
        
        // å°å‡ºæ•¸æ“š
        function exportData(format) {
            if (!currentResult) {
                alert('æ²’æœ‰å¯å°å‡ºçš„æ•¸æ“š');
                return;
            }
            
            log(`ğŸ“¤ å°å‡º ${format.toUpperCase()} æ ¼å¼`);
            
            try {
                let content, filename, mimeType;
                
                switch (format) {
                    case 'csv':
                        if (currentResult.processedItems) {
                            content = convertToCSV(currentResult.processedItems);
                            filename = 'vaultcaddy_receipt_data.csv';
                            mimeType = 'text/csv';
                        } else {
                            throw new Error('æ²’æœ‰å¯å°å‡ºçš„CSVæ•¸æ“š');
                        }
                        break;
                        
                    case 'json':
                        content = JSON.stringify(currentResult, null, 2);
                        filename = 'vaultcaddy_result.json';
                        mimeType = 'application/json';
                        break;
                        
                    case 'excel':
                        if (typeof XLSX !== 'undefined' && currentResult.processedItems) {
                            const ws = XLSX.utils.json_to_sheet(currentResult.processedItems);
                            const wb = XLSX.utils.book_new();
                            XLSX.utils.book_append_sheet(wb, ws, "æ•¸æ“š");
                            XLSX.writeFile(wb, 'vaultcaddy_data.xlsx');
                            log('âœ… Excelæ–‡ä»¶å·²ä¸‹è¼‰');
                            return;
                        } else {
                            throw new Error('Excelå°å‡ºä¸å¯ç”¨');
                        }
                        
                    default:
                        throw new Error(`ä¸æ”¯æ´çš„æ ¼å¼: ${format}`);
                }
                
                // ä¸‹è¼‰æ–‡ä»¶
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                log(`âœ… ${format.toUpperCase()} æ–‡ä»¶å·²ä¸‹è¼‰`);
                
            } catch (error) {
                log(`âŒ å°å‡ºå¤±æ•—: ${error.message}`);
                alert(`å°å‡ºå¤±æ•—: ${error.message}`);
            }
        }
        
        // è½‰æ›ç‚ºCSV
        function convertToCSV(data) {
            if (!data || data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => `"${row[header] || ''}"`).join(','))
            ].join('\n');
            
            return csvContent;
        }
        
        // æŸ¥çœ‹æ´å¯Ÿ
        function viewInsights() {
            if (!currentResult || !currentResult.insights) {
                alert('æ²’æœ‰å¯ç”¨çš„æ´å¯Ÿä¿¡æ¯');
                return;
            }
            
            const insights = currentResult.insights;
            let message = 'ğŸ’¡ æ•¸æ“šæ´å¯Ÿ:\n\n';
            
            insights.forEach((insight, index) => {
                const icon = insight.type === 'positive' ? 'âœ…' : 
                           insight.type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
                message += `${icon} ${insight.title}\n${insight.message}\n\n`;
            });
            
            alert(message);
        }
        
        // æ—¥èªŒå‡½æ•¸
        function log(message) {
            const logSection = document.getElementById('logSection');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logSection.appendChild(logEntry);
            logSection.scrollTop = logSection.scrollHeight;
            
            console.log(message);
        }
    </script>
</body>
</html>
