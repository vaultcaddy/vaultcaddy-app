# ğŸš¨ å…³é”®è¯Šæ–­ï¼šå¦‚ä½•æ‰¾åˆ° vaultcaddy@gmail.com ç”¨æˆ·

## âŒ **æˆ‘ä¹‹å‰çš„é”™è¯¯å‡è®¾**

æˆ‘ä¹‹å‰**é”™è¯¯åœ°å‡è®¾**å›¾1ä¸­çš„ç”¨æˆ· `PxOIosAk2nUmi6x647YIdniiuFC3` æ˜¯ `vaultcaddy@gmail.com`ï¼Œä½†ï¼š
- âŒ å›¾1æ²¡æœ‰æ˜¾ç¤º `email` å­—æ®µ
- âŒ æˆ‘æ— æ³•ç¡®è®¤è¿™ä¸ªç”¨æˆ· ID å¯¹åº”çš„ email

---

## âœ… **æ­£ç¡®çš„æŸ¥æ‰¾æ–¹æ³•**

### **æ­¥éª¤ 1ï¼šåœ¨ Firebase Console ä¸­æœç´¢**

1. æ‰“å¼€ Firebase Console
   https://console.firebase.google.com/project/vaultcaddy-production-cbbe2/firestore/data/~2Fusers

2. åœ¨å³ä¸Šè§’çš„æœç´¢æ¡†ä¸­è¾“å…¥ï¼š
   ```
   email == vaultcaddy@gmail.com
   ```

3. æŸ¥çœ‹æœç´¢ç»“æœ

---

## ğŸ“‹ **å¯èƒ½çš„ç»“æœ**

### **ç»“æœ Aï¼šæ‰¾åˆ°ç”¨æˆ·**

âœ… **è¯´æ˜ï¼š** `vaultcaddy@gmail.com` ç”¨æˆ·å­˜åœ¨äº `users` é›†åˆä¸­

**è®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š**
- ç”¨æˆ· IDï¼ˆæ–‡æ¡£ IDï¼‰ï¼š_________________
- `credits` å­—æ®µï¼š_________________
- `currentCredits` å­—æ®µï¼š_________________

**ç„¶åï¼š**
- å¦‚æœ `credits` ä¸º 0ï¼Œè¯´æ˜ Credits ä»æœªå¢åŠ 
- å¦‚æœ `credits` > 0ï¼Œè¯´æ˜ä¹‹å‰æœ‰å¢åŠ è¿‡

---

### **ç»“æœ Bï¼šæœªæ‰¾åˆ°ç”¨æˆ·**

âŒ **è¯´æ˜ï¼š** `vaultcaddy@gmail.com` ç”¨æˆ·**ä¸å­˜åœ¨**äº `users` é›†åˆä¸­

**è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Credits æ— æ³•å¢åŠ çš„åŸå› ï¼**

**åŸå› ï¼š**
Stripe Webhook æ”¶åˆ°æ”¯ä»˜äº‹ä»¶åï¼Œä¼šå°è¯•åœ¨ `users` é›†åˆä¸­æŸ¥æ‰¾ `email == vaultcaddy@gmail.com` çš„ç”¨æˆ·ã€‚å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±æ— æ³•æ·»åŠ  Creditsã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤ç”¨æˆ·æ³¨å†Œæ—¶æ˜¯å¦åˆ›å»ºäº† `users` æ–‡æ¡£
2. æ£€æŸ¥æ³¨å†Œé€»è¾‘ï¼Œç¡®ä¿åœ¨ç”¨æˆ·æ³¨å†Œæ—¶åˆ›å»º `users` æ–‡æ¡£ï¼š
   ```javascript
   // åœ¨æ³¨å†Œæ—¶
   const userDoc = {
       email: email.toLowerCase(), // ç»Ÿä¸€å°å†™
       credits: 0,
       currentCredits: 0,
       emailVerified: false,
       createdAt: firebase.firestore.FieldValue.serverTimestamp()
   };
   await db.collection('users').doc(userId).set(userDoc);
   ```

---

## ğŸ” **æ·±å…¥è¯Šæ–­**

### **å¦‚æœæ‰¾åˆ°äº†ç”¨æˆ·ä½† Credits ä¸º 0**

**å¯èƒ½åŸå› ï¼š**
1. âŒ Stripe äº§å“çš„ metadata ä¸­ `monthly_credits` æœªè®¾ç½®æˆ–ä¸º 0
2. âŒ ç”¨æˆ·æœªåœ¨æœ€æ–°ä»£ç éƒ¨ç½²åè¿›è¡Œæ–°çš„æµ‹è¯•æ”¯ä»˜
3. âŒ Webhook æœªæ­£ç¡®è§¦å‘æˆ–å¤„ç†

**è§£å†³æ­¥éª¤ï¼š**
1. ç¡®è®¤ Stripe äº§å“ metadata é…ç½®æ­£ç¡®
2. è¿›è¡Œæ–°çš„æµ‹è¯•æ”¯ä»˜ï¼ˆåœ¨æœ€æ–°ä»£ç éƒ¨ç½²åï¼‰
3. æŸ¥çœ‹ Firebase Functions æ—¥å¿—

---

### **å¦‚æœæœªæ‰¾åˆ°ç”¨æˆ·**

**å¯èƒ½åŸå› ï¼š**
1. âŒ ç”¨æˆ·æ³¨å†Œæ—¶æœªåˆ›å»º `users` æ–‡æ¡£
2. âŒ `email` å­—æ®µä¸ Stripe Customer email ä¸åŒ¹é…ï¼ˆå¦‚å¤§å°å†™ä¸åŒï¼‰
3. âŒ ç”¨æˆ·ä½¿ç”¨äº†ä¸åŒçš„ email æ³¨å†Œ

**è§£å†³æ­¥éª¤ï¼š**
1. æ£€æŸ¥ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼ˆauth.htmlï¼‰
2. ç¡®è®¤æ³¨å†Œæ—¶æ˜¯å¦åˆ›å»ºäº† `users` æ–‡æ¡£
3. æ‰‹åŠ¨åˆ›å»º `users` æ–‡æ¡£ï¼ˆä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼‰

---

## ğŸ§ª **æµ‹è¯•æ­¥éª¤**

### **æ­¥éª¤ 1ï¼šç¡®è®¤ç”¨æˆ·å­˜åœ¨**

åœ¨ Firebase Console ä¸­æœç´¢ `email == vaultcaddy@gmail.com`ï¼Œè®°å½•ç»“æœ

---

### **æ­¥éª¤ 2ï¼šå¦‚æœç”¨æˆ·å­˜åœ¨ï¼Œè¿›è¡Œæ–°çš„æµ‹è¯•æ”¯ä»˜**

1. æ‰“å¼€ https://vaultcaddy.com/billing.html
2. ç‚¹å‡» **"ğŸ§ª æ¸¬è©¦ Get Started"**
3. ä½¿ç”¨æµ‹è¯•å¡ï¼š**4242 4242 4242 4242**
4. å®Œæˆæ”¯ä»˜

---

### **æ­¥éª¤ 3ï¼šæŸ¥çœ‹ Webhook æ—¥å¿—**

è¿è¡Œï¼š
```bash
firebase functions:log --only stripeWebhook 2>&1 | tail -100
```

**é¢„æœŸæ—¥å¿—ï¼š**
```
âœ… è¨‚é–±è®Šæ›´ (æ¸¬è©¦æ¨¡å¼): sub_xxx
ğŸ“‹ Subscription è©³æƒ…: {...}
ğŸ” å˜—è©¦é€šé Stripe Customer æŸ¥æ‰¾ç”¨æˆ¶: cus_xxx
ğŸ” Customer email: vaultcaddy@gmail.com
âœ… é€šé customer email æ‰¾åˆ°ç”¨æˆ¶: <ç”¨æˆ¶ID>
ğŸ‰ è¨‚é–±å·²æ¿€æ´»ï¼Œæº–å‚™æ·»åŠ  100 Credits çµ¦ç”¨æˆ¶ <ç”¨æˆ¶ID>
âœ… å·²æˆåŠŸæ·»åŠ  100 Credits çµ¦ç”¨æˆ¶ <ç”¨æˆ¶ID>
```

---

### **æ­¥éª¤ 4ï¼šç¡®è®¤ Credits æ›´æ–°**

åœ¨ Firebase Console ä¸­åˆ·æ–° `users` é›†åˆï¼ŒæŸ¥çœ‹ `vaultcaddy@gmail.com` ç”¨æˆ·çš„ `credits` å­—æ®µæ˜¯å¦å¢åŠ äº† 100

---

## ğŸ“ **ä¸‹ä¸€æ­¥è¡ŒåŠ¨**

**è¯·ç«‹å³æ‰§è¡Œæ­¥éª¤ 1ï¼Œç„¶åå‘Šè¯‰æˆ‘ï¼š**

1. âœ… **æ‰¾åˆ°äº†ç”¨æˆ·**
   - ç”¨æˆ· IDï¼š_________________
   - å½“å‰ creditsï¼š_________________
   
2. âŒ **æœªæ‰¾åˆ°ç”¨æˆ·**
   - ç¡®è®¤ç”¨æˆ·ä¸å­˜åœ¨
   - éœ€è¦æ£€æŸ¥æ³¨å†Œæµç¨‹

**åªæœ‰è¿™æ ·æˆ‘æ‰èƒ½å‡†ç¡®è¯Šæ–­é—®é¢˜ï¼** ğŸ™

