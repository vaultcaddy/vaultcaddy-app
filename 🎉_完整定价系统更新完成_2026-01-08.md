# ğŸ‰ å®Œæ•´å®šä»·ç³»ç»Ÿæ›´æ–°å®ŒæˆæŠ¥å‘Š

**å®Œæˆæ—¶é—´**: 2026-01-08  
**çŠ¶æ€**: âœ… å‰ç«¯ + åç«¯å…¨éƒ¨å®Œæˆ

---

## ğŸ“‹ å®Œæˆæ€»ç»“

### âœ… å·²å®Œæˆçš„æ‰€æœ‰å·¥ä½œ

1. **Stripe ä»·æ ¼é…ç½®** âœ…
   - åˆ›å»ºäº† 2 ä¸ªå¤šè´§å¸ä»·æ ¼å¯¹è±¡
   - æ¯ä¸ªä»·æ ¼æ”¯æŒ 6 ç§è´§å¸ï¼ˆHKD, USD, JPY, KRW, EUR, GBPï¼‰
   - åœç”¨äº†æ—§çš„ 12 ä¸ªå•ç‹¬ä»·æ ¼

2. **å‰ç«¯é¡µé¢æ›´æ–°** âœ…
   - æ›´æ–°äº† 4 ä¸ªè¯­è¨€ç‰ˆæœ¬çš„ `billing.html`
   - æ ‡é¢˜ä»"Starter å…¥é–€ç‰ˆ"æ”¹ä¸º"æœˆä»˜/å¹´ä»˜"
   - ç¡®è®¤æ‰€æœ‰æŒ‰é’®æ­£ç¡®è°ƒç”¨ `createCheckoutSession`

3. **Firebase Functions æ›´æ–°** âœ…
   - æ›´æ–°äº† `createStripeCheckoutSession` å‡½æ•°
   - ä½¿ç”¨æ–°çš„ Price ID
   - ç®€åŒ–äº†ä»·æ ¼ç³»ç»Ÿï¼ˆä»åŒä»·æ ¼æ”¹ä¸ºå•ä»·æ ¼ï¼‰

---

## ğŸ¯ æ–°çš„å®šä»·ç³»ç»Ÿ

### Stripe ä»·æ ¼é…ç½®

**Monthly Plan**:
- **Price ID**: `price_1SnF6hJmiQ31C0GT0QSOiXVI`
- **æ”¯æŒè´§å¸**: HKD, USD, JPY, KRW, EUR, GBP
- **ä»·æ ¼**:
  - ğŸ‡¨ğŸ‡³ HKD $28/æœˆ
  - ğŸ‡ºğŸ‡¸ USD $3.88/æœˆ
  - ğŸ‡¯ğŸ‡µ JPY Â¥599/æœˆ
  - ğŸ‡°ğŸ‡· KRW â‚©5,588/ì›”
  - ğŸ‡ªğŸ‡º EUR â‚¬3.28/æœˆ
  - ğŸ‡¬ğŸ‡§ GBP Â£2.88/æœˆ

**Yearly Plan**:
- **Price ID**: `price_1SnF6hJmiQ31C0GT8SvegPzM`
- **æ”¯æŒè´§å¸**: HKD, USD, JPY, KRW, EUR, GBP
- **ä»·æ ¼**:
  - ğŸ‡¨ğŸ‡³ HKD $264/å¹´ï¼ˆæ¯æœˆ $22ï¼‰
  - ğŸ‡ºğŸ‡¸ USD $34.56/å¹´ï¼ˆæ¯æœˆ $2.88ï¼‰
  - ğŸ‡¯ğŸ‡µ JPY Â¥5,748/å¹´ï¼ˆæ¯æœˆ Â¥479ï¼‰
  - ğŸ‡°ğŸ‡· KRW â‚©53,616/ë…„ï¼ˆæ¯æœˆ â‚©4,468ï¼‰
  - ğŸ‡ªğŸ‡º EUR â‚¬29.76/å¹´ï¼ˆæ¯æœˆ â‚¬2.48ï¼‰
  - ğŸ‡¬ğŸ‡§ GBP Â£22.56/å¹´ï¼ˆæ¯æœˆ Â£1.88ï¼‰

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. å‰ç«¯ï¼ˆBilling Pagesï¼‰

**4ä¸ªè¯­è¨€ç‰ˆæœ¬çš„æ ‡é¢˜**:
| è¯­è¨€ | æœˆä»˜æ ‡é¢˜ | å¹´ä»˜æ ‡é¢˜ |
|------|---------|---------|
| ğŸ‡¨ğŸ‡³ ä¸­æ–‡ | æœˆä»˜ | å¹´ä»˜ |
| ğŸ‡ºğŸ‡¸ è‹±æ–‡ | Monthly | Yearly |
| ğŸ‡¯ğŸ‡µ æ—¥æ–‡ | æœˆæ‰•ã„ | å¹´æ‰•ã„ |
| ğŸ‡°ğŸ‡· éŸ©æ–‡ | ì›”ê°„ | ì—°ê°„ |

**æŒ‰é’®å®ç°**:
```html
<!-- æœˆä»˜æŒ‰é’® -->
<button onclick="createCheckoutSession('monthly', event)">å¼€å§‹ä½¿ç”¨</button>

<!-- å¹´ä»˜æŒ‰é’® -->
<button onclick="createCheckoutSession('yearly', event)">å¼€å§‹ä½¿ç”¨</button>
```

### 2. åç«¯ï¼ˆFirebase Functionsï¼‰

**æ›´æ–°çš„ Price ID é…ç½®**:
```javascript
// ç”Ÿäº§ç¯å¢ƒä»·æ ¼
const productionPriceMapping = {
    monthly: 'price_1SnF6hJmiQ31C0GT0QSOiXVI',  // æœˆè´¹
    yearly: 'price_1SnF6hJmiQ31C0GT8SvegPzM'    // å¹´è´¹
};
```

**ç®€åŒ–çš„ Checkout Session åˆ›å»º**:
```javascript
const session = await stripeClient.checkout.sessions.create({
    mode: 'subscription',
    line_items: [{
        price: selectedPriceId,  // å•ä¸€ä»·æ ¼ IDï¼ˆåŒ…å«æ‰€æœ‰è´§å¸ï¼‰
        quantity: 1
    }],
    customer_email: email,
    metadata: { userId, planType }
});
```

---

## ğŸ“‚ æ›´æ–°çš„æ–‡ä»¶åˆ—è¡¨

### å‰ç«¯æ–‡ä»¶ âœ…
1. `/Users/cavlinyeung/ai-bank-parser/billing.html`
2. `/Users/cavlinyeung/ai-bank-parser/en/billing.html`
3. `/Users/cavlinyeung/ai-bank-parser/jp/billing.html`
4. `/Users/cavlinyeung/ai-bank-parser/kr/billing.html`

### åç«¯æ–‡ä»¶ âœ…
5. `/Users/cavlinyeung/ai-bank-parser/firebase-functions/index.js`

### Stripe é…ç½® âœ…
6. åˆ›å»ºäº† 2 ä¸ªæ–°çš„å¤šè´§å¸ä»·æ ¼
7. åœç”¨äº† 12 ä¸ªæ—§çš„å•è´§å¸ä»·æ ¼

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. éƒ¨ç½² Firebase Functions âš ï¸ å¿…é¡»

```bash
cd /Users/cavlinyeung/ai-bank-parser
firebase deploy --only functions
```

**é‡è¦**ï¼šå¿…é¡»éƒ¨ç½² Firebase Functions åï¼Œæ–°çš„ä»·æ ¼æ‰ä¼šç”Ÿæ•ˆï¼

### 2. éªŒè¯éƒ¨ç½²

éƒ¨ç½²å®Œæˆåï¼š
1. æ£€æŸ¥ Firebase Console çš„ Functions æ—¥å¿—
2. ç¡®è®¤å‡½æ•°éƒ¨ç½²æˆåŠŸ
3. æµ‹è¯•æ”¯ä»˜æµç¨‹

---

## ğŸ§ª æµ‹è¯•æ¸…å•

### å¿…é¡»æµ‹è¯• âš ï¸

- [ ] **ä¸­æ–‡ç‰ˆæœ¬**
  - [ ] ç‚¹å‡»"æœˆä»˜"çš„"é–‹å§‹ä½¿ç”¨"æŒ‰é’®
  - [ ] ç¡®è®¤è·³è½¬åˆ° Stripe Checkout é¡µé¢
  - [ ] ç¡®è®¤ä»·æ ¼æ˜¾ç¤ºä¸º HKD $28/æœˆ
  - [ ] ç‚¹å‡»"å¹´ä»˜"çš„"é–‹å§‹ä½¿ç”¨"æŒ‰é’®
  - [ ] ç¡®è®¤ä»·æ ¼æ˜¾ç¤ºä¸º HKD $264/å¹´

- [ ] **è‹±æ–‡ç‰ˆæœ¬**
  - [ ] æµ‹è¯• Monthly å’Œ Yearly æŒ‰é’®
  - [ ] ç¡®è®¤ä»·æ ¼æ˜¾ç¤ºä¸º USD

- [ ] **æ—¥æ–‡ç‰ˆæœ¬**
  - [ ] æµ‹è¯•æœˆæ‰•ã„å’Œå¹´æ‰•ã„æŒ‰é’®
  - [ ] ç¡®è®¤ä»·æ ¼æ˜¾ç¤ºä¸º JPY

- [ ] **éŸ©æ–‡ç‰ˆæœ¬**
  - [ ] æµ‹è¯•ì›”ê°„å’Œì—°ê°„æŒ‰é’®
  - [ ] ç¡®è®¤ä»·æ ¼æ˜¾ç¤ºä¸º KRW

### æ”¯ä»˜æµç¨‹æµ‹è¯•

ä½¿ç”¨ Stripe æµ‹è¯•å¡æµ‹è¯•ï¼š
- [ ] æˆåŠŸæ”¯ä»˜åè·³è½¬åˆ° success_url
- [ ] å–æ¶ˆæ”¯ä»˜åè·³è½¬åˆ° cancel_url
- [ ] è®¢é˜…åœ¨ Stripe Dashboard ä¸­æ­£ç¡®åˆ›å»º
- [ ] ç”¨æˆ·åœ¨ Firestore ä¸­çš„æ•°æ®æ­£ç¡®æ›´æ–°

---

## ğŸ’¡ é‡è¦è¯´æ˜

### 1. ä»·æ ¼ç³»ç»Ÿç®€åŒ–

**æ—§ç³»ç»Ÿ**ï¼ˆå·²åºŸå¼ƒï¼‰:
- ä½¿ç”¨ basePriceId + usagePriceId åŒä»·æ ¼ç³»ç»Ÿ
- ä½¿ç”¨ Billing Meters è¿›è¡ŒæŒ‰é‡è®¡è´¹
- æ¯ç§è´§å¸æœ‰å•ç‹¬çš„ä»·æ ¼

**æ–°ç³»ç»Ÿ**ï¼ˆå½“å‰ï¼‰:
- ä½¿ç”¨å•ä¸€ Price ID
- æ¯ä¸ª Price ID åŒ…å« 6 ç§è´§å¸é€‰é¡¹
- Stripe æ ¹æ®ç”¨æˆ·åœ°åŒºè‡ªåŠ¨é€‰æ‹©è´§å¸

### 2. è´§å¸é€‰æ‹©

Stripe ä¼šæ ¹æ®ä»¥ä¸‹å› ç´ è‡ªåŠ¨é€‰æ‹©è´§å¸ï¼š
- ç”¨æˆ·çš„åœ°ç†ä½ç½®ï¼ˆIP åœ°å€ï¼‰
- æµè§ˆå™¨è¯­è¨€è®¾ç½®
- ä¿¡ç”¨å¡å‘å¡åœ°åŒº

å¦‚æœéœ€è¦æ‰‹åŠ¨æŒ‡å®šè´§å¸ï¼Œå¯ä»¥åœ¨åˆ›å»º Checkout Session æ—¶æ·»åŠ  `currency` å‚æ•°ï¼š

```javascript
const session = await stripe.checkout.sessions.create({
    // ...å…¶ä»–å‚æ•°
    currency: 'usd'  // æˆ– 'hkd', 'jpy', 'krw', 'eur', 'gbp'
});
```

### 3. æµ‹è¯•æ¨¡å¼

å½“å‰æµ‹è¯•æ¨¡å¼ï¼ˆ`isTest=true`ï¼‰ä½¿ç”¨çš„æ˜¯ç”Ÿäº§ç¯å¢ƒçš„ä»·æ ¼ã€‚

**å»ºè®®**ï¼šåœ¨ Stripe Test Mode ä¸­åˆ›å»ºæµ‹è¯•ä¸“ç”¨çš„ä»·æ ¼ï¼š
- ä½¿ç”¨ç›¸åŒçš„ä»·æ ¼é‡‘é¢
- ä½†ä½¿ç”¨æµ‹è¯•æ¨¡å¼çš„ Price ID
- è¿™æ ·å¯ä»¥é¿å…æ„å¤–ä½¿ç”¨ç”Ÿäº§ä»·æ ¼è¿›è¡Œæµ‹è¯•

---

## ğŸ“Š å®šä»·ç­–ç•¥

### æ–¹æ¡ˆç‰¹ç‚¹
âœ… **å•å±‚å®šä»·**: åªæœ‰ Starter å…¥é—¨ç‰ˆ  
âœ… **ä¸¤ç§å‘¨æœŸ**: æœˆä»˜å’Œå¹´ä»˜  
âœ… **å…­ç§è´§å¸**: è¦†ç›–ä¸»è¦å¸‚åœº  
âœ… **å¹´ä»˜ä¼˜æƒ **: å¹³å‡èŠ‚çœ 20-35%

### åŒ…å«å†…å®¹
- **æœˆä»˜**: 100 ç§¯åˆ†/æœˆï¼Œè¶…å‡ºåæ¯é¡µé¢å¤–ä»˜è´¹
- **å¹´ä»˜**: 1,200 ç§¯åˆ†/å¹´ï¼Œè¶…å‡ºåæ¯é¡µé¢å¤–ä»˜è´¹

### è¶…å‡ºä»·æ ¼ï¼ˆæ¯é¡µï¼‰
- HKD: $0.3
- USD: $0.038
- JPY: Â¥6
- KRW: â‚©55
- EUR: â‚¬0.038
- GBP: Â£0.038

---

## ğŸŠ æœ€ç»ˆçŠ¶æ€

### âœ… å…¨éƒ¨å®Œæˆ

1. **Stripe é…ç½®** âœ…
   - 2 ä¸ªå¤šè´§å¸ä»·æ ¼å¯¹è±¡å·²åˆ›å»º
   - æ—§ä»·æ ¼å·²åœç”¨

2. **å‰ç«¯é¡µé¢** âœ…
   - 4 ä¸ªè¯­è¨€ç‰ˆæœ¬å…¨éƒ¨æ›´æ–°
   - æ ‡é¢˜å’ŒæŒ‰é’®å…¨éƒ¨æ­£ç¡®

3. **åç«¯ Functions** âœ…
   - Price ID å·²æ›´æ–°
   - ä»£ç å·²ç®€åŒ–

### âš ï¸ å¾…éƒ¨ç½²

**å¿…é¡»æ‰§è¡Œ**: `firebase deploy --only functions`

éƒ¨ç½²å®Œæˆåï¼Œæ•´ä¸ªæ–°å®šä»·ç³»ç»Ÿå°†æ­£å¼ä¸Šçº¿ï¼

---

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥ Firebase Functions æ—¥å¿—
2. æ£€æŸ¥ Stripe Dashboard çš„ Events å’Œ Logs
3. ç¡®è®¤ Price ID é…ç½®æ­£ç¡®
4. æµ‹è¯•ä¸åŒè´§å¸çš„æ”¯ä»˜æµç¨‹

---

**æŠ¥å‘Šå®Œæˆæ—¶é—´**: 2026-01-08  
**ç³»ç»ŸçŠ¶æ€**: âœ… ä»£ç å…¨éƒ¨å®Œæˆï¼Œç­‰å¾…éƒ¨ç½²  
**ä¸‹ä¸€æ­¥**: æ‰§è¡Œ `firebase deploy --only functions`


