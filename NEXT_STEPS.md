# ğŸ¯ æ‚¨ç¾åœ¨éœ€è¦åšçš„äº‹ï¼ˆ10 åˆ†é˜ï¼‰

**éƒ¨ç½²ç‹€æ…‹**: âœ… Firebase Functions å·²æˆåŠŸéƒ¨ç½²ï¼

---

## âœ… å·²å®Œæˆï¼ˆè‡ªå‹•ï¼‰

1. âœ… Firebase Functions éƒ¨ç½²ï¼ˆ5 å€‹å‡½æ•¸ï¼‰
2. âœ… ç’°å¢ƒè®Šæ•¸é…ç½®ï¼ˆStripe + Qwen APIï¼‰
3. âœ… èˆŠå‡½æ•¸æ¸…ç†ï¼ˆ13 å€‹èˆŠå‡½æ•¸å·²åˆªé™¤ï¼‰
4. âœ… å®Œæ•´æ–‡æª”å‰µå»ºï¼ˆ7 å€‹æŒ‡å—æ–‡ä»¶ï¼‰

---

## ğŸ”´ å¾…æ‚¨å®Œæˆï¼ˆéœ€è¦æ‰‹å‹•æ“ä½œï¼‰

### ä»»å‹™ 1: é©—è­‰ Stripe Webhookï¼ˆ5 åˆ†é˜ï¼‰â­â­â­â­â­

**ç‚ºä»€éº¼éœ€è¦**: è®“ Stripe çŸ¥é“åœ¨è¨‚é–±/ä»˜æ¬¾æˆåŠŸæ™‚é€šçŸ¥æˆ‘å€‘çš„æ–°å‡½æ•¸

**æ­¥é©Ÿ**:

1. **æ‰“é–‹ Stripe Webhooks**
   - è¨ªå•ï¼šhttps://dashboard.stripe.com/webhooks

2. **æª¢æŸ¥ Webhook URL**
   - æŸ¥æ‰¾æ˜¯å¦æœ‰æŒ‡å‘ä»¥ä¸‹ URL çš„ç«¯é»ï¼š
     ```
     https://us-central1-vaultcaddy-production-cbbe2.cloudfunctions.net/stripeWebhook
     ```

3. **å…©ç¨®æƒ…æ³**:

   **æƒ…æ³ A: æ‰¾åˆ°èˆŠçš„ Webhookï¼ˆURL ä¸åŒï¼‰**
   ```
   â†’ é»æ“Šè©²ç«¯é»
   â†’ é»æ“Šã€Œâ‹®ã€â†’ã€ŒUpdate detailsã€
   â†’ æ›´æ–° URL ç‚ºæ–°çš„ Firebase Function URL
   â†’ ä¿å­˜
   ```

   **æƒ…æ³ B: æ²’æœ‰æ‰¾åˆ°ä»»ä½• Webhook**
   ```
   â†’ é»æ“Šã€Œ+ Add endpointã€
   â†’ å¡«å…¥æ–°çš„ Firebase Function URL
   â†’ é¸æ“‡ 6 å€‹äº‹ä»¶ï¼ˆè¦‹ä¸‹æ–¹ï¼‰
   â†’ ä¿å­˜
   ```

4. **ç¢ºèªç›£è½çš„äº‹ä»¶ï¼ˆå¿…é ˆå…¨é¸ 6 å€‹ï¼‰**:
   - âœ… checkout.session.completed
   - âœ… customer.subscription.created
   - âœ… customer.subscription.updated
   - âœ… customer.subscription.deleted
   - âœ… invoice.payment_succeeded
   - âœ… invoice.payment_failed

5. **ç™¼é€æ¸¬è©¦äº‹ä»¶**:
   ```
   â†’ åœ¨ Webhook é é¢é»æ“Šã€ŒSend test webhookã€
   â†’ é¸æ“‡ã€Œinvoice.payment_succeededã€
   â†’ é»æ“Šã€ŒSend test webhookã€
   â†’ çœ‹åˆ°ã€Œ200 OKã€å°±æˆåŠŸäº†ï¼
   ```

---

### ä»»å‹™ 2: æ¸¬è©¦æ–‡ä»¶ä¸Šå‚³ï¼ˆ5 åˆ†é˜ï¼‰â­â­â­

**ç‚ºä»€éº¼éœ€è¦**: é©—è­‰æ–°çš„ Firebase Function æ­£å¸¸å·¥ä½œ

**æ­¥é©Ÿ**:

1. **è¨ªå•ç¶²ç«™**
   - https://vaultcaddy.com

2. **ç™»å…¥ä¸¦ä¸Šå‚³æ–‡ä»¶**
   - é¸æ“‡ä¸€å€‹ 5 é çš„ PDF
   - é»æ“Šä¸Šå‚³

3. **é æœŸçµæœ**:
   - âœ… è™•ç†æˆåŠŸ
   - âœ… è€—æ™‚ç´„ 50 ç§’ï¼ˆ5 é  Ã— 10 ç§’ï¼‰
   - âœ… æ•¸æ“šæå–æ­£ç¢º
   - âœ… Credits æ‰£é™¤ 5

---

## ğŸ“Š å®Œæˆå¾Œçš„ç‹€æ…‹

### âœ… å®Œæ•´è¶…é¡è¨ˆè²»ç³»çµ±å·²å•Ÿç”¨

```
ç”¨æˆ¶ä¸Šå‚³æ–‡ä»¶
    â†“
âœ… è‡ªå‹•æ‰£é™¤ Credits
    â†“
âœ… è‡ªå‹•æª¢æ¸¬è¶…é¡ï¼ˆå¦‚æœ Credits < 0ï¼‰
    â†“
âœ… è‡ªå‹•å ±å‘Šåˆ° Stripe
    â†“
âœ… ä¸‹å€‹è¨ˆè²»æ—¥ Stripe è‡ªå‹•æ”¶è²»
    â†“
âœ… Webhook é€šçŸ¥æˆ‘å€‘ â†’ é‡ç½® Credits
```

### ğŸ’° è¨ˆè²»é‚è¼¯

**æœˆä»˜**ï¼ˆä¾‹å¦‚ï¼š1æœˆ10æ—¥è¨‚é–±ï¼‰
- 1æœˆ10æ—¥ï¼šæ”¯ä»˜ $38ï¼Œç²å¾— 100 Credits
- 2æœˆ10æ—¥ï¼šè‡ªå‹•æ”¶è²» $38ï¼ˆæœˆè²»ï¼‰+ è¶…é¡è²»ç”¨ï¼Œé‡ç½® Credits

**å¹´ä»˜**ï¼ˆä¾‹å¦‚ï¼š1æœˆ10æ—¥è¨‚é–±ï¼‰
- 1æœˆ10æ—¥ï¼šæ”¯ä»˜ $336ï¼Œç²å¾— 1200 Credits
- æ¯æœˆ10æ—¥ï¼šåƒ…æ”¶å–è¶…é¡è²»ç”¨ï¼ŒCredits ä¸é‡ç½®
- ä¸‹å¹´1æœˆ10æ—¥ï¼šæ”¶å–å¹´è²»ï¼Œé‡ç½® Credits

---

## ğŸ“ ç›¸é—œæ–‡æª”ï¼ˆæŒ‰éœ€æŸ¥çœ‹ï¼‰

| å¦‚æœæ‚¨æƒ³... | æŸ¥çœ‹æ–‡æª” |
|-------------|----------|
| äº†è§£å®Œæ•´éƒ¨ç½²ç‹€æ…‹ | `DEPLOYMENT_SUCCESS_2026-01-29.md` |
| è¨­ç½® Webhook çš„è©³ç´°æ­¥é©Ÿ | `STRIPE_WEBHOOK_SETUP_GUIDE.md` |
| é©—è­‰ Webhook é…ç½® | `WEBHOOK_VERIFICATION_STEPS.md` |
| äº†è§£è¨ˆè²»æµç¨‹ | `OVERAGE_BILLING_FLOW.md` |
| æŸ¥çœ‹å®Œæ•´åŠŸèƒ½ç¸½çµ | `FINAL_SUMMARY_2026-01-29.md` |

---

## â“ å¸¸è¦‹å•é¡Œ

### Q: å¦‚æœ Webhook æ¸¬è©¦å¤±æ•—æ€éº¼è¾¦ï¼Ÿ

**A**: æª¢æŸ¥ Firebase æ—¥èªŒ
1. è¨ªå•ï¼šhttps://console.firebase.google.com/project/vaultcaddy-production-cbbe2/functions/logs
2. ç¯©é¸ï¼š`stripeWebhook`
3. æŸ¥çœ‹éŒ¯èª¤è¨Šæ¯

### Q: å¦‚æœæ–‡ä»¶ä¸Šå‚³å¾ˆæ…¢æˆ–å¤±æ•—ï¼Ÿ

**A**: æª¢æŸ¥ qwenProxy æ—¥èªŒ
1. è¨ªå•ï¼šhttps://console.firebase.google.com/project/vaultcaddy-production-cbbe2/functions/logs
2. ç¯©é¸ï¼š`qwenProxy`
3. æŸ¥çœ‹æ˜¯å¦æœ‰ API éŒ¯èª¤

### Q: å¦‚ä½•ç¢ºèªè¶…é¡è¨ˆè²»æ­£å¸¸å·¥ä½œï¼Ÿ

**A**: 
1. ä¸Šå‚³è¶…é 100 é çš„æ–‡ä»¶
2. æª¢æŸ¥ Firestoreï¼š`credits` æ‡‰ç‚ºè² æ•¸
3. è¨ªå• Stripe Dashboard â†’ Subscriptions â†’ é¸æ“‡ç”¨æˆ¶ â†’ æŸ¥çœ‹ã€ŒUsageã€æ¨™ç±¤
4. æ‡‰è©²çœ‹åˆ°è¶…é¡é æ•¸è¨˜éŒ„

---

## ğŸ‰ å®Œæˆå¾Œ

**æ­å–œï¼æ‚¨çš„ VaultCaddy è¶…é¡è¨ˆè²»ç³»çµ±å·²å®Œå…¨å•Ÿç”¨ï¼**

- âœ… ç”¨æˆ¶å¯ä»¥ä¸Šå‚³æ–‡ä»¶
- âœ… è‡ªå‹•æ‰£é™¤ Credits
- âœ… è¶…é¡è‡ªå‹•è¨ˆè²»
- âœ… è¨‚é–±è‡ªå‹•çºŒè²»
- âœ… å®Œå…¨è‡ªå‹•åŒ–ï¼Œç„¡éœ€æ‰‹å‹•æ“ä½œ

---

**éœ€è¦å¹«åŠ©ï¼Ÿ** æŸ¥çœ‹ä¸Šè¿°æ–‡æª”æˆ–æŸ¥çœ‹ Firebase/Stripe æ—¥èªŒ


