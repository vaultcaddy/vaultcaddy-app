<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="page_title_dashboard">å„€è¡¨æ¿ - VaultCaddy</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="pages.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script src="config.js"></script>
    <script src="google-auth.js"></script>
    <script src="translations.js"></script>
    <script src="unified-auth.js"></script>
    <script src="global-auth-sync.js"></script>
    <script src="navbar-component.js"></script>
    <script src="sidebar-component.js"></script>
    <!-- è¼‰å…¥çµ±ä¸€è™•ç†å™¨ç³»çµ± -->
    <script src="google-ai-integration.js"></script>
    <script src="google-document-ai.js"></script>
    <script src="google-vision-ai.js"></script>
    <script src="google-smart-processor.js"></script>
    <script src="google-cloud-storage.js"></script>
    <script src="ledgerbox-integration.js"></script>
    
    <!-- è¼‰å…¥æ–°çš„OCRå’Œæ•¸æ“šè™•ç†å™¨ -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="tesseract-ocr-processor.js"></script>
    <script src="data-processor.js"></script>
    <script src="intelligent-ocr-processor.js"></script>
    
    <!-- è¼‰å…¥çµ±ä¸€è™•ç†å™¨ -->
    <script src="unified-document-processor.js"></script>
    
    <!-- åœç”¨çš„è™•ç†å™¨ï¼ˆä¿ç•™ä»¥é˜²éœ€è¦ï¼‰ -->
    <!-- <script src="ai-document-processor.js"></script> -->
    <!-- <script src="ai-services.js"></script> -->
    <!-- <script src="enhanced-file-processor.js"></script> -->
    <link rel="stylesheet" href="ledgerbox-styles.css">
    
    <style>
        /* ç™½è‰²ä¸»é¡Œæ¨£å¼ */
        body {
            background: #ffffff !important;
            color: #1f2937 !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .dashboard-container {
            display: flex;
            min-height: 100vh;
            background: #ffffff;
            padding-top: 60px; /* ç‚ºå°èˆªæ¬„ç•™å‡ºç©ºé–“ */
        }
        
        .sidebar {
            width: 280px;
            background: #ffffff;
            border-right: 1px solid #e5e7eb;
            flex-shrink: 0;
            position: fixed;
            top: 60px;
            bottom: 0;
            left: 0;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
        }
        
        .sidebar-header {
            padding: 1.5rem 1rem 1rem 1rem;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .sidebar-header h2 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }
        
        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
        }
        
        .sidebar-nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .sidebar-nav .nav-item {
            margin: 0;
        }
        
        .sidebar-nav .nav-item a {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: #6b7280;
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        
        .sidebar-nav .nav-item.active a {
            background: #eff6ff;
            color: #2563eb;
            border-left-color: #2563eb;
        }
        
        .sidebar-nav .nav-item a:hover {
            background: #f1f5f9;
            color: #374151;
        }
        
        .sidebar-nav .nav-item a i {
            width: 20px;
            margin-right: 0.75rem;
            font-size: 1rem;
        }
        
        .sidebar-section {
            padding: 1rem 0;
            border-top: 1px solid #e2e8f0;
        }
        
        .sidebar-section h3 {
            font-size: 0.75rem;
            font-weight: 600;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 0 0 0.5rem 1rem;
        }
        
        .sidebar-footer {
            padding: 1rem;
            border-top: 1px solid #e2e8f0;
            background: #ffffff;
        }
        
        .sidebar-stats {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
        }
        
        .stat-item:last-child {
            margin-bottom: 0;
        }
        
        .stat-left {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .stat-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1f2937;
        }
        
        .main-content {
            flex: 1;
            background: #ffffff;
            margin-left: 280px;
            overflow-y: auto;
            min-height: calc(100vh - 60px);
        }
        
        .page-header {
            padding: 2rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #ffffff;
        }
        
        .team-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .team-icon {
            width: 48px;
            height: 48px;
            background: #fbbf24;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        
        .team-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .team-details h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }
        
        .subscription-badge {
            background: #3b82f6;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            width: fit-content;
        }
        
        .subscription-badge::after {
            content: 'â–¼';
            font-size: 0.6rem;
            opacity: 0.8;
        }
        
        .project-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .project-btn:hover {
            background: #2563eb;
        }
        
        .controls-bar {
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e2e8f0;
            background: #ffffff;
        }
        
        .filter-input {
            background: #ffffff;
            border: 1px solid #d1d5db;
            color: #1f2937;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            width: 300px;
            font-size: 14px;
        }
        
        .filter-input::placeholder {
            color: #9ca3af;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .actions {
            display: flex;
            gap: 1rem;
        }
        
        .upload-btn {
            background: #6366f1;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .upload-btn:hover {
            background: #4f46e5;
        }
        
        .view-btn {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        .view-btn:hover {
            background: #e5e7eb;
        }
        
        .documents-table-container {
            padding: 2rem;
            background: #ffffff;
            flex: 1;
            overflow-x: auto;
        }
        
        .folder-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
            max-width: 1200px;
        }
        
        .folder-item {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-height: 180px;
            justify-content: center;
        }
        
        .folder-item:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
            transform: translateY(-2px);
        }
        
        .folder-icon {
            width: 64px;
            height: 64px;
            background: #f3f4f6;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            position: relative;
        }
        
        .folder-icon i {
            font-size: 2rem;
            color: #6b7280;
        }
        
        .folder-icon::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 8px;
            width: 20px;
            height: 8px;
            background: #f3f4f6;
            border-radius: 4px 4px 0 0;
        }
        
        .folder-name {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .folder-files-count {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }
        
        .folder-updated {
            font-size: 0.75rem;
            color: #9ca3af;
        }
        
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 3rem;
            color: #6b7280;
        }
        
        .empty-state-icon {
            font-size: 4rem;
            color: #d1d5db;
            margin-bottom: 1rem;
        }
        
        .empty-state h3 {
            font-size: 1.25rem;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .empty-state p {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .documents-table {
            width: 100%;
            min-width: 1200px; /* ç¢ºä¿è¡¨æ ¼æœ€å°å¯¬åº¦ï¼Œè§¸ç™¼æ°´å¹³æ»¾å‹• */
            border-collapse: collapse;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .documents-table thead th {
            background: #f8fafc;
            color: #374151;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid #e2e8f0;
            white-space: nowrap; /* é˜²æ­¢æ¨™é¡Œæ–‡å­—æ›è¡Œ */
            font-size: 14px;
        }
        
        .documents-table tbody tr {
            border-bottom: 1px solid #f3f4f6;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .documents-table tbody tr:hover {
            background: #f9fafb;
        }
        
        .documents-table tbody tr:last-child {
            border-bottom: none;
        }
        
        .documents-table tbody td {
            padding: 1rem;
            color: #374151;
            vertical-align: middle;
            white-space: nowrap; /* é˜²æ­¢å–®å…ƒæ ¼å…§å®¹æ›è¡Œ */
            font-size: 14px;
        }
        
        .document-cell {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .file-icon {
            color: #ef4444;
            font-size: 1.5rem;
        }
        
        .doc-name {
            font-weight: 600;
            color: #1f2937;
        }
        
        .doc-details {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        .period-info {
            color: #6b7280;
        }
        
        .reconciliation {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .reconciliation-text {
            font-weight: 600;
        }
        
        .progress-bar {
            width: 100px;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #10b981;
            transition: width 0.3s;
        }
        
        .progress-percentage {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .reconciliation-status {
            font-size: 0.75rem;
            color: #fbbf24;
        }
        
        .balance-info {
            font-size: 0.875rem;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .status-badge.success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .review-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .review-badge.review {
            background: rgba(249, 115, 22, 0.2);
            color: #f97316;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .action-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }
        
        .pagination-info {
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #6b7280;
            border-top: 1px solid #e2e8f0;
            background: #ffffff;
            font-size: 14px;
        }
        
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .rows-per-page {
            background: #ffffff;
            border: 1px solid #d1d5db;
            color: #374151;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .rows-per-page:focus {
            outline: none;
            border-color: #6366f1;
        }
        
        .pagination-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .page-btn {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            color: #374151;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .page-btn:hover:not(:disabled) {
            background: #e5e7eb;
        }
        
        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* å¯ç·¨è¼¯è¼¸å…¥æ¡†æ¨£å¼ */
        .editable-input {
            border: 1px solid transparent;
            background: transparent;
            padding: 0.5rem;
            font-size: 14px;
            color: #374151;
            width: 100%;
            box-sizing: border-box;
            transition: all 0.2s;
        }
        
        .editable-input:hover {
            border-color: #d1d5db;
            background: #f9fafb;
        }
        
        .editable-input:focus {
            outline: none;
            border-color: #6366f1;
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .editable-input[readonly] {
            background: #f3f4f6;
            color: #6b7280;
            cursor: not-allowed;
        }
        
        .editable-input[readonly]:hover {
            border-color: transparent;
            background: #f3f4f6;
        }
        
        .date-input {
            min-width: 140px;
        }
        
        .description-input {
            min-width: 200px;
        }
        
        .amount-input,
        .balance-input {
            min-width: 100px;
            text-align: right;
        }
        
        .delete-transaction-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .delete-transaction-btn:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        /* æ–‡æª”è©³ç´°è¦–åœ–æ¨£å¼ */
        .back-navigation {
            padding: 1rem 2rem;
            border-bottom: 1px solid #334155;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }
        
        .back-btn:hover {
            color: #e2e8f0;
        }
        
        .document-detail-container {
            display: flex;
            min-height: calc(100vh - 200px);
            height: auto;
        }
        
        .pdf-preview-container {
            width: 40%;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            background: #ffffff;
        }
        
        .pdf-controls {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 1rem;
            background: #f8fafc;
        }
        
        .pdf-control-btn {
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            color: #475569;
            padding: 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pdf-control-btn:hover {
            background: #e2e8f0;
            border-color: #cbd5e1;
        }
        
        .page-info {
            color: #64748b;
            font-weight: 500;
        }
        
        .pdf-viewer {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            padding: 2rem;
        }
        
        .pdf-placeholder {
            text-align: center;
            color: #64748b;
            padding: 2rem;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            background: #ffffff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .pdf-placeholder i {
            font-size: 3rem;
            color: #3b82f6;
            margin-bottom: 1rem;
        }
        
        .pdf-placeholder h3 {
            color: #1f2937;
            margin: 0 0 0.5rem 0;
        }
        
        .pdf-placeholder p {
            color: #6b7280;
            margin: 0;
        }
        
        .pdf-placeholder i {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .data-extraction-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }
        
        .extraction-header {
            padding: 1rem 2rem;
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .extraction-header h2 {
            font-size: 1.5rem;
            color: #e2e8f0;
            margin: 0;
        }
        
        .extraction-tabs {
            display: flex;
            gap: 1rem;
        }
        
        .tab-btn {
            background: none;
            border: none;
            color: #94a3b8;
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .tab-btn.active {
            color: #8b5cf6;
            border-bottom-color: #8b5cf6;
        }
        
        .document-actions {
            display: flex;
            gap: 1rem;
        }
        
        .save-btn, .download-btn, .more-actions-btn {
            background: #475569;
            border: none;
            color: #e2e8f0;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .reconciliation-status {
            padding: 1rem 2rem;
            border-bottom: 1px solid #334155;
        }
        
        .reconciliation-status h3 {
            color: #e2e8f0;
            margin: 0 0 0.5rem 0;
        }
        
        .completion-status {
            color: #fbbf24;
            font-weight: 600;
        }
        
        .bank-statement-details {
            padding: 1rem 2rem;
            border-bottom: 1px solid #334155;
        }
        
        .bank-statement-details h3 {
            color: #e2e8f0;
            margin: 0;
        }
        
        .transactions-section {
            flex: 1;
            padding: 1rem 2rem;
        }
        
        .transactions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .transactions-header h3 {
            color: #e2e8f0;
            margin: 0;
        }
        
        .transaction-controls {
            display: flex;
            gap: 1rem;
        }
        
        .control-btn {
            background: #475569;
            border: none;
            color: #e2e8f0;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .add-btn {
            background: #8b5cf6;
        }
        
        .transaction-info {
            margin-bottom: 1rem;
            color: #94a3b8;
        }
        
        .transactions-table-container {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .transactions-table {
            width: 100%;
            border-collapse: collapse;
            background: #ffffff;
        }
        
        .transactions-table thead th {
            background: #f8fafc;
            color: #374151;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .transactions-table tbody tr {
            border-bottom: 1px solid #e5e7eb;
        }
        
        .transactions-table tbody tr:last-child {
            border-bottom: none;
        }
        
        .transactions-table tbody td {
            padding: 0.75rem;
            color: #374151;
        }
        
        .transaction-checkbox {
            margin: 0;
        }
        
        .delete-transaction-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0.25rem;
        }
        
        .delete-transaction-btn:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        .view-container {
            height: 100%;
        }
        
        /* å¯ç·¨è¼¯è¡¨æ ¼æ¨£å¼ */
        .editable-input {
            width: 100%;
            border: 1px solid transparent;
            background: transparent;
            padding: 0.5rem;
            font-size: 14px;
            color: #374151;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .editable-input:focus {
            outline: none;
            border-color: #6366f1;
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .editable-input:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        
        .date-input {
            min-width: 140px;
        }
        
        .description-input {
            min-width: 200px;
        }
        
        .amount-input, .balance-input {
            min-width: 100px;
            text-align: right;
        }
        
        .transaction-row:hover .editable-input {
            border-color: #d1d5db;
        }
        
        .delete-transaction-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .delete-transaction-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }
        
        /* å´é‚Šæ¬„æœç´¢æ¬„ */
        .sidebar-search {
            margin-bottom: 1.5rem;
        }
        
        .search-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: #ffffff;
            color: #1f2937;
            font-size: 0.875rem;
        }
        
        .search-input::placeholder {
            color: #9ca3af;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* é …ç›®å€å¡Š */
        .project-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        
        .project-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
        }
        
        .add-project-btn {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .add-project-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }
        
        .project-item {
            display: flex;
            align-items: center;
            padding: 0.5rem 0;
            color: #6b7280;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .project-item:hover {
            color: #374151;
        }
        
        .project-item i {
            margin-right: 0.75rem;
            width: 16px;
        }
        
        /* é…ç½®å€å¡Š */
        .config-item {
            display: flex;
            align-items: center;
            padding: 0.5rem 0;
            color: #6b7280;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .config-item:hover {
            color: #374151;
        }
        
        .config-item i {
            margin-right: 0.75rem;
            width: 16px;
        }
<body>
    <!-- å°èˆªæ¬„ -->
    <div id="navbar-placeholder"></div>

    <!-- Dashboard å®¹å™¨ -->
    <div class="dashboard-container">
        <!-- å·¦å´é‚Šæ¬„ -->
        <aside class="sidebar">
            <!-- æœç´¢æ¬„ -->
            <div class="sidebar-search">
                <input type="text" placeholder="ç¯©é¸æ–‡æª”åç¨±..." class="search-input">
            </div>
            
            <!-- é …ç›®å€å¡Š -->
            <div class="sidebar-section">
                <div class="project-header">
                    <span class="project-title">project</span>
                    <button class="add-project-btn">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="project-item">
                    <i class="fas fa-folder"></i>
                    <span>Team project</span>
                </div>
            </div>
            
            <!-- é…ç½®å€å¡Š -->
            <div class="sidebar-section">
                <h3>é…ç½®</h3>
                <div class="config-item">
                    <i class="fas fa-user"></i>
                    <span>å¸³æˆ¶</span>
                </div>
                <div class="config-item">
                    <i class="fas fa-credit-card"></i>
                    <span>è¨ˆè²»</span>
                </div>
            </div>
        </aside>

        <!-- ä¸»å…§å®¹å€åŸŸ -->
        <main class="main-content" id="main-content">
            <!-- æ–‡æª”åˆ—è¡¨è¦–åœ– -->
            <div id="document-list-view" class="view-container">
                <!-- é é¢æ¨™é¡Œ -->
                <header class="page-header">
                    <div class="header-left">
                        <div class="team-info">
                            <div class="team-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="team-details">
                                <h1 id="team-name">1æ‰­æ‰­æ‰¹'s team</h1>
                                <span class="subscription-badge" id="subscription-badge">Professional</span>
                            </div>
                        </div>
                    </div>
                    <div class="header-right">
                        <button class="project-btn" onclick="createNewProject()">
                            <i class="fas fa-plus"></i>
                            <span>+ Project</span>
                        </button>
                    </div>
                </header>

                <!-- æ§åˆ¶æ¬„ -->
                <div class="controls-bar">
                    <div class="search-filter">
                        <input type="text" data-translate-placeholder="filter_document_name" placeholder="ç¯©é¸æ–‡æª”åç¨±..." class="filter-input" id="filter-input">
                    </div>
                    <div class="actions">
                        <button class="upload-btn" onclick="openUploadModal()">
                            <i class="fas fa-upload"></i>
                            <span data-translate="upload_files">ä¸Šå‚³æ–‡ä»¶</span>
                        </button>
                        <button class="view-btn" onclick="toggleView()">
                            <i class="fas fa-list"></i>
                            <span data-translate="view">æª¢è¦–</span>
                        </button>
                    </div>
                </div>

                <!-- æ–‡æª”è¡¨æ ¼è¦–åœ– -->
                <div class="documents-table-container">
                    <table class="documents-table" id="documents-table">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="select-all" onchange="toggleSelectAll()">
                                    <i class="fas fa-sort"></i>
                                </th>
                                <th data-translate="document">Document <i class="fas fa-sort"></i></th>
                                <th data-translate="statement_period">Statement Period <i class="fas fa-sort"></i></th>
                                <th data-translate="reconciliation">Reconciliation <i class="fas fa-sort"></i></th>
                                <th data-translate="balance_info">Balance Info <i class="fas fa-sort"></i></th>
                                <th data-translate="status">Status <i class="fas fa-sort"></i></th>
                                <th data-translate="review_status">Review Status <i class="fas fa-sort"></i></th>
                                <th data-translate="notes">Notes <i class="fas fa-sort"></i></th>
                                <th data-translate="date_uploaded">Date Uploaded <i class="fas fa-sort"></i></th>
                                <th data-translate="actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="documents-tbody">
                            <!-- æ–‡æª”å°‡å‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
                        </tbody>
                    </table>
                    
                    <!-- ç©ºç‹€æ…‹ -->
                    <div class="empty-state" id="empty-state" style="display: none;">
                        <div class="empty-content">
                            <i class="fas fa-file-alt"></i>
                            <h3>No results.</h3>
                            <p>ä¸Šå‚³æ‚¨çš„ç¬¬ä¸€å€‹æ–‡æª”é–‹å§‹ä½¿ç”¨</p>
                        </div>
                    </div>
                </div>

                <!-- åˆ†é æ§åˆ¶ -->
                <div class="pagination">
                    <div class="pagination-info">
                        <span id="selection-info">0 of 0 row(s) selected.</span>
                    </div>
                    <div class="pagination-controls">
                        <div class="rows-per-page">
                            <span>Rows per page</span>
                            <select id="rows-per-page" onchange="changeRowsPerPage()">
                                <option value="10">10</option>
                                <option value="25">25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                        <div class="page-info">
                            <span id="page-info">Page 1 of 0</span>
                        </div>
                        <div class="page-buttons">
                            <button class="page-btn" onclick="goToFirstPage()" disabled>
                                <i class="fas fa-angle-double-left"></i>
                            </button>
                            <button class="page-btn" onclick="goToPreviousPage()" disabled>
                                <i class="fas fa-angle-left"></i>
                            </button>
                            <button class="page-btn" onclick="goToNextPage()" disabled>
                                <i class="fas fa-angle-right"></i>
                            </button>
                            <button class="page-btn" onclick="goToLastPage()" disabled>
                                <i class="fas fa-angle-double-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ–‡æª”è©³ç´°è¦–åœ– -->
            <div id="document-detail-view" class="view-container" style="display: none;">
                <!-- è¿”å›æŒ‰éˆ• -->
                <div class="back-navigation">
                    <button class="back-btn" onclick="backToDocumentList()">
                        <i class="fas fa-arrow-left"></i> <span data-translate="back_to_dashboard">è¿”å›å„€è¡¨æ¿</span>
                    </button>
                </div>

                <!-- æ–‡æª”è©³ç´°å…§å®¹ -->
                <div class="document-detail-container">
                    <!-- å·¦å´ï¼šPDF é è¦½ -->
                    <div class="pdf-preview-container">
                        <div class="pdf-controls">
                            <button class="pdf-control-btn"><i class="fas fa-chevron-left"></i></button>
                            <span class="page-info">1 of 3</span>
                            <button class="pdf-control-btn"><i class="fas fa-chevron-right"></i></button>
                            <button class="pdf-control-btn"><i class="fas fa-search-plus"></i></button>
                            <button class="pdf-control-btn"><i class="fas fa-undo"></i></button>
                            <button class="pdf-control-btn"><i class="fas fa-search-minus"></i></button>
                        </div>
                        <div class="pdf-viewer">
                            <div class="pdf-placeholder" id="pdf-placeholder">
                                <i class="fas fa-file-pdf"></i>
                                <h3>PDF Preview</h3>
                                <p id="document-title">Document Loading...</p>
                                <small style="display: block; margin-top: 1rem; color: #9ca3af;">
                                    æ–‡ä»¶é è¦½å°‡é¡¯ç¤ºåœ¨é€™è£¡ï¼Œè®“ç”¨æˆ¶å¿«é€Ÿè­˜åˆ¥æ–‡ä»¶å…§å®¹
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- å³å´ï¼šæ•¸æ“šæå–å’Œè™•ç† -->
                    <div class="data-extraction-container">
                        <!-- é ‚éƒ¨æ¨™é¡Œ -->
                        <div class="extraction-header">
                            <h2 id="document-title-header">Document Loading...</h2>
                            <div class="extraction-tabs">
                                <button class="tab-btn active" data-tab="results">Results</button>
                                <button class="tab-btn" data-tab="export">Export</button>
                                <button class="tab-btn" data-tab="json">JSON</button>
                            </div>
                            <div class="document-actions">
                                <button class="save-btn">
                                    <i class="fas fa-save"></i> Saved
                                </button>
                                <button class="download-btn">
                                    <i class="fas fa-download"></i> Download
                                </button>
                                <button class="more-actions-btn">
                                    <i class="fas fa-ellipsis-h"></i>
                                </button>
                            </div>
                        </div>

                        <!-- å°å¸³ç‹€æ…‹ -->
                        <div class="reconciliation-status">
                            <h3 data-translate="reconciliation_status">å°å¸³ç‹€æ…‹</h3>
                            <p>0 <span data-translate="of">å…±</span> 13 <span data-translate="transactions_reconciled">ç­†äº¤æ˜“å·²å°å¸³</span></p>
                            <div class="completion-status">0% <span data-translate="complete">å®Œæˆ</span></div>
                        </div>

                        <!-- éŠ€è¡Œå°å¸³å–®è©³ç´°ä¿¡æ¯ -->
                        <div class="bank-statement-details">
                            <h3 data-translate="bank_statement_details">éŠ€è¡Œå°å¸³å–®è©³ç´°ä¿¡æ¯èˆ‡å‚™è¨»</h3>
                            <!-- å¯æ”¶èµ·çš„è©³ç´°ä¿¡æ¯å€åŸŸ -->
                        </div>

                        <!-- äº¤æ˜“åˆ—è¡¨ -->
                        <div class="transactions-section">
                            <div class="transactions-header">
                                <h3 data-translate="transactions_title">äº¤æ˜“è¨˜éŒ„</h3>
                                <div class="transaction-controls">
                                    <button class="control-btn">Show Unreconciled</button>
                                    <button class="control-btn">Toggle All</button>
                                    <button class="control-btn add-btn">Add Item</button>
                                </div>
                            </div>

                            <div class="transaction-info">
                                <p><span data-translate="showing_transactions">é¡¯ç¤ºç¬¬</span> 1 <span data-translate="to">è‡³</span> 13 <span data-translate="of">å…±</span> 13 <span data-translate="transactions">ç­†äº¤æ˜“</span></p>
                            </div>

                            <!-- äº¤æ˜“è¡¨æ ¼ -->
                            <div class="transactions-table-container">
                                <table class="transactions-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 40px;"><i class="fas fa-check"></i></th>
                                            <th>Date</th>
                                            <th>Description</th>
                                            <th>Amount</th>
                                            <th>Balance</th>
                                            <th style="width: 40px;"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="transactions-tbody">
                                        <!-- å‹•æ…‹å¡«å……çš„äº¤æ˜“æ•¸æ“šå°‡é¡¯ç¤ºåœ¨é€™è£¡ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ç™»å…¥ç‹€æ…‹æª¢æŸ¥ - ä½¿ç”¨å…¨åŸŸåŒæ­¥ç³»çµ±
        function checkLoginStatus() {
            console.log('ğŸ” Dashboard æª¢æŸ¥èº«ä»½é©—è­‰ç‹€æ…‹...');
            
            // ä½¿ç”¨å…¨åŸŸèº«ä»½é©—è­‰åŒæ­¥ç³»çµ±
            if (window.GlobalAuthSync) {
                const globalState = window.GlobalAuthSync.getCurrentAuthState();
                console.log('ğŸŒ Dashboard å…¨åŸŸèº«ä»½é©—è­‰ç‹€æ…‹:', globalState);
                return globalState.isAuthenticated;
            }
            
            // å…œåº•é‚è¼¯ï¼šå¦‚æœå…¨åŸŸç³»çµ±æœªè¼‰å…¥ï¼Œä½¿ç”¨æœ¬åœ°æª¢æŸ¥
            console.log('âš ï¸ å…¨åŸŸåŒæ­¥ç³»çµ±æœªè¼‰å…¥ï¼Œä½¿ç”¨æœ¬åœ°æª¢æŸ¥');
            return window.checkGlobalAuthState ? window.checkGlobalAuthState() : true;
        }

        // æ–‡æª”é¡å‹é…ç½®
        const documentTypes = {
            'bank-statement': {
                titleKey: 'bank_statement_processor',
                subtitleKey: 'manage_view_documents',
                title: 'éŠ€è¡Œå°å¸³å–®è™•ç†å™¨',
                subtitle: 'ç®¡ç†å’ŒæŸ¥çœ‹æ‚¨çš„æ–‡æª”',
                icon: 'fas fa-university'
            }
        };

        // è¨‚é–±æ–¹æ¡ˆé…ç½®
        const subscriptionPlans = {
            'free': {
                name: 'Free',
                color: '#6b7280',
                features: ['åŸºç¤æ–‡æª”è™•ç†', 'æ¯æœˆ10å€‹æ–‡æª”']
            },
            'basic': {
                name: 'Basic',
                color: '#10b981',
                features: ['é€²éšæ–‡æª”è™•ç†', 'æ¯æœˆ100å€‹æ–‡æª”']
            },
            'professional': {
                name: 'Professional',
                color: '#3b82f6',
                features: ['AIæ™ºèƒ½è™•ç†', 'ç„¡é™æ–‡æª”', 'å„ªå…ˆæ”¯æ´']
            },
            'business': {
                name: 'Business',
                color: '#8b5cf6',
                features: ['ä¼æ¥­ç´šåŠŸèƒ½', 'åœ˜éšŠå”ä½œ', 'APIå­˜å–']
            }
        };

        // é é¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¯ Dashboard é é¢è¼‰å…¥ä¸­...');
            
            // ç­‰å¾…å…¨åŸŸåŒæ­¥ç³»çµ±è¼‰å…¥
            const initializeWithGlobalSync = () => {
                if (window.GlobalAuthSync) {
                    console.log('ğŸŒ ä½¿ç”¨å…¨åŸŸèº«ä»½é©—è­‰åŒæ­¥ç³»çµ±');
                    
                    // ç›£è½å…¨åŸŸèº«ä»½é©—è­‰ç‹€æ…‹è®ŠåŒ–
                    window.onGlobalAuthChange((authState) => {
                        console.log('ğŸ”„ Dashboard æ”¶åˆ°å…¨åŸŸèº«ä»½é©—è­‰ç‹€æ…‹è®ŠåŒ–:', authState);
                        updateDashboardAuthState(authState);
                    });
                    
                    // åˆå§‹æª¢æŸ¥
                    const authResult = checkLoginStatus();
                    console.log('ğŸ¯ Dashboard åˆå§‹èº«ä»½é©—è­‰çµæœ:', authResult);
                    
                    if (!authResult) {
                        console.log('âš ï¸ Dashboard æœªæª¢æ¸¬åˆ°ç™»å…¥ç‹€æ…‹ï¼Œé¡¯ç¤ºæç¤º');
                        showLoginPromptInDashboard();
                    }
                } else {
                    console.log('âš ï¸ å…¨åŸŸåŒæ­¥ç³»çµ±æœªè¼‰å…¥ï¼Œä½¿ç”¨å…œåº•é‚è¼¯');
                    // å…œåº•é‚è¼¯
                    const authResult = checkLoginStatus();
                    if (!authResult) {
                        showLoginPromptInDashboard();
                    }
                }
            };
            
            // å¦‚æœå…¨åŸŸåŒæ­¥ç³»çµ±å·²è¼‰å…¥ï¼Œç«‹å³åˆå§‹åŒ–ï¼›å¦å‰‡ç­‰å¾…
            if (window.GlobalAuthSync) {
                initializeWithGlobalSync();
            } else {
                setTimeout(initializeWithGlobalSync, 100);
            }

            // åˆå§‹åŒ–çµ±ä¸€å´é‚Šæ¬„
            window.unifiedSidebar = new VaultCaddySidebar();
            
            // åˆå§‹åŒ–ç”¨æˆ¶åœ˜éšŠä¿¡æ¯
            initializeUserTeamInfo();
            
            // è™•ç† hash è·¯ç”±
            handleHashRouting();
            
            // ç›£è½ hash è®ŠåŒ–
            window.addEventListener('hashchange', handleHashRouting);
            
            // ç›£è½èªè¨€è®Šæ›´äº‹ä»¶
            window.addEventListener('languageChanged', function(e) {
                console.log('Dashboard: èªè¨€å·²è®Šæ›´ç‚º', e.detail.language);
                // èªè¨€è®Šæ›´æ™‚é‡æ–°æ‡‰ç”¨ç•¶å‰æ–‡æª”é¡å‹çš„ç¿»è­¯
                const hash = window.location.hash.substring(1);
                const docType = hash || 'bank-statement';
                if (documentTypes[docType]) {
                    updatePageForDocumentType(docType);
                }
                // æ³¨æ„ï¼šå´é‚Šæ¬„çš„èªè¨€æ›´æ–°ç”± VaultCaddySidebar çš„ setupLanguageListener è™•ç†
            });
            
            console.log('âœ… Unified Dashboard åˆå§‹åŒ–å®Œæˆ');
        });

        // åˆå§‹åŒ–ç”¨æˆ¶åœ˜éšŠä¿¡æ¯
        function initializeUserTeamInfo() {
            console.log('ğŸ‘¥ åˆå§‹åŒ–ç”¨æˆ¶åœ˜éšŠä¿¡æ¯...');
            
            // ç²å–ç”¨æˆ¶åç¨±
            let userName = '1æ‰­æ‰­æ‰¹'; // é»˜èªåç¨±
            
            if (window.GlobalAuthSync) {
                const authState = window.GlobalAuthSync.getCurrentAuthState();
                if (authState.userName && !authState.userName.includes('{"uid"')) {
                    userName = authState.userName;
                }
            } else {
                // å¾localStorageç²å–
                const storedName = localStorage.getItem('google_user_name') || localStorage.getItem('user_name');
                if (storedName && !storedName.includes('{"uid"')) {
                    userName = storedName;
                }
            }
            
            // ç”Ÿæˆåœ˜éšŠåç¨±
            const teamName = `${userName}'s team`;
            
            // æ›´æ–°åœ˜éšŠåç¨±é¡¯ç¤º
            const teamNameElement = document.getElementById('team-name');
            if (teamNameElement) {
                teamNameElement.textContent = teamName;
                console.log('âœ… åœ˜éšŠåç¨±å·²æ›´æ–°:', teamName);
            }
            
            // ç²å–ä¸¦è¨­ç½®è¨‚é–±æ–¹æ¡ˆ
            let subscriptionPlan = 'professional'; // é»˜èªç‚ºå°ˆæ¥­ç‰ˆ
            
            if (window.GlobalAuthSync) {
                const authState = window.GlobalAuthSync.getCurrentAuthState();
                subscriptionPlan = authState.subscriptionPlan || 'professional';
            } else {
                subscriptionPlan = localStorage.getItem('vaultcaddy_subscription') || 'professional';
            }
            
            // æ›´æ–°è¨‚é–±æ–¹æ¡ˆé¡¯ç¤º
            updateSubscriptionBadge(subscriptionPlan);
            
            console.log('âœ… ç”¨æˆ¶åœ˜éšŠä¿¡æ¯åˆå§‹åŒ–å®Œæˆ:', { teamName, subscriptionPlan });
        }
        
        // æ›´æ–°è¨‚é–±æ–¹æ¡ˆæ¨™ç±¤
        function updateSubscriptionBadge(planKey) {
            const badgeElement = document.getElementById('subscription-badge');
            if (!badgeElement) return;
            
            const plan = subscriptionPlans[planKey];
            if (plan) {
                badgeElement.textContent = plan.name;
                badgeElement.style.background = plan.color;
                console.log('âœ… è¨‚é–±æ–¹æ¡ˆå·²æ›´æ–°:', plan.name);
            }
        }
        
        // å‰µå»ºæ–°é …ç›®
        function createNewProject() {
            console.log('ğŸ“ å‰µå»ºæ–°é …ç›®...');
            // é€™è£¡å¯ä»¥å¯¦ç¾å‰µå»ºæ–°é …ç›®çš„é‚è¼¯
            alert('å‰µå»ºæ–°é …ç›®åŠŸèƒ½æ­£åœ¨é–‹ç™¼ä¸­...');
        }

        // è™•ç† hash è·¯ç”±
        function handleHashRouting() {
            const hash = window.location.hash.substring(1); // ç§»é™¤ #
            const docType = hash || 'bank-statement'; // é»˜èªç‚ºéŠ€è¡Œå°å¸³å–®
            
            if (documentTypes[docType]) {
                updatePageForDocumentType(docType);
            }
        }

        // æ›´æ–°é é¢ç‚ºæŒ‡å®šæ–‡æª”é¡å‹
        function updatePageForDocumentType(docType) {
            const config = documentTypes[docType];
            
            // ç¢ºä¿é¡¯ç¤ºæ–‡æª”åˆ—è¡¨è¦–åœ–ï¼Œéš±è—è©³ç´°è¦–åœ–
            const listView = document.getElementById('document-list-view');
            const detailView = document.getElementById('document-detail-view');
            
            if (listView && detailView) {
                listView.style.display = 'block';
                detailView.style.display = 'none';
            }
            
            // æ›´æ–°é é¢æ¨™é¡Œ - æ”¯æŒå¤šèªè¨€
            const titleElement = document.getElementById('page-title');
            const subtitleElement = document.getElementById('page-subtitle');
            
            if (titleElement) {
                titleElement.textContent = config.title;
                titleElement.setAttribute('data-translate', config.titleKey);
            }
            if (subtitleElement) {
                subtitleElement.textContent = config.subtitle;
                subtitleElement.setAttribute('data-translate', config.subtitleKey);
            }
            
            // æ›´æ–°ç€è¦½å™¨æ¨™é¡Œ
            document.title = `${config.title} - VaultCaddy`;
            
            // æ›´æ–°å´é‚Šæ¬„æ´»èºç‹€æ…‹
            if (window.unifiedSidebar) {
                window.unifiedSidebar.updateActivePage(docType);
            }
            
            // è¼‰å…¥è©²æ–‡æª”é¡å‹çš„æ–‡ä»¶
            loadFilesForDocumentType(docType);
            
            // å¦‚æœèªè¨€ç®¡ç†å™¨å­˜åœ¨ï¼Œé‡æ–°æ‡‰ç”¨ç¿»è­¯
            if (window.languageManager) {
                window.languageManager.loadLanguage(window.languageManager.currentLanguage);
            }
            
            console.log('âœ… æ›´æ–°é é¢é¡å‹:', docType, config.title);
        }
        
        // è¼‰å…¥æŒ‡å®šæ–‡æª”é¡å‹çš„æ–‡ä»¶å¤¾
        function loadFilesForDocumentType(docType) {
            const documentsTable = document.getElementById('documents-table');
            const documentsTbody = document.getElementById('documents-tbody');
            const emptyState = document.getElementById('empty-state');
            
            if (!documentsTable || !documentsTbody) {
                console.error('æ‰¾ä¸åˆ°æ–‡æª”è¡¨æ ¼å®¹å™¨');
                return;
            }
            
            // æ¸…ç©ºç¾æœ‰å…§å®¹
            documentsTbody.innerHTML = '';
            
            // å„ªå…ˆå¾çµ±ä¸€å­˜å„²è¼‰å…¥ï¼Œç„¶å¾Œæ˜¯èˆŠæ ¼å¼
            let storedFiles = [];
            
            // 1. å˜—è©¦å¾çµ±ä¸€å­˜å„²è¼‰å…¥
            if (window.UnifiedDocumentProcessor && window.UnifiedDocumentProcessor.processors.storage) {
                console.log(`ğŸ“‚ å¾çµ±ä¸€å­˜å„²è¼‰å…¥ ${docType} æ–‡ä»¶`);
                storedFiles = window.UnifiedDocumentProcessor.getAllProcessedDocuments(docType);
                
                // è½‰æ›çµ±ä¸€æ ¼å¼ç‚ºé¡¯ç¤ºæ ¼å¼
                storedFiles = storedFiles.map(doc => ({
                    id: doc.id,
                    name: doc.fileName,
                    size: doc.fileSize || 0,
                    documentType: doc.documentType,
                    uploadDate: new Date(doc.processedAt).toLocaleDateString('zh-TW'),
                    status: 'completed',
                    processedData: doc
                }));
            }
            
            // 2. å¦‚æœçµ±ä¸€å­˜å„²æ²’æœ‰æ•¸æ“šï¼Œå˜—è©¦èˆŠæ ¼å¼
            if (storedFiles.length === 0) {
                console.log(`ğŸ“‚ å¾èˆŠå­˜å„²è¼‰å…¥ ${docType} æ–‡ä»¶`);
                const storageKey = `vaultcaddy_files_${docType}`;
                storedFiles = JSON.parse(localStorage.getItem(storageKey) || '[]');
            }
            
            console.log(`ğŸ“ è¼‰å…¥ ${docType} æ–‡ä»¶:`, storedFiles.length, 'å€‹æ–‡ä»¶');
            
            // å¦‚æœæ²’æœ‰æ–‡ä»¶ï¼Œé¡¯ç¤ºç©ºç‹€æ…‹
            if (storedFiles.length === 0) {
                documentsTable.style.display = 'none';
                emptyState.style.display = 'block';
                updatePaginationInfo(0);
                return;
            }
            
            // é¡¯ç¤ºè¡¨æ ¼ï¼Œéš±è—ç©ºç‹€æ…‹
            documentsTable.style.display = 'table';
            emptyState.style.display = 'none';
            
            // å‰µå»ºè¡¨æ ¼è¡Œ
            storedFiles.forEach(file => {
                createDocumentRow(documentsTbody, file);
            });
            
            // æ›´æ–°çµ±è¨ˆä¿¡æ¯å’Œåˆ†é 
            updateDocumentStats();
            updatePaginationInfo(storedFiles.length);
        }
        
        // å‰µå»ºç©ºæ–‡ä»¶å¤¾
        function createEmptyFolder(container, docType) {
            const folderItem = document.createElement('div');
            folderItem.className = 'folder-item';
            folderItem.innerHTML = `
                <div class="folder-icon">
                    <i class="fas fa-folder"></i>
                </div>
                <div class="folder-name">${documentTypes[docType]?.title || docType}</div>
                <div class="folder-files-count">0 files</div>
                <div class="folder-updated">å‰›å‰›å‰µå»º</div>
            `;
            folderItem.onclick = () => {
                console.log('ğŸ“ é»æ“Šç©ºæ–‡ä»¶å¤¾:', docType);
                // å¯ä»¥å¯¦ç¾æ‰“é–‹æ–‡ä»¶å¤¾æˆ–ä¸Šå‚³æ–‡ä»¶çš„é‚è¼¯
            };
            container.appendChild(folderItem);
        }
        
        // å°‡æ–‡ä»¶åˆ†çµ„åˆ°æ–‡ä»¶å¤¾ä¸­
        function groupFilesIntoFolders(files, docType) {
            const folders = [];
            
            // æŒ‰æœˆä»½åˆ†çµ„
            const groupedByMonth = {};
            files.forEach(file => {
                const date = new Date(file.uploadDate);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                
                if (!groupedByMonth[monthKey]) {
                    groupedByMonth[monthKey] = [];
                }
                groupedByMonth[monthKey].push(file);
            });
            
            // å‰µå»ºæ–‡ä»¶å¤¾
            Object.keys(groupedByMonth).forEach(monthKey => {
                const filesInMonth = groupedByMonth[monthKey];
                const date = new Date(monthKey + '-01');
                
                folders.push({
                    id: `folder_${monthKey}`,
                    name: `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ`,
                    filesCount: filesInMonth.length,
                    files: filesInMonth,
                    updated: filesInMonth[0].uploadDate,
                    type: docType
                });
            });
            
            // å¦‚æœæ²’æœ‰æ–‡ä»¶ï¼Œå‰µå»ºä¸€å€‹ç©ºæ–‡ä»¶å¤¾
            if (folders.length === 0) {
                folders.push({
                    id: `folder_empty_${docType}`,
                    name: documentTypes[docType]?.title || docType,
                    filesCount: 0,
                    files: [],
                    updated: 'å‰›å‰›å‰µå»º',
                    type: docType
                });
            }
            
            return folders;
        }
        
        // å‰µå»ºæ–‡ä»¶å¤¾é …ç›®
        function createFolderItem(container, folder) {
            const folderItem = document.createElement('div');
            folderItem.className = 'folder-item';
            folderItem.innerHTML = `
                <div class="folder-icon">
                    <i class="fas fa-folder${folder.filesCount > 0 ? '-open' : ''}"></i>
                </div>
                <div class="folder-name">${folder.name}</div>
                <div class="folder-files-count">${folder.filesCount} files</div>
                <div class="folder-updated">${folder.updated}</div>
            `;
            folderItem.onclick = () => {
                console.log('ğŸ“ é»æ“Šæ–‡ä»¶å¤¾:', folder.name, folder.filesCount, 'å€‹æ–‡ä»¶');
                openFolder(folder);
            };
            container.appendChild(folderItem);
        }
        
        // æ‰“é–‹æ–‡ä»¶å¤¾
        function openFolder(folder) {
            console.log('ğŸ“‚ æ‰“é–‹æ–‡ä»¶å¤¾:', folder);
            if (folder.filesCount === 0) {
                alert('æ–‡ä»¶å¤¾ç‚ºç©ºï¼Œè«‹å…ˆä¸Šå‚³æ–‡ä»¶');
                return;
            }
            
            // é€™è£¡å¯ä»¥å¯¦ç¾æ‰“é–‹æ–‡ä»¶å¤¾çš„é‚è¼¯
            // ä¾‹å¦‚é¡¯ç¤ºæ–‡ä»¶å¤¾å…§å®¹æˆ–è·³è½‰åˆ°æ–‡ä»¶åˆ—è¡¨
            alert(`æ‰“é–‹æ–‡ä»¶å¤¾: ${folder.name} (${folder.filesCount} å€‹æ–‡ä»¶)`);
        }

        // æ‰“é–‹æ–‡æª”è©³ç´°è¦–åœ–
        function openDocumentDetail(documentId) {
            document.getElementById('document-list-view').style.display = 'none';
            document.getElementById('document-detail-view').style.display = 'block';
            
            // å„ªå…ˆä½¿ç”¨LedgerBoxè™•ç†å™¨çš„æ•¸æ“š
            if (window.ledgerBoxProcessor) {
                window.ledgerBoxProcessor.openDocumentDetail(documentId);
                return;
            }
            
            // å…œåº•ï¼šå¾localStorageç²å–æ–‡ä»¶ä¿¡æ¯
            const fileInfo = getFileInfoById(documentId);
            
            if (fileInfo) {
                // æ›´æ–°æ–‡æª”æ¨™é¡Œç‚ºå¯¦éš›æ–‡ä»¶å
                document.getElementById('document-title').textContent = fileInfo.name;
                
                // æ›´æ–°PDFé è¦½å€åŸŸ
                updatePDFPreview(fileInfo);
                
                console.log('ğŸ“„ æ‰“é–‹æ–‡æª”è©³ç´°è¦–åœ–:', fileInfo.name, fileInfo.documentType);
            } else {
                // å…œåº•ï¼šä½¿ç”¨æ–‡æª”ID
                document.getElementById('document-title').textContent = documentId + '.pdf';
                console.warn('âš ï¸ æ‰¾ä¸åˆ°æ–‡æª”ä¿¡æ¯:', documentId);
            }
        }
        
        // æ ¹æ“šæ–‡æª”IDç²å–æ–‡ä»¶ä¿¡æ¯
        function getFileInfoById(documentId) {
            // æª¢æŸ¥æ‰€æœ‰æ–‡æª”é¡å‹çš„å­˜å„²
            const docTypes = ['bank-statement', 'general'];
            
            for (const docType of docTypes) {
                const storageKey = `vaultcaddy_files_${docType}`;
                const storedFiles = JSON.parse(localStorage.getItem(storageKey) || '[]');
                
                const fileInfo = storedFiles.find(file => file.id === documentId);
                if (fileInfo) {
                    return fileInfo;
                }
            }
            
            return null;
        }
        
        // æ›´æ–°PDFé è¦½å€åŸŸ
        function updatePDFPreview(fileInfo) {
            const pdfPlaceholder = document.querySelector('.pdf-placeholder');
            if (pdfPlaceholder) {
                pdfPlaceholder.innerHTML = `
                    <i class="fas fa-file-pdf"></i>
                    <h3>PDF Preview</h3>
                    <p>Document: ${fileInfo.name}</p>
                    <p style="color: #6b7280; font-size: 0.875rem;">Type: ${fileInfo.documentType}</p>
                    <p style="color: #6b7280; font-size: 0.875rem;">Size: ${(fileInfo.size / 1024 / 1024).toFixed(2)} MB</p>
                    <small style="display: block; margin-top: 1rem; color: #9ca3af;">
                        å¯¦éš›æ–‡ä»¶é è¦½åŠŸèƒ½æ­£åœ¨é–‹ç™¼ä¸­ï¼Œç›®å‰é¡¯ç¤ºæ–‡ä»¶ä¿¡æ¯
                    </small>
                `;
            }
        }

        // è¿”å›æ–‡æª”åˆ—è¡¨
        function backToDocumentList() {
            document.getElementById('document-detail-view').style.display = 'none';
            document.getElementById('document-list-view').style.display = 'block';
            
            // æ¸…é™¤ç•¶å‰æ–‡æª”
            if (window.ledgerBoxProcessor) {
                window.ledgerBoxProcessor.currentDocument = null;
            }
        }

        // å…¶ä»–åŠŸèƒ½å‡½æ•¸
        function showHelp() {
            alert('Document processing help will be shown here.');
        }

        function openUploadModal() {
            // çµ±ä¸€ä½¿ç”¨LedgerBoxé¢¨æ ¼çš„ä¸Šå‚³æ¨¡æ…‹æ¡†
            if (window.ledgerBoxProcessor) {
                window.ledgerBoxProcessor.openLedgerBoxModal();
            } else {
                console.error('âŒ LedgerBoxè™•ç†å™¨æœªè¼‰å…¥');
                alert('ç³»çµ±åˆå§‹åŒ–ä¸­ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
        }
        
        function closeUploadModal() {
            const modal = document.getElementById('upload-modal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                // æ¸…ç†æ–‡ä»¶è¼¸å…¥
                const fileInput = document.getElementById('modal-file-input');
                if (fileInput) {
                    fileInput.value = '';
                }
                clearFilePreview();
            }
        }
        
        function clearFilePreview() {
            const preview = document.getElementById('file-preview-area');
            if (preview) {
                preview.innerHTML = '<p>æ‹–æ”¾æ–‡ä»¶åˆ°é€™è£¡æˆ–é»æ“Šé¸æ“‡æ–‡ä»¶</p>';
                preview.className = 'file-drop-area';
            }
        }
        
        function handleModalFileSelect() {
            const fileInput = document.getElementById('modal-file-input');
            if (fileInput) {
                fileInput.click();
            }
        }
        
        function handleFileInputChange(event) {
            const files = event.target.files;
            if (files && files.length > 0) {
                displayFilePreview(files);
            }
        }
        
        function displayFilePreview(files) {
            const preview = document.getElementById('file-preview-area');
            if (!preview) return;
            
            let html = '<div class="file-list"><h4>é¸ä¸­çš„æ–‡ä»¶:</h4>';
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                html += `
                    <div class="file-item">
                        <i class="fas fa-file-pdf"></i>
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${fileSize} MB</div>
                        </div>
                        <button onclick="removeFile(${i})" class="remove-file-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            }
            html += '</div>';
            preview.innerHTML = html;
            preview.className = 'file-drop-area has-files';
        }
        
        async function processSelectedFiles() {
            console.log('ğŸš€ é–‹å§‹è™•ç†é¸ä¸­çš„æ–‡ä»¶...');
            
            const fileInput = document.getElementById('modal-file-input');
            if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
                console.error('âŒ æ²’æœ‰é¸ä¸­çš„æ–‡ä»¶');
                alert('è«‹å…ˆé¸æ“‡è¦ä¸Šå‚³çš„æ–‡ä»¶');
                return;
            }
            
            console.log(`ğŸ“ æ‰¾åˆ° ${fileInput.files.length} å€‹æ–‡ä»¶:`, Array.from(fileInput.files).map(f => f.name));
            
            // è½‰æ›ç‚ºæ•¸çµ„ä¸¦è¨˜éŒ„è©³ç´°ä¿¡æ¯
            const files = Array.from(fileInput.files);
            console.log('ğŸ“„ æ–‡ä»¶è©³æƒ…:', files.map(f => ({
                name: f.name,
                size: f.size,
                type: f.type,
                lastModified: f.lastModified
            })));
            
            // ç²å–ç•¶å‰æ–‡æª”é¡å‹
            const hash = window.location.hash.substring(1);
            const currentDocType = hash || 'bank-statement';
            
            closeUploadModal();
            showProcessingStatus(files);
            
            try {
                // ä½¿ç”¨çµ±ä¸€è™•ç†å™¨è™•ç†æ–‡ä»¶
                if (window.UnifiedDocumentProcessor) {
                    console.log('ğŸ¯ ä½¿ç”¨çµ±ä¸€è™•ç†å™¨è™•ç†æ–‡ä»¶...');
                    
                    const processingResults = await window.UnifiedDocumentProcessor.processUploadedFiles(files, currentDocType);
                    
                    console.log('âœ… çµ±ä¸€è™•ç†å™¨è™•ç†å®Œæˆ:', processingResults);
                    
                    // æª¢æŸ¥æ˜¯å¦æœ‰è™•ç†å¤±æ•—çš„æ–‡ä»¶
                    const failedFiles = processingResults.filter(r => r.status === 'error');
                    if (failedFiles.length > 0) {
                        console.error('âŒ éƒ¨åˆ†æ–‡ä»¶è™•ç†å¤±æ•—:', failedFiles);
                        alert(`${failedFiles.length} å€‹æ–‡ä»¶è™•ç†å¤±æ•—ï¼š${failedFiles.map(f => f.error).join(', ')}`);
                    }
                    
                    // åªæ·»åŠ æˆåŠŸè™•ç†çš„æ–‡ä»¶åˆ°è¡¨æ ¼
                    const successfulFiles = files.filter((_, index) => 
                        processingResults[index] && processingResults[index].status === 'success'
                    );
                    
                    if (successfulFiles.length > 0) {
                        addProcessedFilesToTable(successfulFiles);
                        
                        // ä¿å­˜è™•ç†çµæœåˆ°çµ±ä¸€å­˜å„²
                        saveUnifiedProcessingResults(processingResults, currentDocType);
                        
                        showSuccessNotification(successfulFiles.length);
                    }
                } else {
                    // å…œåº•ï¼šä½¿ç”¨åŸæœ‰çš„æ¨¡æ“¬è™•ç†
                    console.log('âš ï¸ çµ±ä¸€è™•ç†å™¨æœªè¼‰å…¥ï¼Œä½¿ç”¨æ¨¡æ“¬è™•ç†');
                    setTimeout(() => {
                        addProcessedFilesToTable(files);
                        showSuccessNotification(files.length);
                        hideProcessingStatus();
                    }, 2000);
                    return;
                }
                
                // æ›´æ–°çµ±è¨ˆ
                updateDocumentStats();
                
            } catch (error) {
                console.error('âŒ è™•ç†æ–‡ä»¶æ™‚å‡ºéŒ¯:', error);
                alert(`è™•ç†æ–‡ä»¶æ™‚å‡ºç¾éŒ¯èª¤ï¼š${error.message}`);
            } finally {
                hideProcessingStatus();
            }
        }
        
        // ä¿å­˜è™•ç†çµæœåˆ°localStorageï¼ˆèˆŠç‰ˆæœ¬ï¼Œä¿ç•™å…¼å®¹æ€§ï¼‰
        function saveProcessingResults(results, documentType) {
            const storageKey = `vaultcaddy_processing_results_${documentType}`;
            const existingResults = JSON.parse(localStorage.getItem(storageKey) || '[]');
            
            // æ·»åŠ æ–°çš„è™•ç†çµæœ
            results.forEach(result => {
                if (result.status === 'success') {
                    existingResults.push(result);
                }
            });
            
            localStorage.setItem(storageKey, JSON.stringify(existingResults));
            console.log(`ğŸ’¾ å·²ä¿å­˜ ${results.length} å€‹è™•ç†çµæœåˆ° ${storageKey}`);
        }
        
        // ä¿å­˜çµ±ä¸€è™•ç†å™¨çµæœ
        function saveUnifiedProcessingResults(results, documentType) {
            console.log(`ğŸ’¾ çµ±ä¸€è™•ç†å™¨çµæœå·²è‡ªå‹•ä¿å­˜åˆ°çµ±ä¸€å­˜å„²ç³»çµ±`);
            
            // çµ±ä¸€è™•ç†å™¨æœƒè‡ªå‹•ä¿å­˜ï¼Œé€™è£¡åªéœ€è¦è§¸ç™¼UIæ›´æ–°
            results.forEach(result => {
                if (result.status === 'success') {
                    // è§¸ç™¼UIæ›´æ–°äº‹ä»¶
                    window.dispatchEvent(new CustomEvent('vaultcaddy:document:added', {
                        detail: { 
                            documentType: documentType,
                            fileName: result.fileName,
                            data: result.data
                        }
                    }));
                }
            });
        }
        
        function showSuccessNotification(fileCount) {
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #10b981; color: white; padding: 1rem; border-radius: 8px; z-index: 1000; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
                    <i class="fas fa-check-circle"></i> æˆåŠŸè™•ç† ${fileCount} å€‹æ–‡ä»¶ï¼
                </div>
            `;
            document.body.appendChild(notification);
            
            // 3ç§’å¾Œè‡ªå‹•ç§»é™¤é€šçŸ¥
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        function showProcessingStatus(files) {
            // å¯ä»¥é¡¯ç¤ºä¸€å€‹è™•ç†ä¸­çš„é€šçŸ¥
            const notification = document.createElement('div');
            notification.id = 'processing-notification';
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #3b82f6; color: white; padding: 1rem; border-radius: 8px; z-index: 1000;">
                    <i class="fas fa-spinner fa-spin"></i> æ­£åœ¨è™•ç† ${files.length} å€‹æ–‡ä»¶...
                </div>
            `;
            document.body.appendChild(notification);
        }
        
        function hideProcessingStatus() {
            const notification = document.getElementById('processing-notification');
            if (notification) {
                notification.remove();
            }
        }
        
        function addProcessedFilesToTable(files) {
            console.log('ğŸ“‹ æ·»åŠ æ–‡ä»¶åˆ°æ–‡ä»¶å¤¾è¦–åœ–ï¼Œæ–‡ä»¶æ•¸é‡:', files.length);
            
            // ç²å–ç•¶å‰æ–‡æª”é¡å‹
            const hash = window.location.hash.substring(1);
            const currentDocType = hash || 'bank-statement';
            
            console.log('ğŸ“Š ç•¶å‰æ–‡ä»¶å¤¾ç‹€æ…‹:', {
                documentType: currentDocType,
                filesToAdd: files.length
            });
            
            // å¾localStorageç²å–ç•¶å‰æ–‡æª”é¡å‹çš„æ–‡ä»¶åˆ—è¡¨
            const storageKey = `vaultcaddy_files_${currentDocType}`;
            let existingFiles = JSON.parse(localStorage.getItem(storageKey) || '[]');
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileId = `${currentDocType}_${Date.now()}_${i}`;
                const currentDate = new Date().toLocaleDateString('zh-TW');
                
                console.log(`ğŸ“„ è™•ç†æ–‡ä»¶ ${i + 1}/${files.length}:`, {
                    name: file.name,
                    size: file.size,
                    fileId: fileId,
                    documentType: currentDocType
                });
                
                // ä¿å­˜æ–‡ä»¶ä¿¡æ¯åˆ°localStorageï¼ˆæŒ‰æ–‡æª”é¡å‹åˆ†é›¢ï¼‰
                const fileInfo = {
                    id: fileId,
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    documentType: currentDocType,
                    uploadDate: currentDate,
                    status: 'processing'
                };
                existingFiles.push(fileInfo);
                
                console.log(`âœ… æ–‡ä»¶ ${file.name} å·²æ·»åŠ åˆ°å­˜å„² (${currentDocType})`);
            }
            
            // ä¿å­˜æ›´æ–°å¾Œçš„æ–‡ä»¶åˆ—è¡¨åˆ°localStorage
            localStorage.setItem(storageKey, JSON.stringify(existingFiles));
            
            console.log(`ğŸ‰ æ‰€æœ‰ ${files.length} å€‹æ–‡ä»¶å·²æˆåŠŸæ·»åŠ åˆ°å­˜å„² (${currentDocType})`);
            console.log('ğŸ“Š å­˜å„²æœ€çµ‚ç‹€æ…‹:', {
                storageKey: storageKey,
                totalStoredFiles: existingFiles.length
            });
            
            // é‡æ–°è¼‰å…¥æ–‡ä»¶å¤¾è¦–åœ–
            loadFilesForDocumentType(currentDocType);
            
            // æ›´æ–°çµ±è¨ˆ
            updateDocumentStats();
        }
        
        function updateDocumentStats() {
            // æ›´æ–°æ–‡æª”è™•ç†çµ±è¨ˆ
            const documentRows = document.querySelectorAll('.document-row');
            const processedCount = documentRows.length;
            const statsElement = document.querySelector('[data-stat="processed-docs"]');
            if (statsElement) {
                statsElement.textContent = processedCount;
            }
            
            // æ›´æ–°å´é‚Šæ¬„çµ±è¨ˆ
            console.log(`ğŸ“Š æ›´æ–°æ–‡æª”çµ±è¨ˆ: ${processedCount} å€‹æ–‡æª”`);
        }
        
        function updateSidebarStats(newFileCount) {
            // æ›´æ–°å´é‚Šæ¬„çš„è™•ç†æ–‡æª”æ•¸é‡
            const processedElement = document.querySelector('.stat-value');
            if (processedElement && processedElement.textContent.includes('Processed Documents')) {
                const currentCount = parseInt(processedElement.textContent) || 0;
                processedElement.textContent = currentCount + newFileCount;
                console.log(`ğŸ“Š å´é‚Šæ¬„çµ±è¨ˆå·²æ›´æ–°: +${newFileCount} å€‹æ–‡æª”`);
            }
        }
        
        function showLoginPromptInDashboard() {
            console.log('ğŸ’¡ åœ¨ Dashboard ä¸­é¡¯ç¤ºç™»å…¥æç¤ºè€Œä¸æ˜¯é‡å®šå‘');
            
            // æª¢æŸ¥æ˜¯å¦å·²ç¶“å­˜åœ¨æç¤º
            const existing = document.getElementById('dashboard-login-prompt');
            if (existing) return;
            
            // åœ¨é é¢é ‚éƒ¨é¡¯ç¤ºä¸€å€‹æº«å’Œçš„ç™»å…¥æç¤º
            const notification = document.createElement('div');
            notification.id = 'dashboard-login-prompt';
            notification.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; background: #fef3c7; border-bottom: 1px solid #f59e0b; padding: 0.75rem; z-index: 1000; text-align: center;">
                    <p style="margin: 0; color: #92400e;">
                        <i class="fas fa-info-circle"></i> 
                        ç‚ºäº†ç²å¾—å®Œæ•´åŠŸèƒ½ï¼Œè«‹ <a href="auth.html" style="color: #b45309; text-decoration: underline;">é‡æ–°ç™»å…¥</a> æˆ– 
                        <button onclick="window.location.reload()" style="background: #f59e0b; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; margin-left: 0.5rem;">é‡æ–°è¼‰å…¥é é¢</button>
                        <button onclick="document.getElementById('dashboard-login-prompt').remove(); adjustPageMargin(false);" style="background: transparent; border: none; color: #92400e; margin-left: 1rem;">âœ•</button>
                    </p>
                </div>
            `;
            document.body.insertBefore(notification, document.body.firstChild);
            
            // èª¿æ•´é é¢å…§å®¹å‘ä¸‹åç§»
            adjustPageMargin(true);
        }
        
        function hideLoginPromptInDashboard() {
            const existing = document.getElementById('dashboard-login-prompt');
            if (existing) {
                existing.remove();
                adjustPageMargin(false);
                console.log('âœ… Dashboard ç™»å…¥æç¤ºå·²ç§»é™¤');
            }
        }
        
        function adjustPageMargin(hasPrompt) {
            const mainContent = document.querySelector('.dashboard-container');
            if (mainContent) {
                mainContent.style.marginTop = hasPrompt ? '60px' : '0px';
            }
        }
        
        // æ›´æ–° Dashboard èº«ä»½é©—è­‰ç‹€æ…‹
        function updateDashboardAuthState(authState) {
            console.log('ğŸ”„ æ›´æ–° Dashboard èº«ä»½é©—è­‰ç‹€æ…‹:', authState);
            
            if (authState.isAuthenticated) {
                // ç”¨æˆ¶å·²ç™»å…¥ï¼Œç§»é™¤ç™»å…¥æç¤º
                hideLoginPromptInDashboard();
                
                // æ›´æ–°ç”¨æˆ¶ä¿¡æ¯é¡¯ç¤º
                updateUserInfoDisplay(authState);
                
                console.log('âœ… Dashboard èªè­‰ç‹€æ…‹: å·²ç™»å…¥');
            } else {
                // ç”¨æˆ¶æœªç™»å…¥ï¼Œé¡¯ç¤ºç™»å…¥æç¤º
                showLoginPromptInDashboard();
                console.log('âš ï¸ Dashboard èªè­‰ç‹€æ…‹: æœªç™»å…¥');
            }
        }
        
        function updateUserInfoDisplay(authState) {
            // æ›´æ–°é é¢ä¸­çš„ç”¨æˆ¶ä¿¡æ¯ï¼ˆå¦‚æœéœ€è¦ï¼‰
            if (authState.userEmail || authState.credits) {
                console.log('ğŸ“Š æ›´æ–°ç”¨æˆ¶ä¿¡æ¯é¡¯ç¤º:', {
                    email: authState.userEmail,
                    credits: authState.credits
                });
                
                // è§¸ç™¼å°èˆªæ¬„æ›´æ–°
                if (window.VaultCaddyNavbar && window.VaultCaddyNavbar.loadUserState) {
                    window.VaultCaddyNavbar.loadUserState();
                }
            }
        }

        function toggleView() {
            alert('View toggle functionality will be implemented.');
        }

        function showActionMenu(event, documentId) {
            alert(`Action menu for ${documentId} will be shown here.`);
        }

        // åˆªé™¤äº¤æ˜“è¡Œ
        function deleteTransaction(button) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†äº¤æ˜“å—ï¼Ÿ')) {
                const row = button.closest('tr');
                row.remove();
                
                // é‡æ–°è¨ˆç®—é¤˜é¡
                recalculateBalances();
            }
        }
        
        // é‡æ–°è¨ˆç®—æ‰€æœ‰é¤˜é¡
        function recalculateBalances() {
            const rows = document.querySelectorAll('#transactions-tbody tr');
            let runningBalance = 0;
            
            rows.forEach((row, index) => {
                const amountInput = row.querySelector('.amount-input');
                const balanceInput = row.querySelector('.balance-input');
                
                if (amountInput && balanceInput) {
                    const amount = parseFloat(amountInput.value) || 0;
                    runningBalance += amount;
                    balanceInput.value = runningBalance.toFixed(2);
                }
            });
        }
        
        // ç›£è½é‡‘é¡è®ŠåŒ–ä¸¦è‡ªå‹•é‡æ–°è¨ˆç®—é¤˜é¡
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('amount-input')) {
                recalculateBalances();
            }
        });
        
        // æ¨™ç±¤åˆ‡æ›
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('tab-btn')) {
                // ç§»é™¤æ‰€æœ‰æ´»èºç‹€æ…‹
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                // æ·»åŠ æ´»èºç‹€æ…‹åˆ°é»æ“Šçš„æ¨™ç±¤
                e.target.classList.add('active');
            }
        });
    </script>

    <!-- åŸå§‹ä¸Šå‚³æ¨¡æ…‹æ¡†å·²ç§»é™¤ï¼Œçµ±ä¸€ä½¿ç”¨LedgerBoxé¢¨æ ¼æ¨¡æ…‹æ¡† -->

    <style>
        /* ä¸Šå‚³æ¨¡æ…‹æ¡†æ¨£å¼ */
        .upload-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .modal-content {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            z-index: 1001;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #1f2937;
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .modal-close-btn {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .modal-close-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .file-drop-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 1.5rem;
            background: #f9fafb;
        }
        
        .file-drop-area:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        .file-drop-area.has-files {
            border-style: solid;
            border-color: #10b981;
            background: #f0fdf4;
        }
        
        .file-list h4 {
            margin: 0 0 1rem 0;
            color: #1f2937;
            text-align: left;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-bottom: 0.5rem;
        }
        
        .file-item i {
            color: #ef4444;
            font-size: 1.25rem;
            margin-right: 0.75rem;
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-name {
            font-weight: 500;
            color: #1f2937;
        }
        
        .file-size {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .remove-file-btn {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .remove-file-btn:hover {
            background: #fef2f2;
            color: #ef4444;
        }
        
        .upload-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        .file-types ul {
            margin: 0.5rem 0 0 0;
            padding-left: 1.5rem;
            color: #6b7280;
        }
        
        .processing-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .processing-options label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #374151;
            cursor: pointer;
        }
        
        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: #ffffff;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        /* ç‹€æ…‹å¾½ç« æ¨£å¼ */
        .status-badge.processing {
            background: #fef3c7;
            color: #92400e;
        }
        
        .review-badge.pending {
            background: #fee2e2;
            color: #991b1b;
        }
        
        @media (max-width: 768px) {
            .upload-options {
                grid-template-columns: 1fr;
            }
        }
        
        // å‰µå»ºæ–‡æª”è¡¨æ ¼è¡Œ
        function createDocumentRow(tbody, file) {
            const row = document.createElement('tr');
            row.className = 'document-row';
            row.setAttribute('data-file-id', file.id);
            
            const uploadDate = new Date(file.uploadTime || file.uploadDate).toLocaleDateString('zh-TW');
            const fileSize = formatFileSize(file.size);
            
            row.innerHTML = `
                <td>
                    <input type="checkbox" class="file-checkbox" onchange="updateSelection()">
                </td>
                <td>
                    <div class="document-info">
                        <i class="fas fa-file-pdf" style="color: #ef4444; margin-right: 0.5rem;"></i>
                        <div>
                            <strong>${file.name}</strong>
                            <small style="display: block; color: #6b7280;">${fileSize}</small>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="period-info">
                        <strong>2024å¹´1æœˆ</strong>
                        <small>2024-01-01 è‡³ 2024-01-31</small>
                    </div>
                </td>
                <td>
                    <div class="reconciliation">
                        <span class="reconciliation-fraction">0/13</span>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="balance-info">
                        <div>æœŸåˆ: $10,000</div>
                        <div>æœŸæœ«: $8,500</div>
                        <strong>å·®é¡: -$1,500</strong>
                    </div>
                </td>
                <td>
                    <span class="status-indicator in-progress">è™•ç†ä¸­</span>
                </td>
                <td>
                    <span class="status-badge review">å¾…å¯©æ ¸</span>
                </td>
                <td>
                    <span style="color: #6b7280;">ç„¡å‚™è¨»</span>
                </td>
                <td>
                    <span style="color: #6b7280;">${uploadDate}</span>
                </td>
                <td>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="viewDocument('${file.id}')" title="æŸ¥çœ‹">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn" onclick="downloadDocument('${file.id}')" title="ä¸‹è¼‰">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="action-btn" onclick="deleteDocument('${file.id}')" title="åˆªé™¤">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            
            tbody.appendChild(row);
        }
        
        // æ›´æ–°åˆ†é ä¿¡æ¯
        function updatePaginationInfo(totalRows) {
            const selectionInfo = document.getElementById('selection-info');
            const pageInfo = document.getElementById('page-info');
            
            if (selectionInfo) {
                selectionInfo.textContent = `0 of ${totalRows} row(s) selected.`;
            }
            
            if (pageInfo) {
                const totalPages = Math.ceil(totalRows / 10);
                pageInfo.textContent = `Page 1 of ${totalPages}`;
            }
        }
        
        // åˆ†é æ§åˆ¶å‡½æ•¸
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('select-all');
            const fileCheckboxes = document.querySelectorAll('.file-checkbox');
            
            fileCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            updateSelection();
        }
        
        function updateSelection() {
            const fileCheckboxes = document.querySelectorAll('.file-checkbox');
            const checkedBoxes = document.querySelectorAll('.file-checkbox:checked');
            const selectionInfo = document.getElementById('selection-info');
            
            if (selectionInfo) {
                selectionInfo.textContent = `${checkedBoxes.length} of ${fileCheckboxes.length} row(s) selected.`;
            }
        }
        
        function changeRowsPerPage() {
            const rowsPerPage = document.getElementById('rows-per-page').value;
            console.log('æ›´æ”¹æ¯é è¡Œæ•¸:', rowsPerPage);
            // é‡æ–°è¼‰å…¥ç•¶å‰æ–‡æª”é¡å‹
            const currentDocType = getCurrentDocumentType();
            loadFilesForDocumentType(currentDocType);
        }
        
        function goToFirstPage() {
            console.log('å‰å¾€ç¬¬ä¸€é ');
        }
        
        function goToPreviousPage() {
            console.log('å‰å¾€ä¸Šä¸€é ');
        }
        
        function goToNextPage() {
            console.log('å‰å¾€ä¸‹ä¸€é ');
        }
        
        function goToLastPage() {
            console.log('å‰å¾€æœ€å¾Œä¸€é ');
        }
        
        // æ–‡æª”æ“ä½œå‡½æ•¸
        function viewDocument(fileId) {
            console.log('æŸ¥çœ‹æ–‡æª”:', fileId);
            // åˆ‡æ›åˆ°æ–‡æª”è©³ç´°è¦–åœ–
            showDocumentDetail(fileId);
        }
        
        function downloadDocument(fileId) {
            console.log('ä¸‹è¼‰æ–‡æª”:', fileId);
            // å¯¦ç¾ä¸‹è¼‰åŠŸèƒ½
        }
        
        function deleteDocument(fileId) {
            console.log('åˆªé™¤æ–‡æª”:', fileId);
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹æ–‡æª”å—ï¼Ÿ')) {
                // å¯¦ç¾åˆªé™¤åŠŸèƒ½
                const row = document.querySelector(`[data-file-id="${fileId}"]`);
                if (row) {
                    row.remove();
                    updateDocumentStats();
                }
            }
        }
        
        // ç²å–ç•¶å‰æ–‡æª”é¡å‹
        function getCurrentDocumentType() {
            const hash = window.location.hash;
            if (hash === '#bank-statement') {
                return 'bank-statement';
            }
            // é»˜èªè¿”å›éŠ€è¡Œå°å¸³å–®
            return 'bank-statement';
        }
