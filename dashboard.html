<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="page_title_dashboard">ÂÑÄË°®Êùø - VaultCaddy</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="pages.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script src="config.js"></script>
    <script src="google-auth.js"></script>
    <script src="translations.js"></script>
    <script src="unified-auth.js"></script>
    <script src="global-auth-sync.js"></script>
    <script src="navbar-component.js"></script>
    <script src="sidebar-component.js"></script>
    <!-- ËºâÂÖ•Áµ±‰∏ÄËôïÁêÜÂô®Á≥ªÁµ± -->
    <script src="google-ai-integration.js"></script>
    <script src="google-document-ai.js"></script>
    <script src="google-vision-ai.js"></script>
    <script src="google-smart-processor.js"></script>
    <script src="google-cloud-storage.js"></script>
    <script src="ledgerbox-integration.js"></script>
    
    <!-- ËºâÂÖ•Êñ∞ÁöÑOCRÂíåÊï∏ÊìöËôïÁêÜÂô® -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="tesseract-ocr-processor.js"></script>
    <script src="data-processor.js"></script>
    <script src="intelligent-ocr-processor.js"></script>
    
    <!-- ËºâÂÖ•Áµ±‰∏ÄËôïÁêÜÂô® -->
    <script src="unified-document-processor.js"></script>
    
    <!-- ÂÅúÁî®ÁöÑËôïÁêÜÂô®Ôºà‰øùÁïô‰ª•Èò≤ÈúÄË¶ÅÔºâ -->
    <!-- <script src="ai-document-processor.js"></script> -->
    <!-- <script src="ai-services.js"></script> -->
    <!-- <script src="enhanced-file-processor.js"></script> -->
    <link rel="stylesheet" href="ledgerbox-styles.css">
    
    <style>
        /* ÁôΩËâ≤‰∏ªÈ°åÊ®£Âºè */
        body {
            background: #ffffff !important;
            color: #1f2937 !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .dashboard-container {
            display: flex;
            min-height: 100vh;
            background: #ffffff;
            padding-top: 60px; /* ÁÇ∫Â∞éËà™Ê¨ÑÁïôÂá∫Á©∫Èñì */
        }
        
        .sidebar {
            width: 280px;
            background: #f8fafc;
            border-right: 1px solid #e2e8f0;
            flex-shrink: 0;
            position: fixed;
            top: 60px;
            bottom: 0;
            left: 0;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            padding: 1.5rem 1rem 1rem 1rem;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .sidebar-header h2 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }
        
        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
        }
        
        .sidebar-nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .sidebar-nav .nav-item {
            margin: 0;
        }
        
        .sidebar-nav .nav-item a {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: #6b7280;
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        
        .sidebar-nav .nav-item.active a {
            background: #eff6ff;
            color: #2563eb;
            border-left-color: #2563eb;
        }
        
        .sidebar-nav .nav-item a:hover {
            background: #f1f5f9;
            color: #374151;
        }
        
        .sidebar-nav .nav-item a i {
            width: 20px;
            margin-right: 0.75rem;
            font-size: 1rem;
        }
        
        .sidebar-section {
            padding: 1rem 0;
            border-top: 1px solid #e2e8f0;
        }
        
        .sidebar-section h3 {
            font-size: 0.75rem;
            font-weight: 600;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 0 0 0.5rem 1rem;
        }
        
        .sidebar-footer {
            padding: 1rem;
            border-top: 1px solid #e2e8f0;
            background: #ffffff;
        }
        
        .sidebar-stats {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
        }
        
        .stat-item:last-child {
            margin-bottom: 0;
        }
        
        .stat-left {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .stat-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1f2937;
        }
        
        .main-content {
            flex: 1;
            background: #ffffff;
            margin-left: 280px;
            overflow-y: auto;
            min-height: calc(100vh - 60px);
        }
        
        .page-header {
            padding: 2rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #ffffff;
        }
        
        .page-header h1 {
            font-size: 2rem;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }
        
        .page-header p {
            color: #6b7280;
            margin: 0.5rem 0 0 0;
        }
        
        .help-btn {
            background: #6366f1;
            color: #ffffff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .help-btn:hover {
            background: #4f46e5;
        }
        
        .controls-bar {
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e2e8f0;
            background: #ffffff;
        }
        
        .filter-input {
            background: #ffffff;
            border: 1px solid #d1d5db;
            color: #1f2937;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            width: 300px;
            font-size: 14px;
        }
        
        .filter-input::placeholder {
            color: #9ca3af;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .actions {
            display: flex;
            gap: 1rem;
        }
        
        .upload-btn {
            background: #6366f1;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .upload-btn:hover {
            background: #4f46e5;
        }
        
        .view-btn {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        .view-btn:hover {
            background: #e5e7eb;
        }
        
        .documents-table-container {
            padding: 0 2rem;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .documents-table {
            width: 100%;
            min-width: 1200px; /* Á¢∫‰øùË°®Ê†ºÊúÄÂ∞èÂØ¨Â∫¶ÔºåËß∏ÁôºÊ∞¥Âπ≥ÊªæÂãï */
            border-collapse: collapse;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .documents-table thead th {
            background: #f8fafc;
            color: #374151;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid #e2e8f0;
            white-space: nowrap; /* Èò≤Ê≠¢Ê®ôÈ°åÊñáÂ≠óÊèõË°å */
            font-size: 14px;
        }
        
        .documents-table tbody tr {
            border-bottom: 1px solid #f3f4f6;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .documents-table tbody tr:hover {
            background: #f9fafb;
        }
        
        .documents-table tbody tr:last-child {
            border-bottom: none;
        }
        
        .documents-table tbody td {
            padding: 1rem;
            color: #374151;
            vertical-align: middle;
            white-space: nowrap; /* Èò≤Ê≠¢ÂñÆÂÖÉÊ†ºÂÖßÂÆπÊèõË°å */
            font-size: 14px;
        }
        
        .document-cell {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .file-icon {
            color: #ef4444;
            font-size: 1.5rem;
        }
        
        .doc-name {
            font-weight: 600;
            color: #1f2937;
        }
        
        .doc-details {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        .period-info {
            color: #6b7280;
        }
        
        .reconciliation {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .reconciliation-text {
            font-weight: 600;
        }
        
        .progress-bar {
            width: 100px;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #10b981;
            transition: width 0.3s;
        }
        
        .progress-percentage {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .reconciliation-status {
            font-size: 0.75rem;
            color: #fbbf24;
        }
        
        .balance-info {
            font-size: 0.875rem;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .status-badge.success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .review-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .review-badge.review {
            background: rgba(249, 115, 22, 0.2);
            color: #f97316;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .action-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }
        
        .pagination-info {
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #6b7280;
            border-top: 1px solid #e2e8f0;
            background: #ffffff;
            font-size: 14px;
        }
        
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .rows-per-page {
            background: #ffffff;
            border: 1px solid #d1d5db;
            color: #374151;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .rows-per-page:focus {
            outline: none;
            border-color: #6366f1;
        }
        
        .pagination-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .page-btn {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            color: #374151;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .page-btn:hover:not(:disabled) {
            background: #e5e7eb;
        }
        
        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* ÂèØÁ∑®ËºØËº∏ÂÖ•Ê°ÜÊ®£Âºè */
        .editable-input {
            border: 1px solid transparent;
            background: transparent;
            padding: 0.5rem;
            font-size: 14px;
            color: #374151;
            width: 100%;
            box-sizing: border-box;
            transition: all 0.2s;
        }
        
        .editable-input:hover {
            border-color: #d1d5db;
            background: #f9fafb;
        }
        
        .editable-input:focus {
            outline: none;
            border-color: #6366f1;
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .editable-input[readonly] {
            background: #f3f4f6;
            color: #6b7280;
            cursor: not-allowed;
        }
        
        .editable-input[readonly]:hover {
            border-color: transparent;
            background: #f3f4f6;
        }
        
        .date-input {
            min-width: 140px;
        }
        
        .description-input {
            min-width: 200px;
        }
        
        .amount-input,
        .balance-input {
            min-width: 100px;
            text-align: right;
        }
        
        .delete-transaction-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .delete-transaction-btn:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        /* ÊñáÊ™îË©≥Á¥∞Ë¶ñÂúñÊ®£Âºè */
        .back-navigation {
            padding: 1rem 2rem;
            border-bottom: 1px solid #334155;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }
        
        .back-btn:hover {
            color: #e2e8f0;
        }
        
        .document-detail-container {
            display: flex;
            min-height: calc(100vh - 200px);
            height: auto;
        }
        
        .pdf-preview-container {
            width: 40%;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            background: #ffffff;
        }
        
        .pdf-controls {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 1rem;
            background: #f8fafc;
        }
        
        .pdf-control-btn {
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            color: #475569;
            padding: 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pdf-control-btn:hover {
            background: #e2e8f0;
            border-color: #cbd5e1;
        }
        
        .page-info {
            color: #64748b;
            font-weight: 500;
        }
        
        .pdf-viewer {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            padding: 2rem;
        }
        
        .pdf-placeholder {
            text-align: center;
            color: #64748b;
            padding: 2rem;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            background: #ffffff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .pdf-placeholder i {
            font-size: 3rem;
            color: #3b82f6;
            margin-bottom: 1rem;
        }
        
        .pdf-placeholder h3 {
            color: #1f2937;
            margin: 0 0 0.5rem 0;
        }
        
        .pdf-placeholder p {
            color: #6b7280;
            margin: 0;
        }
        
        .pdf-placeholder i {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .data-extraction-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }
        
        .extraction-header {
            padding: 1rem 2rem;
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .extraction-header h2 {
            font-size: 1.5rem;
            color: #e2e8f0;
            margin: 0;
        }
        
        .extraction-tabs {
            display: flex;
            gap: 1rem;
        }
        
        .tab-btn {
            background: none;
            border: none;
            color: #94a3b8;
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .tab-btn.active {
            color: #8b5cf6;
            border-bottom-color: #8b5cf6;
        }
        
        .document-actions {
            display: flex;
            gap: 1rem;
        }
        
        .save-btn, .download-btn, .more-actions-btn {
            background: #475569;
            border: none;
            color: #e2e8f0;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .reconciliation-status {
            padding: 1rem 2rem;
            border-bottom: 1px solid #334155;
        }
        
        .reconciliation-status h3 {
            color: #e2e8f0;
            margin: 0 0 0.5rem 0;
        }
        
        .completion-status {
            color: #fbbf24;
            font-weight: 600;
        }
        
        .bank-statement-details {
            padding: 1rem 2rem;
            border-bottom: 1px solid #334155;
        }
        
        .bank-statement-details h3 {
            color: #e2e8f0;
            margin: 0;
        }
        
        .transactions-section {
            flex: 1;
            padding: 1rem 2rem;
        }
        
        .transactions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .transactions-header h3 {
            color: #e2e8f0;
            margin: 0;
        }
        
        .transaction-controls {
            display: flex;
            gap: 1rem;
        }
        
        .control-btn {
            background: #475569;
            border: none;
            color: #e2e8f0;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .add-btn {
            background: #8b5cf6;
        }
        
        .transaction-info {
            margin-bottom: 1rem;
            color: #94a3b8;
        }
        
        .transactions-table-container {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .transactions-table {
            width: 100%;
            border-collapse: collapse;
            background: #ffffff;
        }
        
        .transactions-table thead th {
            background: #f8fafc;
            color: #374151;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .transactions-table tbody tr {
            border-bottom: 1px solid #e5e7eb;
        }
        
        .transactions-table tbody tr:last-child {
            border-bottom: none;
        }
        
        .transactions-table tbody td {
            padding: 0.75rem;
            color: #374151;
        }
        
        .transaction-checkbox {
            margin: 0;
        }
        
        .delete-transaction-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0.25rem;
        }
        
        .delete-transaction-btn:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        .view-container {
            height: 100%;
        }
        
        /* ÂèØÁ∑®ËºØË°®Ê†ºÊ®£Âºè */
        .editable-input {
            width: 100%;
            border: 1px solid transparent;
            background: transparent;
            padding: 0.5rem;
            font-size: 14px;
            color: #374151;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .editable-input:focus {
            outline: none;
            border-color: #6366f1;
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .editable-input:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        
        .date-input {
            min-width: 140px;
        }
        
        .description-input {
            min-width: 200px;
        }
        
        .amount-input, .balance-input {
            min-width: 100px;
            text-align: right;
        }
        
        .transaction-row:hover .editable-input {
            border-color: #d1d5db;
        }
        
        .delete-transaction-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .delete-transaction-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }
    </style>
</head>
<body>
    <!-- Â∞éËà™Ê¨Ñ -->
    <div id="navbar-placeholder"></div>

    <!-- Dashboard ÂÆπÂô® -->
    <div class="dashboard-container">
        <!-- Â∑¶ÂÅ¥ÈÇäÊ¨Ñ -->
        <aside class="sidebar">
            <!-- Áµ±‰∏ÄÁöÑÂ∑¶ÂÅ¥Â∞éËà™ -->
            <div class="sidebar-header">
                <h2 data-translate="models">Ê®°Âûã</h2>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li class="nav-item active">
                        <a href="dashboard.html#bank-statement">
                            <i class="fas fa-university"></i>
                            <span data-translate="sidebar_bank_statements">ÈäÄË°åÂ∞çÂ∏≥ÂñÆ</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="dashboard.html#invoice">
                            <i class="fas fa-file-invoice"></i>
                            <span data-translate="sidebar_invoices">ÁôºÁ•®</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="dashboard.html#receipt">
                            <i class="fas fa-receipt"></i>
                            <span data-translate="sidebar_receipts">Êî∂Êìö</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="dashboard.html#general">
                            <i class="fas fa-file-alt"></i>
                            <span data-translate="sidebar_general">‰∏ÄËà¨ÊñáÊ™î</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="sidebar-section">
                <h3 data-translate="configurations">ÈÖçÁΩÆ</h3>
                <ul class="sidebar-nav">
                    <li class="nav-item">
                        <a href="account.html">
                            <i class="fas fa-user"></i>
                            <span data-translate="account">Â∏≥Êà∂</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="billing.html">
                            <i class="fas fa-credit-card"></i>
                            <span data-translate="billing">Ë®àË≤ª</span>
                        </a>
                    </li>
                </ul>
            </div>
            
            <div class="sidebar-footer">
                <div class="sidebar-stats">
                    <div class="stat-item">
                        <div class="stat-left">
                            <i class="fas fa-file-alt" style="color: #6b7280; font-size: 1rem; width: 16px; text-align: center;"></i>
                            <span class="stat-label">ËôïÁêÜÊñáÊ™îÁ∏ΩÊï∏</span>
                        </div>
                        <span class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <div class="stat-left">
                            <i class="fas fa-clock" style="color: #6b7280; font-size: 1rem; width: 16px; text-align: center;"></i>
                            <span class="stat-label" data-translate="average_processing_time">Âπ≥ÂùáËôïÁêÜÊôÇÈñì</span>
                        </div>
                        <span class="stat-value">0ms</span>
                    </div>
                    <div class="stat-item">
                        <div class="stat-left">
                            <i class="fas fa-check-circle" style="color: #10b981; font-size: 1rem; width: 16px; text-align: center;"></i>
                            <span class="stat-label" data-translate="processing_success_rate">ËôïÁêÜÊàêÂäüÁéá</span>
                        </div>
                        <span class="stat-value">0%</span>
                    </div>
                    <div class="stat-item">
                        <div class="stat-left">
                            <i class="fas fa-coins" style="color: #f59e0b; font-size: 1rem; width: 16px; text-align: center;"></i>
                            <span class="stat-label" data-translate="remaining_credits">Ââ©È§òÁ©çÂàÜ</span>
                        </div>
                        <span class="stat-value">7</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- ‰∏ªÂÖßÂÆπÂçÄÂüü -->
        <main class="main-content" id="main-content">
            <!-- ÊñáÊ™îÂàóË°®Ë¶ñÂúñ -->
            <div id="document-list-view" class="view-container">
                <!-- È†ÅÈù¢Ê®ôÈ°å -->
                <header class="page-header">
                    <div class="header-left">
                        <h1 id="page-title">Bank statement converter</h1>
                        <p id="page-subtitle">Manage and view your documents</p>
                    </div>
                    <div class="header-right">
                        <button class="help-btn" onclick="showHelp()">Need Help?</button>
                    </div>
                </header>

                <!-- ÊéßÂà∂Ê¨Ñ -->
                <div class="controls-bar">
                    <div class="search-filter">
                        <input type="text" data-translate-placeholder="filter_document_name" placeholder="ÁØ©ÈÅ∏ÊñáÊ™îÂêçÁ®±..." class="filter-input" id="filter-input">
                    </div>
                    <div class="actions">
                        <button class="upload-btn" onclick="openUploadModal()">
                            <i class="fas fa-upload"></i>
                            <span data-translate="upload_files">‰∏äÂÇ≥Êñá‰ª∂</span>
                        </button>
                        <button class="view-btn" onclick="toggleView()">
                            <i class="fas fa-list"></i>
                            <span data-translate="view">Ê™¢Ë¶ñ</span>
                        </button>
                    </div>
                </div>

                <!-- ÊñáÊ™îË°®Ê†º -->
                <div class="documents-table-container">
                    <table class="documents-table">
                        <thead>
                            <tr>
                                <th style="width: 40px;">
                                    <input type="checkbox" class="select-all">
                                </th>
                                <th data-translate="document">ÊñáÊ™î</th>
                                <th data-translate="statement_period">Â∞çÂ∏≥ÂñÆÊúüÈñì</th>
                                <th data-translate="reconciliation">Â∞çÂ∏≥</th>
                                <th data-translate="balance_info">È§òÈ°ç‰ø°ÊÅØ</th>
                                <th data-translate="status">ÁãÄÊÖã</th>
                                <th>Review Status</th>
                                <th>Notes</th>
                                <th>Date Uploaded</th>
                                <th data-translate="actions">Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody id="documents-tbody">
                            <!-- Áî®Êà∂ÊñáÊ™îÂ∞áÂãïÊÖãËºâÂÖ•Âà∞ÈÄôË£° -->
                            <!-- Êñ∞Áî®Êà∂Â∞áÁúãÂà∞Á©∫ÁöÑË°®Ê†ºÔºåÂ∑≤ËôïÁêÜÊñáÊ™îÁöÑÁî®Êà∂Â∞áÁúãÂà∞ÂÖ∂ËôïÁêÜÁöÑÊñá‰ª∂ -->
                        </tbody>
                    </table>
                </div>

                <!-- ÂàÜÈ†Å‰ø°ÊÅØ -->
                <div class="pagination-info">
                    <span>0 <span data-translate="of">ÂÖ±</span> 1 <span data-translate="row_s_selected">Ë°åÂ∑≤ÈÅ∏Êìá</span>.</span>
                    <div class="pagination-controls">
                        <span data-translate="rows_per_page">ÊØèÈ†ÅË°åÊï∏</span>
                        <select class="rows-per-page">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                        </select>
                        <span><span data-translate="page_of">Á¨¨</span> 1 <span data-translate="of">ÂÖ±</span> 1</span>
                        <div class="pagination-buttons">
                            <button class="page-btn" disabled><i class="fas fa-angle-double-left"></i></button>
                            <button class="page-btn" disabled><i class="fas fa-angle-left"></i></button>
                            <button class="page-btn" disabled><i class="fas fa-angle-right"></i></button>
                            <button class="page-btn" disabled><i class="fas fa-angle-double-right"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÊñáÊ™îË©≥Á¥∞Ë¶ñÂúñ -->
            <div id="document-detail-view" class="view-container" style="display: none;">
                <!-- ËøîÂõûÊåâÈàï -->
                <div class="back-navigation">
                    <button class="back-btn" onclick="backToDocumentList()">
                        <i class="fas fa-arrow-left"></i> <span data-translate="back_to_dashboard">ËøîÂõûÂÑÄË°®Êùø</span>
                    </button>
                </div>

                <!-- ÊñáÊ™îË©≥Á¥∞ÂÖßÂÆπ -->
                <div class="document-detail-container">
                    <!-- Â∑¶ÂÅ¥ÔºöPDF È†êË¶Ω -->
                    <div class="pdf-preview-container">
                        <div class="pdf-controls">
                            <button class="pdf-control-btn"><i class="fas fa-chevron-left"></i></button>
                            <span class="page-info">1 of 3</span>
                            <button class="pdf-control-btn"><i class="fas fa-chevron-right"></i></button>
                            <button class="pdf-control-btn"><i class="fas fa-search-plus"></i></button>
                            <button class="pdf-control-btn"><i class="fas fa-undo"></i></button>
                            <button class="pdf-control-btn"><i class="fas fa-search-minus"></i></button>
                        </div>
                        <div class="pdf-viewer">
                            <div class="pdf-placeholder" id="pdf-placeholder">
                                <i class="fas fa-file-pdf"></i>
                                <h3>PDF Preview</h3>
                                <p id="document-title">Document Loading...</p>
                                <small style="display: block; margin-top: 1rem; color: #9ca3af;">
                                    Êñá‰ª∂È†êË¶ΩÂ∞áÈ°ØÁ§∫Âú®ÈÄôË£°ÔºåËÆìÁî®Êà∂Âø´ÈÄüË≠òÂà•Êñá‰ª∂ÂÖßÂÆπ
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Âè≥ÂÅ¥ÔºöÊï∏ÊìöÊèêÂèñÂíåËôïÁêÜ -->
                    <div class="data-extraction-container">
                        <!-- È†ÇÈÉ®Ê®ôÈ°å -->
                        <div class="extraction-header">
                            <h2 id="document-title-header">Document Loading...</h2>
                            <div class="extraction-tabs">
                                <button class="tab-btn active" data-tab="results">Results</button>
                                <button class="tab-btn" data-tab="export">Export</button>
                                <button class="tab-btn" data-tab="json">JSON</button>
                            </div>
                            <div class="document-actions">
                                <button class="save-btn">
                                    <i class="fas fa-save"></i> Saved
                                </button>
                                <button class="download-btn">
                                    <i class="fas fa-download"></i> Download
                                </button>
                                <button class="more-actions-btn">
                                    <i class="fas fa-ellipsis-h"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Â∞çÂ∏≥ÁãÄÊÖã -->
                        <div class="reconciliation-status">
                            <h3 data-translate="reconciliation_status">Â∞çÂ∏≥ÁãÄÊÖã</h3>
                            <p>0 <span data-translate="of">ÂÖ±</span> 13 <span data-translate="transactions_reconciled">Á≠Ü‰∫§ÊòìÂ∑≤Â∞çÂ∏≥</span></p>
                            <div class="completion-status">0% <span data-translate="complete">ÂÆåÊàê</span></div>
                        </div>

                        <!-- ÈäÄË°åÂ∞çÂ∏≥ÂñÆË©≥Á¥∞‰ø°ÊÅØ -->
                        <div class="bank-statement-details">
                            <h3 data-translate="bank_statement_details">ÈäÄË°åÂ∞çÂ∏≥ÂñÆË©≥Á¥∞‰ø°ÊÅØËàáÂÇôË®ª</h3>
                            <!-- ÂèØÊî∂Ëµ∑ÁöÑË©≥Á¥∞‰ø°ÊÅØÂçÄÂüü -->
                        </div>

                        <!-- ‰∫§ÊòìÂàóË°® -->
                        <div class="transactions-section">
                            <div class="transactions-header">
                                <h3 data-translate="transactions_title">‰∫§ÊòìË®òÈåÑ</h3>
                                <div class="transaction-controls">
                                    <button class="control-btn">Show Unreconciled</button>
                                    <button class="control-btn">Toggle All</button>
                                    <button class="control-btn add-btn">Add Item</button>
                                </div>
                            </div>

                            <div class="transaction-info">
                                <p><span data-translate="showing_transactions">È°ØÁ§∫Á¨¨</span> 1 <span data-translate="to">Ëá≥</span> 13 <span data-translate="of">ÂÖ±</span> 13 <span data-translate="transactions">Á≠Ü‰∫§Êòì</span></p>
                            </div>

                            <!-- ‰∫§ÊòìË°®Ê†º -->
                            <div class="transactions-table-container">
                                <table class="transactions-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 40px;"><i class="fas fa-check"></i></th>
                                            <th>Date</th>
                                            <th>Description</th>
                                            <th>Amount</th>
                                            <th>Balance</th>
                                            <th style="width: 40px;"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="transactions-tbody">
                                        <!-- ÂãïÊÖãÂ°´ÂÖÖÁöÑ‰∫§ÊòìÊï∏ÊìöÂ∞áÈ°ØÁ§∫Âú®ÈÄôË£° -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ÁôªÂÖ•ÁãÄÊÖãÊ™¢Êü• - ‰ΩøÁî®ÂÖ®ÂüüÂêåÊ≠•Á≥ªÁµ±
        function checkLoginStatus() {
            console.log('üîç Dashboard Ê™¢Êü•Ë∫´‰ªΩÈ©óË≠âÁãÄÊÖã...');
            
            // ‰ΩøÁî®ÂÖ®ÂüüË∫´‰ªΩÈ©óË≠âÂêåÊ≠•Á≥ªÁµ±
            if (window.GlobalAuthSync) {
                const globalState = window.GlobalAuthSync.getCurrentAuthState();
                console.log('üåê Dashboard ÂÖ®ÂüüË∫´‰ªΩÈ©óË≠âÁãÄÊÖã:', globalState);
                return globalState.isAuthenticated;
            }
            
            // ÂÖúÂ∫ïÈÇèËºØÔºöÂ¶ÇÊûúÂÖ®ÂüüÁ≥ªÁµ±Êú™ËºâÂÖ•Ôºå‰ΩøÁî®Êú¨Âú∞Ê™¢Êü•
            console.log('‚ö†Ô∏è ÂÖ®ÂüüÂêåÊ≠•Á≥ªÁµ±Êú™ËºâÂÖ•Ôºå‰ΩøÁî®Êú¨Âú∞Ê™¢Êü•');
            return window.checkGlobalAuthState ? window.checkGlobalAuthState() : true;
        }

        // ÊñáÊ™îÈ°ûÂûãÈÖçÁΩÆ
        const documentTypes = {
            'bank-statement': {
                titleKey: 'bank_statement_processor',
                subtitleKey: 'manage_view_documents',
                title: 'ÈäÄË°åÂ∞çÂ∏≥ÂñÆËôïÁêÜÂô®',
                subtitle: 'ÁÆ°ÁêÜÂíåÊü•ÁúãÊÇ®ÁöÑÊñáÊ™î',
                icon: 'fas fa-university'
            },
            'invoice': {
                titleKey: 'invoice_processor', 
                subtitleKey: 'manage_view_documents',
                title: 'ÁôºÁ•®ËôïÁêÜÂô®',
                subtitle: 'ÁÆ°ÁêÜÂíåÊü•ÁúãÊÇ®ÁöÑÊñáÊ™î',
                icon: 'fas fa-file-invoice'
            },
            'receipt': {
                titleKey: 'receipt_processor',
                subtitleKey: 'manage_view_documents',
                title: 'Êî∂ÊìöËôïÁêÜÂô®',
                subtitle: 'ÁÆ°ÁêÜÂíåÊü•ÁúãÊÇ®ÁöÑÊñáÊ™î',
                icon: 'fas fa-receipt'
            },
            'general': {
                titleKey: 'general_processor',
                subtitleKey: 'manage_view_documents',
                title: '‰∏ÄËà¨ÊñáÊ™îËôïÁêÜÂô®',
                subtitle: 'ÁÆ°ÁêÜÂíåÊü•ÁúãÊÇ®ÁöÑÊñáÊ™î',
                icon: 'fas fa-file-alt'
            },
            'account': {
                titleKey: 'account_settings',
                subtitleKey: 'manage_account_info',
                title: 'Â∏≥Êà∂Ë®≠ÂÆö',
                subtitle: 'ÁÆ°ÁêÜÊÇ®ÁöÑÂ∏≥Êà∂Ë≥áË®ä',
                icon: 'fas fa-user'
            },
            'billing': {
                titleKey: 'billing_credits',
                subtitleKey: 'manage_billing_subscription',
                title: 'Ë®àË≤ªËàáÁ©çÂàÜ',
                subtitle: 'ÁÆ°ÁêÜÊÇ®ÁöÑË®àË≤ª„ÄÅË®ÇÈñ±ÂíåÁ©çÂàÜ',
                icon: 'fas fa-credit-card'
            }
        };

        // È†ÅÈù¢ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéØ Dashboard È†ÅÈù¢ËºâÂÖ•‰∏≠...');
            
            // Á≠âÂæÖÂÖ®ÂüüÂêåÊ≠•Á≥ªÁµ±ËºâÂÖ•
            const initializeWithGlobalSync = () => {
                if (window.GlobalAuthSync) {
                    console.log('üåê ‰ΩøÁî®ÂÖ®ÂüüË∫´‰ªΩÈ©óË≠âÂêåÊ≠•Á≥ªÁµ±');
                    
                    // Áõ£ËÅΩÂÖ®ÂüüË∫´‰ªΩÈ©óË≠âÁãÄÊÖãËÆäÂåñ
                    window.onGlobalAuthChange((authState) => {
                        console.log('üîÑ Dashboard Êî∂Âà∞ÂÖ®ÂüüË∫´‰ªΩÈ©óË≠âÁãÄÊÖãËÆäÂåñ:', authState);
                        updateDashboardAuthState(authState);
                    });
                    
                    // ÂàùÂßãÊ™¢Êü•
                    const authResult = checkLoginStatus();
                    console.log('üéØ Dashboard ÂàùÂßãË∫´‰ªΩÈ©óË≠âÁµêÊûú:', authResult);
                    
                    if (!authResult) {
                        console.log('‚ö†Ô∏è Dashboard Êú™Ê™¢Ê∏¨Âà∞ÁôªÂÖ•ÁãÄÊÖãÔºåÈ°ØÁ§∫ÊèêÁ§∫');
                        showLoginPromptInDashboard();
                    }
                } else {
                    console.log('‚ö†Ô∏è ÂÖ®ÂüüÂêåÊ≠•Á≥ªÁµ±Êú™ËºâÂÖ•Ôºå‰ΩøÁî®ÂÖúÂ∫ïÈÇèËºØ');
                    // ÂÖúÂ∫ïÈÇèËºØ
                    const authResult = checkLoginStatus();
                    if (!authResult) {
                        showLoginPromptInDashboard();
                    }
                }
            };
            
            // Â¶ÇÊûúÂÖ®ÂüüÂêåÊ≠•Á≥ªÁµ±Â∑≤ËºâÂÖ•ÔºåÁ´ãÂç≥ÂàùÂßãÂåñÔºõÂê¶ÂâáÁ≠âÂæÖ
            if (window.GlobalAuthSync) {
                initializeWithGlobalSync();
            } else {
                setTimeout(initializeWithGlobalSync, 100);
            }

            // ÂàùÂßãÂåñÁµ±‰∏ÄÂÅ¥ÈÇäÊ¨Ñ
            window.unifiedSidebar = new VaultCaddySidebar();
            
            // ËôïÁêÜ hash Ë∑ØÁî±
            handleHashRouting();
            
            // Áõ£ËÅΩ hash ËÆäÂåñ
            window.addEventListener('hashchange', handleHashRouting);
            
            // Áõ£ËÅΩË™ûË®ÄËÆäÊõ¥‰∫ã‰ª∂
            window.addEventListener('languageChanged', function(e) {
                console.log('Dashboard: Ë™ûË®ÄÂ∑≤ËÆäÊõ¥ÁÇ∫', e.detail.language);
                // Ë™ûË®ÄËÆäÊõ¥ÊôÇÈáçÊñ∞ÊáâÁî®Áï∂ÂâçÊñáÊ™îÈ°ûÂûãÁöÑÁøªË≠Ø
                const hash = window.location.hash.substring(1);
                const docType = hash || 'bank-statement';
                if (documentTypes[docType]) {
                    updatePageForDocumentType(docType);
                }
                // Ê≥®ÊÑèÔºöÂÅ¥ÈÇäÊ¨ÑÁöÑË™ûË®ÄÊõ¥Êñ∞Áî± VaultCaddySidebar ÁöÑ setupLanguageListener ËôïÁêÜ
            });
            
            console.log('‚úÖ Unified Dashboard ÂàùÂßãÂåñÂÆåÊàê');
        });

        // ËôïÁêÜ hash Ë∑ØÁî±
        function handleHashRouting() {
            const hash = window.location.hash.substring(1); // ÁßªÈô§ #
            const docType = hash || 'bank-statement'; // ÈªòË™çÁÇ∫ÈäÄË°åÂ∞çÂ∏≥ÂñÆ
            
            if (documentTypes[docType]) {
                updatePageForDocumentType(docType);
            }
        }

        // Êõ¥Êñ∞È†ÅÈù¢ÁÇ∫ÊåáÂÆöÊñáÊ™îÈ°ûÂûã
        function updatePageForDocumentType(docType) {
            const config = documentTypes[docType];
            
            // Á¢∫‰øùÈ°ØÁ§∫ÊñáÊ™îÂàóË°®Ë¶ñÂúñÔºåÈö±ËóèË©≥Á¥∞Ë¶ñÂúñ
            const listView = document.getElementById('document-list-view');
            const detailView = document.getElementById('document-detail-view');
            
            if (listView && detailView) {
                listView.style.display = 'block';
                detailView.style.display = 'none';
            }
            
            // Êõ¥Êñ∞È†ÅÈù¢Ê®ôÈ°å - ÊîØÊåÅÂ§öË™ûË®Ä
            const titleElement = document.getElementById('page-title');
            const subtitleElement = document.getElementById('page-subtitle');
            
            if (titleElement) {
                titleElement.textContent = config.title;
                titleElement.setAttribute('data-translate', config.titleKey);
            }
            if (subtitleElement) {
                subtitleElement.textContent = config.subtitle;
                subtitleElement.setAttribute('data-translate', config.subtitleKey);
            }
            
            // Êõ¥Êñ∞ÁÄèË¶ΩÂô®Ê®ôÈ°å
            document.title = `${config.title} - VaultCaddy`;
            
            // Êõ¥Êñ∞ÂÅ¥ÈÇäÊ¨ÑÊ¥ªË∫çÁãÄÊÖã
            if (window.unifiedSidebar) {
                window.unifiedSidebar.updateActivePage(docType);
            }
            
            // ËºâÂÖ•Ë©≤ÊñáÊ™îÈ°ûÂûãÁöÑÊñá‰ª∂
            loadFilesForDocumentType(docType);
            
            // Â¶ÇÊûúË™ûË®ÄÁÆ°ÁêÜÂô®Â≠òÂú®ÔºåÈáçÊñ∞ÊáâÁî®ÁøªË≠Ø
            if (window.languageManager) {
                window.languageManager.loadLanguage(window.languageManager.currentLanguage);
            }
            
            console.log('‚úÖ Êõ¥Êñ∞È†ÅÈù¢È°ûÂûã:', docType, config.title);
        }
        
        // ËºâÂÖ•ÊåáÂÆöÊñáÊ™îÈ°ûÂûãÁöÑÊñá‰ª∂
        function loadFilesForDocumentType(docType) {
            const tbody = document.getElementById('documents-tbody');
            if (!tbody) return;
            
            // Ê∏ÖÁ©∫Áï∂ÂâçË°®Ê†º
            tbody.innerHTML = '';
            
            // ÂÑ™ÂÖàÂæûÁµ±‰∏ÄÂ≠òÂÑ≤ËºâÂÖ•ÔºåÁÑ∂ÂæåÊòØËàäÊ†ºÂºè
            let storedFiles = [];
            
            // 1. ÂòóË©¶ÂæûÁµ±‰∏ÄÂ≠òÂÑ≤ËºâÂÖ•
            if (window.UnifiedDocumentProcessor && window.UnifiedDocumentProcessor.processors.storage) {
                console.log(`üìÇ ÂæûÁµ±‰∏ÄÂ≠òÂÑ≤ËºâÂÖ• ${docType} Êñá‰ª∂`);
                storedFiles = window.UnifiedDocumentProcessor.getAllProcessedDocuments(docType);
                
                // ËΩâÊèõÁµ±‰∏ÄÊ†ºÂºèÁÇ∫È°ØÁ§∫Ê†ºÂºè
                storedFiles = storedFiles.map(doc => ({
                    id: doc.id,
                    name: doc.fileName,
                    size: doc.fileSize || 0,
                    documentType: doc.documentType,
                    uploadDate: new Date(doc.processedAt).toLocaleDateString('zh-TW'),
                    status: 'completed',
                    processedData: doc
                }));
            }
            
            // 2. Â¶ÇÊûúÁµ±‰∏ÄÂ≠òÂÑ≤Ê≤íÊúâÊï∏ÊìöÔºåÂòóË©¶ËàäÊ†ºÂºè
            if (storedFiles.length === 0) {
                console.log(`üìÇ ÂæûËàäÂ≠òÂÑ≤ËºâÂÖ• ${docType} Êñá‰ª∂`);
                const storageKey = `vaultcaddy_files_${docType}`;
                storedFiles = JSON.parse(localStorage.getItem(storageKey) || '[]');
            }
            
            console.log(`üìÅ ËºâÂÖ• ${docType} Êñá‰ª∂:`, storedFiles.length, 'ÂÄãÊñá‰ª∂');
            
            if (storedFiles.length === 0) {
                // È°ØÁ§∫"No results"Á©∫ÁãÄÊÖã
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" style="text-align: center; padding: 3rem; color: #6b7280; background: #1e293b;">
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 1rem;">
                                <div style="color: #94a3b8; font-size: 1.125rem; font-weight: 500;">
                                    No results.
                                </div>
                                <div style="color: #64748b; font-size: 0.875rem;">
                                    Â∞öÊú™‰∏äÂÇ≥‰ªª‰Ωï ${documentTypes[docType]?.title || docType} Êñá‰ª∂
                                </div>
                                <div style="color: #64748b; font-size: 0.875rem;">
                                    ÈªûÊìä‰∏äÊñπÁöÑ„Äå‰∏äÂÇ≥Êñá‰ª∂„ÄçÊåâÈàïÈñãÂßã‰ΩøÁî®
                                </div>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // È°ØÁ§∫Â≠òÂÑ≤ÁöÑÊñá‰ª∂
            storedFiles.forEach((fileInfo, index) => {
                const row = document.createElement('tr');
                row.className = 'document-row';
                row.onclick = () => openDocumentDetail(fileInfo.id);
                
                row.innerHTML = `
                    <td>
                        <input type="checkbox" onclick="event.stopPropagation()">
                    </td>
                    <td>
                        <div class="document-cell">
                            <i class="fas fa-file-pdf file-icon"></i>
                            <div class="document-info">
                                <div class="doc-name">${fileInfo.name}</div>
                                <div class="doc-details">
                                    <i class="fas fa-user"></i> ${fileInfo.documentType}<br>
                                    <i class="fas fa-file"></i> ${(fileInfo.size / 1024 / 1024).toFixed(2)} MB
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="period-info">
                            <i class="fas fa-check"></i> Â∑≤ËôïÁêÜ
                            <br><small>‰∏äÂÇ≥Êñº ${fileInfo.uploadDate}</small>
                        </div>
                    </td>
                    <td>
                        <div class="reconciliation">
                            <div class="reconciliation-text">-/-</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 100%"></div>
                            </div>
                            <div class="progress-percentage">100%</div>
                            <small class="reconciliation-status">
                                <i class="fas fa-check"></i> <span data-translate="completed">Â∑≤ÂÆåÊàê</span>
                            </small>
                        </div>
                    </td>
                    <td>
                        <div class="balance-info">
                            <div>Â∑≤ËôïÁêÜ</div>
                        </div>
                    </td>
                    <td>
                        <span class="status-badge success">
                            <i class="fas fa-check"></i> Completed
                        </span>
                    </td>
                    <td>
                        <span class="review-badge review">
                            <i class="fas fa-eye"></i> Ready
                        </span>
                    </td>
                    <td>‚Äî</td>
                    <td>${fileInfo.uploadDate}</td>
                    <td>
                        <button class="action-btn" onclick="event.stopPropagation(); showActionMenu(event, '${fileInfo.id}')" title="More actions">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            console.log(`‚úÖ Â∑≤ËºâÂÖ• ${storedFiles.length} ÂÄã ${docType} Êñá‰ª∂Âà∞Ë°®Ê†º`);
        }

        // ÊâìÈñãÊñáÊ™îË©≥Á¥∞Ë¶ñÂúñ
        function openDocumentDetail(documentId) {
            document.getElementById('document-list-view').style.display = 'none';
            document.getElementById('document-detail-view').style.display = 'block';
            
            // ÂÑ™ÂÖà‰ΩøÁî®LedgerBoxËôïÁêÜÂô®ÁöÑÊï∏Êìö
            if (window.ledgerBoxProcessor) {
                window.ledgerBoxProcessor.openDocumentDetail(documentId);
                return;
            }
            
            // ÂÖúÂ∫ïÔºöÂæûlocalStorageÁç≤ÂèñÊñá‰ª∂‰ø°ÊÅØ
            const fileInfo = getFileInfoById(documentId);
            
            if (fileInfo) {
                // Êõ¥Êñ∞ÊñáÊ™îÊ®ôÈ°åÁÇ∫ÂØ¶ÈöõÊñá‰ª∂Âêç
                document.getElementById('document-title').textContent = fileInfo.name;
                
                // Êõ¥Êñ∞PDFÈ†êË¶ΩÂçÄÂüü
                updatePDFPreview(fileInfo);
                
                console.log('üìÑ ÊâìÈñãÊñáÊ™îË©≥Á¥∞Ë¶ñÂúñ:', fileInfo.name, fileInfo.documentType);
            } else {
                // ÂÖúÂ∫ïÔºö‰ΩøÁî®ÊñáÊ™îID
                document.getElementById('document-title').textContent = documentId + '.pdf';
                console.warn('‚ö†Ô∏è Êâæ‰∏çÂà∞ÊñáÊ™î‰ø°ÊÅØ:', documentId);
            }
        }
        
        // Ê†πÊìöÊñáÊ™îIDÁç≤ÂèñÊñá‰ª∂‰ø°ÊÅØ
        function getFileInfoById(documentId) {
            // Ê™¢Êü•ÊâÄÊúâÊñáÊ™îÈ°ûÂûãÁöÑÂ≠òÂÑ≤
            const docTypes = ['bank-statement', 'invoice', 'receipt', 'general'];
            
            for (const docType of docTypes) {
                const storageKey = `vaultcaddy_files_${docType}`;
                const storedFiles = JSON.parse(localStorage.getItem(storageKey) || '[]');
                
                const fileInfo = storedFiles.find(file => file.id === documentId);
                if (fileInfo) {
                    return fileInfo;
                }
            }
            
            return null;
        }
        
        // Êõ¥Êñ∞PDFÈ†êË¶ΩÂçÄÂüü
        function updatePDFPreview(fileInfo) {
            const pdfPlaceholder = document.querySelector('.pdf-placeholder');
            if (pdfPlaceholder) {
                pdfPlaceholder.innerHTML = `
                    <i class="fas fa-file-pdf"></i>
                    <h3>PDF Preview</h3>
                    <p>Document: ${fileInfo.name}</p>
                    <p style="color: #6b7280; font-size: 0.875rem;">Type: ${fileInfo.documentType}</p>
                    <p style="color: #6b7280; font-size: 0.875rem;">Size: ${(fileInfo.size / 1024 / 1024).toFixed(2)} MB</p>
                    <small style="display: block; margin-top: 1rem; color: #9ca3af;">
                        ÂØ¶ÈöõÊñá‰ª∂È†êË¶ΩÂäüËÉΩÊ≠£Âú®ÈñãÁôº‰∏≠ÔºåÁõÆÂâçÈ°ØÁ§∫Êñá‰ª∂‰ø°ÊÅØ
                    </small>
                `;
            }
        }

        // ËøîÂõûÊñáÊ™îÂàóË°®
        function backToDocumentList() {
            document.getElementById('document-detail-view').style.display = 'none';
            document.getElementById('document-list-view').style.display = 'block';
            
            // Ê∏ÖÈô§Áï∂ÂâçÊñáÊ™î
            if (window.ledgerBoxProcessor) {
                window.ledgerBoxProcessor.currentDocument = null;
            }
        }

        // ÂÖ∂‰ªñÂäüËÉΩÂáΩÊï∏
        function showHelp() {
            alert('Document processing help will be shown here.');
        }

        function openUploadModal() {
            // Áµ±‰∏Ä‰ΩøÁî®LedgerBoxÈ¢®Ê†ºÁöÑ‰∏äÂÇ≥Ê®°ÊÖãÊ°Ü
            if (window.ledgerBoxProcessor) {
                window.ledgerBoxProcessor.openLedgerBoxModal();
            } else {
                console.error('‚ùå LedgerBoxËôïÁêÜÂô®Êú™ËºâÂÖ•');
                alert('Á≥ªÁµ±ÂàùÂßãÂåñ‰∏≠ÔºåË´ãÁ®çÂæåÂÜçË©¶');
            }
        }
        
        function closeUploadModal() {
            const modal = document.getElementById('upload-modal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                // Ê∏ÖÁêÜÊñá‰ª∂Ëº∏ÂÖ•
                const fileInput = document.getElementById('modal-file-input');
                if (fileInput) {
                    fileInput.value = '';
                }
                clearFilePreview();
            }
        }
        
        function clearFilePreview() {
            const preview = document.getElementById('file-preview-area');
            if (preview) {
                preview.innerHTML = '<p>ÊãñÊîæÊñá‰ª∂Âà∞ÈÄôË£°ÊàñÈªûÊìäÈÅ∏ÊìáÊñá‰ª∂</p>';
                preview.className = 'file-drop-area';
            }
        }
        
        function handleModalFileSelect() {
            const fileInput = document.getElementById('modal-file-input');
            if (fileInput) {
                fileInput.click();
            }
        }
        
        function handleFileInputChange(event) {
            const files = event.target.files;
            if (files && files.length > 0) {
                displayFilePreview(files);
            }
        }
        
        function displayFilePreview(files) {
            const preview = document.getElementById('file-preview-area');
            if (!preview) return;
            
            let html = '<div class="file-list"><h4>ÈÅ∏‰∏≠ÁöÑÊñá‰ª∂:</h4>';
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                html += `
                    <div class="file-item">
                        <i class="fas fa-file-pdf"></i>
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${fileSize} MB</div>
                        </div>
                        <button onclick="removeFile(${i})" class="remove-file-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            }
            html += '</div>';
            preview.innerHTML = html;
            preview.className = 'file-drop-area has-files';
        }
        
        async function processSelectedFiles() {
            console.log('üöÄ ÈñãÂßãËôïÁêÜÈÅ∏‰∏≠ÁöÑÊñá‰ª∂...');
            
            const fileInput = document.getElementById('modal-file-input');
            if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
                console.error('‚ùå Ê≤íÊúâÈÅ∏‰∏≠ÁöÑÊñá‰ª∂');
                alert('Ë´ãÂÖàÈÅ∏ÊìáË¶Å‰∏äÂÇ≥ÁöÑÊñá‰ª∂');
                return;
            }
            
            console.log(`üìÅ ÊâæÂà∞ ${fileInput.files.length} ÂÄãÊñá‰ª∂:`, Array.from(fileInput.files).map(f => f.name));
            
            // ËΩâÊèõÁÇ∫Êï∏ÁµÑ‰∏¶Ë®òÈåÑË©≥Á¥∞‰ø°ÊÅØ
            const files = Array.from(fileInput.files);
            console.log('üìÑ Êñá‰ª∂Ë©≥ÊÉÖ:', files.map(f => ({
                name: f.name,
                size: f.size,
                type: f.type,
                lastModified: f.lastModified
            })));
            
            // Áç≤ÂèñÁï∂ÂâçÊñáÊ™îÈ°ûÂûã
            const hash = window.location.hash.substring(1);
            const currentDocType = hash || 'bank-statement';
            
            closeUploadModal();
            showProcessingStatus(files);
            
            try {
                // ‰ΩøÁî®Áµ±‰∏ÄËôïÁêÜÂô®ËôïÁêÜÊñá‰ª∂
                if (window.UnifiedDocumentProcessor) {
                    console.log('üéØ ‰ΩøÁî®Áµ±‰∏ÄËôïÁêÜÂô®ËôïÁêÜÊñá‰ª∂...');
                    
                    const processingResults = await window.UnifiedDocumentProcessor.processUploadedFiles(files, currentDocType);
                    
                    console.log('‚úÖ Áµ±‰∏ÄËôïÁêÜÂô®ËôïÁêÜÂÆåÊàê:', processingResults);
                    
                    // Ê™¢Êü•ÊòØÂê¶ÊúâËôïÁêÜÂ§±ÊïóÁöÑÊñá‰ª∂
                    const failedFiles = processingResults.filter(r => r.status === 'error');
                    if (failedFiles.length > 0) {
                        console.error('‚ùå ÈÉ®ÂàÜÊñá‰ª∂ËôïÁêÜÂ§±Êïó:', failedFiles);
                        alert(`${failedFiles.length} ÂÄãÊñá‰ª∂ËôïÁêÜÂ§±ÊïóÔºö${failedFiles.map(f => f.error).join(', ')}`);
                    }
                    
                    // Âè™Ê∑ªÂä†ÊàêÂäüËôïÁêÜÁöÑÊñá‰ª∂Âà∞Ë°®Ê†º
                    const successfulFiles = files.filter((_, index) => 
                        processingResults[index] && processingResults[index].status === 'success'
                    );
                    
                    if (successfulFiles.length > 0) {
                        addProcessedFilesToTable(successfulFiles);
                        
                        // ‰øùÂ≠òËôïÁêÜÁµêÊûúÂà∞Áµ±‰∏ÄÂ≠òÂÑ≤
                        saveUnifiedProcessingResults(processingResults, currentDocType);
                        
                        showSuccessNotification(successfulFiles.length);
                    }
                } else {
                    // ÂÖúÂ∫ïÔºö‰ΩøÁî®ÂéüÊúâÁöÑÊ®°Êì¨ËôïÁêÜ
                    console.log('‚ö†Ô∏è Áµ±‰∏ÄËôïÁêÜÂô®Êú™ËºâÂÖ•Ôºå‰ΩøÁî®Ê®°Êì¨ËôïÁêÜ');
                    setTimeout(() => {
                        addProcessedFilesToTable(files);
                        showSuccessNotification(files.length);
                        hideProcessingStatus();
                    }, 2000);
                    return;
                }
                
                // Êõ¥Êñ∞Áµ±Ë®à
                updateDocumentStats();
                
            } catch (error) {
                console.error('‚ùå ËôïÁêÜÊñá‰ª∂ÊôÇÂá∫ÈåØ:', error);
                alert(`ËôïÁêÜÊñá‰ª∂ÊôÇÂá∫ÁèæÈåØË™§Ôºö${error.message}`);
            } finally {
                hideProcessingStatus();
            }
        }
        
        // ‰øùÂ≠òËôïÁêÜÁµêÊûúÂà∞localStorageÔºàËàäÁâàÊú¨Ôºå‰øùÁïôÂÖºÂÆπÊÄßÔºâ
        function saveProcessingResults(results, documentType) {
            const storageKey = `vaultcaddy_processing_results_${documentType}`;
            const existingResults = JSON.parse(localStorage.getItem(storageKey) || '[]');
            
            // Ê∑ªÂä†Êñ∞ÁöÑËôïÁêÜÁµêÊûú
            results.forEach(result => {
                if (result.status === 'success') {
                    existingResults.push(result);
                }
            });
            
            localStorage.setItem(storageKey, JSON.stringify(existingResults));
            console.log(`üíæ Â∑≤‰øùÂ≠ò ${results.length} ÂÄãËôïÁêÜÁµêÊûúÂà∞ ${storageKey}`);
        }
        
        // ‰øùÂ≠òÁµ±‰∏ÄËôïÁêÜÂô®ÁµêÊûú
        function saveUnifiedProcessingResults(results, documentType) {
            console.log(`üíæ Áµ±‰∏ÄËôïÁêÜÂô®ÁµêÊûúÂ∑≤Ëá™Âãï‰øùÂ≠òÂà∞Áµ±‰∏ÄÂ≠òÂÑ≤Á≥ªÁµ±`);
            
            // Áµ±‰∏ÄËôïÁêÜÂô®ÊúÉËá™Âãï‰øùÂ≠òÔºåÈÄôË£°Âè™ÈúÄË¶ÅËß∏ÁôºUIÊõ¥Êñ∞
            results.forEach(result => {
                if (result.status === 'success') {
                    // Ëß∏ÁôºUIÊõ¥Êñ∞‰∫ã‰ª∂
                    window.dispatchEvent(new CustomEvent('vaultcaddy:document:added', {
                        detail: { 
                            documentType: documentType,
                            fileName: result.fileName,
                            data: result.data
                        }
                    }));
                }
            });
        }
        
        function showSuccessNotification(fileCount) {
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #10b981; color: white; padding: 1rem; border-radius: 8px; z-index: 1000; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
                    <i class="fas fa-check-circle"></i> ÊàêÂäüËôïÁêÜ ${fileCount} ÂÄãÊñá‰ª∂ÔºÅ
                </div>
            `;
            document.body.appendChild(notification);
            
            // 3ÁßíÂæåËá™ÂãïÁßªÈô§ÈÄöÁü•
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        function showProcessingStatus(files) {
            // ÂèØ‰ª•È°ØÁ§∫‰∏ÄÂÄãËôïÁêÜ‰∏≠ÁöÑÈÄöÁü•
            const notification = document.createElement('div');
            notification.id = 'processing-notification';
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #3b82f6; color: white; padding: 1rem; border-radius: 8px; z-index: 1000;">
                    <i class="fas fa-spinner fa-spin"></i> Ê≠£Âú®ËôïÁêÜ ${files.length} ÂÄãÊñá‰ª∂...
                </div>
            `;
            document.body.appendChild(notification);
        }
        
        function hideProcessingStatus() {
            const notification = document.getElementById('processing-notification');
            if (notification) {
                notification.remove();
            }
        }
        
        function addProcessedFilesToTable(files) {
            console.log('üìã Ê∑ªÂä†Êñá‰ª∂Âà∞Ë°®Ê†ºÔºåÊñá‰ª∂Êï∏Èáè:', files.length);
            
            const tbody = document.getElementById('documents-tbody');
            if (!tbody) {
                console.error('‚ùå Êâæ‰∏çÂà∞Ë°®Ê†º tbody ÂÖÉÁ¥†');
                return;
            }
            
            // Áç≤ÂèñÁï∂ÂâçÊñáÊ™îÈ°ûÂûã
            const hash = window.location.hash.substring(1);
            const currentDocType = hash || 'bank-statement';
            
            console.log('üìä Áï∂ÂâçË°®Ê†ºÁãÄÊÖã:', {
                childrenCount: tbody.children.length,
                innerHTML: tbody.innerHTML.substring(0, 100) + '...',
                documentType: currentDocType
            });
            
            // Â¶ÇÊûúË°®Ê†ºÊòØÁ©∫ÁöÑÔºåÂÖàÊ∏ÖÈô§‰Ωî‰ΩçÁ¨¶
            if (tbody.children.length === 0 || tbody.innerHTML.includes('Áî®Êà∂ÊñáÊ™îÂ∞áÂãïÊÖãËºâÂÖ•Âà∞ÈÄôË£°')) {
                console.log('üßπ Ê∏ÖÈô§Ë°®Ê†º‰Ωî‰ΩçÁ¨¶');
                tbody.innerHTML = '';
            }
            
            // ÂæûlocalStorageÁç≤ÂèñÁï∂ÂâçÊñáÊ™îÈ°ûÂûãÁöÑÊñá‰ª∂ÂàóË°®
            const storageKey = `vaultcaddy_files_${currentDocType}`;
            let existingFiles = JSON.parse(localStorage.getItem(storageKey) || '[]');
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileId = `${currentDocType}_${Date.now()}_${i}`;
                const currentDate = new Date().toLocaleDateString('zh-TW');
                
                console.log(`üìÑ ËôïÁêÜÊñá‰ª∂ ${i + 1}/${files.length}:`, {
                    name: file.name,
                    size: file.size,
                    fileId: fileId,
                    documentType: currentDocType
                });
                
                // ‰øùÂ≠òÊñá‰ª∂‰ø°ÊÅØÂà∞localStorageÔºàÊåâÊñáÊ™îÈ°ûÂûãÂàÜÈõ¢Ôºâ
                const fileInfo = {
                    id: fileId,
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    documentType: currentDocType,
                    uploadDate: currentDate,
                    status: 'processing'
                };
                existingFiles.push(fileInfo);
                
                const row = document.createElement('tr');
                row.className = 'document-row';
                row.onclick = () => openDocumentDetail(fileId);
                
                row.innerHTML = `
                    <td>
                        <input type="checkbox" onclick="event.stopPropagation()">
                    </td>
                    <td>
                        <div class="document-cell">
                            <i class="fas fa-file-pdf file-icon"></i>
                            <div class="document-info">
                                <div class="doc-name">${file.name}</div>
                                <div class="doc-details">
                                    <i class="fas fa-user"></i> Êñ∞‰∏äÂÇ≥ÊñáÊ™î (${currentDocType})<br>
                                    <i class="fas fa-file"></i> ${(file.size / 1024 / 1024).toFixed(2)} MB
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="period-info">
                            <i class="fas fa-clock"></i> ËôïÁêÜ‰∏≠...
                            <br><small>ÂàÜÊûêÊñáÊ™îÂÖßÂÆπ‰∏≠</small>
                        </div>
                    </td>
                    <td>
                        <div class="reconciliation">
                            <div class="reconciliation-text">-/-</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <div class="progress-percentage">0%</div>
                            <small class="reconciliation-status">
                                <i class="fas fa-clock"></i> <span data-translate="processing">ËôïÁêÜ‰∏≠</span>
                            </small>
                        </div>
                    </td>
                    <td>
                        <div class="balance-info">
                            <div>ËôïÁêÜ‰∏≠...</div>
                        </div>
                    </td>
                    <td>
                        <span class="status-badge processing">
                            <i class="fas fa-clock"></i> Processing
                        </span>
                    </td>
                    <td>
                        <span class="review-badge pending">
                            <i class="fas fa-clock"></i> Pending
                        </span>
                    </td>
                    <td>‚Äî</td>
                    <td>${currentDate}</td>
                    <td>
                        <button class="action-btn" onclick="event.stopPropagation(); showActionMenu(event, '${fileId}')" title="More actions">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
                console.log(`‚úÖ Êñá‰ª∂ ${file.name} Â∑≤Ê∑ªÂä†Âà∞Ë°®Ê†º (${currentDocType})`);
            }
            
            // ‰øùÂ≠òÊõ¥Êñ∞ÂæåÁöÑÊñá‰ª∂ÂàóË°®Âà∞localStorage
            localStorage.setItem(storageKey, JSON.stringify(existingFiles));
            
            console.log(`üéâ ÊâÄÊúâ ${files.length} ÂÄãÊñá‰ª∂Â∑≤ÊàêÂäüÊ∑ªÂä†Âà∞Ë°®Ê†º (${currentDocType})`);
            console.log('üìä Ë°®Ê†ºÊúÄÁµÇÁãÄÊÖã:', {
                totalRows: tbody.children.length,
                tableHTML: tbody.innerHTML.length + ' characters',
                storageKey: storageKey,
                totalStoredFiles: existingFiles.length
            });
            
            // Êõ¥Êñ∞Áµ±Ë®à
            updateDocumentStats();
        }
        
        function updateDocumentStats() {
            // Êõ¥Êñ∞ÊñáÊ™îËôïÁêÜÁµ±Ë®à
            const processedCount = document.querySelectorAll('#documents-tbody tr').length;
            const statsElement = document.querySelector('[data-stat="processed-docs"]');
            if (statsElement) {
                statsElement.textContent = processedCount;
            }
            
            // Êõ¥Êñ∞ÂÅ¥ÈÇäÊ¨ÑÁµ±Ë®à
            console.log(`üìä Êõ¥Êñ∞ÊñáÊ™îÁµ±Ë®à: ${processedCount} ÂÄãÂ∑≤ËôïÁêÜÊñáÊ™î`);
        }
        
        function updateSidebarStats(newFileCount) {
            // Êõ¥Êñ∞ÂÅ¥ÈÇäÊ¨ÑÁöÑËôïÁêÜÊñáÊ™îÊï∏Èáè
            const processedElement = document.querySelector('.stat-value');
            if (processedElement && processedElement.textContent.includes('Processed Documents')) {
                const currentCount = parseInt(processedElement.textContent) || 0;
                processedElement.textContent = currentCount + newFileCount;
                console.log(`üìä ÂÅ¥ÈÇäÊ¨ÑÁµ±Ë®àÂ∑≤Êõ¥Êñ∞: +${newFileCount} ÂÄãÊñáÊ™î`);
            }
        }
        
        function showLoginPromptInDashboard() {
            console.log('üí° Âú® Dashboard ‰∏≠È°ØÁ§∫ÁôªÂÖ•ÊèêÁ§∫ËÄå‰∏çÊòØÈáçÂÆöÂêë');
            
            // Ê™¢Êü•ÊòØÂê¶Â∑≤Á∂ìÂ≠òÂú®ÊèêÁ§∫
            const existing = document.getElementById('dashboard-login-prompt');
            if (existing) return;
            
            // Âú®È†ÅÈù¢È†ÇÈÉ®È°ØÁ§∫‰∏ÄÂÄãÊ∫´ÂíåÁöÑÁôªÂÖ•ÊèêÁ§∫
            const notification = document.createElement('div');
            notification.id = 'dashboard-login-prompt';
            notification.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; background: #fef3c7; border-bottom: 1px solid #f59e0b; padding: 0.75rem; z-index: 1000; text-align: center;">
                    <p style="margin: 0; color: #92400e;">
                        <i class="fas fa-info-circle"></i> 
                        ÁÇ∫‰∫ÜÁç≤ÂæóÂÆåÊï¥ÂäüËÉΩÔºåË´ã <a href="auth.html" style="color: #b45309; text-decoration: underline;">ÈáçÊñ∞ÁôªÂÖ•</a> Êàñ 
                        <button onclick="window.location.reload()" style="background: #f59e0b; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; margin-left: 0.5rem;">ÈáçÊñ∞ËºâÂÖ•È†ÅÈù¢</button>
                        <button onclick="document.getElementById('dashboard-login-prompt').remove(); adjustPageMargin(false);" style="background: transparent; border: none; color: #92400e; margin-left: 1rem;">‚úï</button>
                    </p>
                </div>
            `;
            document.body.insertBefore(notification, document.body.firstChild);
            
            // Ë™øÊï¥È†ÅÈù¢ÂÖßÂÆπÂêë‰∏ãÂÅèÁßª
            adjustPageMargin(true);
        }
        
        function hideLoginPromptInDashboard() {
            const existing = document.getElementById('dashboard-login-prompt');
            if (existing) {
                existing.remove();
                adjustPageMargin(false);
                console.log('‚úÖ Dashboard ÁôªÂÖ•ÊèêÁ§∫Â∑≤ÁßªÈô§');
            }
        }
        
        function adjustPageMargin(hasPrompt) {
            const mainContent = document.querySelector('.dashboard-container');
            if (mainContent) {
                mainContent.style.marginTop = hasPrompt ? '60px' : '0px';
            }
        }
        
        // Êõ¥Êñ∞ Dashboard Ë∫´‰ªΩÈ©óË≠âÁãÄÊÖã
        function updateDashboardAuthState(authState) {
            console.log('üîÑ Êõ¥Êñ∞ Dashboard Ë∫´‰ªΩÈ©óË≠âÁãÄÊÖã:', authState);
            
            if (authState.isAuthenticated) {
                // Áî®Êà∂Â∑≤ÁôªÂÖ•ÔºåÁßªÈô§ÁôªÂÖ•ÊèêÁ§∫
                hideLoginPromptInDashboard();
                
                // Êõ¥Êñ∞Áî®Êà∂‰ø°ÊÅØÈ°ØÁ§∫
                updateUserInfoDisplay(authState);
                
                console.log('‚úÖ Dashboard Ë™çË≠âÁãÄÊÖã: Â∑≤ÁôªÂÖ•');
            } else {
                // Áî®Êà∂Êú™ÁôªÂÖ•ÔºåÈ°ØÁ§∫ÁôªÂÖ•ÊèêÁ§∫
                showLoginPromptInDashboard();
                console.log('‚ö†Ô∏è Dashboard Ë™çË≠âÁãÄÊÖã: Êú™ÁôªÂÖ•');
            }
        }
        
        function updateUserInfoDisplay(authState) {
            // Êõ¥Êñ∞È†ÅÈù¢‰∏≠ÁöÑÁî®Êà∂‰ø°ÊÅØÔºàÂ¶ÇÊûúÈúÄË¶ÅÔºâ
            if (authState.userEmail || authState.credits) {
                console.log('üìä Êõ¥Êñ∞Áî®Êà∂‰ø°ÊÅØÈ°ØÁ§∫:', {
                    email: authState.userEmail,
                    credits: authState.credits
                });
                
                // Ëß∏ÁôºÂ∞éËà™Ê¨ÑÊõ¥Êñ∞
                if (window.VaultCaddyNavbar && window.VaultCaddyNavbar.loadUserState) {
                    window.VaultCaddyNavbar.loadUserState();
                }
            }
        }

        function toggleView() {
            alert('View toggle functionality will be implemented.');
        }

        function showActionMenu(event, documentId) {
            alert(`Action menu for ${documentId} will be shown here.`);
        }

        // Âà™Èô§‰∫§ÊòìË°å
        function deleteTransaction(button) {
            if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÁ≠Ü‰∫§ÊòìÂóéÔºü')) {
                const row = button.closest('tr');
                row.remove();
                
                // ÈáçÊñ∞Ë®àÁÆóÈ§òÈ°ç
                recalculateBalances();
            }
        }
        
        // ÈáçÊñ∞Ë®àÁÆóÊâÄÊúâÈ§òÈ°ç
        function recalculateBalances() {
            const rows = document.querySelectorAll('#transactions-tbody tr');
            let runningBalance = 0;
            
            rows.forEach((row, index) => {
                const amountInput = row.querySelector('.amount-input');
                const balanceInput = row.querySelector('.balance-input');
                
                if (amountInput && balanceInput) {
                    const amount = parseFloat(amountInput.value) || 0;
                    runningBalance += amount;
                    balanceInput.value = runningBalance.toFixed(2);
                }
            });
        }
        
        // Áõ£ËÅΩÈáëÈ°çËÆäÂåñ‰∏¶Ëá™ÂãïÈáçÊñ∞Ë®àÁÆóÈ§òÈ°ç
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('amount-input')) {
                recalculateBalances();
            }
        });
        
        // Ê®ôÁ±§ÂàáÊèõ
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('tab-btn')) {
                // ÁßªÈô§ÊâÄÊúâÊ¥ªË∫çÁãÄÊÖã
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                // Ê∑ªÂä†Ê¥ªË∫çÁãÄÊÖãÂà∞ÈªûÊìäÁöÑÊ®ôÁ±§
                e.target.classList.add('active');
            }
        });
    </script>

    <!-- ÂéüÂßã‰∏äÂÇ≥Ê®°ÊÖãÊ°ÜÂ∑≤ÁßªÈô§ÔºåÁµ±‰∏Ä‰ΩøÁî®LedgerBoxÈ¢®Ê†ºÊ®°ÊÖãÊ°Ü -->

    <style>
        /* ‰∏äÂÇ≥Ê®°ÊÖãÊ°ÜÊ®£Âºè */
        .upload-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .modal-content {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            z-index: 1001;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #1f2937;
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .modal-close-btn {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .modal-close-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .file-drop-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 1.5rem;
            background: #f9fafb;
        }
        
        .file-drop-area:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        .file-drop-area.has-files {
            border-style: solid;
            border-color: #10b981;
            background: #f0fdf4;
        }
        
        .file-list h4 {
            margin: 0 0 1rem 0;
            color: #1f2937;
            text-align: left;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-bottom: 0.5rem;
        }
        
        .file-item i {
            color: #ef4444;
            font-size: 1.25rem;
            margin-right: 0.75rem;
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-name {
            font-weight: 500;
            color: #1f2937;
        }
        
        .file-size {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .remove-file-btn {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .remove-file-btn:hover {
            background: #fef2f2;
            color: #ef4444;
        }
        
        .upload-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        .file-types ul {
            margin: 0.5rem 0 0 0;
            padding-left: 1.5rem;
            color: #6b7280;
        }
        
        .processing-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .processing-options label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #374151;
            cursor: pointer;
        }
        
        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: #ffffff;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        /* ÁãÄÊÖãÂæΩÁ´†Ê®£Âºè */
        .status-badge.processing {
            background: #fef3c7;
            color: #92400e;
        }
        
        .review-badge.pending {
            background: #fee2e2;
            color: #991b1b;
        }
        
        @media (max-width: 768px) {
            .upload-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
