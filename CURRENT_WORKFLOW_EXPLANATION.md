# ğŸ”„ å½“å‰é“¶è¡Œå¯¹è´¦å•è½¬æ¢å·¥ä½œæµç¨‹è¯¦è§£

> **æœ€åæ›´æ–°ï¼š** 2026-02-03  
> **å½“å‰çŠ¶æ€ï¼š** ä½¿ç”¨åƒé—®AIï¼ˆQwen-VL-Maxï¼‰ + å‰ç«¯åå¤„ç†  
> **æ ¸å¿ƒæ–‡ä»¶ï¼š** `qwen-vl-max-processor.js`, `firstproject.html`

---

## ğŸ“Š å®Œæ•´å·¥ä½œæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    1. ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶                               â”‚
â”‚                 (firstproject.html)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ PDF æˆ– å›¾ç‰‡æ–‡ä»¶
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 2. æ–‡ä»¶ç±»å‹åˆ¤æ–­                                  â”‚
â”‚                                                                  â”‚
â”‚  if (PDF) {                                                      â”‚
â”‚      è½¬æ¢ä¸ºå›¾ç‰‡ (pdf-to-image-converter.js)                     â”‚
â”‚      â†’ ä½¿ç”¨ pdf.js åº“ï¼Œ300 DPI                                  â”‚
â”‚  }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ å›¾ç‰‡æ–‡ä»¶æ•°ç»„ (1å¼ æˆ–å¤šå¼ )
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              3. ä¸Šä¼ åˆ° Firebase Storage                          â”‚
â”‚                                                                  â”‚
â”‚  â€¢ å­˜å‚¨è·¯å¾„: projects/{projectId}/documents/{docId}/            â”‚
â”‚  â€¢ è·å–å…¬å¼€URL (ç”¨äºAIè®¿é—®)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ å›¾ç‰‡URLæ•°ç»„
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           4. æ‰£é™¤ Credits (credits-manager.js)                   â”‚
â”‚                                                                  â”‚
â”‚  â€¢ æ¯é¡µæ‰£é™¤ 1 Credit                                             â”‚
â”‚  â€¢ å¦‚æœä½™é¢ä¸è¶³ â†’ åœæ­¢å¤„ç†ï¼Œæç¤ºå……å€¼                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Credits å·²æ‰£é™¤
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    5. è°ƒç”¨ Qwen-VL Max AI (qwen-vl-max-processor.js)            â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  5.1 æ–‡ä»¶è½¬Base64                                         â”‚  â”‚
â”‚  â”‚      â€¢ è¯»å–æ–‡ä»¶å†…å®¹                                       â”‚  â”‚
â”‚  â”‚      â€¢ è½¬æ¢ä¸ºBase64ç¼–ç                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  5.2 ç”Ÿæˆ Prompt (generatePrompt)                        â”‚  â”‚
â”‚  â”‚      â€¢ æ ¹æ®æ–‡æ¡£ç±»å‹ç”Ÿæˆæç¤ºè¯                             â”‚  â”‚
â”‚  â”‚      â€¢ é“¶è¡Œå¯¹è´¦å•: è¯¦ç»†çš„å­—æ®µæå–è§„åˆ™                     â”‚  â”‚
â”‚  â”‚      â€¢ å‘ç¥¨: å‘ç¥¨å­—æ®µæå–è§„åˆ™                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  5.3 æ„å»º API è¯·æ±‚                                        â”‚  â”‚
â”‚  â”‚      {                                                    â”‚  â”‚
â”‚  â”‚        model: "qwen3-vl-plus-2025-12-19",               â”‚  â”‚
â”‚  â”‚        messages: [                                       â”‚  â”‚
â”‚  â”‚          {                                               â”‚  â”‚
â”‚  â”‚            role: "user",                                 â”‚  â”‚
â”‚  â”‚            content: [                                    â”‚  â”‚
â”‚  â”‚              {type: "image_url", image_url: {...}},    â”‚  â”‚
â”‚  â”‚              {type: "text", text: prompt}              â”‚  â”‚
â”‚  â”‚            ]                                             â”‚  â”‚
â”‚  â”‚          }                                               â”‚  â”‚
â”‚  â”‚        ],                                                â”‚  â”‚
â”‚  â”‚        temperature: 0.1,                                 â”‚  â”‚
â”‚  â”‚        max_tokens: 4000                                  â”‚  â”‚
â”‚  â”‚      }                                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  5.4 é€šè¿‡ Cloudflare Worker è½¬å‘                         â”‚  â”‚
â”‚  â”‚      â€¢ URL: deepseek-proxy.vaultcaddy.workers.dev       â”‚  â”‚
â”‚  â”‚      â€¢ éšè—çœŸå® API Key                                  â”‚  â”‚
â”‚  â”‚      â€¢ POST è¯·æ±‚åˆ°åƒé—®API                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                        â”‚
â”‚                         â”‚ ç­‰å¾… 8-15 ç§’                           â”‚
â”‚                         â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  5.5 æ¥æ”¶ AI å“åº”                                         â”‚  â”‚
â”‚  â”‚      â€¢ è¿”å› JSON æ ¼å¼çš„æå–æ•°æ®                          â”‚  â”‚
â”‚  â”‚      â€¢ åŒ…å«ä½¿ç”¨é‡ç»Ÿè®¡ (tokens, cost)                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ AI åŸå§‹å“åº” (JSONå­—ç¬¦ä¸²)
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              6. è§£æå“åº” (parseJSON)                             â”‚
â”‚                                                                  â”‚
â”‚  â€¢ æ¸…ç† markdown ä»£ç å—æ ‡è®° (```json)                            â”‚
â”‚  â€¢ å°è¯• JSON.parse()                                             â”‚
â”‚  â€¢ å¦‚æœå¤±è´¥ï¼Œä½¿ç”¨æ­£åˆ™æå– JSON å¯¹è±¡                               â”‚
â”‚  â€¢ éªŒè¯å¿…éœ€å­—æ®µæ˜¯å¦å­˜åœ¨                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ æå–çš„ç»“æ„åŒ–æ•°æ® (JavaScript å¯¹è±¡)
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      7. å‰ç«¯åå¤„ç† (postProcessTransactions) â­ å…³é”®æ­¥éª¤       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å¤„ç†æ’ç”Ÿé“¶è¡ŒåŒæ—¥å¤šç¬”äº¤æ˜“é—®é¢˜                             â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  ä¼ªä»£ç ï¼š                                                  â”‚  â”‚
â”‚  â”‚  lastValidDate = null                                     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  for each transaction in transactions:                   â”‚  â”‚
â”‚  â”‚      if (transaction.date ä¸ºç©ºæˆ–ç©ºç™½):                    â”‚  â”‚
â”‚  â”‚          if (lastValidDate å­˜åœ¨):                         â”‚  â”‚
â”‚  â”‚              transaction.date = lastValidDate  // å¡«å……    â”‚  â”‚
â”‚  â”‚          else:                                            â”‚  â”‚
â”‚  â”‚              å°è¯•ä» statementPeriod æå–æ—¥æœŸ             â”‚  â”‚
â”‚  â”‚      else:                                                â”‚  â”‚
â”‚  â”‚          lastValidDate = transaction.date  // æ›´æ–°       â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  ç¤ºä¾‹ï¼š                                                          â”‚
â”‚  è¾“å…¥ï¼ˆAIæå–çš„åŸå§‹æ•°æ®ï¼‰ï¼š                                      â”‚
â”‚    [                                                             â”‚
â”‚      {date: "10 Mar", description: "ATM", debit: 500},          â”‚
â”‚      {date: "",       description: "TRANSFER", debit: 200}, â†ç©º â”‚
â”‚      {date: "",       description: "POS", debit: 150}       â†ç©º â”‚
â”‚    ]                                                             â”‚
â”‚                                                                  â”‚
â”‚  è¾“å‡ºï¼ˆåå¤„ç†åï¼‰ï¼š                                              â”‚
â”‚    [                                                             â”‚
â”‚      {date: "10 Mar", description: "ATM", debit: 500},          â”‚
â”‚      {date: "10 Mar", description: "TRANSFER", debit: 200}, â†å¡«å……â”‚
â”‚      {date: "10 Mar", description: "POS", debit: 150}       â†å¡«å……â”‚
â”‚    ]                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ å¤„ç†åçš„å®Œæ•´æ•°æ®
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         8. ä¿å­˜åˆ° Firestore (simple-data-manager.js)             â”‚
â”‚                                                                  â”‚
â”‚  ä¿å­˜è·¯å¾„: projects/{projectId}/documents/{docId}                â”‚
â”‚  ä¿å­˜å†…å®¹:                                                       â”‚
â”‚    {                                                             â”‚
â”‚      name: "æ–‡æ¡£åç§°",                                           â”‚
â”‚      status: "completed",                                        â”‚
â”‚      processedData: {å¤„ç†åçš„æ•°æ®},                              â”‚
â”‚      rawText: {AIåŸå§‹å“åº”},                                      â”‚
â”‚      processingTime: 12345,  // æ¯«ç§’                             â”‚
â”‚      processor: "qwen-vl-max",                                   â”‚
â”‚      model: "qwen3-vl-plus-2025-12-19",                         â”‚
â”‚      usage: {tokens, cost},                                      â”‚
â”‚      createdAt: Timestamp                                        â”‚
â”‚    }                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ æ•°æ®å·²ä¿å­˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              9. åˆ·æ–° UI (loadDocuments)                          â”‚
â”‚                                                                  â”‚
â”‚  â€¢ ä» Firestore è¯»å–æœ€æ–°æ–‡æ¡£åˆ—è¡¨                                 â”‚
â”‚  â€¢ æ¸²æŸ“è¡¨æ ¼ï¼Œæ˜¾ç¤ºæ‰€æœ‰äº¤æ˜“è®°å½•                                    â”‚
â”‚  â€¢ è®¡ç®—æ±‡æ€»æ•°æ®ï¼ˆæ€»æ”¶å…¥ã€æ€»æ”¯å‡ºã€ä½™é¢ï¼‰                          â”‚
â”‚  â€¢ æ›´æ–°é¡µé¢ä¸Šçš„ç»Ÿè®¡ä¿¡æ¯                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” æ ¸å¿ƒæ­¥éª¤è¯¦è§£

### æ­¥éª¤ 5.2ï¼šPrompt ç”Ÿæˆï¼ˆgeneratePromptï¼‰

**é“¶è¡Œå¯¹è´¦å•çš„ Prompt ç»“æ„ï¼š**

```
STRICT MODE: You are a OCR COPY MACHINE. ONLY copy visible text. ZERO calculation. ZERO inference.

ğŸ“ TARGET TABLE IDENTIFICATION (CRITICAL):
- FIND table with header containing BOTH: "æˆ¶å£é€²æ”¯" AND "é¤˜é¡"
- IGNORE any section with "æˆ¶å£æ‘˜è¦" / "Account Summary" / "ç¸½è¨ˆ" / "TOTAL"
- FIRST row of target table MUST be "æ‰¿ä¸Šçµé¤˜" (Brought Forward)
- LAST row's "é¤˜é¡" = closingBalance

âœ‚ï¸ FIELD EXTRACTION RULES (NON-NEGOTIABLE):
For EACH ROW in the identified table:
â€¢ "date": copy RAW text from Date column. 
          If empty / blank / whitespace-only â†’ output "" (empty string). 
          NEVER fill or infer.
â€¢ "description": copy ALL visible text from description column
â€¢ "credit": copy number from Credit/è²¸é … column. If empty â†’ 0
â€¢ "debit": copy number from Debit/å€Ÿé … column. If empty â†’ 0
â€¢ "balance": copy number from Balance/é¤˜é¡ column. If blank â†’ null

â— ABSOLUTE COMMANDS:
- IF number unclear â†’ output null (NEVER guess/calculate)
- REMOVE all commas from numbers before outputting
- Date format: keep original string (e.g., "10 Mar", "2025-02-22")
- Output ONLY valid JSON. NO explanations. NO markdown.

ğŸ“¤ OUTPUT STRUCTURE (exact keys, no variation):
{
  "bankName": "...",
  "accountNumber": "...",
  "accountHolder": "...",
  "currency": "...",
  "statementPeriod": "...",
  "openingBalance": 30718.39,
  "closingBalance": 30018.39,
  "transactions": [
    {
      "date": "10 Mar",
      "description": "ATM WITHDRAWAL",
      "credit": 0,
      "debit": 500.00,
      "balance": null
    },
    {
      "date": "",  // â† ç©ºç™½æ—¥æœŸï¼ˆåŒæ—¥å¤šç¬”äº¤æ˜“ï¼‰â€” å‰ç«¯ä¼šå¡«å……
      "description": "ONLINE TRANSFER",
      "credit": 0,
      "debit": 200.00,
      "balance": null
    }
  ]
}
```

**å…³é”®è®¾è®¡ç†å¿µï¼š**

1. âœ… **"OCR COPY MACHINE"** - AIåªè´Ÿè´£å¤åˆ¶å¯è§æ–‡æœ¬
2. âœ… **"ZERO calculation"** - ä¸è®¡ç®—ä»»ä½•æ•°å€¼
3. âœ… **"If empty â†’ output ''"** - ç©ºç™½æ—¥æœŸè¾“å‡ºç©ºå­—ç¬¦ä¸²ï¼ˆä¸æ˜¯nullï¼‰
4. âœ… **ç¤ºä¾‹åŒ…å«ç©ºç™½æ—¥æœŸ** - æ•™AIå¦‚ä½•å¤„ç†åŒæ—¥å¤šç¬”

---

### æ­¥éª¤ 7ï¼šå‰ç«¯åå¤„ç†ï¼ˆpostProcessTransactionsï¼‰

**å®Œæ•´ä»£ç å®ç°ï¼š**

```javascript
postProcessTransactions(extractedData) {
    // å¦‚æœæ²¡æœ‰ transactions æ•°ç»„ï¼Œç›´æ¥è¿”å›
    if (!extractedData || !extractedData.transactions || 
        !Array.isArray(extractedData.transactions)) {
        return extractedData;
    }
    
    let lastValidDate = null;
    
    // éå†æ‰€æœ‰äº¤æ˜“ï¼Œå¡«å……ç©ºç™½æ—¥æœŸ
    extractedData.transactions = extractedData.transactions.map((tx, index) => {
        // å¦‚æœå½“å‰äº¤æ˜“çš„æ—¥æœŸä¸ºç©º/null/undefined/çº¯ç©ºæ ¼
        if (!tx.date || (typeof tx.date === 'string' && tx.date.trim() === '')) {
            if (lastValidDate) {
                // âœ… ä½¿ç”¨ä¸Šä¸€ç¬”äº¤æ˜“çš„æ—¥æœŸ
                tx.date = lastValidDate;
            } else {
                // å¦‚æœæ˜¯ç¬¬ä¸€ç¬”å°±ä¸ºç©ºï¼ˆç½•è§ï¼‰ï¼Œå°è¯•ä½¿ç”¨ statement çš„å¼€å§‹æ—¥æœŸ
                if (extractedData.statementPeriod) {
                    // å°è¯•ä» "22 Feb to 22 Mar" ä¸­æå–å¼€å§‹æ—¥æœŸ
                    const periodMatch = extractedData.statementPeriod.match(/^([^to]+)/);
                    if (periodMatch) {
                        tx.date = periodMatch[1].trim();
                    } else {
                        tx.date = 'Unknown';
                    }
                } else {
                    tx.date = 'Unknown';
                }
            }
        } else {
            // âœ… æ›´æ–°æœ€åæœ‰æ•ˆæ—¥æœŸ
            lastValidDate = tx.date;
        }
        
        return tx;
    });
    
    return extractedData;
}
```

**å·¥ä½œåŸç†ï¼š**

1. **ç¬¬ä¸€ç¬”äº¤æ˜“ï¼ˆ10 Marï¼‰**
   - æ—¥æœŸï¼š`"10 Mar"`ï¼ˆä¸ä¸ºç©ºï¼‰
   - åŠ¨ä½œï¼š`lastValidDate = "10 Mar"`

2. **ç¬¬äºŒç¬”äº¤æ˜“ï¼ˆç©ºï¼‰**
   - æ—¥æœŸï¼š`""`ï¼ˆä¸ºç©ºï¼‰
   - åŠ¨ä½œï¼š`tx.date = lastValidDate` â†’ `"10 Mar"`

3. **ç¬¬ä¸‰ç¬”äº¤æ˜“ï¼ˆç©ºï¼‰**
   - æ—¥æœŸï¼š`""`ï¼ˆä¸ºç©ºï¼‰
   - åŠ¨ä½œï¼š`tx.date = lastValidDate` â†’ `"10 Mar"`

**ä¼˜åŠ¿ï¼š**

- âœ… **ç¡®å®šæ€§ç®—æ³•** - 100%å¯é ï¼Œæ— éšæœºæ€§
- âœ… **ä¸ä¾èµ–AI** - å®Œå…¨åœ¨å‰ç«¯JavaScriptå¤„ç†
- âœ… **å¤„ç†è¾¹ç•Œæƒ…å†µ** - ç¬¬ä¸€ç¬”ä¸ºç©ºæ—¶ä½¿ç”¨statementPeriod

---

## ğŸ“Š å¤šé¡µæ–‡æ¡£å¤„ç†

### æ–¹æ¡ˆï¼šæ‰¹é‡æ¨¡å¼ï¼ˆprocessMultiPageDocumentï¼‰

**æµç¨‹ï¼š**

```
æ–‡ä»¶æ•°ç»„ â†’ æ‰€æœ‰è½¬Base64 â†’ ä¸€æ¬¡æ€§å‘é€ç»™AI â†’ AIåˆå¹¶å¤„ç† â†’ è¿”å›å®Œæ•´ç»“æœ
```

**ä¼˜åŠ¿ï¼š**

- âœ… **é€Ÿåº¦å¿«** - åªéœ€ä¸€æ¬¡APIè°ƒç”¨
- âœ… **æˆæœ¬ä½** - å‡å°‘é‡å¤å¤„ç†
- âœ… **å‡†ç¡®ç‡é«˜** - AIå¯ä»¥çœ‹åˆ°å®Œæ•´ä¸Šä¸‹æ–‡

**è¯·æ±‚ç¤ºä¾‹ï¼ˆ3é¡µPDFï¼‰ï¼š**

```javascript
{
  model: "qwen3-vl-plus-2025-12-19",
  messages: [{
    role: "user",
    content: [
      {type: "image_url", image_url: {url: "data:image/jpeg;base64,/9j/..."}}, // ç¬¬1é¡µ
      {type: "image_url", image_url: {url: "data:image/jpeg;base64,/9j/..."}}, // ç¬¬2é¡µ
      {type: "image_url", image_url: {url: "data:image/jpeg;base64,/9j/..."}}, // ç¬¬3é¡µ
      {type: "text", text: "è¿™æ˜¯ä¸€ä»½3é¡µçš„é“¶è¡Œå¯¹è´¦å•ï¼Œè¯·åˆå¹¶æå–æ‰€æœ‰äº¤æ˜“..."}
    ]
  }],
  max_tokens: 8000  // å¤šé¡µéœ€è¦æ›´å¤štokens
}
```

---

## âš ï¸ å½“å‰å·²çŸ¥é—®é¢˜

### é—®é¢˜ï¼šæ’ç”Ÿé“¶è¡ŒåŒæ—¥å¤šç¬”äº¤æ˜“

**ç°è±¡ï¼š**
- é“¶è¡Œå¯¹è´¦å•æ ¼å¼ï¼š
  ```
  Date       Description       Debit    Balance
  10 Mar     ATM WITHDRAWAL    500.00   30218.39
             ONLINE TRANSFER   200.00
             POS PURCHASE      150.00   30018.39
  ```

**AIæå–ç»“æœï¼š**
- âœ… **ç¬¬ä¸€ç¬”** - æ—¥æœŸï¼š`"10 Mar"`
- â“ **ç¬¬äºŒç¬”** - æ—¥æœŸï¼š`""`ï¼ˆç©ºç™½ï¼‰
- â“ **ç¬¬ä¸‰ç¬”** - æ—¥æœŸï¼š`""`ï¼ˆç©ºç™½ï¼‰

**å‰ç«¯åå¤„ç†ç»“æœï¼š**
- âœ… **æ‰€æœ‰äº¤æ˜“** - æ—¥æœŸéƒ½å˜æˆï¼š`"10 Mar"`

**é—®é¢˜ç‚¹ï¼š**

æ ¹æ®æ‚¨è¯´"é—®é¢˜æ— æ³•è§£å†³"ï¼Œå¯èƒ½çš„æƒ…å†µï¼š

1. **AIå®Œå…¨æ— æ³•è¯†åˆ«æ—¥æœŸï¼Ÿ**
   - å³ä½¿ç¬¬ä¸€ç¬”çš„æ—¥æœŸä¹Ÿæå–ä¸åˆ°ï¼Ÿ
   - éœ€è¦æŸ¥çœ‹AIçš„åŸå§‹å“åº”

2. **åå¤„ç†é€»è¾‘æœ‰bugï¼Ÿ**
   - ç©ºç™½æ—¥æœŸæ²¡æœ‰è¢«æ­£ç¡®å¡«å……ï¼Ÿ
   - éœ€è¦æ£€æŸ¥å®é™…è¿è¡Œæ—¥å¿—

3. **UIæ˜¾ç¤ºæœ‰é—®é¢˜ï¼Ÿ**
   - æ•°æ®æ­£ç¡®ä½†UIä¸æ˜¾ç¤ºï¼Ÿ
   - éœ€è¦æ£€æŸ¥è¡¨æ ¼æ¸²æŸ“ä»£ç 

---

## ğŸ”§ è¯Šæ–­æ­¥éª¤

### 1. æŸ¥çœ‹AIåŸå§‹å“åº”

åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œï¼š

```javascript
// ä¸Šä¼ æ–‡ä»¶åï¼ŒæŸ¥çœ‹æœ€æ–°æ–‡æ¡£çš„åŸå§‹å“åº”
const docs = await window.simpleDataManager.getDocuments(currentProjectId);
const latestDoc = docs[0];
console.log('AI åŸå§‹å“åº”:', latestDoc.rawText);
console.log('å¤„ç†åæ•°æ®:', latestDoc.processedData);
```

### 2. æ£€æŸ¥åå¤„ç†æ˜¯å¦æ‰§è¡Œ

åœ¨ `qwen-vl-max-processor.js` çš„ `postProcessTransactions` å‡½æ•°ä¸­æ·»åŠ æ—¥å¿—ï¼š

```javascript
postProcessTransactions(extractedData) {
    console.log('ğŸ” åå¤„ç†è¾“å…¥:', JSON.stringify(extractedData.transactions, null, 2));
    
    // ... å¤„ç†é€»è¾‘ ...
    
    console.log('âœ… åå¤„ç†è¾“å‡º:', JSON.stringify(extractedData.transactions, null, 2));
    return extractedData;
}
```

### 3. æ£€æŸ¥UIæ¸²æŸ“

åœ¨ `firstproject.html` çš„è¡¨æ ¼æ¸²æŸ“ä»£ç ä¸­æ£€æŸ¥æ—¥æœŸæ˜¾ç¤ºé€»è¾‘ã€‚

---

## ğŸ’¡ å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå¢å¼ºPromptï¼ˆè®©AIæ›´æ˜ç¡®ç†è§£ï¼‰

åœ¨Promptä¸­æ·»åŠ æ›´å¤šç¤ºä¾‹ï¼š

```
ğŸ“¤ EXAMPLE for same-day multiple transactions:
Input (what you see in PDF):
  Date       Description       Debit
  10 Mar     ATM WITHDRAWAL    500.00
             ONLINE TRANSFER   200.00
             POS PURCHASE      150.00

Output (what you should return):
  [
    {"date": "10 Mar", "description": "ATM WITHDRAWAL", "debit": 500},
    {"date": "",       "description": "ONLINE TRANSFER", "debit": 200},
    {"date": "",       "description": "POS PURCHASE", "debit": 150}
  ]

âš ï¸ CRITICAL: Do NOT copy "10 Mar" to rows 2-3. Leave them as "" (empty string).
```

### æ–¹æ¡ˆ2ï¼šOCRé¢„å¤„ç†ï¼ˆä½¿ç”¨Tesseract.jsï¼‰

å¦‚æœAIå®Œå…¨æ— æ³•è¯†åˆ«è¡¨æ ¼ç»“æ„ï¼Œå¯ä»¥ä½¿ç”¨ï¼š

1. **Tesseract.js OCR** â†’ è·å–æ–‡æœ¬å’Œåæ ‡
2. **è§„åˆ™å¼•æ“** â†’ æ ¹æ®åæ ‡å¯¹é½å­—æ®µ
3. **å‰ç«¯å¡«å……** â†’ åº”ç”¨åŒæ—¥å¤šç¬”é€»è¾‘

---

## ğŸ“ æ€»ç»“

å½“å‰å·¥ä½œæµç¨‹ï¼š

1. âœ… **ç”¨æˆ·ä¸Šä¼ ** â†’ PDF/å›¾ç‰‡
2. âœ… **æ–‡ä»¶å¤„ç†** â†’ PDFè½¬å›¾ç‰‡ï¼ˆå¦‚éœ€è¦ï¼‰
3. âœ… **ä¸Šä¼ Storage** â†’ è·å–URL
4. âœ… **æ‰£é™¤Credits** â†’ æ¯é¡µ1 Credit
5. âœ… **AIæå–** â†’ åƒé—®VL-Maxï¼ˆ8-15ç§’ï¼‰
6. âœ… **è§£æå“åº”** â†’ JSON parsing
7. âœ… **å‰ç«¯åå¤„ç†** â†’ **å¡«å……ç©ºç™½æ—¥æœŸ**ï¼ˆæ ¸å¿ƒåˆ›æ–°ï¼‰
8. âœ… **ä¿å­˜æ•°æ®** â†’ Firestore
9. âœ… **åˆ·æ–°UI** â†’ æ˜¾ç¤ºç»“æœ

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**

- âœ… ä¸ä¾èµ–Promptçš„å®Œç¾æ€§
- âœ… ç¡®å®šæ€§ç®—æ³•ï¼Œ100%å¯é 
- âœ… å¤„ç†è¾¹ç•Œæƒ…å†µï¼ˆç¬¬ä¸€ç¬”ä¸ºç©ºï¼‰

**ä¸‹ä¸€æ­¥ï¼š**

è¯·æä¾›å…·ä½“çš„æµ‹è¯•æ¡ˆä¾‹ï¼Œè®©æˆ‘è¯Šæ–­é—®é¢˜å‡ºåœ¨å“ªä¸€æ­¥ï¼

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0  
**åˆ›å»ºæ—¥æœŸï¼š** 2026-02-03  
**ç»´æŠ¤è€…ï¼š** AIåŠ©æ‰‹

