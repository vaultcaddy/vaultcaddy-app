# ğŸ“Š ç”¨æˆ·æ•°æ®ç»“æ„ç¤ºä¾‹

## ğŸ¯ **Firestore users é›†åˆç¤ºä¾‹**

### **ç¤ºä¾‹ 1ï¼šEmail æ³¨å†Œç”¨æˆ·**

```json
{
  "email": "john.doe@example.com",
  "displayName": "John Doe",
  "company": "Acme Corporation",
  "credits": 0,
  "currentCredits": 0,
  "planType": "Free Plan",
  "emailVerified": false,
  "photoURL": "",
  "provider": "email",
  "createdAt": "2025-12-14T17:30:00Z",
  "updatedAt": "2025-12-14T17:30:00Z"
}
```

---

### **ç¤ºä¾‹ 2ï¼šGoogle ç™»å½•ç”¨æˆ·**

```json
{
  "email": "jane.smith@gmail.com",
  "displayName": "Jane Smith",
  "company": "",
  "credits": 0,
  "currentCredits": 0,
  "planType": "Free Plan",
  "emailVerified": true,
  "photoURL": "https://lh3.googleusercontent.com/a/...",
  "provider": "google",
  "createdAt": "2025-12-14T17:31:00Z",
  "updatedAt": "2025-12-14T17:31:00Z"
}
```

---

### **ç¤ºä¾‹ 3ï¼šStripe æ”¯ä»˜ç”¨æˆ·ï¼ˆæœªè®¢é˜…å‰ï¼‰**

```json
{
  "email": "alice.wong@company.com",
  "displayName": "alice.wong",
  "company": "",
  "credits": 0,
  "currentCredits": 0,
  "planType": "Free Plan",
  "emailVerified": false,
  "photoURL": "",
  "provider": "stripe",
  "source": "stripe_payment",
  "stripeCustomerId": "cus_abc123xyz",
  "createdAt": "2025-12-14T17:32:00Z",
  "updatedAt": "2025-12-14T17:32:00Z"
}
```

---

### **ç¤ºä¾‹ 4ï¼šPro Plan ç”¨æˆ·ï¼ˆå·²è®¢é˜…æœˆè´¹ï¼‰**

```json
{
  "email": "bob.chen@startup.com",
  "displayName": "Bob Chen",
  "company": "Startup Inc.",
  "credits": 100,
  "currentCredits": 85,
  "planType": "Pro Plan",
  "emailVerified": true,
  "photoURL": "",
  "provider": "email",
  "stripeCustomerId": "cus_def456uvw",
  "stripeSubscriptionId": "sub_ghi789rst",
  "subscriptionPlan": "monthly",
  "resetDate": "2026-01-14T08:00:00Z",
  "meteredSubscriptionItemId": "si_abc123xyz",
  "totalCreditsUsed": 15,
  "includedCredits": 100,
  "lastPurchaseDate": "2025-12-14T17:33:00Z",
  "createdAt": "2025-12-14T17:00:00Z",
  "updatedAt": "2025-12-14T17:33:00Z"
}
```

---

### **ç¤ºä¾‹ 5ï¼šPro Plan ç”¨æˆ·ï¼ˆå·²è®¢é˜…å¹´è´¹ï¼‰**

```json
{
  "email": "carol.liu@enterprise.com",
  "displayName": "Carol Liu",
  "company": "Enterprise Solutions Ltd.",
  "credits": 1200,
  "currentCredits": 1150,
  "planType": "Pro Plan",
  "emailVerified": true,
  "photoURL": "",
  "provider": "google",
  "stripeCustomerId": "cus_jkl012mno",
  "stripeSubscriptionId": "sub_pqr345stu",
  "subscriptionPlan": "yearly",
  "resetDate": "2026-12-14T08:00:00Z",
  "meteredSubscriptionItemId": "si_def456uvw",
  "totalCreditsUsed": 50,
  "includedCredits": 1200,
  "lastPurchaseDate": "2025-12-14T17:34:00Z",
  "createdAt": "2025-12-14T16:00:00Z",
  "updatedAt": "2025-12-14T17:34:00Z"
}
```

---

## ğŸ“‹ **å­—æ®µè¯´æ˜**

### **åŸºç¡€å­—æ®µï¼ˆæ‰€æœ‰ç”¨æˆ·éƒ½æœ‰ï¼‰**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `email` | string | âœ… | ç”¨æˆ·é‚®ç®±ï¼ˆç»Ÿä¸€å°å†™ï¼‰ |
| `displayName` | string | âœ… | ç”¨æˆ·æ˜¾ç¤ºåç§° |
| `company` | string | â­• | å…¬å¸åç§°ï¼ˆå¯é€‰ï¼Œå¯ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰ |
| `credits` | number | âœ… | æ€» Credits |
| `currentCredits` | number | âœ… | å½“å‰å¯ç”¨ Credits |
| `planType` | string | âœ… | "Free Plan" æˆ– "Pro Plan" |
| `emailVerified` | boolean | âœ… | Email æ˜¯å¦å·²éªŒè¯ |
| `photoURL` | string | âœ… | ç”¨æˆ·å¤´åƒ URLï¼ˆå¯ä¸ºç©ºï¼‰ |
| `provider` | string | âœ… | æ³¨å†Œæ–¹å¼ï¼šemail/google/stripe |
| `createdAt` | timestamp | âœ… | åˆ›å»ºæ—¶é—´ |
| `updatedAt` | timestamp | âœ… | æ›´æ–°æ—¶é—´ |

### **è®¢é˜…ç›¸å…³å­—æ®µï¼ˆPro Plan ç”¨æˆ·æ‰æœ‰ï¼‰**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `stripeCustomerId` | string | Stripe å®¢æˆ· ID |
| `stripeSubscriptionId` | string | Stripe è®¢é˜… ID |
| `subscriptionPlan` | string | monthly æˆ– yearly |
| `resetDate` | timestamp | Credits é‡ç½®æ—¥æœŸ |
| `meteredSubscriptionItemId` | string | ç”¨äºè®¡é‡è®¡è´¹çš„è®¢é˜…é¡¹ ID |
| `totalCreditsUsed` | number | æœ¬æœŸç´¯è®¡ä½¿ç”¨çš„ Credits |
| `includedCredits` | number | è®¢é˜…åŒ…å«çš„ Creditsï¼ˆ100 æˆ– 1200ï¼‰ |
| `lastPurchaseDate` | timestamp | æœ€åè´­ä¹°/ç»­è´¹æ—¥æœŸ |

---

## ğŸ”„ **ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸä¸­çš„æ•°æ®å˜åŒ–**

### **é˜¶æ®µ 1ï¼šåˆæ¬¡æ³¨å†Œ**

```
Email æ³¨å†Œ
â†’ email: user@example.com
â†’ displayName: User Name
â†’ company: Company Name
â†’ planType: Free Plan
â†’ credits: 0
```

### **é˜¶æ®µ 2ï¼šEmail éªŒè¯å**

```
éªŒè¯ Email
â†’ emailVerified: true
â†’ credits: 20 (èµ é€)
â†’ currentCredits: 20
```

### **é˜¶æ®µ 3ï¼šè®¢é˜… Pro Planï¼ˆæœˆè´¹ï¼‰**

```
å®Œæˆ Stripe æ”¯ä»˜
â†’ planType: Pro Plan
â†’ credits: 100 (æ–°å¢)
â†’ currentCredits: 100
â†’ stripeCustomerId: cus_xxx
â†’ stripeSubscriptionId: sub_xxx
â†’ subscriptionPlan: monthly
â†’ resetDate: +1 ä¸ªæœˆ
â†’ includedCredits: 100
â†’ totalCreditsUsed: 0
```

### **é˜¶æ®µ 4ï¼šä½¿ç”¨ Credits**

```
ä¸Šä¼ æ–‡æ¡£å¤„ç†
â†’ credits: 100 â†’ 99
â†’ currentCredits: 100 â†’ 99
â†’ totalCreditsUsed: 0 â†’ 1
```

### **é˜¶æ®µ 5ï¼šè¶…å‡ºé¢åº¦ï¼ˆOverageï¼‰**

```
ç»§ç»­å¤„ç†æ–‡æ¡£
â†’ credits: 0 â†’ -5
â†’ currentCredits: 0 â†’ -5
â†’ totalCreditsUsed: 100 â†’ 105
â†’ è‡ªåŠ¨å‘ Stripe æŠ¥å‘Šè¶…é¢ä½¿ç”¨ (5 credits)
```

### **é˜¶æ®µ 6ï¼šæœˆåº¦ç»­è´¹**

```
Stripe è‡ªåŠ¨ç»­è´¹
â†’ æ‰£é™¤åŸºç¡€è´¹ç”¨ + è¶…é¢è´¹ç”¨
â†’ credits: -5 â†’ 100 (æ¸…é›¶æ—§ Creditsï¼Œæ·»åŠ æ–° 100)
â†’ currentCredits: -5 â†’ 100
â†’ totalCreditsUsed: 105 â†’ 0 (é‡ç½®)
â†’ resetDate: +1 ä¸ªæœˆ
```

### **é˜¶æ®µ 7ï¼šå–æ¶ˆè®¢é˜…**

```
ç”¨æˆ·å–æ¶ˆè®¢é˜…
â†’ planType: Pro Plan â†’ Free Plan (åˆ°æœŸå)
â†’ credits: 150 â†’ 50 (è¶…è¿‡ 50 çš„éƒ¨åˆ†æ¸…é™¤)
â†’ currentCredits: 150 â†’ 50
â†’ åˆ é™¤è®¢é˜…ç›¸å…³å­—æ®µ
```

---

## ğŸ’¡ **ç‰¹æ®Šæƒ…å†µå¤„ç†**

### **æƒ…å†µ 1ï¼šå–æ¶ˆè®¢é˜…æ—¶æœ‰æ­£æ•° Credits**

```
credits: 150
â†’ å–æ¶ˆè®¢é˜…å â†’ 50 (ä¿ç•™ä¸Šé™ 50)
```

### **æƒ…å†µ 2ï¼šå–æ¶ˆè®¢é˜…æ—¶æœ‰è´Ÿæ•° Credits (Overage)**

```
credits: -30
â†’ éœ€è¦å…ˆæ”¯ä»˜è¶…é¢è´¹ç”¨
â†’ æ”¯ä»˜å â†’ 0
```

### **æƒ…å†µ 3ï¼šå¹´è´¹ç”¨æˆ·è¶…é¢**

```
includedCredits: 1200
totalCreditsUsed: 1250
â†’ Overage: 50 credits
â†’ ä¸‹æ¬¡å‘ç¥¨å°†æ”¶å–è¶…é¢è´¹ç”¨
```

---

## ğŸ¯ **å…³é”®ç‚¹**

1. **æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰åŸºç¡€å­—æ®µ**ï¼Œæ— è®ºæ³¨å†Œæ–¹å¼
2. **å…¬å¸åç§°å¯é€‰**ï¼ŒEmail æ³¨å†Œæ—¶å¯å¡«ï¼Œå…¶ä»–æ–¹å¼ä¸ºç©º
3. **å¯†ç ä¸å­˜å‚¨åœ¨ Firestore**ï¼Œåªåœ¨ Firebase Auth ä¸­
4. **Pro Plan ç”¨æˆ·æœ‰é¢å¤–çš„è®¢é˜…å­—æ®µ**
5. **Credits å¯ä»¥ä¸ºè´Ÿæ•°**ï¼ˆä»… Pro Planï¼Œç”¨äº Overage è®¡è´¹ï¼‰
6. **å–æ¶ˆè®¢é˜…æ—¶ï¼Œæ­£æ•° Credits ä¸Šé™ä¸º 50**
7. **æ¯æ¬¡ç»­è´¹æ—¶ï¼Œæ—§ Credits æ¸…é›¶ï¼Œæ·»åŠ æ–° Credits**

---

**ğŸ“Š è¿™å°±æ˜¯å®Œæ•´çš„ç”¨æˆ·æ•°æ®ç»“æ„ï¼**


