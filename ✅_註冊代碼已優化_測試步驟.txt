# âœ… è¨»å†Šä»£ç¢¼å·²å„ªåŒ–å®Œæˆ

## ğŸ“‹ **ä¿®æ”¹å…§å®¹**

### **æ–‡ä»¶**: `simple-auth.js`

### **ä¸»è¦æ”¹é€²**:

1. **âœ… Email çµ±ä¸€è½‰æ›ç‚ºå°å¯«**
   - é¿å…å¤§å°å¯«åŒ¹é…å•é¡Œ
   - `const normalizedEmail = email.toLowerCase().trim();`

2. **âœ… æ·»åŠ è©³ç´°çš„èª¿è©¦æ—¥èªŒ**
   - è¨˜éŒ„ç”¨æˆ¶ IDã€Email
   - è¨˜éŒ„æ–‡æª”å‰µå»ºéç¨‹

3. **âœ… é©—è­‰æ–‡æª”å‰µå»ºæˆåŠŸ**
   - å‰µå»ºå¾Œç«‹å³è®€å–æ–‡æª”
   - ç¢ºèª `email` å­—æ®µå­˜åœ¨
   - å¦‚æœé©—è­‰å¤±æ•—ï¼Œæ‹‹å‡ºéŒ¯èª¤

4. **âœ… ç¢ºä¿æ•¸æ“šå®Œæ•´æ€§**
   - å¦‚æœ Firestore æ–‡æª”å‰µå»ºå¤±æ•—ï¼Œåˆªé™¤ Auth ç”¨æˆ¶
   - é˜²æ­¢å‡ºç¾"æœ‰ Auth å¸³æˆ¶ä½†æ²’æœ‰ Firestore ç”¨æˆ¶æ–‡æª”"çš„æƒ…æ³

---

## ğŸ“Š **å‰µå»ºçš„ç”¨æˆ¶æ–‡æª”çµæ§‹**

```javascript
{
    email: "user@example.com",        // âœ… å°å¯«
    displayName: "User Name",
    credits: 0,                        // åˆå§‹ç‚º 0ï¼Œé©—è­‰å¾ŒæœƒåŠ  20
    currentCredits: 0,
    emailVerified: false,
    createdAt: serverTimestamp,
    updatedAt: serverTimestamp
}
```

---

## ğŸ§ª **æ¸¬è©¦æ­¥é©Ÿ**

### **æ­¥é©Ÿ 1ï¼šé‡æ–°è¨»å†Šæ–°ç”¨æˆ¶**

1. æ‰“é–‹ç€è¦½å™¨çš„**ç„¡ç—•æ¨¡å¼** (Incognito/Private)
2. è¨ªå• https://vaultcaddy.com/auth.html
3. é»æ“Š"ç«‹å³è¨»å†Š"
4. å¡«å¯«è¨»å†Šè¡¨å–®ï¼š
   - **Email**: ä½¿ç”¨ä¸€å€‹æ–°çš„æ¸¬è©¦ emailï¼ˆå¦‚ `test123@gmail.com`ï¼‰
   - **åå­—**: Test
   - **å§“æ°**: User
   - **å¯†ç¢¼**: Test1234
   - **ç¢ºèªå¯†ç¢¼**: Test1234
5. é»æ“Š"å‰µå»ºå¸³æˆ¶"

---

### **æ­¥é©Ÿ 2ï¼šæŸ¥çœ‹æ§åˆ¶å°æ—¥èªŒ**

åœ¨ç€è¦½å™¨æŒ‰ `F12` æ‰“é–‹é–‹ç™¼è€…å·¥å…·ï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¼¸å‡ºï¼š

**é æœŸæ—¥èªŒï¼š**
```
ğŸ“ æ­£åœ¨è¨»å†Š... test123@gmail.com
ğŸ“ æ­£åœ¨å‰µå»º Firestore ç”¨æˆ¶æ–‡æª”...
   ç”¨æˆ¶ ID: xxxxxxxxxxxxx
   Email: test123@gmail.com
âœ… Firestore ç”¨æˆ¶æ–‡æª”å·²å‰µå»º
   æ–‡æª”å…§å®¹: { email: "test123@gmail.com", displayName: "Test User", credits: 0, ... }
âœ… ç”¨æˆ¶æ–‡æª”é©—è­‰æˆåŠŸï¼Œemail å­—æ®µ: test123@gmail.com
âœ… è¨»å†ŠæˆåŠŸ
```

---

### **æ­¥é©Ÿ 3ï¼šåœ¨ Firebase Console ä¸­é©—è­‰**

1. æ‰“é–‹ Firebase Console
   https://console.firebase.google.com/project/vaultcaddy-production-cbbe2/firestore/data/~2Fusers

2. æŸ¥æ‰¾æ–°å‰µå»ºçš„ç”¨æˆ¶æ–‡æª”

3. ç¢ºèªæ–‡æª”åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
   - âœ… `email`: test123@gmail.com (å°å¯«)
   - âœ… `displayName`: Test User
   - âœ… `credits`: 0
   - âœ… `currentCredits`: 0
   - âœ… `emailVerified`: false
   - âœ… `createdAt`: (æ™‚é–“æˆ³)
   - âœ… `updatedAt`: (æ™‚é–“æˆ³)

---

### **æ­¥é©Ÿ 4ï¼šæ¸¬è©¦ Email é©—è­‰å’Œ Credits å¢åŠ **

1. æª¢æŸ¥è¨»å†Šæ™‚ä½¿ç”¨çš„ email æ”¶ä»¶ç®±
2. è¤‡è£½é©—è­‰ç¢¼
3. åœ¨é©—è­‰é é¢è¼¸å…¥é©—è­‰ç¢¼
4. é©—è­‰æˆåŠŸå¾Œï¼Œå†æ¬¡æª¢æŸ¥ Firebase Console
5. ç¢ºèªï¼š
   - âœ… `emailVerified`: true
   - âœ… `credits`: 20 (å¾ 0 å¢åŠ åˆ° 20)
   - âœ… `currentCredits`: 20

---

### **æ­¥é©Ÿ 5ï¼šæ¸¬è©¦ Stripe æ”¯ä»˜ï¼ˆä½¿ç”¨æ–°ç”¨æˆ¶ï¼‰**

1. ç™»å…¥å‰›è¨»å†Šçš„æ–°ç”¨æˆ¶å¸³æˆ¶
2. è¨ªå• https://vaultcaddy.com/billing.html
3. é»æ“Š **"ğŸ§ª æ¸¬è©¦ Get Started"**
4. ä½¿ç”¨æ¸¬è©¦å¡ï¼š**4242 4242 4242 4242**
5. å®Œæˆæ”¯ä»˜

---

### **æ­¥é©Ÿ 6ï¼šç¢ºèª Credits å¢åŠ **

1. åˆ·æ–° Firebase Console
2. æŸ¥çœ‹æ–°ç”¨æˆ¶çš„ `credits` å­—æ®µ
3. æ‡‰è©²å¾ **20** å¢åŠ åˆ° **120**ï¼ˆ+100ï¼‰

---

## ğŸ” **å¦‚æœå‡ºç¾å•é¡Œ**

### **å•é¡Œ Aï¼šè¨»å†Šæ™‚æ§åˆ¶å°é¡¯ç¤ºéŒ¯èª¤**

**æŸ¥çœ‹éŒ¯èª¤æ¶ˆæ¯ï¼š**
- å¦‚æœæ˜¯ "ç„¡æ³•å‰µå»ºç”¨æˆ¶è³‡æ–™"ï¼Œèªªæ˜ Firestore æ–‡æª”å‰µå»ºå¤±æ•—
- æª¢æŸ¥ Firebase Firestore å®‰å…¨è¦å‰‡

**è§£æ±ºæ–¹æ¡ˆï¼š**
æª¢æŸ¥ Firestore å®‰å…¨è¦å‰‡ï¼Œç¢ºä¿å…è¨±å‰µå»ºç”¨æˆ¶æ–‡æª”ï¼š

```
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId} {
      // å…è¨±ç”¨æˆ¶å‰µå»ºè‡ªå·±çš„æ–‡æª”
      allow create: if request.auth.uid == userId;
      // å…è¨±ç”¨æˆ¶è®€å¯«è‡ªå·±çš„æ–‡æª”
      allow read, write: if request.auth.uid == userId;
    }
  }
}
```

---

### **å•é¡Œ Bï¼šè¨»å†ŠæˆåŠŸä½† Firestore ä¸­æ²’æœ‰æ–‡æª”**

**å¯èƒ½åŸå› ï¼š**
- Firestore å®‰å…¨è¦å‰‡é˜»æ­¢äº†å‰µå»ºæ“ä½œ
- ç¶²çµ¡å•é¡Œ

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. æŸ¥çœ‹ç€è¦½å™¨æ§åˆ¶å°çš„å®Œæ•´éŒ¯èª¤æ—¥èªŒ
2. æª¢æŸ¥ Firestore å®‰å…¨è¦å‰‡
3. å˜—è©¦ä½¿ç”¨å…¶ä»–ç¶²çµ¡

---

### **å•é¡Œ Cï¼šæ–‡æª”å‰µå»ºæˆåŠŸä½†ç¼ºå°‘ email å­—æ®µ**

**å¯èƒ½åŸå› ï¼š**
- ä»£ç¢¼æœªæ­£ç¢ºéƒ¨ç½²

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. æ¸…é™¤ç€è¦½å™¨ç·©å­˜ï¼ˆCtrl+Shift+Deleteï¼‰
2. å¼·åˆ¶åˆ·æ–°é é¢ï¼ˆCtrl+F5ï¼‰
3. å†æ¬¡å˜—è©¦è¨»å†Š

---

## ğŸ“ **å®Œæˆæ¸¬è©¦å¾Œ**

è«‹å‘Šè¨´æˆ‘ï¼š
1. âœ… è¨»å†Šæ˜¯å¦æˆåŠŸï¼Ÿ
2. âœ… æ§åˆ¶å°æ—¥èªŒæ˜¯å¦é¡¯ç¤º"ç”¨æˆ¶æ–‡æª”é©—è­‰æˆåŠŸ"ï¼Ÿ
3. âœ… Firebase Console ä¸­æ–°ç”¨æˆ¶æ˜¯å¦æœ‰ `email` å­—æ®µï¼Ÿ
4. âœ… Email é©—è­‰å¾Œ Credits æ˜¯å¦å¾ 0 å¢åŠ åˆ° 20ï¼Ÿ
5. âœ… æ¸¬è©¦æ”¯ä»˜å¾Œ Credits æ˜¯å¦å¾ 20 å¢åŠ åˆ° 120ï¼Ÿ

**å¦‚æœä»¥ä¸Šéƒ½æˆåŠŸï¼Œèªªæ˜å•é¡Œå·²å®Œå…¨è§£æ±ºï¼** ğŸ‰

