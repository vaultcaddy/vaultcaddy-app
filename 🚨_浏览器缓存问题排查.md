# ğŸš¨ æµè§ˆå™¨ç¼“å­˜é—®é¢˜æ’æŸ¥

## é—®é¢˜
ä¸Šä¼ æ–‡ä»¶åï¼ŒFirebase Logs ä¸­æ²¡æœ‰ `deductCreditsClient` çš„æ—¥å¿—ï¼Œè¯´æ˜å®¢æˆ·ç«¯è¿˜åœ¨ä½¿ç”¨æ—§ä»£ç ã€‚

---

## ğŸ” æ’æŸ¥æ­¥éª¤

### æ­¥éª¤1ï¼šæ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·

1. **æ‰“å¼€æ§åˆ¶å°**
   - Mac: `Cmd + Option + J`
   - Windows: `Ctrl + Shift + J`
   - æˆ–å³é”® â†’ "æ£€æŸ¥" â†’ "Console" æ ‡ç­¾

2. **æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯**
   - çº¢è‰²é”™è¯¯ä¿¡æ¯
   - ç‰¹åˆ«æ˜¯å…³äº `deductCreditsClient` çš„é”™è¯¯

---

### æ­¥éª¤2ï¼šæ£€æŸ¥ JS æ–‡ä»¶æ˜¯å¦æ›´æ–°

åœ¨æ§åˆ¶å°ä¸­è¿è¡Œä»¥ä¸‹ä»£ç ï¼š

```javascript
// æ£€æŸ¥å‡½æ•°æ˜¯å¦å­˜åœ¨
console.log('creditsManager.deductCredits:', window.creditsManager.deductCredits.toString().substring(0, 200));
```

**é¢„æœŸè¾“å‡º**ï¼ˆæ–°ç‰ˆæœ¬ï¼‰ï¼š
```
"function(pages) { ... è°ƒç”¨åç«¯ Cloud Function ..."
```

**å¦‚æœçœ‹åˆ°**ï¼ˆæ—§ç‰ˆæœ¬ï¼‰ï¼š
```
"function(pages) { ... db.runTransaction ..."
```

è¯´æ˜è¿˜åœ¨ä½¿ç”¨æ—§ä»£ç ï¼

---

### æ­¥éª¤3ï¼šå¼ºåˆ¶æ¸…é™¤ç¼“å­˜

#### æ–¹æ³•1ï¼šå¼€å‘è€…å·¥å…·æ¸…é™¤ï¼ˆæœ€å½»åº•ï¼‰

1. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. ç‚¹å‡»é¡¶éƒ¨çš„ "Network"ï¼ˆç½‘ç»œï¼‰æ ‡ç­¾
3. å‹¾é€‰ "Disable cache"ï¼ˆç¦ç”¨ç¼“å­˜ï¼‰
4. **å³é”®ç‚¹å‡»åˆ·æ–°æŒ‰é’®**
5. é€‰æ‹© "æ¸…ç©ºç¼“å­˜å¹¶ç¡¬æ€§é‡æ–°åŠ è½½"

#### æ–¹æ³•2ï¼šåº”ç”¨ç¨‹åºå­˜å‚¨æ¸…é™¤

1. æ‰“å¼€å¼€å‘è€…å·¥å…·
2. ç‚¹å‡» "Application"ï¼ˆåº”ç”¨ç¨‹åºï¼‰æ ‡ç­¾
3. å·¦ä¾§æ‰¾åˆ° "Storage" â†’ "Clear site data"
4. ç‚¹å‡» "Clear site data" æŒ‰é’®
5. åˆ·æ–°é¡µé¢

#### æ–¹æ³•3ï¼šéšç§æµè§ˆæ¨¡å¼

1. æ‰“å¼€æ–°çš„éšç§æµè§ˆçª—å£
   - Mac: `Cmd + Shift + N`
   - Windows: `Ctrl + Shift + N`
2. è®¿é—® https://vaultcaddy.com
3. ç™»å½•å¹¶æµ‹è¯•

---

### æ­¥éª¤4ï¼šæŸ¥çœ‹ Network è¯·æ±‚

1. æ‰“å¼€å¼€å‘è€…å·¥å…·
2. ç‚¹å‡» "Network" æ ‡ç­¾
3. åˆ·æ–°é¡µé¢
4. æŸ¥æ‰¾ `credits-manager.js` æ–‡ä»¶
5. æŸ¥çœ‹ï¼š
   - **Status**: åº”è¯¥æ˜¯ `200`ï¼ˆä¸åº”è¯¥æ˜¯ `304 Not Modified`ï¼‰
   - **Size**: åº”è¯¥æ˜¾ç¤ºå®é™…å¤§å°ï¼ˆä¸åº”è¯¥æ˜¯ `(disk cache)`ï¼‰

---

## ğŸ§ª éªŒè¯æ˜¯å¦ä½¿ç”¨æ–°ä»£ç 

åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œï¼š

```javascript
// æµ‹è¯•è°ƒç”¨æ–°å‡½æ•°
console.log('Testing deductCredits...');

// æŸ¥çœ‹å‡½æ•°å†…å®¹
const funcStr = window.creditsManager.deductCredits.toString();
if (funcStr.includes('deductCreditsClient')) {
    console.log('âœ… ä½¿ç”¨æ–°ä»£ç ï¼ˆè°ƒç”¨åç«¯ï¼‰');
} else if (funcStr.includes('db.runTransaction')) {
    console.log('âŒ ä½¿ç”¨æ—§ä»£ç ï¼ˆç›´æ¥æ“ä½œ Firestoreï¼‰');
} else {
    console.log('âš ï¸ æœªçŸ¥ç‰ˆæœ¬');
}
```

---

## ğŸ“‹ å¦‚æœè¿˜æ˜¯ä¸è¡Œ

### ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ ç‰ˆæœ¬å·

ä¿®æ”¹ HTML æ–‡ä»¶ä¸­çš„ JS å¼•ç”¨ï¼Œæ·»åŠ ç‰ˆæœ¬å‚æ•°ï¼š

```html
<!-- æ—§çš„ -->
<script src="credits-manager.js"></script>

<!-- æ–°çš„ï¼ˆå¼ºåˆ¶é‡æ–°åŠ è½½ï¼‰-->
<script src="credits-manager.js?v=20251217-2"></script>
```

è¿™ä¼šå¼ºåˆ¶æµè§ˆå™¨é‡æ–°ä¸‹è½½ JS æ–‡ä»¶ã€‚

---

## ğŸ¯ é¢„æœŸçœ‹åˆ°çš„æ—¥å¿—

æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°ä¸Šä¼ åï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°åº”è¯¥çœ‹åˆ°ï¼š

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’° æ‰£é™¤ Credits (é€šéå¾Œç«¯ Cloud Function)
   ç”¨æˆ· ID: 3bLhZuU9H0b3ExhwFCJuN4vZeGb2
   æ‰£é™¤é æ•¸: 1
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Credits å·²æ‰£é™¤: 1 é ï¼Œå‰©é¤˜: -55
```

åœ¨ Firebase Logs åº”è¯¥çœ‹åˆ°ï¼š
```
ğŸ“ å®¢æˆ·ç«¯è°ƒç”¨ deductCreditsClient
ğŸ” æ‰£é™¤ Credits: userId=3bLhZuU9H0b3ExhwFCJuN4vZeGb2
ğŸ“¡ reportUsageToStripe
âœ… ä½¿ç”¨é‡å·²æŠ¥å‘Šç»™ Stripe Billing Meter
```


