<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="page_title_dashboard">ÂÑÄË°®Êùø - VaultCaddy</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="pages.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script src="config.js"></script>
    <script src="translations.js"></script>
    <script src="unified-auth.js"></script>
    <script src="global-auth-sync.js?v=3.9"></script>
    <script src="navbar-component.js?v=3.9"></script>
    <script src="sidebar-component.js?v=3.9"></script>
    <!-- ËºâÂÖ•Áµ±‰∏ÄËôïÁêÜÂô®Á≥ªÁµ± -->
    <script src="google-ai-integration.js"></script>
    <script src="google-document-ai.js"></script>
    <script src="google-vision-ai.js"></script>
    <script src="google-smart-processor.js"></script>
    <script src="google-cloud-storage.js"></script>
    <script src="ledgerbox-integration.js"></script>
    
    <!-- ËºâÂÖ•Êï∏ÊìöËôïÁêÜÂô® -->
    <script src="data-processor.js"></script>
    
    <!-- ËºâÂÖ•Áµ±‰∏ÄËôïÁêÜÂô® -->
    <script src="unified-document-processor.js"></script>
    
    <!-- ËºâÂÖ•Â∞éÂá∫ÁÆ°ÁêÜÂô® -->
    <script src="export-manager.js"></script>
    <link rel="stylesheet" href="ledgerbox-styles.css">
    
    <style>
        /* ÁôΩËâ≤‰∏ªÈ°åÊ®£Âºè */
        body {
            background: #ffffff !important;
            color: #1f2937 !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .dashboard-container {
            display: flex;
            min-height: 100vh;
            background: #ffffff;
            padding-top: 60px; /* ÁÇ∫Â∞éËà™Ê¨ÑÁïôÂá∫Á©∫Èñì */
        }
        
        .sidebar {
            width: 280px;
            background: #ffffff;
            border-right: 1px solid #e5e7eb;
            flex-shrink: 0;
            position: fixed;
            top: 60px;
            bottom: 0;
            left: 0;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
        }
        
        .sidebar-header {
            padding: 1.5rem 1rem 1rem 1rem;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .sidebar-header h2 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }
        
        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
        }
        
        .sidebar-nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .sidebar-nav .nav-item {
            margin: 0;
        }
        
        .sidebar-nav .nav-item a {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: #6b7280;
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        
        .sidebar-nav .nav-item.active a {
            background: #eff6ff;
            color: #2563eb;
            border-left-color: #2563eb;
        }
        
        .sidebar-nav .nav-item a:hover {
            background: #f1f5f9;
            color: #374151;
        }
        
        .sidebar-nav .nav-item a i {
            width: 20px;
            margin-right: 0.75rem;
            font-size: 1rem;
        }
        
        .sidebar-section {
            padding: 1rem 0;
            border-top: 1px solid #e2e8f0;
        }
        
        .sidebar-section h3 {
            font-size: 0.75rem;
            font-weight: 600;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 0 0 0.5rem 1rem;
        }
        
        .sidebar-footer {
            padding: 1rem;
            border-top: 1px solid #e2e8f0;
            background: #ffffff;
        }
        
        .sidebar-stats {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
        }
        
        .stat-item:last-child {
            margin-bottom: 0;
        }
        
        .stat-left {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .stat-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1f2937;
        }
        
        .main-content {
            flex: 1;
            background: #ffffff;
            margin-left: 280px;
            overflow-y: auto;
            min-height: calc(100vh - 60px);
            display: block !important;
            visibility: visible !important;
        }
        
        .page-header {
            padding: 2rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #ffffff;
        }
        
        .team-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .team-icon {
            width: 48px;
            height: 48px;
            background: #fbbf24;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        
        .team-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .team-details h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }
        
        .subscription-badge {
            background: #3b82f6;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            width: fit-content;
        }
        
        .subscription-badge::after {
            content: '‚ñº';
            font-size: 0.6rem;
            opacity: 0.8;
        }
        
        .project-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .project-btn:hover {
            background: #2563eb;
        }
        
        .controls-bar {
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e2e8f0;
            background: #ffffff;
        }
        
        .filter-input {
            background: #ffffff;
            border: 1px solid #d1d5db;
            color: #1f2937;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            width: 300px;
            font-size: 14px;
        }
        
        .filter-input::placeholder {
            color: #9ca3af;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .actions {
            display: flex;
            gap: 1rem;
        }
        
        .upload-btn {
            background: #6366f1;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .upload-btn:hover {
            background: #4f46e5;
        }
        
        .view-btn {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        .view-btn:hover {
            background: #e5e7eb;
        }
        
        .documents-table-container {
            padding: 2rem;
            background: #ffffff;
            flex: 1;
            overflow-x: auto;
        }
        
        .folder-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
            max-width: 1200px;
        }
        
        .folder-item {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-height: 180px;
            justify-content: center;
        }
        
        .folder-item:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
            transform: translateY(-2px);
        }
        
        .folder-icon {
            width: 64px;
            height: 64px;
            background: #f3f4f6;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            position: relative;
        }
        
        .folder-icon i {
            font-size: 2rem;
            color: #6b7280;
        }
        
        .folder-icon::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 8px;
            width: 20px;
            height: 8px;
            background: #f3f4f6;
            border-radius: 4px 4px 0 0;
        }
        
        .folder-name {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .folder-files-count {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }
        
        .folder-updated {
            font-size: 0.75rem;
            color: #9ca3af;
        }
        
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 3rem;
            color: #6b7280;
        }
        
        .empty-state-icon {
            font-size: 4rem;
            color: #d1d5db;
            margin-bottom: 1rem;
        }
        
        .empty-state h3 {
            font-size: 1.25rem;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .empty-state p {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .documents-table {
            width: 100%;
            min-width: 1200px; /* Á¢∫‰øùË°®Ê†ºÊúÄÂ∞èÂØ¨Â∫¶ÔºåËß∏ÁôºÊ∞¥Âπ≥ÊªæÂãï */
            border-collapse: collapse;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .documents-table thead th {
            background: #f8fafc;
            color: #374151;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid #e2e8f0;
            white-space: nowrap; /* Èò≤Ê≠¢Ê®ôÈ°åÊñáÂ≠óÊèõË°å */
            font-size: 14px;
        }
        
        .documents-table tbody tr {
            border-bottom: 1px solid #f3f4f6;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .documents-table tbody tr:hover {
            background: #f9fafb;
        }
        
        .documents-table tbody tr:last-child {
            border-bottom: none;
        }
        
        .documents-table tbody td {
            padding: 1rem;
            color: #374151;
            vertical-align: middle;
            white-space: nowrap; /* Èò≤Ê≠¢ÂñÆÂÖÉÊ†ºÂÖßÂÆπÊèõË°å */
            font-size: 14px;
        }
        
        .document-cell {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .file-icon {
            color: #ef4444;
            font-size: 1.5rem;
        }
        
        .doc-name {
            font-weight: 600;
            color: #1f2937;
        }
        
        .doc-details {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        .period-info {
            color: #6b7280;
        }
        
        .reconciliation {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .reconciliation-text {
            font-weight: 600;
        }
        
        .progress-bar {
            width: 100px;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #10b981;
            transition: width 0.3s;
        }
        
        .progress-percentage {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .reconciliation-status {
            font-size: 0.75rem;
            color: #fbbf24;
        }
        
        .balance-info {
            font-size: 0.875rem;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .status-badge.success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .review-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .review-badge.review {
            background: rgba(249, 115, 22, 0.2);
            color: #f97316;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .action-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }
        
        .pagination-info {
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #6b7280;
            border-top: 1px solid #e2e8f0;
            background: #ffffff;
            font-size: 14px;
        }
        
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .rows-per-page {
            background: #ffffff;
            border: 1px solid #d1d5db;
            color: #374151;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .rows-per-page:focus {
            outline: none;
            border-color: #6366f1;
        }
        
        .pagination-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .page-btn {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            color: #374151;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .page-btn:hover:not(:disabled) {
            background: #e5e7eb;
        }
        
        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* ÂèØÁ∑®ËºØËº∏ÂÖ•Ê°ÜÊ®£Âºè */
        .editable-input {
            border: 1px solid transparent;
            background: transparent;
            padding: 0.5rem;
            font-size: 14px;
            color: #374151;
            width: 100%;
            box-sizing: border-box;
            transition: all 0.2s;
        }
        
        .editable-input:hover {
            border-color: #d1d5db;
            background: #f9fafb;
        }
        
        .editable-input:focus {
            outline: none;
            border-color: #6366f1;
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .editable-input[readonly] {
            background: #f3f4f6;
            color: #6b7280;
            cursor: not-allowed;
        }
        
        .editable-input[readonly]:hover {
            border-color: transparent;
            background: #f3f4f6;
        }
        
        .date-input {
            min-width: 140px;
        }
        
        .description-input {
            min-width: 200px;
        }
        
        .amount-input,
        .balance-input {
            min-width: 100px;
            text-align: right;
        }
        
        .delete-transaction-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .delete-transaction-btn:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        /* ÊñáÊ™îË©≥Á¥∞Ë¶ñÂúñÊ®£Âºè */
        .back-navigation {
            padding: 1rem 2rem;
            border-bottom: 1px solid #334155;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }
        
        .back-btn:hover {
            color: #e2e8f0;
        }
        
        .document-detail-container {
            display: flex;
            min-height: calc(100vh - 200px);
            height: auto;
        }
        
        .pdf-preview-container {
            width: 40%;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            background: #ffffff;
        }
        
        .pdf-controls {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 1rem;
            background: #f8fafc;
        }
        
        .pdf-control-btn {
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            color: #475569;
            padding: 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pdf-control-btn:hover {
            background: #e2e8f0;
            border-color: #cbd5e1;
        }
        
        .page-info {
            color: #64748b;
            font-weight: 500;
        }
        
        .pdf-viewer {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            padding: 2rem;
        }
        
        .pdf-placeholder {
            text-align: center;
            color: #64748b;
            padding: 2rem;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            background: #ffffff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .pdf-placeholder i {
            font-size: 3rem;
            color: #3b82f6;
            margin-bottom: 1rem;
        }
        
        .pdf-placeholder h3 {
            color: #1f2937;
            margin: 0 0 0.5rem 0;
        }
        
        .pdf-placeholder p {
            color: #6b7280;
            margin: 0;
        }
        
        .pdf-placeholder i {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .data-extraction-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }
        
        .extraction-header {
            padding: 1rem 2rem;
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .extraction-header h2 {
            font-size: 1.5rem;
            color: #e2e8f0;
            margin: 0;
        }
        
        .extraction-tabs {
            display: flex;
            gap: 1rem;
        }
        
        .tab-btn {
            background: none;
            border: none;
            color: #94a3b8;
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .tab-btn.active {
            color: #8b5cf6;
            border-bottom-color: #8b5cf6;
        }
        
        .document-actions {
            display: flex;
            gap: 1rem;
        }
        
        .save-btn, .download-btn, .more-actions-btn {
            background: #475569;
            border: none;
            color: #e2e8f0;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .reconciliation-status {
            padding: 1rem 2rem;
            border-bottom: 1px solid #334155;
        }
        
        .reconciliation-status h3 {
            color: #e2e8f0;
            margin: 0 0 0.5rem 0;
        }
        
        .completion-status {
            color: #fbbf24;
            font-weight: 600;
        }
        
        .bank-statement-details {
            padding: 1rem 2rem;
            border-bottom: 1px solid #334155;
        }
        
        .bank-statement-details h3 {
            color: #e2e8f0;
            margin: 0;
        }
        
        .transactions-section {
            flex: 1;
            padding: 1rem 2rem;
        }
        
        .transactions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .transactions-header h3 {
            color: #e2e8f0;
            margin: 0;
        }
        
        .transaction-controls {
            display: flex;
            gap: 1rem;
        }
        
        .control-btn {
            background: #475569;
            border: none;
            color: #e2e8f0;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .add-btn {
            background: #8b5cf6;
        }
        
        .transaction-info {
            margin-bottom: 1rem;
            color: #94a3b8;
        }
        
        .transactions-table-container {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .transactions-table {
            width: 100%;
            border-collapse: collapse;
            background: #ffffff;
        }
        
        .transactions-table thead th {
            background: #f8fafc;
            color: #374151;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .transactions-table tbody tr {
            border-bottom: 1px solid #e5e7eb;
        }
        
        .transactions-table tbody tr:last-child {
            border-bottom: none;
        }
        
        .transactions-table tbody td {
            padding: 0.75rem;
            color: #374151;
        }
        
        .transaction-checkbox {
            margin: 0;
        }
        
        .delete-transaction-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0.25rem;
        }
        
        .delete-transaction-btn:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        .view-container {
            height: 100%;
            display: block !important;
            visibility: visible !important;
        }
        
        /* ÂèØÁ∑®ËºØË°®Ê†ºÊ®£Âºè */
        .editable-input {
            width: 100%;
            border: 1px solid transparent;
            background: transparent;
            padding: 0.5rem;
            font-size: 14px;
            color: #374151;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .editable-input:focus {
            outline: none;
            border-color: #6366f1;
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .editable-input:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        
        .date-input {
            min-width: 140px;
        }
        
        .description-input {
            min-width: 200px;
        }
        
        .amount-input, .balance-input {
            min-width: 100px;
            text-align: right;
        }
        
        .transaction-row:hover .editable-input {
            border-color: #d1d5db;
        }
        
        .delete-transaction-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .delete-transaction-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }
        
        /* ÂÅ¥ÈÇäÊ¨ÑÊêúÁ¥¢Ê¨Ñ */
        .sidebar-search {
            margin-bottom: 1.5rem;
        }
        
        .search-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: #ffffff;
            color: #1f2937;
            font-size: 0.875rem;
        }
        
        .search-input::placeholder {
            color: #9ca3af;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* È†ÖÁõÆÂçÄÂ°ä */
        .project-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        
        .project-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
        }
        
        .add-project-btn {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .add-project-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }
        
        .project-item {
            display: flex;
            align-items: center;
            padding: 0.5rem 0;
            color: #6b7280;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .project-item:hover {
            color: #374151;
        }
        
        .project-item i {
            margin-right: 0.75rem;
            width: 16px;
        }
        
        /* ÈÖçÁΩÆÂçÄÂ°ä */
        .config-item {
            display: flex;
            align-items: center;
            padding: 0.5rem 0;
            color: #6b7280;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .config-item:hover {
            color: #374151;
        }
        
        .config-item i {
            margin-right: 0.75rem;
            width: 16px;
        }
        
        /* ÂÅ¥ÈÇäÊ¨ÑÈ†ÖÁõÆhoverÊïàÊûú */
        .nav-item:hover {
            background: #f1f5f9 !important;
        }
        
        .nav-item.active {
            background: #eff6ff !important;
            color: #2563eb !important;
        }
    </style>
</head>
<body>
    <!-- AI ‰∏äÂÇ≥Ê®°ÊÖãÊ°Ü - ÊîæÂú® body ÊúÄÂâçÈù¢Á¢∫‰øùÁ´ãÂç≥ËºâÂÖ• -->
    <div id="aiUploadModal" class="ai-upload-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 10000; align-items: center; justify-content: center;">
        <div class="ai-upload-overlay" onclick="closeAIUploadModal()" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px);"></div>
        <div class="ai-upload-container" style="position: relative; background: white; border-radius: 16px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2); width: 90%; max-width: 800px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
            <!-- ÈóúÈñâÊåâÈàïÔºàÂè≥‰∏äËßíÔºâ -->
            <button class="ai-close-btn" onclick="closeAIUploadModal()" style="position: absolute; top: 1rem; right: 1rem; background: #f3f4f6; border: none; color: #6b7280; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; z-index: 10; box-shadow: 0 2px 4px rgba(0,0,0,0.1);" onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937'" onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280'">
                <i class="fas fa-times"></i>
            </button>

            <!-- ‰∏äÂÇ≥ÂçÄÂüü -->
            <div class="ai-upload-content" style="padding: 2rem; overflow-y: auto; flex: 1;">
                <!-- ÊñáÊ™îÈ°ûÂûãÈÅ∏ÊìáÂô® -->
                <div class="document-type-selector" style="margin-bottom: 2rem;">
                    <h3 style="font-size: 1.1rem; color: #1f2937; margin: 0 0 1rem 0; font-weight: 600;">ÈÅ∏ÊìáÊñáÊ™îÈ°ûÂûã</h3>
                    <div class="document-types-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                        <!-- Bank statements -->
                        <div class="doc-type-card" data-type="bank_statement" onclick="selectDocumentType('bank_statement')" style="background: #ffffff; border: 2px solid #e5e7eb; border-radius: 12px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease; position: relative;">
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <div style="font-size: 1.5rem;">üè¶</div>
                                <div style="font-weight: 600; color: #1f2937; font-size: 1rem;">Bank statements</div>
                                <div style="font-size: 0.875rem; color: #6b7280; line-height: 1.4;">Convert bank statements to excel and csv</div>
                            </div>
                            <div class="selected-indicator" style="display: none; position: absolute; top: 0.75rem; right: 0.75rem; width: 24px; height: 24px; background: #3b82f6; border-radius: 50%; color: white; align-items: center; justify-content: center; font-size: 0.875rem;">‚úì</div>
                        </div>
                        
                        <!-- Invoices -->
                        <div class="doc-type-card" data-type="invoice" onclick="selectDocumentType('invoice')" style="background: #ffffff; border: 2px solid #e5e7eb; border-radius: 12px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease; position: relative;">
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <div style="font-size: 1.5rem;">üìÑ</div>
                                <div style="font-weight: 600; color: #1f2937; font-size: 1rem;">Invoices</div>
                                <div style="font-size: 0.875rem; color: #6b7280; line-height: 1.4;">Extract numbers, dates, item details, prices, and vendor information</div>
                            </div>
                            <div class="selected-indicator" style="display: none; position: absolute; top: 0.75rem; right: 0.75rem; width: 24px; height: 24px; background: #3b82f6; border-radius: 50%; color: white; align-items: center; justify-content: center; font-size: 0.875rem;">‚úì</div>
                        </div>
                        
                        <!-- Receipts -->
                        <div class="doc-type-card" data-type="receipt" onclick="selectDocumentType('receipt')" style="background: #ffffff; border: 2px solid #e5e7eb; border-radius: 12px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease; position: relative;">
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <div style="font-size: 1.5rem;">üßæ</div>
                                <div style="font-weight: 600; color: #1f2937; font-size: 1rem;">Receipts</div>
                                <div style="font-size: 0.875rem; color: #6b7280; line-height: 1.4;">Classify dates, items, prices, and totals for financial management</div>
                            </div>
                            <div class="selected-indicator" style="display: none; position: absolute; top: 0.75rem; right: 0.75rem; width: 24px; height: 24px; background: #3b82f6; border-radius: 50%; color: white; align-items: center; justify-content: center; font-size: 0.875rem;">‚úì</div>
                        </div>
                        
                        <!-- General -->
                        <div class="doc-type-card" data-type="general" onclick="selectDocumentType('general')" style="background: #ffffff; border: 2px solid #e5e7eb; border-radius: 12px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease; position: relative;">
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <div style="font-size: 1.5rem;">üìã</div>
                                <div style="font-weight: 600; color: #1f2937; font-size: 1rem;">General</div>
                                <div style="font-size: 0.875rem; color: #6b7280; line-height: 1.4;">Extract text, tables, and other data from any document</div>
                            </div>
                            <div class="selected-indicator" style="display: none; position: absolute; top: 0.75rem; right: 0.75rem; width: 24px; height: 24px; background: #3b82f6; border-radius: 50%; color: white; align-items: center; justify-content: center; font-size: 0.875rem;">‚úì</div>
                        </div>
                    </div>
                </div>
                
                <!-- ‰∏äÂÇ≥ÂçÄÂüü -->
                <div id="aiUploadArea" class="ai-upload-area" style="border: 3px dashed #d1d5db; border-radius: 12px; padding: 3rem 2rem; text-align: center; cursor: pointer; transition: all 0.3s ease; background: #fafafa;">
                    <div class="ai-upload-icon" style="font-size: 4rem; margin-bottom: 1rem;">üìÑ</div>
                    <div class="ai-upload-text" style="font-size: 1.2rem; color: #374151; margin-bottom: 0.5rem; font-weight: 600;">ÊãñÊîæÊñá‰ª∂Âà∞Ê≠§ËôïÊàñÈªûÊìä‰∏äÂÇ≥</div>
                    <div class="ai-upload-hint" style="color: #6b7280; font-size: 0.9rem;">ÊîØÊè¥ PDF„ÄÅJPG„ÄÅPNG Ê†ºÂºè (ÊúÄÂ§ß 20MB)</div>
                    <input type="file" id="aiFileInput" class="ai-file-input" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
                </div>

                <!-- ËôïÁêÜÈÄ≤Â∫¶ -->
                <div id="aiProgressContainer" class="ai-progress-container" style="display: none; margin-top: 2rem;">
                    <div class="ai-progress-steps" style="display: flex; justify-content: space-between; margin-bottom: 1.5rem;">
                        <div class="ai-step" data-step="1" style="flex: 1; text-align: center; opacity: 0.4; transition: all 0.3s ease;">
                            <div class="ai-step-icon" style="font-size: 2.5rem; margin-bottom: 0.5rem; position: relative; display: inline-block;">üì§</div>
                            <div class="ai-step-text" style="font-size: 0.875rem; color: #6b7280; font-weight: 500;">Êñá‰ª∂‰∏äÂÇ≥</div>
                        </div>
                        <div class="ai-step" data-step="2" style="flex: 1; text-align: center; opacity: 0.4; transition: all 0.3s ease;">
                            <div class="ai-step-icon" style="font-size: 2.5rem; margin-bottom: 0.5rem; position: relative; display: inline-block;">ü§ñ</div>
                            <div class="ai-step-text" style="font-size: 0.875rem; color: #6b7280; font-weight: 500;">AI ÂàÜÊûê</div>
                        </div>
                        <div class="ai-step" data-step="3" style="flex: 1; text-align: center; opacity: 0.4; transition: all 0.3s ease;">
                            <div class="ai-step-icon" style="font-size: 2.5rem; margin-bottom: 0.5rem; position: relative; display: inline-block;">üìä</div>
                            <div class="ai-step-text" style="font-size: 0.875rem; color: #6b7280; font-weight: 500;">Êï∏ÊìöÊèêÂèñ</div>
                        </div>
                        <div class="ai-step" data-step="4" style="flex: 1; text-align: center; opacity: 0.4; transition: all 0.3s ease;">
                            <div class="ai-step-icon" style="font-size: 2.5rem; margin-bottom: 0.5rem; position: relative; display: inline-block;">‚òÅÔ∏è</div>
                            <div class="ai-step-text" style="font-size: 0.875rem; color: #6b7280; font-weight: 500;">Èõ≤Á´ØÂ≠òÂÑ≤</div>
                        </div>
                    </div>
                    <div class="ai-progress-bar" style="width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden;">
                        <div class="ai-progress-fill" id="aiProgressFill" style="height: 100%; background: linear-gradient(90deg, #4f46e5 0%, #7c3aed 100%); transition: width 0.5s ease; width: 0%;"></div>
                    </div>
                </div>

                <!-- ËôïÁêÜÊó•Ë™å -->
                <div id="aiLogContainer" class="ai-log-container" style="display: none; margin-top: 1.5rem; background: #1f2937; border-radius: 8px; padding: 1rem; max-height: 200px; overflow-y: auto;">
                    <div class="ai-log-header" style="color: #9ca3af; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">ËôïÁêÜÊó•Ë™å</div>
                    <div id="aiLogContent" class="ai-log-content" style="font-family: 'Monaco', 'Courier New', monospace; font-size: 0.75rem; color: #d1d5db; line-height: 1.6;"></div>
                </div>

                <!-- ÊèêÂèñÁµêÊûú -->
                <div id="aiResultsContainer" class="ai-results-container" style="display: none; margin-top: 1.5rem; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                    <div class="ai-results-header" style="background: #f9fafb; padding: 1rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">üìä ÊèêÂèñÁöÑÊï∏Êìö</div>
                    <div id="aiResultsContent" class="ai-results-content" style="padding: 1.5rem; max-height: 300px; overflow-y: auto;"></div>
                    <div class="ai-results-actions" style="display: flex; gap: 1rem; padding: 1rem; background: #f9fafb; border-top: 1px solid #e5e7eb;">
                        <button class="ai-btn ai-btn-primary" onclick="saveAIResults()" style="flex: 1; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.2s; background: #4f46e5; color: white;">
                            <i class="fas fa-save"></i> ‰øùÂ≠òÂà∞È†ÖÁõÆ
                        </button>
                        <button class="ai-btn ai-btn-secondary" onclick="resetAIUpload()" style="flex: 1; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.2s; background: #f3f4f6; color: #374151;">
                            <i class="fas fa-redo"></i> ËôïÁêÜÂè¶‰∏ÄÂÄãÊñá‰ª∂
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Á´ãÂç≥Âü∑Ë°åÁöÑÈ†ÅÈù¢ÂèØË¶ãÊÄßËÖ≥Êú¨
        (function() {
            document.documentElement.style.cssText = 'display: block !important; visibility: visible !important;';
            document.body.style.cssText = 'display: block !important; visibility: visible !important; background: #ffffff;';
            
            // Á´ãÂç≥Á¢∫Ë™çÊ®°ÊÖãÊ°ÜÂ≠òÂú®
            console.log('üöÄ Body ÈñãÂßãËºâÂÖ•ÔºåÁ´ãÂç≥Ê™¢Êü•Ê®°ÊÖãÊ°Ü');
            const immediateCheck = document.getElementById('aiUploadModal');
            console.log('‚ö° Á´ãÂç≥Ê™¢Êü•ÁµêÊûú:', immediateCheck ? '‚úÖ Ê®°ÊÖãÊ°ÜÂ∑≤Âú® DOM ‰∏≠' : '‚ùå Ê®°ÊÖãÊ°Ü‰∏çÂ≠òÂú®');
        })();
    </script>

    <!-- Â∞éËà™Ê¨Ñ -->
    <div id="navbar-placeholder">
        <!-- Fallback Â∞éËà™Ê¨Ñ -->
        <nav class="fallback-navbar" style="position: fixed; top: 0; left: 0; right: 0; height: 60px; background: #ffffff; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between; padding: 0 2rem; z-index: 1000;">
            <div class="navbar-left" style="display: flex; align-items: center;">
                <div class="logo" style="display: flex; align-items: center; gap: 0.75rem;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; font-weight: bold;">VC</div>
                    <div>
                        <div style="font-size: 1.25rem; font-weight: 700; color: #1f2937;">VaultCaddy</div>
                        <div style="font-size: 0.75rem; color: #6b7280;">AI DOCUMENT PROCESSING</div>
                    </div>
                </div>
            </div>
            <div class="navbar-right" style="display: flex; align-items: center; gap: 1rem;">
                <span id="navbar-page-title" style="color: #6b7280;">Team Project</span>
                <div style="width: 32px; height: 32px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">C</div>
            </div>
        </nav>
    </div>

    <!-- Dashboard ÂÆπÂô® -->
    <div class="dashboard-container" style="display: flex !important; min-height: calc(100vh - 60px); background: #ffffff; padding-top: 60px; visibility: visible !important;">
        <!-- Â∑¶ÂÅ¥ÈÇäÊ¨Ñ (Áî± sidebar-component.js ÂãïÊÖãÁîüÊàê) -->
        <aside class="sidebar"></aside>

        <!-- ‰∏ªÂÖßÂÆπÂçÄÂüü -->
        <main class="main-content" id="main-content" style="flex: 1; background: #ffffff; overflow-y: auto; min-height: calc(100vh - 60px); display: block !important; visibility: visible !important;">
            <!-- ÊñáÊ™îÂàóË°®Ë¶ñÂúñ -->
            <div id="document-list-view" class="view-container" style="display: none;">
                <!-- È†ÅÈù¢Ê®ôÈ°å -->
                <header class="page-header">
                    <div class="header-left">
                        <div class="team-info">
                            <div class="team-icon">
                                <i class="fas fa-folder"></i>
                            </div>
                            <div class="team-details">
                                <h1 id="project-title">Project</h1>
                                <span class="subscription-badge" id="subscription-badge">Free</span>
                            </div>
                        </div>
                    </div>
                    <div class="header-right">
                        <button class="project-btn" onclick="confirmDeleteProject()" style="background: #ef4444;">
                            <i class="fas fa-trash"></i>
                            <span>Delete</span>
                        </button>
                    </div>
                </header>

                <!-- ÊéßÂà∂Ê¨Ñ -->
                <div class="controls-bar">
                    <div class="search-filter">
                        <input type="text" data-translate-placeholder="filter_document_name" placeholder="ÁØ©ÈÅ∏ÊñáÊ™îÂêçÁ®±..." class="filter-input" id="filter-input">
                    </div>
                    <div class="actions">
                        <button class="upload-btn" onclick="openUploadModal()">
                            <i class="fas fa-upload"></i>
                            <span data-translate="upload_files">‰∏äÂÇ≥Êñá‰ª∂</span>
                        </button>
                        <button class="view-btn" onclick="toggleView()">
                            <i class="fas fa-list"></i>
                            <span data-translate="view">Ê™¢Ë¶ñ</span>
                        </button>
                    </div>
                </div>

                <!-- ÊñáÊ™îË°®Ê†ºË¶ñÂúñ -->
                <div class="documents-table-container" style="background: #ffffff;">
                    <table class="documents-table" id="documents-table" style="width: 100%; border-collapse: collapse; background: #ffffff;">
                        <thead style="background: #ffffff; border-bottom: 2px solid #e5e7eb;">
                            <tr>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                    <input type="checkbox" id="select-all" onchange="toggleSelectAll()" style="margin-right: 0.5rem;">
                                    Document
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                                </th>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                    Statement Period
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                                </th>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                    Reconciliation
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                                </th>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                    Balance Info
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                                </th>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                    Status
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                                </th>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                    Review Status
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                                </th>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                    Notes
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                                </th>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                    Date Uploaded
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                                </th>
                                <th style="text-align: center; padding: 1rem; font-weight: 600; color: #374151;">
                                    Actions
                                </th>
                            </tr>
                        </thead>
                        <tbody id="documents-tbody">
                            <!-- ÊñáÊ™îÂ∞áÂãïÊÖãËºâÂÖ•Âà∞ÈÄôË£° -->
                        </tbody>
                    </table>
                    
                    <!-- Á©∫ÁãÄÊÖã -->
                    <div class="empty-state" id="empty-state" style="display: none; text-align: center; padding: 4rem 2rem; background: #ffffff;">
                        <div class="empty-content">
                            <i class="fas fa-file-alt" style="font-size: 3rem; color: #d1d5db; margin-bottom: 1rem;"></i>
                            <h3 style="font-size: 1.25rem; font-weight: 600; color: #374151; margin-bottom: 0.5rem;">No results.</h3>
                            <p style="color: #6b7280;">‰∏äÂÇ≥ÊÇ®ÁöÑÁ¨¨‰∏ÄÂÄãÊñáÊ™îÈñãÂßã‰ΩøÁî®</p>
                        </div>
                    </div>
                </div>

                <!-- ÂàÜÈ†ÅÊéßÂà∂ -->
                <div class="pagination">
                    <div class="pagination-info">
                        <span id="selection-info">0 of 0 row(s) selected.</span>
                    </div>
                    <div class="pagination-controls">
                        <div class="rows-per-page">
                            <span>Rows per page</span>
                            <select id="rows-per-page" onchange="changeRowsPerPage()">
                                <option value="10">10</option>
                                <option value="25">25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                        <div class="page-info">
                            <span id="page-info">Page 1 of 0</span>
                        </div>
                        <div class="page-buttons">
                            <button class="page-btn" onclick="goToFirstPage()" disabled>
                                <i class="fas fa-angle-double-left"></i>
                            </button>
                            <button class="page-btn" onclick="goToPreviousPage()" disabled>
                                <i class="fas fa-angle-left"></i>
                            </button>
                            <button class="page-btn" onclick="goToNextPage()" disabled>
                                <i class="fas fa-angle-right"></i>
                            </button>
                            <button class="page-btn" onclick="goToLastPage()" disabled>
                                <i class="fas fa-angle-double-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Team Project Ë¶ñÂúñ -->
            <div id="team-project-view" class="view-container" style="display: block !important; visibility: visible !important; padding: 2rem 3rem; background: #ffffff;">
                <!-- È†ÅÈù¢Ê®ôÈ°å -->
                <header style="margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <h1 id="team-project-title" style="font-size: 2rem; font-weight: 700; color: #1f2937; margin: 0 0 0.5rem 0;">Project</h1>
                        <p style="color: #6b7280; font-size: 1rem; margin: 0;">Manage and view your documents</p>
                    </div>
                    <button onclick="confirmDeleteProject()" style="background: #ef4444; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-weight: 500;">
                        <i class="fas fa-trash"></i>
                        <span>Delete</span>
                    </button>
                </header>

                <!-- ÊéßÂà∂Ê¨Ñ -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <div style="flex: 1; max-width: 300px;">
                        <input type="text" placeholder="Filter document name..." style="width: 100%; padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 6px; background: #ffffff; color: #1f2937; font-size: 0.875rem;">
                    </div>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <button onclick="openUploadModal()" style="background: #8b5cf6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-weight: 500;">
                            <span>Upload files</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                        <div class="dropdown" style="position: relative;">
                            <button onclick="toggleExportMenu()" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-weight: 500;">
                                <i class="fas fa-download"></i>
                                <span>Export</span>
                                <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                            </button>
                            <div id="exportMenu" class="export-menu" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 0.5rem; background: white; border: 1px solid #e5e7eb; border-radius: 6px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); min-width: 200px; z-index: 1000;">
                                <div style="padding: 0.5rem 0;">
                                    <button onclick="exportDocuments('csv')" class="export-menu-item" style="width: 100%; text-align: left; padding: 0.75rem 1rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; gap: 0.75rem; color: #374151; transition: background 0.2s;">
                                        <i class="fas fa-file-csv" style="color: #10b981; width: 20px;"></i>
                                        <div>
                                            <div style="font-weight: 500;">CSV</div>
                                            <div style="font-size: 0.75rem; color: #6b7280;">ÈÄöÁî®Ê†ºÂºè</div>
                                        </div>
                                    </button>
                                    <button onclick="exportDocuments('iif')" class="export-menu-item" style="width: 100%; text-align: left; padding: 0.75rem 1rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; gap: 0.75rem; color: #374151; transition: background 0.2s;">
                                        <i class="fas fa-file-alt" style="color: #3b82f6; width: 20px;"></i>
                                        <div>
                                            <div style="font-weight: 500;">IIF</div>
                                            <div style="font-size: 0.75rem; color: #6b7280;">QuickBooks Desktop</div>
                                        </div>
                                    </button>
                                    <button onclick="exportDocuments('qbo')" class="export-menu-item" style="width: 100%; text-align: left; padding: 0.75rem 1rem; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; gap: 0.75rem; color: #374151; transition: background 0.2s;">
                                        <i class="fas fa-cloud" style="color: #8b5cf6; width: 20px;"></i>
                                        <div>
                                            <div style="font-weight: 500;">QBO</div>
                                            <div style="font-size: 0.75rem; color: #6b7280;">QuickBooks Online</div>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button style="background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; padding: 0.75rem 1rem; border-radius: 6px; display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <i class="fas fa-sliders-h"></i>
                            <span>View</span>
                        </button>
                        <button style="background: transparent; border: none; color: #6b7280; padding: 0.5rem; cursor: pointer; font-size: 1.25rem;">
                            <i class="fas fa-question-circle"></i>
                        </button>
                    </div>
                </div>

                <!-- ÊñáÊ™îË°®Ê†º -->
                <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead style="background: #f8fafc;">
                            <tr>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; font-size: 0.875rem;">
                                    <input type="checkbox" style="margin-right: 0.5rem;">
                                    <span>Document</span>
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af;"></i>
                                </th>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; font-size: 0.875rem;">
                                    <span>Statement Period</span>
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af;"></i>
                                </th>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; font-size: 0.875rem;">
                                    <span>Reconciliation</span>
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af;"></i>
                                </th>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; font-size: 0.875rem;">
                                    <span>Balance Info</span>
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af;"></i>
                                </th>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; font-size: 0.875rem;">
                                    <span>Status</span>
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af;"></i>
                                </th>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; font-size: 0.875rem;">
                                    <span>Review Status</span>
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af;"></i>
                                </th>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; font-size: 0.875rem;">
                                    <span>Notes</span>
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af;"></i>
                                </th>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; font-size: 0.875rem;">
                                    <span>Date Uploaded</span>
                                    <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af;"></i>
                                </th>
                                <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; font-size: 0.875rem;">
                                    <span>Actions</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="team-project-tbody">
                            <!-- Á©∫ÁãÄÊÖã -->
                            <tr>
                                <td colspan="9" style="text-align: center; padding: 4rem 2rem;">
                                    <div style="color: #6b7280;">
                                        <i class="fas fa-file-alt" style="font-size: 3rem; margin-bottom: 1rem; color: #d1d5db;"></i>
                                        <h3 style="font-size: 1.2rem; margin-bottom: 0.5rem; color: #374151;">No results.</h3>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ÂàÜÈ†ÅÊéßÂà∂ -->
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; margin-top: 1rem;">
                    <div>
                        <span style="color: #6b7280; font-size: 0.875rem;">0 of 0 row(s) selected.</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="color: #6b7280; font-size: 0.875rem;">Rows per page</span>
                            <select style="background: #ffffff; border: 1px solid #d1d5db; color: #1f2937; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.875rem;">
                                <option value="10">10</option>
                                <option value="25">25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                        <div>
                            <span style="color: #374151; font-size: 0.875rem;">Page 1 of 0</span>
                        </div>
                        <div style="display: flex; gap: 0.25rem;">
                            <button disabled style="background: transparent; border: 1px solid #d1d5db; color: #9ca3af; padding: 0.5rem; border-radius: 4px; cursor: not-allowed;">
                                <i class="fas fa-angle-double-left"></i>
                            </button>
                            <button disabled style="background: transparent; border: 1px solid #d1d5db; color: #9ca3af; padding: 0.5rem; border-radius: 4px; cursor: not-allowed;">
                                <i class="fas fa-angle-left"></i>
                            </button>
                            <button disabled style="background: transparent; border: 1px solid #d1d5db; color: #9ca3af; padding: 0.5rem; border-radius: 4px; cursor: not-allowed;">
                                <i class="fas fa-angle-right"></i>
                            </button>
                            <button disabled style="background: transparent; border: 1px solid #d1d5db; color: #9ca3af; padding: 0.5rem; border-radius: 4px; cursor: not-allowed;">
                                <i class="fas fa-angle-double-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÈäÄË°åÂ∞çÂ∏≥ÂñÆË¶ñÂúñ -->
            <div id="bank-statement-view" class="view-container" style="display: none;">
                <!-- È†ÅÈù¢Ê®ôÈ°å -->
                <header class="page-header" style="padding: 2rem; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                    <div class="header-left">
                        <div class="team-info" style="display: flex; align-items: center; gap: 1rem;">
                            <div class="team-icon" style="width: 48px; height: 48px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="team-details">
                                <h1 id="team-name" style="font-size: 1.5rem; font-weight: 700; color: #1f2937; margin: 0;">1Êâ≠Êâ≠Êâπ's team</h1>
                                <span class="subscription-badge" id="subscription-badge" style="background: #6b7280; color: white; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.75rem; font-weight: 600;">Free</span>
                            </div>
                        </div>
                    </div>
                    <div class="header-right">
                        <button class="project-btn" onclick="createNewProject()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-weight: 500;">
                            <i class="fas fa-plus"></i>
                            <span>+ Project</span>
                        </button>
                    </div>
                </header>

                <!-- ÊéßÂà∂Ê¨Ñ -->
                <div class="controls-bar" style="padding: 1rem 2rem; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                    <div class="search-filter">
                        <input type="text" placeholder="ÁØ©ÈÅ∏ÊñáÊ™îÂêçÁ®±..." class="filter-input" id="filter-input" style="background: #ffffff; border: 1px solid #d1d5db; color: #1f2937; padding: 0.5rem 1rem; border-radius: 6px; width: 300px;">
                    </div>
                    <div class="actions" style="display: flex; gap: 1rem; align-items: center;">
                        <button class="upload-btn" onclick="openUploadModal()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-weight: 500;">
                            <i class="fas fa-upload"></i>
                            <span>‰∏äÂÇ≥Êñá‰ª∂</span>
                        </button>
                        <button class="view-btn" onclick="toggleView()" style="background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; padding: 0.75rem 1rem; border-radius: 6px; display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <i class="fas fa-list"></i>
                            <span>Ê™¢Ë¶ñ</span>
                        </button>
                    </div>
                </div>

                <!-- ÊñáÊ™îË°®Ê†ºË¶ñÂúñ -->
                <div class="documents-table-container" style="padding: 2rem; background: #ffffff; flex: 1; overflow-x: auto;">
                <table class="documents-table" id="documents-table" style="width: 100%; border-collapse: collapse; background: #ffffff; border-radius: 8px; overflow: hidden; border: 1px solid #e5e7eb;">
                    <thead style="background: #ffffff; border-bottom: 2px solid #e5e7eb;">
                        <tr>
                            <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                <input type="checkbox" id="select-all-2" onchange="toggleSelectAll()" style="margin-right: 0.5rem;">
                                Document
                                <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                            </th>
                            <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                Statement Period
                                <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                            </th>
                            <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                Reconciliation
                                <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                            </th>
                            <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                Balance Info
                                <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                            </th>
                            <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                Status
                                <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                            </th>
                            <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                Review Status
                                <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                            </th>
                            <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                Notes
                                <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                            </th>
                            <th style="text-align: left; padding: 1rem; font-weight: 600; color: #374151; white-space: nowrap;">
                                Date Uploaded
                                <i class="fas fa-sort" style="margin-left: 0.5rem; color: #9ca3af; font-size: 0.75rem;"></i>
                            </th>
                            <th style="text-align: center; padding: 1rem; font-weight: 600; color: #374151;">
                                Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody id="documents-tbody">
                        <!-- ÊñáÊ™îÂ∞áÂãïÊÖãËºâÂÖ•Âà∞ÈÄôË£° -->
                    </tbody>
                </table>
                
                <!-- Á©∫ÁãÄÊÖã -->
                <div class="empty-state" id="empty-state" style="display: none; text-align: center; padding: 4rem 2rem; color: #6b7280; background: #ffffff;">
                    <div class="empty-content">
                        <i class="fas fa-file-alt" style="font-size: 3rem; margin-bottom: 1rem; color: #d1d5db;"></i>
                        <h3 style="font-size: 1.2rem; margin-bottom: 0.5rem; color: #374151;">No results.</h3>
                        <p style="color: #6b7280; font-size: 0.9rem;">‰∏äÂÇ≥ÊÇ®ÁöÑÁ¨¨‰∏ÄÂÄãÊñáÊ™îÈñãÂßã‰ΩøÁî®</p>
                    </div>
                </div>
                
                <!-- ÂàÜÈ†ÅÊéßÂà∂ -->
                <div class="pagination" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; border-top: 1px solid #e5e7eb; background: #ffffff;">
                    <div class="pagination-info">
                        <span id="selection-info" style="color: #6b7280;">0 of 0 row(s) selected.</span>
                    </div>
                    <div class="pagination-controls" style="display: flex; align-items: center; gap: 1rem;">
                        <div class="rows-per-page" style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="color: #6b7280;">Rows per page</span>
                            <select id="rows-per-page" onchange="changeRowsPerPage()" style="background: #ffffff; border: 1px solid #d1d5db; color: #1f2937; padding: 0.25rem 0.5rem; border-radius: 4px;">
                                <option value="10">10</option>
                                <option value="25">25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                        <div class="page-info">
                            <span id="page-info" style="color: #374151;">Page 1 of 0</span>
                        </div>
                        <div class="page-buttons" style="display: flex; gap: 0.25rem;">
                            <button class="page-btn" onclick="goToFirstPage()" disabled style="background: transparent; border: 1px solid #d1d5db; color: #9ca3af; padding: 0.5rem; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-angle-double-left"></i>
                            </button>
                            <button class="page-btn" onclick="goToPreviousPage()" disabled style="background: transparent; border: 1px solid #d1d5db; color: #9ca3af; padding: 0.5rem; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-angle-left"></i>
                            </button>
                            <button class="page-btn" onclick="goToNextPage()" disabled style="background: transparent; border: 1px solid #d1d5db; color: #9ca3af; padding: 0.5rem; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-angle-right"></i>
                            </button>
                            <button class="page-btn" onclick="goToLastPage()" disabled style="background: transparent; border: 1px solid #d1d5db; color: #9ca3af; padding: 0.5rem; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-angle-double-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ‰∏äÂÇ≥Êñá‰ª∂Ê®°ÊÖãÊ°Ü -->
    <div id="upload-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‰∏äÂÇ≥Êñá‰ª∂</h2>
                <button class="close-btn" onclick="closeUploadModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="file-drop-area">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h3>ÊãñÊîæÊñá‰ª∂Âà∞Ê≠§ËôïÊàñÈªûÊìäÈÅ∏Êìá</h3>
                    <p>ÊîØÊè¥ PDF, PNG, JPG Ê†ºÂºè</p>
                    <input type="file" id="file-input" multiple accept=".pdf,.png,.jpg,.jpeg" style="display: none;">
                    <button class="upload-file-btn" onclick="document.getElementById('file-input').click()">ÈÅ∏ÊìáÊñá‰ª∂</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÁôªÂÖ•ÁãÄÊÖãÊ™¢Êü• - ‰ΩøÁî®ÂÖ®ÂüüÂêåÊ≠•Á≥ªÁµ±
        function checkLoginStatus() {
            console.log('üîç Dashboard Ê™¢Êü•Ë∫´‰ªΩÈ©óË≠âÁãÄÊÖã...');
            
            // ‰ΩøÁî®ÂÖ®ÂüüË∫´‰ªΩÈ©óË≠âÂêåÊ≠•Á≥ªÁµ±
            if (window.GlobalAuthSync) {
                const globalState = window.GlobalAuthSync.getCurrentAuthState();
                console.log('üåê Dashboard ÂÖ®ÂüüË∫´‰ªΩÈ©óË≠âÁãÄÊÖã:', globalState);
                return globalState.isAuthenticated;
            }
            
            // ÂÖúÂ∫ïÈÇèËºØÔºöÂ¶ÇÊûúÂÖ®ÂüüÁ≥ªÁµ±Êú™ËºâÂÖ•Ôºå‰ΩøÁî®Êú¨Âú∞Ê™¢Êü•
            console.log('‚ö†Ô∏è ÂÖ®ÂüüÂêåÊ≠•Á≥ªÁµ±Êú™ËºâÂÖ•Ôºå‰ΩøÁî®Êú¨Âú∞Ê™¢Êü•');
            return window.checkGlobalAuthState ? window.checkGlobalAuthState() : true;
        }

        // ÊñáÊ™îÈ°ûÂûãÈÖçÁΩÆ
        const documentTypes = {
            'bank-statement': {
                titleKey: 'bank_statement_processor',
                subtitleKey: 'manage_view_documents',
                title: 'ÈäÄË°åÂ∞çÂ∏≥ÂñÆËôïÁêÜÂô®',
                subtitle: 'ÁÆ°ÁêÜÂíåÊü•ÁúãÊÇ®ÁöÑÊñáÊ™î',
                icon: 'fas fa-university'
            }
        };

        // Ë®ÇÈñ±ÊñπÊ°àÈÖçÁΩÆ
        const subscriptionPlans = {
            'free': {
                name: 'Free',
                color: '#6b7280',
                features: ['Âü∫Á§éÊñáÊ™îËôïÁêÜ', 'ÊØèÊúà10ÂÄãÊñáÊ™î']
            },
            'basic': {
                name: 'Basic',
                color: '#10b981',
                features: ['ÈÄ≤ÈöéÊñáÊ™îËôïÁêÜ', 'ÊØèÊúà100ÂÄãÊñáÊ™î']
            },
            'professional': {
                name: 'Professional',
                color: '#3b82f6',
                features: ['AIÊô∫ËÉΩËôïÁêÜ', 'ÁÑ°ÈôêÊñáÊ™î', 'ÂÑ™ÂÖàÊîØÊè¥']
            },
            'business': {
                name: 'Business',
                color: '#8b5cf6',
                features: ['‰ºÅÊ•≠Á¥öÂäüËÉΩ', 'ÂúòÈöäÂçî‰Ωú', 'APIÂ≠òÂèñ']
            }
        };

        // È†ÅÈù¢ÂàùÂßãÂåñ
        // Á´ãÂç≥Âü∑Ë°åÔºöÁ¢∫‰øùÈ†ÅÈù¢ÂèØË¶ã
        (function() {
            console.log('üöÄ Á´ãÂç≥ÂàùÂßãÂåñÈ†ÅÈù¢...');
            
            // Á¢∫‰øùbodyÂèØË¶ã
            document.body.style.display = 'block';
            document.body.style.visibility = 'visible';
            
            // Á¢∫‰øùdashboardÂÆπÂô®ÂèØË¶ã
            const dashboardContainer = document.querySelector('.dashboard-container');
            if (dashboardContainer) {
                dashboardContainer.style.display = 'flex';
                dashboardContainer.style.visibility = 'visible';
            }
            
            // Á¢∫‰øùÂÅ¥ÈÇäÊ¨ÑÂèØË¶ã
            const sidebar = document.querySelector('.sidebar');
            if (sidebar) {
                sidebar.style.display = 'block';
                sidebar.style.visibility = 'visible';
            }
            
            // Á¢∫‰øù‰∏ªÂÖßÂÆπÂèØË¶ã
            const mainContent = document.getElementById('main-content');
            if (mainContent) {
                mainContent.style.display = 'block';
                mainContent.style.visibility = 'visible';
            }
            
            console.log('‚úÖ È†ÅÈù¢Á´ãÂç≥ÂàùÂßãÂåñÂÆåÊàê');
        })();

        // Áç≤ÂèñÁï∂ÂâçÈ†ÖÁõÆ ID
        function getCurrentProjectId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('project');
        }

        // Áç≤ÂèñÁï∂ÂâçÈ†ÖÁõÆ‰ø°ÊÅØ
        function getCurrentProject() {
            const projectId = getCurrentProjectId();
            if (!projectId) return null;
            
            const projects = JSON.parse(localStorage.getItem('vaultcaddy_projects') || '[]');
            return projects.find(p => p.id === projectId);
        }

        // Êõ¥Êñ∞È†ÅÈù¢Ê®ôÈ°åÁÇ∫È†ÖÁõÆÂêçÁ®±
        function updateProjectTitle() {
            const project = getCurrentProject();
            if (project) {
                // Êõ¥Êñ∞ document-list-view ‰∏≠ÁöÑÊ®ôÈ°å
                const projectTitle = document.getElementById('project-title');
                if (projectTitle) {
                    projectTitle.textContent = project.name;
                }
                
                // Êõ¥Êñ∞ team-project-view ‰∏≠ÁöÑÊ®ôÈ°å
                const teamProjectTitle = document.getElementById('team-project-title');
                if (teamProjectTitle) {
                    teamProjectTitle.textContent = project.name;
                }
                
                console.log('‚úÖ È†ÖÁõÆÊ®ôÈ°åÂ∑≤Êõ¥Êñ∞:', project.name);
            }
        }

        // Á¢∫Ë™çÂà™Èô§È†ÖÁõÆ
        function confirmDeleteProject() {
            const project = getCurrentProject();
            if (!project) {
                alert('ÁÑ°Ê≥ïÊâæÂà∞Áï∂ÂâçÈ†ÖÁõÆ');
                return;
            }
            
            const confirmed = confirm(`ÊòØÂê¶Âà™Èô§È†ÖÁõÆ„Äå${project.name}„ÄçÔºü\n\nÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÊí§Èä∑„ÄÇ`);
            if (confirmed) {
                deleteProject(project.id);
            }
        }

        // Âà™Èô§È†ÖÁõÆ
        function deleteProject(projectId) {
            // Âæû localStorage Áç≤ÂèñÈ†ÖÁõÆÂàóË°®
            const projects = JSON.parse(localStorage.getItem('vaultcaddy_projects') || '[]');
            
            // ÈÅéÊøæÊéâË¶ÅÂà™Èô§ÁöÑÈ†ÖÁõÆ
            const updatedProjects = projects.filter(p => p.id !== projectId);
            
            // ‰øùÂ≠òÊõ¥Êñ∞ÂæåÁöÑÂàóË°®
            localStorage.setItem('vaultcaddy_projects', JSON.stringify(updatedProjects));
            
            // Ëß∏ÁôºÈ†ÖÁõÆÂà™Èô§‰∫ã‰ª∂ÔºåËÆìÂÅ¥ÈÇäÊ¨ÑÊõ¥Êñ∞
            window.dispatchEvent(new CustomEvent('projectDeleted', { 
                detail: { projectId } 
            }));
            
            console.log('‚úÖ È†ÖÁõÆÂ∑≤Âà™Èô§:', projectId);
            
            // ËøîÂõûÂà∞ dashboard
            window.location.href = 'dashboard.html';
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéØ Dashboard È†ÅÈù¢ËºâÂÖ•‰∏≠...');
            
            // ========== üîê Ë∫´‰ªΩÈ©óË≠âÊ™¢Êü•ÔºàÂº∑Âà∂Ôºâ ==========
            console.log('üîê === Âº∑Âà∂Ê™¢Êü•Ë∫´‰ªΩÈ©óË≠âÁãÄÊÖã ===');
            
            let isAuthenticated = false;
            
            if (window.GlobalAuthSync) {
                const authState = window.GlobalAuthSync.getCurrentAuthState();
                isAuthenticated = authState.isAuthenticated;
                console.log('   GlobalAuthSync ÁãÄÊÖã:', authState);
                console.log('   ÊòØÂê¶Â∑≤ÁôªÂÖ•:', isAuthenticated);
            } else {
                console.warn('   ‚ö†Ô∏è GlobalAuthSync Êú™ÊâæÂà∞ÔºåÊ™¢Êü•Êú¨Âú∞Â≠òÂÑ≤');
                const hasGoogleUser = !!localStorage.getItem('googleUser');
                const hasVaultcaddyUser = !!localStorage.getItem('vaultcaddyUser');
                isAuthenticated = hasGoogleUser || hasVaultcaddyUser;
                console.log('   localStorage Ê™¢Êü• - GoogleÁî®Êà∂:', hasGoogleUser, ', VaultCaddyÁî®Êà∂:', hasVaultcaddyUser);
                console.log('   ÊòØÂê¶Â∑≤ÁôªÂÖ•:', isAuthenticated);
            }
            
            // Â¶ÇÊûúÊú™ÁôªÂÖ•ÔºåÂº∑Âà∂ÈáçÂÆöÂêëÂà∞ÁôªÂÖ•È†ÅÈù¢
            if (!isAuthenticated) {
                console.error('‚ùå Áî®Êà∂Êú™ÁôªÂÖ•ÔºåÂº∑Âà∂ÈáçÂÆöÂêëÂà∞ÁôªÂÖ•È†ÅÈù¢');
                alert('Ë´ãÂÖàÁôªÂÖ•ÊâçËÉΩË®™ÂïèÊ≠§È†ÅÈù¢');
                window.location.href = 'index.html';
                return; // ÂÅúÊ≠¢Âü∑Ë°åÂæåÁ∫å‰ª£Á¢º
            }
            
            console.log('‚úÖ Ë∫´‰ªΩÈ©óË≠âÈÄöÈÅéÔºåÁπºÁ∫åËºâÂÖ•È†ÅÈù¢');
            console.log('');
            
            // Ê™¢Êü•Ê®°ÊÖãÊ°ÜÊòØÂê¶Â≠òÂú®
            const modalCheck = document.getElementById('aiUploadModal');
            console.log('üîç DOMContentLoaded ÊôÇÊ®°ÊÖãÊ°ÜÊ™¢Êü•:', modalCheck ? '‚úÖ Â≠òÂú®' : '‚ùå ‰∏çÂ≠òÂú®');
            if (modalCheck) {
                console.log('üìã Ê®°ÊÖãÊ°ÜË©≥ÊÉÖ:', {
                    id: modalCheck.id,
                    display: modalCheck.style.display,
                    ‰ΩçÁΩÆ: modalCheck.getBoundingClientRect()
                });
            } else {
                console.error('‚ùå Âö¥ÈáçÈåØË™§ÔºöÊ®°ÊÖãÊ°ÜÂú® DOMContentLoaded Âæå‰ªç‰∏çÂ≠òÂú®');
                console.error('üìä DOM Áµ±Ë®à:', {
                    Á∏ΩÂÖÉÁ¥†Êï∏: document.getElementsByTagName('*').length,
                    bodyÂ≠òÂú®: !!document.body,
                    ÊâÄÊúâdivÊï∏Èáè: document.getElementsByTagName('div').length
                });
            }
            
            // Êõ¥Êñ∞È†ÖÁõÆÊ®ôÈ°å
            updateProjectTitle();
            
            // Á≠âÂæÖÂÖ®ÂüüÂêåÊ≠•Á≥ªÁµ±ËºâÂÖ•
            const initializeWithGlobalSync = () => {
                if (window.GlobalAuthSync) {
                    console.log('üåê ‰ΩøÁî®ÂÖ®ÂüüË∫´‰ªΩÈ©óË≠âÂêåÊ≠•Á≥ªÁµ±');
                    
                    // Áõ£ËÅΩÂÖ®ÂüüË∫´‰ªΩÈ©óË≠âÁãÄÊÖãËÆäÂåñ
                    window.onGlobalAuthChange((authState) => {
                        console.log('üîÑ Dashboard Êî∂Âà∞ÂÖ®ÂüüË∫´‰ªΩÈ©óË≠âÁãÄÊÖãËÆäÂåñ:', authState);
                        updateDashboardAuthState(authState);
                    });
                    
                    // ÂàùÂßãÊ™¢Êü•
                    const authResult = checkLoginStatus();
                    console.log('üéØ Dashboard ÂàùÂßãË∫´‰ªΩÈ©óË≠âÁµêÊûú:', authResult);
                    
                    if (!authResult) {
                        console.log('‚ö†Ô∏è Dashboard Êú™Ê™¢Ê∏¨Âà∞ÁôªÂÖ•ÁãÄÊÖãÔºåÈ°ØÁ§∫ÊèêÁ§∫');
                        showLoginPromptInDashboard();
                    }
                } else {
                    console.log('‚ö†Ô∏è ÂÖ®ÂüüÂêåÊ≠•Á≥ªÁµ±Êú™ËºâÂÖ•Ôºå‰ΩøÁî®ÂÖúÂ∫ïÈÇèËºØ');
                    // ÂÖúÂ∫ïÈÇèËºØ
                    const authResult = checkLoginStatus();
                    if (!authResult) {
                        showLoginPromptInDashboard();
                    }
                }
            };
            
            // Â¶ÇÊûúÂÖ®ÂüüÂêåÊ≠•Á≥ªÁµ±Â∑≤ËºâÂÖ•ÔºåÁ´ãÂç≥ÂàùÂßãÂåñÔºõÂê¶ÂâáÁ≠âÂæÖ
            if (window.GlobalAuthSync) {
                initializeWithGlobalSync();
            } else {
                setTimeout(initializeWithGlobalSync, 100);
            }

            // ÂàùÂßãÂåñÁµ±‰∏ÄÂÅ¥ÈÇäÊ¨Ñ
            window.unifiedSidebar = new VaultCaddySidebar();
            
            // ÂàùÂßãÂåñÁî®Êà∂ÂúòÈöä‰ø°ÊÅØ
            initializeUserTeamInfo();
            
            // ËôïÁêÜ hash Ë∑ØÁî±
            handleHashRouting();
            
            // Á¢∫‰øùÈ†ÅÈù¢ÂÖßÂÆπÂèØË¶ã
            ensurePageContentVisible();
            
            // Áõ£ËÅΩ hash ËÆäÂåñ
            window.addEventListener('hashchange', handleHashRouting);
            
            // Áõ£ËÅΩË™ûË®ÄËÆäÊõ¥‰∫ã‰ª∂
            window.addEventListener('languageChanged', function(e) {
                console.log('Dashboard: Ë™ûË®ÄÂ∑≤ËÆäÊõ¥ÁÇ∫', e.detail.language);
                // Ë™ûË®ÄËÆäÊõ¥ÊôÇÈáçÊñ∞ÊáâÁî®Áï∂ÂâçÊñáÊ™îÈ°ûÂûãÁöÑÁøªË≠Ø
                const hash = window.location.hash.substring(1);
                const docType = hash || 'bank-statement';
                if (documentTypes[docType]) {
                    updatePageForDocumentType(docType);
                }
                // Ê≥®ÊÑèÔºöÂÅ¥ÈÇäÊ¨ÑÁöÑË™ûË®ÄÊõ¥Êñ∞Áî± VaultCaddySidebar ÁöÑ setupLanguageListener ËôïÁêÜ
            });
            
            console.log('‚úÖ Unified Dashboard ÂàùÂßãÂåñÂÆåÊàê');
        });

        // ÂàùÂßãÂåñÁî®Êà∂ÂúòÈöä‰ø°ÊÅØ
        function initializeUserTeamInfo() {
            console.log('üë• ÂàùÂßãÂåñÁî®Êà∂ÂúòÈöä‰ø°ÊÅØ...');
            
            // Áç≤ÂèñÁî®Êà∂ÂêçÁ®±
            let userName = '1Êâ≠Êâ≠Êâπ'; // ÈªòË™çÂêçÁ®±
            
            if (window.GlobalAuthSync) {
                const authState = window.GlobalAuthSync.getCurrentAuthState();
                if (authState.userName && !authState.userName.includes('{"uid"')) {
                    userName = authState.userName;
                }
            } else {
                // ÂæûlocalStorageÁç≤Âèñ
                const storedName = localStorage.getItem('google_user_name') || localStorage.getItem('user_name');
                if (storedName && !storedName.includes('{"uid"')) {
                    userName = storedName;
                }
            }
            
            // ÁîüÊàêÂúòÈöäÂêçÁ®±
            const teamName = `${userName}'s team`;
            
            // Êõ¥Êñ∞ÂúòÈöäÂêçÁ®±È°ØÁ§∫
            const teamNameElement = document.getElementById('team-name');
            if (teamNameElement) {
                teamNameElement.textContent = teamName;
                console.log('‚úÖ ÂúòÈöäÂêçÁ®±Â∑≤Êõ¥Êñ∞:', teamName);
            }
            
            // Áç≤Âèñ‰∏¶Ë®≠ÁΩÆË®ÇÈñ±ÊñπÊ°à
            let subscriptionPlan = 'free'; // ÈªòË™çÁÇ∫ÂÖçË≤ªÁâà
            
            if (window.GlobalAuthSync) {
                const authState = window.GlobalAuthSync.getCurrentAuthState();
                subscriptionPlan = authState.subscriptionPlan || 'free';
            } else {
                subscriptionPlan = localStorage.getItem('vaultcaddy_subscription') || 'free';
            }
            
            // Êõ¥Êñ∞Ë®ÇÈñ±ÊñπÊ°àÈ°ØÁ§∫
            updateSubscriptionBadge(subscriptionPlan);
            
            console.log('‚úÖ Áî®Êà∂ÂúòÈöä‰ø°ÊÅØÂàùÂßãÂåñÂÆåÊàê:', { teamName, subscriptionPlan });
        }
        
        // Êõ¥Êñ∞Ë®ÇÈñ±ÊñπÊ°àÊ®ôÁ±§
        function updateSubscriptionBadge(planKey) {
            const badgeElement = document.getElementById('subscription-badge');
            if (!badgeElement) return;
            
            const plan = subscriptionPlans[planKey];
            if (plan) {
                badgeElement.textContent = plan.name;
                badgeElement.style.background = plan.color;
                console.log('‚úÖ Ë®ÇÈñ±ÊñπÊ°àÂ∑≤Êõ¥Êñ∞:', plan.name);
            }
        }
        
        // ÂâµÂª∫Êñ∞È†ÖÁõÆ
        function createNewProject() {
            console.log('üìÅ ÂâµÂª∫Êñ∞È†ÖÁõÆ...');
            // ÈÄôË£°ÂèØ‰ª•ÂØ¶ÁèæÂâµÂª∫Êñ∞È†ÖÁõÆÁöÑÈÇèËºØ
            alert('ÂâµÂª∫Êñ∞È†ÖÁõÆÂäüËÉΩÊ≠£Âú®ÈñãÁôº‰∏≠...');
        }

        // ËôïÁêÜ hash Ë∑ØÁî±
        function handleHashRouting() {
            console.log('üîÑ handleHashRouting Ë¢´Ë™øÁî®');
            console.log('üìç Áï∂Ââç URL:', window.location.href);
            console.log('üìç Hash:', window.location.hash);
            
            const hash = window.location.hash.substring(1); // ÁßªÈô§ #
            const docType = hash || 'bank-statement'; // ÈªòË™çÁÇ∫ÈäÄË°åÂ∞çÂ∏≥ÂñÆ
            
            console.log('üìç Ëß£ÊûêÁµêÊûú:', { hash, docType });
            console.log('üìç documentTypes:', documentTypes);
            console.log('üìç documentTypes[docType]:', documentTypes[docType]);
            
            if (documentTypes[docType]) {
                console.log('‚úÖ ÊâæÂà∞ÊñáÊ™îÈ°ûÂûãÔºåË™øÁî® updatePageForDocumentType');
                updatePageForDocumentType(docType);
            } else {
                console.error('‚ùå documentTypes ‰∏≠Êâæ‰∏çÂà∞:', docType);
            }
        }

        // Êõ¥Êñ∞È†ÅÈù¢ÁÇ∫ÊåáÂÆöÊñáÊ™îÈ°ûÂûã
        function updatePageForDocumentType(docType) {
            const config = documentTypes[docType];
            
            // Á¢∫‰øùÈ°ØÁ§∫ÊñáÊ™îÂàóË°®Ë¶ñÂúñÔºåÈö±ËóèË©≥Á¥∞Ë¶ñÂúñ
            const listView = document.getElementById('document-list-view');
            const detailView = document.getElementById('document-detail-view');
            
            if (listView && detailView) {
                listView.style.display = 'block';
                detailView.style.display = 'none';
            }
            
            // Êõ¥Êñ∞È†ÅÈù¢Ê®ôÈ°å - ÊîØÊåÅÂ§öË™ûË®Ä
            const titleElement = document.getElementById('page-title');
            const subtitleElement = document.getElementById('page-subtitle');
            
            if (titleElement) {
                titleElement.textContent = config.title;
                titleElement.setAttribute('data-translate', config.titleKey);
            }
            if (subtitleElement) {
                subtitleElement.textContent = config.subtitle;
                subtitleElement.setAttribute('data-translate', config.subtitleKey);
            }
            
            // Êõ¥Êñ∞ÁÄèË¶ΩÂô®Ê®ôÈ°å
            document.title = `${config.title} - VaultCaddy`;
            
            // Êõ¥Êñ∞ÂÅ¥ÈÇäÊ¨ÑÊ¥ªË∫çÁãÄÊÖã
            if (window.unifiedSidebar) {
                window.unifiedSidebar.updateActivePage(docType);
            }
            
            // ËºâÂÖ•Ë©≤ÊñáÊ™îÈ°ûÂûãÁöÑÊñá‰ª∂
            loadFilesForDocumentType(docType);
            
            // Â¶ÇÊûúË™ûË®ÄÁÆ°ÁêÜÂô®Â≠òÂú®ÔºåÈáçÊñ∞ÊáâÁî®ÁøªË≠Ø
            if (window.languageManager) {
                window.languageManager.loadLanguage(window.languageManager.currentLanguage);
            }
            
            console.log('‚úÖ Êõ¥Êñ∞È†ÅÈù¢È°ûÂûã:', docType, config.title);
        }
        
        // ËºâÂÖ•ÊåáÂÆöÊñáÊ™îÈ°ûÂûãÁöÑÊñá‰ª∂Â§æ
        function loadFilesForDocumentType(docType) {
            const documentsTable = document.getElementById('documents-table');
            const documentsTbody = document.getElementById('documents-tbody');
            const emptyState = document.getElementById('empty-state');
            
            if (!documentsTable || !documentsTbody) {
                console.error('Êâæ‰∏çÂà∞ÊñáÊ™îË°®Ê†ºÂÆπÂô®');
                return;
            }
            
            // Ê∏ÖÁ©∫ÁèæÊúâÂÖßÂÆπ
            documentsTbody.innerHTML = '';
            
            // Áç≤ÂèñÁï∂ÂâçÈ†ÖÁõÆ ID
            const projectId = getCurrentProjectId();
            if (!projectId) {
                console.warn('‚ö†Ô∏è ÁÑ°Ê≥ïÁç≤ÂèñÈ†ÖÁõÆ IDÔºåÁÑ°Ê≥ïËºâÂÖ•Êñá‰ª∂');
                // Ë°®Ê†ºÂßãÁµÇÈ°ØÁ§∫
                documentsTable.style.display = 'table';
                if (emptyState) emptyState.style.display = 'block';
                updatePaginationInfo(0);
                return;
            }
            
            // ÂæûÁï∂ÂâçÈ†ÖÁõÆÁöÑÂ≠òÂÑ≤ËºâÂÖ•Êñá‰ª∂
            let storedFiles = [];
            const projectStorageKey = `vaultcaddy_project_${projectId}_documents`;
            
            console.log(`üìÇ ÂæûÈ†ÖÁõÆ ${projectId} ËºâÂÖ•Êñá‰ª∂`);
            const projectDocuments = JSON.parse(localStorage.getItem(projectStorageKey) || '[]');
            
            // ËΩâÊèõÁÇ∫È°ØÁ§∫Ê†ºÂºèÔºà‰øùÁïôÊâÄÊúâÂéüÂßãÊï∏ÊìöÔºâ
            storedFiles = projectDocuments.map(doc => ({
                id: doc.id,
                name: doc.fileName || doc.name || 'Êú™ÂëΩÂêçÊñá‰ª∂',
                size: doc.fileSize || doc.size || 0,
                documentType: doc.documentType || docType,
                uploadDate: doc.createdAt,
                createdAt: doc.createdAt,
                isProcessing: doc.isProcessing || false,
                processingProgress: doc.processingProgress || 0,
                status: doc.status || 'completed',
                // ‰øùÁïôÊâÄÊúâÂéüÂßãÊï∏Êìö‰ΩúÁÇ∫ processedData
                processedData: doc,
                // ÂêåÊôÇ‰πüÂú®È†ÇÂ±§Êö¥Èú≤ÈóúÈçµÂ≠óÊÆµ‰ª•‰æøË®™Âïè
                ...doc
            }));
            
            console.log(`üìÅ È†ÖÁõÆ ${projectId} ËºâÂÖ•Êñá‰ª∂:`, storedFiles.length, 'ÂÄãÊñá‰ª∂');
            console.log('üìÑ Êñá‰ª∂Ë©≥ÊÉÖ:', storedFiles);
            
            // Ë°®Ê†ºÂßãÁµÇÈ°ØÁ§∫
            documentsTable.style.display = 'table';
            
            // Â¶ÇÊûúÊ≤íÊúâÊñá‰ª∂ÔºåÈ°ØÁ§∫Á©∫ÁãÄÊÖã
            if (storedFiles.length === 0) {
                console.log('‚ö†Ô∏è Ê≤íÊúâÊñá‰ª∂ÔºåÈ°ØÁ§∫Á©∫ÁãÄÊÖã');
                if (emptyState) emptyState.style.display = 'block';
                updatePaginationInfo(0);
                return;
            }
            
            // Èö±ËóèÁ©∫ÁãÄÊÖã
            if (emptyState) emptyState.style.display = 'none';
            
            console.log('‚úÖ ÈñãÂßãÂâµÂª∫Ë°®Ê†ºË°å...');
            // ÂâµÂª∫Ë°®Ê†ºË°å
            storedFiles.forEach((file, index) => {
                try {
                    console.log(`üìù ÂâµÂª∫Á¨¨ ${index + 1} Ë°å:`, {
                        name: file.name,
                        fileName: file.fileName,
                        accountHolder: file.accountHolder,
                        accountNumber: file.accountNumber,
                        isProcessing: file.isProcessing,
                        status: file.status
                    });
                    createDocumentRow(documentsTbody, file);
                    console.log(`‚úÖ Á¨¨ ${index + 1} Ë°åÂâµÂª∫ÊàêÂäü`);
                } catch (error) {
                    console.error(`‚ùå ÂâµÂª∫Á¨¨ ${index + 1} Ë°åÊôÇÂá∫ÈåØ:`, error);
                    console.error(`‚ùå Êñá‰ª∂Êï∏Êìö:`, file);
                }
            });
            console.log('‚úÖ Ë°®Ê†ºË°åÂâµÂª∫ÂÆåÊàê');
            
            // Êõ¥Êñ∞Áµ±Ë®à‰ø°ÊÅØÂíåÂàÜÈ†Å
            updateDocumentStats();
            updatePaginationInfo(storedFiles.length);
        }
        
        // ÂâµÂª∫Á©∫Êñá‰ª∂Â§æ
        function createEmptyFolder(container, docType) {
            const folderItem = document.createElement('div');
            folderItem.className = 'folder-item';
            folderItem.innerHTML = `
                <div class="folder-icon">
                    <i class="fas fa-folder"></i>
                </div>
                <div class="folder-name">${documentTypes[docType]?.title || docType}</div>
                <div class="folder-files-count">0 files</div>
                <div class="folder-updated">ÂâõÂâõÂâµÂª∫</div>
            `;
            folderItem.onclick = () => {
                console.log('üìÅ ÈªûÊìäÁ©∫Êñá‰ª∂Â§æ:', docType);
                // ÂèØ‰ª•ÂØ¶ÁèæÊâìÈñãÊñá‰ª∂Â§æÊàñ‰∏äÂÇ≥Êñá‰ª∂ÁöÑÈÇèËºØ
            };
            container.appendChild(folderItem);
        }
        
        // Â∞áÊñá‰ª∂ÂàÜÁµÑÂà∞Êñá‰ª∂Â§æ‰∏≠
        function groupFilesIntoFolders(files, docType) {
            const folders = [];
            
            // ÊåâÊúà‰ªΩÂàÜÁµÑ
            const groupedByMonth = {};
            files.forEach(file => {
                const date = new Date(file.uploadDate);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                
                if (!groupedByMonth[monthKey]) {
                    groupedByMonth[monthKey] = [];
                }
                groupedByMonth[monthKey].push(file);
            });
            
            // ÂâµÂª∫Êñá‰ª∂Â§æ
            Object.keys(groupedByMonth).forEach(monthKey => {
                const filesInMonth = groupedByMonth[monthKey];
                const date = new Date(monthKey + '-01');
                
                folders.push({
                    id: `folder_${monthKey}`,
                    name: `${date.getFullYear()}Âπ¥${date.getMonth() + 1}Êúà`,
                    filesCount: filesInMonth.length,
                    files: filesInMonth,
                    updated: filesInMonth[0].uploadDate,
                    type: docType
                });
            });
            
            // Â¶ÇÊûúÊ≤íÊúâÊñá‰ª∂ÔºåÂâµÂª∫‰∏ÄÂÄãÁ©∫Êñá‰ª∂Â§æ
            if (folders.length === 0) {
                folders.push({
                    id: `folder_empty_${docType}`,
                    name: documentTypes[docType]?.title || docType,
                    filesCount: 0,
                    files: [],
                    updated: 'ÂâõÂâõÂâµÂª∫',
                    type: docType
                });
            }
            
            return folders;
        }
        
        // ÂâµÂª∫Êñá‰ª∂Â§æÈ†ÖÁõÆ
        function createFolderItem(container, folder) {
            const folderItem = document.createElement('div');
            folderItem.className = 'folder-item';
            folderItem.innerHTML = `
                <div class="folder-icon">
                    <i class="fas fa-folder${folder.filesCount > 0 ? '-open' : ''}"></i>
                </div>
                <div class="folder-name">${folder.name}</div>
                <div class="folder-files-count">${folder.filesCount} files</div>
                <div class="folder-updated">${folder.updated}</div>
            `;
            folderItem.onclick = () => {
                console.log('üìÅ ÈªûÊìäÊñá‰ª∂Â§æ:', folder.name, folder.filesCount, 'ÂÄãÊñá‰ª∂');
                openFolder(folder);
            };
            container.appendChild(folderItem);
        }
        
        // ÊâìÈñãÊñá‰ª∂Â§æ
        function openFolder(folder) {
            console.log('üìÇ ÊâìÈñãÊñá‰ª∂Â§æ:', folder);
            if (folder.filesCount === 0) {
                alert('Êñá‰ª∂Â§æÁÇ∫Á©∫ÔºåË´ãÂÖà‰∏äÂÇ≥Êñá‰ª∂');
                return;
            }
            
            // ÈÄôË£°ÂèØ‰ª•ÂØ¶ÁèæÊâìÈñãÊñá‰ª∂Â§æÁöÑÈÇèËºØ
            // ‰æãÂ¶ÇÈ°ØÁ§∫Êñá‰ª∂Â§æÂÖßÂÆπÊàñË∑≥ËΩâÂà∞Êñá‰ª∂ÂàóË°®
            alert(`ÊâìÈñãÊñá‰ª∂Â§æ: ${folder.name} (${folder.filesCount} ÂÄãÊñá‰ª∂)`);
        }

        // ÊâìÈñãÊñáÊ™îË©≥Á¥∞Ë¶ñÂúñ
        function openDocumentDetail(documentId) {
            document.getElementById('document-list-view').style.display = 'none';
            document.getElementById('document-detail-view').style.display = 'block';
            
            // ÂÑ™ÂÖà‰ΩøÁî®LedgerBoxËôïÁêÜÂô®ÁöÑÊï∏Êìö
            if (window.ledgerBoxProcessor) {
                window.ledgerBoxProcessor.openDocumentDetail(documentId);
                return;
            }
            
            // ÂÖúÂ∫ïÔºöÂæûlocalStorageÁç≤ÂèñÊñá‰ª∂‰ø°ÊÅØ
            const fileInfo = getFileInfoById(documentId);
            
            if (fileInfo) {
                // Êõ¥Êñ∞ÊñáÊ™îÊ®ôÈ°åÁÇ∫ÂØ¶ÈöõÊñá‰ª∂Âêç
                document.getElementById('document-title').textContent = fileInfo.name;
                
                // Êõ¥Êñ∞PDFÈ†êË¶ΩÂçÄÂüü
                updatePDFPreview(fileInfo);
                
                console.log('üìÑ ÊâìÈñãÊñáÊ™îË©≥Á¥∞Ë¶ñÂúñ:', fileInfo.name, fileInfo.documentType);
            } else {
                // ÂÖúÂ∫ïÔºö‰ΩøÁî®ÊñáÊ™îID
                document.getElementById('document-title').textContent = documentId + '.pdf';
                console.warn('‚ö†Ô∏è Êâæ‰∏çÂà∞ÊñáÊ™î‰ø°ÊÅØ:', documentId);
            }
        }
        
        // Ê†πÊìöÊñáÊ™îIDÁç≤ÂèñÊñá‰ª∂‰ø°ÊÅØ
        function getFileInfoById(documentId) {
            // Ê™¢Êü•ÊâÄÊúâÊñáÊ™îÈ°ûÂûãÁöÑÂ≠òÂÑ≤
            const docTypes = ['bank-statement', 'general'];
            
            for (const docType of docTypes) {
                const storageKey = `vaultcaddy_files_${docType}`;
                const storedFiles = JSON.parse(localStorage.getItem(storageKey) || '[]');
                
                const fileInfo = storedFiles.find(file => file.id === documentId);
                if (fileInfo) {
                    return fileInfo;
                }
            }
            
            return null;
        }
        
        // Êõ¥Êñ∞PDFÈ†êË¶ΩÂçÄÂüü
        function updatePDFPreview(fileInfo) {
            const pdfPlaceholder = document.querySelector('.pdf-placeholder');
            if (pdfPlaceholder) {
                pdfPlaceholder.innerHTML = `
                    <i class="fas fa-file-pdf"></i>
                    <h3>PDF Preview</h3>
                    <p>Document: ${fileInfo.name}</p>
                    <p style="color: #6b7280; font-size: 0.875rem;">Type: ${fileInfo.documentType}</p>
                    <p style="color: #6b7280; font-size: 0.875rem;">Size: ${(fileInfo.size / 1024 / 1024).toFixed(2)} MB</p>
                    <small style="display: block; margin-top: 1rem; color: #9ca3af;">
                        ÂØ¶ÈöõÊñá‰ª∂È†êË¶ΩÂäüËÉΩÊ≠£Âú®ÈñãÁôº‰∏≠ÔºåÁõÆÂâçÈ°ØÁ§∫Êñá‰ª∂‰ø°ÊÅØ
                    </small>
                `;
            }
        }

        // ËøîÂõûÊñáÊ™îÂàóË°®
        function backToDocumentList() {
            document.getElementById('document-detail-view').style.display = 'none';
            document.getElementById('document-list-view').style.display = 'block';
            
            // Ê∏ÖÈô§Áï∂ÂâçÊñáÊ™î
            if (window.ledgerBoxProcessor) {
                window.ledgerBoxProcessor.currentDocument = null;
            }
        }

        // ÂÖ∂‰ªñÂäüËÉΩÂáΩÊï∏
        function showHelp() {
            alert('Document processing help will be shown here.');
        }

        function openUploadModal() {
            console.log('');
            console.log('========================================');
            console.log('üîµ openUploadModal Ë¢´Ë™øÁî®ÔºÅ');
            console.log('üîµ ÊôÇÈñìÊà≥:', new Date().toLocaleTimeString());
            console.log('üîµ DOM ÁãÄÊÖã:', document.readyState);
            console.log('========================================');
            
            // Á¢∫‰øù DOM Â∑≤ÂÆåÂÖ®ËºâÂÖ•
            if (document.readyState === 'loading') {
                console.log('‚è≥ DOM Â∞öÊú™ËºâÂÖ•ÂÆåÊàêÔºåÁ≠âÂæÖ...');
                document.addEventListener('DOMContentLoaded', openUploadModal);
                return;
            }
            
            // ÊâìÈñãÊñ∞ÁöÑ AI ‰∏äÂÇ≥Ê®°ÊÖãÊ°Ü
            const modal = document.getElementById('aiUploadModal');
            console.log('üîµ ÊâæÂà∞Ê®°ÊÖãÊ°Ü:', modal);
            console.log('üîµ Ê®°ÊÖãÊ°ÜÂÖÉÁ¥†Â≠òÂú®:', !!modal);
            
            if (modal) {
                console.log('‚úÖ ÈñãÂïü‰∏äÂÇ≥Ê®°ÊÖãÊ°Ü');
                modal.style.display = 'flex';
                
                // ‰ΩøÁî® setTimeout Á¢∫‰øù DOM Â∑≤Ê∏≤Êüì
                setTimeout(() => {
                    initializeAIUpload();
                }, 100);
            } else {
                console.error('‚ùå Êâæ‰∏çÂà∞ aiUploadModal');
                console.error('‚ùå Body ÂÖßÂÆπ:', document.body ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®');
                console.error('‚ùå ÊâÄÊúâÂÖÉÁ¥†Êï∏Èáè:', document.getElementsByTagName('*').length);
                
                // ÂòóË©¶Â§öÊ¨°Âª∂ÈÅ≤ÈáçË©¶
                let retryCount = 0;
                const maxRetries = 5;
                const retryInterval = setInterval(() => {
                    retryCount++;
                    console.log(`üîÑ ÈáçË©¶Á¨¨ ${retryCount} Ê¨°...`);
                    
                    const retryModal = document.getElementById('aiUploadModal');
                    if (retryModal) {
                        console.log('‚úÖ ÈáçË©¶ÊàêÂäüÔºåÊâæÂà∞Ê®°ÊÖãÊ°Ü');
                        clearInterval(retryInterval);
                        retryModal.style.display = 'flex';
                        setTimeout(() => initializeAIUpload(), 100);
                    } else if (retryCount >= maxRetries) {
                        console.error(`‚ùå ÈáçË©¶ ${maxRetries} Ê¨°Âæå‰ªçÁÑ∂Â§±Êïó`);
                        clearInterval(retryInterval);
                        alert('‰∏äÂÇ≥ÂäüËÉΩÂàùÂßãÂåñÂ§±ÊïóÔºåË´ãÈáçÊñ∞Êï¥ÁêÜÈ†ÅÈù¢ÂæåÂÜçË©¶');
                    }
                }, 300);
            }
        }
        
        // Á¢∫‰øùÂáΩÊï∏ÂÖ®Â±ÄÂèØÁî®
        window.openUploadModal = openUploadModal;
        
        function closeAIUploadModal() {
            const modal = document.getElementById('aiUploadModal');
            if (modal) {
                modal.style.display = 'none';
                resetAIUpload();
            }
        }
        window.closeAIUploadModal = closeAIUploadModal;
        
        // AI ‰∏äÂÇ≥ËôïÁêÜÂô®
        let aiCurrentFile = null;
        let aiIsProcessing = false;
        let aiProcessingResults = {};
        let selectedDocumentType = 'bank_statement'; // ÈªòË™çÈÅ∏ÊìáÈäÄË°åÂ∞çÂ∏≥ÂñÆ
        
        function initializeAIUpload() {
            console.log('üé¨ initializeAIUpload Ë¢´Ë™øÁî®');
            
            const uploadArea = document.getElementById('aiUploadArea');
            const fileInput = document.getElementById('aiFileInput');
            
            console.log('   uploadArea ÂÖÉÁ¥†:', uploadArea ? '‚úÖ ÊâæÂà∞' : '‚ùå Êú™ÊâæÂà∞');
            console.log('   fileInput ÂÖÉÁ¥†:', fileInput ? '‚úÖ ÊâæÂà∞' : '‚ùå Êú™ÊâæÂà∞');
            
            if (!uploadArea || !fileInput) {
                console.error('‚ùå ÈóúÈçµÂÖÉÁ¥†Áº∫Â§±ÔºåÁÑ°Ê≥ïÂàùÂßãÂåñ‰∏äÂÇ≥');
                return;
            }
            
            // ÂàùÂßãÂåñÈªòË™çÈÅ∏ÊìáÔºàBank statementsÔºâ
            selectDocumentType('bank_statement');
            
            // ÈªûÊìä‰∏äÂÇ≥ÂçÄÂüüËß∏ÁôºÊñá‰ª∂ÈÅ∏Êìá
            uploadArea.onclick = () => {
                console.log('üñ±Ô∏è ‰∏äÂÇ≥ÂçÄÂüüË¢´ÈªûÊìä');
                fileInput.click();
            };
            
            // Êñá‰ª∂ÈÅ∏Êìá‰∫ã‰ª∂
            fileInput.onchange = (e) => {
                console.log('üìÅ Êñá‰ª∂Ë¢´ÈÅ∏Êìá');
                const files = Array.from(e.target.files);
                console.log('   ÈÅ∏ÊìáÁöÑÊñá‰ª∂Êï∏Èáè:', files.length);
                if (files.length > 0) {
                    console.log('   Êñá‰ª∂Âêç:', files[0].name);
                    handleAIFileUpload(files[0]);
                }
            };
            
            console.log('‚úÖ AI ‰∏äÂÇ≥ÂàùÂßãÂåñÂÆåÊàê');
            
            // ÊãñÊîæ‰∫ã‰ª∂
            uploadArea.ondragover = (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            };
            
            uploadArea.ondragleave = () => {
                uploadArea.classList.remove('dragover');
            };
            
            uploadArea.ondrop = (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                if (files.length > 0) {
                    handleAIFileUpload(files[0]);
                }
            };
        }
        
        async function handleAIFileUpload(file) {
            console.log('');
            console.log('========================================');
            console.log('üîµ handleAIFileUpload Ë¢´Ë™øÁî®');
            console.log('üìÑ Êñá‰ª∂Âêç:', file.name);
            console.log('üìè Êñá‰ª∂Â§ßÂ∞è:', file.size, 'bytes');
            console.log('üìã Êñá‰ª∂È°ûÂûã:', file.type);
            console.log('========================================');
            
            if (aiIsProcessing) {
                console.log('‚ö†Ô∏è Ê≠£Âú®ËôïÁêÜ‰∏≠ÔºåÂøΩÁï•Êñ∞‰∏äÂÇ≥');
                return;
            }
            
            // È©óË≠âÊñá‰ª∂
            console.log('üîç È©óË≠âÊñá‰ª∂...');
            if (!validateAIFile(file)) {
                console.log('‚ùå Êñá‰ª∂È©óË≠âÂ§±Êïó');
                return;
            }
            console.log('‚úÖ Êñá‰ª∂È©óË≠âÈÄöÈÅé');
            
            aiCurrentFile = file;
            aiIsProcessing = true;
            
            try {
                console.log('');
                console.log('üìÇ === ÈñãÂßãÁ¨¨‰∏ÄÈÉ®ÂàÜÔºöÂâµÂª∫Êñá‰ª∂Ë°å ===');
                
                // 1. Á´ãÂç≥ÈóúÈñâÊ®°ÊÖãÊ°Ü
                console.log('1Ô∏è‚É£ ÈóúÈñâ‰∏äÂÇ≥Ê®°ÊÖãÊ°Ü...');
                closeAIUploadModal();
                console.log('   ‚úÖ Ê®°ÊÖãÊ°ÜÂ∑≤ÈóúÈñâ');
                
                // 2. Áç≤ÂèñÈ†ÖÁõÆ ID
                console.log('');
                console.log('2Ô∏è‚É£ Áç≤ÂèñÁï∂ÂâçÈ†ÖÁõÆ ID...');
                const projectId = getCurrentProjectId();
                console.log('   È†ÖÁõÆ ID:', projectId);
                
                if (!projectId) {
                    console.error('   ‚ùå ÁÑ°Ê≥ïÁç≤ÂèñÈ†ÖÁõÆ ID');
                    throw new Error('ÁÑ°Ê≥ïÁ¢∫ÂÆöÁï∂ÂâçÈ†ÖÁõÆ');
                }
                console.log('   ‚úÖ È†ÖÁõÆ ID Áç≤ÂèñÊàêÂäü');
                
                // 3. ÂâµÂª∫Êñá‰ª∂Ë®òÈåÑÔºàÂè™ÂåÖÂê´Âü∫Êú¨‰ø°ÊÅØÔºå‰∏çÊ∂âÂèä AIÔºâ
                console.log('');
                console.log('3Ô∏è‚É£ ÂâµÂª∫Êñá‰ª∂Ë®òÈåÑ...');
                
                const currentDate = new Date();
                const documentId = Date.now().toString();
                
                console.log('   ÂâµÂª∫Êñá‰ª∂ ID:', documentId);
                console.log('   Áï∂ÂâçÊôÇÈñì:', currentDate.toISOString());
                
                // Â∞áÊñá‰ª∂ËΩâÊèõÁÇ∫ Data URL ‰ª•‰æøÈ†êË¶Ω
                console.log('   ËΩâÊèõÊñá‰ª∂ÁÇ∫ Data URL...');
                const fileDataURL = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
                console.log('   ‚úÖ Data URL ËΩâÊèõÂÆåÊàê');
                
                // ÂâµÂª∫Êñá‰ª∂Ë®òÈåÑÔºàÁ¨¨‰∏ÄÈÉ®ÂàÜÔºöÂè™ÂåÖÂê´Âü∫Êú¨‰ø°ÊÅØÔºâ
                const processingDocument = {
                    id: documentId,
                    name: file.name,
                    fileName: file.name,
                    size: file.size,
                    fileSize: file.size,
                    type: file.type,
                    fileType: file.type,
                    uploadTime: currentDate.toISOString(),
                    uploadDate: currentDate.toISOString(),
                    projectId: projectId,
                    createdAt: currentDate.toISOString(),
                    status: 'Processing',
                    processingProgress: 0,
                    isProcessing: true,
                    // Â≠òÂÑ≤Êñá‰ª∂ÁöÑ Data URL ‰ª•‰æøÈ†êË¶Ω
                    fileDataURL: fileDataURL,
                    // È†êË®≠Êï∏ÊìöÔºàÈÅøÂÖç undefined ÈåØË™§Ôºâ
                    processedData: {
                        fileName: file.name,
                        accountHolder: 'ËôïÁêÜ‰∏≠...',
                        accountNumber: '',
                        startDate: '‚Äî',
                        endDate: '‚Äî',
                        transactions: [],
                        startBalance: 0,
                        endBalance: 0
                    }
                };
                
                console.log('   ‚úÖ Êñá‰ª∂Ë®òÈåÑÂâµÂª∫ÂÆåÊàê');
                console.log('   Êñá‰ª∂Ë®òÈåÑ:', JSON.stringify(processingDocument, null, 2));
                
                // 4. ‰øùÂ≠òÂà∞ localStorage
                console.log('');
                console.log('4Ô∏è‚É£ ‰øùÂ≠òÂà∞ localStorage...');
                const storageKey = `vaultcaddy_project_${projectId}_documents`;
                console.log('   Â≠òÂÑ≤Èçµ:', storageKey);
                
                let existingDocs = [];
                try {
                    const stored = localStorage.getItem(storageKey);
                    existingDocs = stored ? JSON.parse(stored) : [];
                    console.log('   ÁèæÊúâÊñáÊ™îÊï∏Èáè:', existingDocs.length);
                } catch (e) {
                    console.error('   ‚ö†Ô∏è ËÆÄÂèñÁèæÊúâÊñáÊ™îÂ§±Êïó:', e);
                    existingDocs = [];
                }
                
                existingDocs.push(processingDocument);
                localStorage.setItem(storageKey, JSON.stringify(existingDocs));
                console.log('   ‚úÖ ‰øùÂ≠òÊàêÂäüÔºåÁèæÂú®Êúâ', existingDocs.length, 'ÂÄãÊñáÊ™î');
                
                // 5. Âú®È†ÅÈù¢‰∏≠È°ØÁ§∫Êñá‰ª∂Ë°å
                console.log('');
                console.log('5Ô∏è‚É£ Âú®È†ÅÈù¢‰∏≠ÂâµÂª∫Êñá‰ª∂Ë°å...');
                const documentsTbody = document.getElementById('documents-tbody');
                const emptyState = document.getElementById('empty-state');
                
                console.log('   documents-tbody ÂÖÉÁ¥†:', documentsTbody ? '‚úÖ ÊâæÂà∞' : '‚ùå Êú™ÊâæÂà∞');
                console.log('   empty-state ÂÖÉÁ¥†:', emptyState ? '‚úÖ ÊâæÂà∞' : '‚ùå Êú™ÊâæÂà∞');
                
                if (!documentsTbody) {
                    throw new Error('Êâæ‰∏çÂà∞ documents-tbody ÂÖÉÁ¥†');
                }
                
                // Èö±ËóèÁ©∫ÁãÄÊÖã
                if (emptyState) {
                    emptyState.style.display = 'none';
                    console.log('   ‚úÖ Á©∫ÁãÄÊÖãÂ∑≤Èö±Ëóè');
                }
                
                // ÂâµÂª∫Êñ∞ÁöÑË°®Ê†ºË°å
                console.log('   Ê≠£Âú®Ë™øÁî® createDocumentRow...');
                createDocumentRow(documentsTbody, processingDocument);
                console.log('   ‚úÖ Êñá‰ª∂Ë°åÂ∑≤Ê∑ªÂä†Âà∞Ë°®Ê†º');
                
                // Êõ¥Êñ∞ÂàÜÈ†Å‰ø°ÊÅØ
                console.log('   Êõ¥Êñ∞ÂàÜÈ†Å‰ø°ÊÅØ...');
                updatePaginationInfo(existingDocs.length);
                console.log('   ‚úÖ ÂàÜÈ†Å‰ø°ÊÅØÂ∑≤Êõ¥Êñ∞');
                
                // ÂÆåÊàêÁ¨¨‰∏ÄÈÉ®ÂàÜ
                console.log('');
                console.log('‚úÖ‚úÖ‚úÖ Á¨¨‰∏ÄÈÉ®ÂàÜÂÆåÊàêÔºÅÊñá‰ª∂Â∑≤ÊàêÂäüÈ°ØÁ§∫ ‚úÖ‚úÖ‚úÖ');
                console.log('========================================');
                
                // 6. ÈñãÂßãÁ¨¨‰∫åÈÉ®ÂàÜÔºöÂæåÂè∞ AI Êï∏ÊìöÊèêÂèñ
                console.log('');
                console.log('ü§ñ === ÈñãÂßãÁ¨¨‰∫åÈÉ®ÂàÜÔºöAI Êï∏ÊìöÊèêÂèñ ===');
                startBackgroundAIProcessing(file, documentId, projectId);
                
                // ÈáçÁΩÆËôïÁêÜÊ®ôË™åÔºàÁ¨¨‰∏ÄÈÉ®ÂàÜÂÆåÊàêÔºâ
                aiIsProcessing = false;
                
            } catch (error) {
                console.error('‚ùå Êñá‰ª∂‰∏äÂÇ≥ÈåØË™§:', error);
                console.error('‚ùå ÈåØË™§Â†ÜÊ£ß:', error.stack);
                console.error('‚ùå ÈåØË™§Ë©≥ÊÉÖ:', {
                    message: error.message,
                    name: error.name
                });
                alert('Êñá‰ª∂‰∏äÂÇ≥Â§±ÊïóÔºåË´ãÈáçË©¶\n\nÈåØË™§Ë©≥ÊÉÖ: ' + error.message);
                aiIsProcessing = false;
            }
        }
        
        // Ëá™Âãï‰øùÂ≠òÂà∞È†ÖÁõÆÁöÑÂáΩÊï∏
        async function autoSaveToProject() {
            if (!aiProcessingResults.extractedData) {
                throw new Error('Ê≤íÊúâÂèØ‰øùÂ≠òÁöÑÊï∏Êìö');
            }
            
            try {
                // Áç≤ÂèñÁï∂ÂâçÈ†ÖÁõÆ ID
                const projectId = getCurrentProjectId();
                console.log('üíæ Ëá™Âãï‰øùÂ≠òÊñá‰ª∂Âà∞È†ÖÁõÆ:', projectId);
                
                if (!projectId) {
                    throw new Error('ÁÑ°Ê≥ïÁ¢∫ÂÆöÁï∂ÂâçÈ†ÖÁõÆ');
                }
                
                // ‰øùÂ≠òÂà∞ localStorage
                const storageKey = `vaultcaddy_project_${projectId}_documents`;
                const existingDocs = JSON.parse(localStorage.getItem(storageKey) || '[]');
                
                console.log('üìÇ ÁèæÊúâÊñáÊ™îÊï∏Èáè:', existingDocs.length);
                
                const newDocument = {
                    id: Date.now().toString(),
                    ...aiProcessingResults.extractedData,
                    projectId: projectId,
                    createdAt: new Date().toISOString()
                };
                
                existingDocs.push(newDocument);
                localStorage.setItem(storageKey, JSON.stringify(existingDocs));
                
                console.log('‚úÖ ÊñáÊ™îÂ∑≤Ëá™Âãï‰øùÂ≠òÔºåÊñ∞ÊñáÊ™îÊï∏Èáè:', existingDocs.length);
                console.log('üíæ Â≠òÂÑ≤Èçµ:', storageKey);
                console.log('üìÑ ÊñáÊ™îË©≥ÊÉÖ:', newDocument);
                
                // ÈóúÈñâÊ®°ÊÖãÊ°Ü‰∏¶Âà∑Êñ∞È†ÅÈù¢
                closeAIUploadModal();
                location.reload();
                
            } catch (error) {
                console.error('‰øùÂ≠òÂ§±Êïó:', error);
                throw error;
            }
        }
        
        // ÂæåÂè∞ AI Êï∏ÊìöÊèêÂèñÔºà‰∏çÈòªÂ°û UIÔºâ
        async function startBackgroundAIProcessing(file, documentId, projectId) {
            console.log('');
            console.log('================================================================================');
            console.log('ü§ñ ÈñãÂßãÂæåÂè∞ AI ËôïÁêÜ');
            console.log('   Êñá‰ª∂Âêç:', file.name);
            console.log('   Êñá‰ª∂È°ûÂûã:', file.type);
            console.log('   Êñá‰ª∂Â§ßÂ∞è:', file.size, 'bytes');
            console.log('   ÊñáÊ™î ID:', documentId);
            console.log('   È†ÖÁõÆ ID:', projectId);
            console.log('================================================================================');
            console.log('');
            
            try {
                // Êõ¥Êñ∞ÈÄ≤Â∫¶Âà∞ 10%
                console.log('üìä Ê≠•È©ü 0: Êõ¥Êñ∞ÈÄ≤Â∫¶Âà∞ 10%...');
                updateDocumentProgress(documentId, projectId, 10);
                
                // Ê≠•È©ü 1 & 2: ‰ΩøÁî® Google Smart Processor ËôïÁêÜÊñá‰ª∂
                console.log('');
                console.log('üß† === ‰ΩøÁî® Google AI ËôïÁêÜÂô®ËôïÁêÜÊñá‰ª∂ ===');
                console.log('   Êñá‰ª∂Âêç:', file.name);
                console.log('   Êñá‰ª∂È°ûÂûã:', file.type);
                
                updateDocumentProgress(documentId, projectId, 30);
                
                // Ë™øÁî® processWithGoogleAIÔºàÂ∑≤Á∂ìÈõÜÊàê‰∫Ü Google Smart ProcessorÔºâ
                const aiResult = await processWithGoogleAI(file);
                
                console.log('‚úÖ Google AI ËôïÁêÜÂÆåÊàê');
                console.log('   ËôïÁêÜÂô®:', aiResult.processor || 'Unknown');
                console.log('   ÊàêÂäüÁãÄÊÖã:', aiResult.success);
                console.log('   ÊèêÂèñÁöÑÂéüÂßãÊï∏Êìö:', JSON.stringify(aiResult.extractedData, null, 2));
                updateDocumentProgress(documentId, projectId, 70);
                
                // Ê≠•È©ü 3: Ëß£Êûê‰∏¶‰øùÂ≠òÊï∏Êìö
                console.log('');
                console.log('üíæ === Ê≠•È©ü 3: Ëß£Êûê‰∏¶‰øùÂ≠òÊï∏Êìö ===');
                const parsedData = parseAIResponse(aiResult, file);
                console.log('‚úÖ Êï∏ÊìöËß£ÊûêÂÆåÊàê');
                console.log('   ÈäÄË°åÂêçÁ®±:', parsedData.bankName);
                console.log('   Â∏≥Êà∂ÊåÅÊúâ‰∫∫:', parsedData.accountHolder);
                console.log('   Â∏≥Êà∂ËôüÁ¢º:', parsedData.accountNumber);
                console.log('   Â∞çÂ∏≥ÊúüÈñì:', parsedData.startDate, 'to', parsedData.endDate);
                console.log('   ÊúüÂàùÈ§òÈ°ç:', parsedData.startBalance);
                console.log('   ÊúüÊú´È§òÈ°ç:', parsedData.endBalance);
                console.log('   ‰∫§ÊòìÊï∏Èáè:', parsedData.transactionCount);
                console.log('   ‰∫§ÊòìË©≥ÊÉÖ:', parsedData.transactions);
                
                // Êõ¥Êñ∞ localStorage ‰∏≠ÁöÑÊñáÊ™î
                console.log('');
                console.log('üíæ === Ê≠•È©ü 4: ‰øùÂ≠òÂà∞ localStorage ===');
                updateDocumentWithExtractedData(documentId, projectId, parsedData);
                updateDocumentProgress(documentId, projectId, 100);
                console.log('‚úÖ Êï∏ÊìöÂ∑≤‰øùÂ≠òÂà∞ localStorage');
                
                // È©óË≠â‰øùÂ≠ò
                const storageKey = `vaultcaddy_project_${projectId}_documents`;
                const savedDocs = JSON.parse(localStorage.getItem(storageKey) || '[]');
                const savedDoc = savedDocs.find(doc => doc.id === documentId);
                console.log('');
                console.log('üîç === È©óË≠â‰øùÂ≠òÁöÑÊï∏Êìö ===');
                console.log('   Â≠òÂÑ≤Èçµ:', storageKey);
                console.log('   ‰øùÂ≠òÁöÑÊñáÊ™î:', savedDoc);
                console.log('   ‰∫§ÊòìÊï∏Èáè (processedData):', savedDoc?.processedData?.transactions?.length);
                console.log('   ‰∫§ÊòìÊï∏Èáè (È†ÇÂ±§):', savedDoc?.transactions?.length);
                
                console.log('');
                console.log('üéâ AI Êï∏ÊìöÊèêÂèñÂÆåÊàêÔºÅ');
                console.log('================================================================================');
                console.log('');
                
                // Âª∂ÈÅ≤ 1 ÁßíÂæåÂà∑Êñ∞È†ÅÈù¢ÔºåËÆìÁî®Êà∂ÁúãÂà∞ 100% ÈÄ≤Â∫¶
                setTimeout(() => {
                    console.log('üîÑ Âà∑Êñ∞È†ÅÈù¢‰ª•È°ØÁ§∫ÊèêÂèñÁöÑÊï∏Êìö...');
                    location.reload();
                }, 1500);
                
            } catch (error) {
                console.error('');
                console.error('================================================================================');
                console.error('‚ùå ÂæåÂè∞ AI ËôïÁêÜÂ§±Êïó');
                console.error('   ÈåØË™§È°ûÂûã:', error.name);
                console.error('   ÈåØË™§Ê∂àÊÅØ:', error.message);
                console.error('   ÈåØË™§Â†ÜÊ£ß:', error.stack);
                console.error('================================================================================');
                console.error('');
                
                // Êõ¥Êñ∞ÊñáÊ™îÁãÄÊÖãÁÇ∫ÈåØË™§
                updateDocumentStatus(documentId, projectId, 'Error', error.message);
                
                // È°ØÁ§∫ÈåØË™§Ê∂àÊÅØÁµ¶Áî®Êà∂
                alert(`AI ËôïÁêÜÂ§±Êïó: ${error.message}\n\nË´ãÊü•ÁúãÊéßÂà∂Âè∞‰∫ÜËß£Ë©≥ÊÉÖ„ÄÇ`);
            }
        }
        
        // Ê≥®ÊÑèÔºöfileToBase64„ÄÅextractDataWithGemini„ÄÅparseBankStatementData ÂáΩÊï∏Â∑≤Âà™Èô§
        // ÁèæÂú®Áµ±‰∏Ä‰ΩøÁî® processWithGoogleAI (Á¨¨3080Ë°å) Âíå parseAIResponse (Á¨¨3133Ë°å)
        
        // Êõ¥Êñ∞ÊñáÊ™îËôïÁêÜÈÄ≤Â∫¶
        function updateDocumentProgress(documentId, projectId, progress) {
            const storageKey = `vaultcaddy_project_${projectId}_documents`;
            const documents = JSON.parse(localStorage.getItem(storageKey) || '[]');
            
            const docIndex = documents.findIndex(doc => doc.id === documentId);
            if (docIndex !== -1) {
                documents[docIndex].processingProgress = progress;
                localStorage.setItem(storageKey, JSON.stringify(documents));
                console.log(`üìä Êõ¥Êñ∞ÈÄ≤Â∫¶: ${progress}%`);
            }
        }
        
        // Êõ¥Êñ∞ÊñáÊ™îÁãÄÊÖã
        function updateDocumentStatus(documentId, projectId, status, errorMessage = '') {
            const storageKey = `vaultcaddy_project_${projectId}_documents`;
            const documents = JSON.parse(localStorage.getItem(storageKey) || '[]');
            
            const docIndex = documents.findIndex(doc => doc.id === documentId);
            if (docIndex !== -1) {
                documents[docIndex].status = status;
                documents[docIndex].isProcessing = false;
                if (errorMessage) {
                    documents[docIndex].errorMessage = errorMessage;
                }
                localStorage.setItem(storageKey, JSON.stringify(documents));
                console.log(`üìù Êõ¥Êñ∞ÁãÄÊÖã: ${status}`);
            }
        }
        
        // Êõ¥Êñ∞ÊñáÊ™îÁöÑÊèêÂèñÊï∏Êìö
        function updateDocumentWithExtractedData(documentId, projectId, extractedData) {
            const storageKey = `vaultcaddy_project_${projectId}_documents`;
            const documents = JSON.parse(localStorage.getItem(storageKey) || '[]');
            
            const docIndex = documents.findIndex(doc => doc.id === documentId);
            if (docIndex !== -1) {
                documents[docIndex].isProcessing = false;
                documents[docIndex].status = 'Success';
                documents[docIndex].processedData = extractedData;
                
                // ÂêåÊôÇÂ∞áÊèêÂèñÁöÑÊï∏ÊìöË§áË£ΩÂà∞È†ÇÂ±§ÔºåÊñπ‰æøË®™Âïè
                Object.assign(documents[docIndex], extractedData);
                
                localStorage.setItem(storageKey, JSON.stringify(documents));
                console.log('üíæ ÊèêÂèñÁöÑÊï∏ÊìöÂ∑≤‰øùÂ≠ò');
            }
        }
        
        function validateAIFile(file) {
            const maxSize = 20 * 1024 * 1024; // 20MB
            if (file.size > maxSize) {
                logAI(`‚ùå Êñá‰ª∂ÈÅéÂ§ß: ${(file.size/1024/1024).toFixed(2)}MB (ÊúÄÂ§ß 20MB)`, 'error');
                alert('Êñá‰ª∂ÈÅéÂ§ßÔºåÊúÄÂ§ßÊîØÊè¥ 20MB');
                return false;
            }
            
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];
            if (!allowedTypes.includes(file.type)) {
                logAI(`‚ùå ‰∏çÊîØÊè¥ÁöÑÊñá‰ª∂È°ûÂûã: ${file.type}`, 'error');
                alert('‰∏çÊîØÊè¥ÁöÑÊñá‰ª∂È°ûÂûãÔºåË´ã‰∏äÂÇ≥ PDF„ÄÅJPG Êàñ PNG Êñá‰ª∂');
                return false;
            }
            
            return true;
        }
        
        async function processAIStep(stepNumber, message, processor) {
            updateAIStep(stepNumber, 'active');
            updateAIProgress((stepNumber - 1) * 25);
            logAI(message, 'info');
            
            try {
                const result = await processor();
                updateAIStep(stepNumber, 'completed');
                updateAIProgress(stepNumber * 25);
                return result;
            } catch (error) {
                logAI(`‚ùå Ê≠•È©ü ${stepNumber} Â§±Êïó: ${error.message}`, 'error');
                throw error;
            }
        }
        
        function updateAIStep(stepNumber, status) {
            const step = document.querySelector(`.ai-step[data-step="${stepNumber}"]`);
            if (step) {
                step.classList.remove('active', 'completed');
                if (status) {
                    step.classList.add(status);
                }
            }
        }
        
        function updateAIProgress(percentage) {
            const progressFill = document.getElementById('aiProgressFill');
            if (progressFill) {
                progressFill.style.width = `${percentage}%`;
            }
        }
        
        function logAI(message, type = 'info') {
            const logContent = document.getElementById('aiLogContent');
            if (logContent) {
                const entry = document.createElement('div');
                entry.className = `ai-log-entry ${type}`;
                entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                logContent.appendChild(entry);
                logContent.scrollTop = logContent.scrollHeight;
            }
            console.log(message);
        }
        
        async function processWithGoogleAI(file) {
            try {
                logAI('üß† ‰ΩøÁî® Google AI ËôïÁêÜÂô®...', 'info');
                
                // Ê™¢Êü• Google Smart Processor
                if (window.googleSmartProcessor) {
                    const documentType = determineDocumentType(file);
                    logAI(`üìã ÊñáÊ™îÈ°ûÂûã: ${documentType}`, 'info');
                    
                    const result = await window.googleSmartProcessor.processDocumentOptimized(file, documentType);
                    
                    if (!result.success) {
                        throw new Error(result.error || 'AI ËôïÁêÜÂ§±Êïó');
                    }
                    
                    logAI(`‚úÖ ${result.processor} ËôïÁêÜÊàêÂäü`, 'success');
                    return result;
                    
                } else if (window.googleAIProcessor) {
                    const documentType = determineDocumentType(file);
                    const result = await window.googleAIProcessor.processDocument(file, documentType);
                    
                    if (!result.success) {
                        throw new Error(result.error || 'AI ËôïÁêÜÂ§±Êïó');
                    }
                    
                    logAI(`‚úÖ Gemini AI ÂàÜÊûêÂÆåÊàê`, 'success');
                    return result;
                    
                } else {
                    throw new Error('Ê≤íÊúâÂèØÁî®ÁöÑ Google AI ËôïÁêÜÂô®');
                }
                
            } catch (error) {
                logAI(`‚ùå Google AI ËôïÁêÜÂ§±Êïó: ${error.message}`, 'error');
                throw error;
            }
        }
        
        // ÈÅ∏ÊìáÊñáÊ™îÈ°ûÂûã
        function selectDocumentType(type) {
            console.log('üìã Áî®Êà∂ÈÅ∏ÊìáÊñáÊ™îÈ°ûÂûã:', type);
            
            // Êõ¥Êñ∞ÂÖ®Â±ÄËÆäÈáè
            selectedDocumentType = type;
            
            // ÁßªÈô§ÊâÄÊúâÂç°ÁâáÁöÑÈÅ∏‰∏≠ÁãÄÊÖã
            document.querySelectorAll('.doc-type-card').forEach(card => {
                card.style.borderColor = '#e5e7eb';
                card.style.background = '#ffffff';
                const indicator = card.querySelector('.selected-indicator');
                if (indicator) {
                    indicator.style.display = 'none';
                }
            });
            
            // Ê∑ªÂä†ÈÅ∏‰∏≠ÁãÄÊÖãÂà∞Áï∂ÂâçÂç°Áâá
            const selectedCard = document.querySelector(`.doc-type-card[data-type="${type}"]`);
            if (selectedCard) {
                selectedCard.style.borderColor = '#3b82f6';
                selectedCard.style.background = '#eff6ff';
                const indicator = selectedCard.querySelector('.selected-indicator');
                if (indicator) {
                    indicator.style.display = 'flex';
                }
            }
            
            console.log('‚úÖ ÊñáÊ™îÈ°ûÂûãÂ∑≤Êõ¥Êñ∞ÁÇ∫:', selectedDocumentType);
        }
        window.selectDocumentType = selectDocumentType;
        
        function determineDocumentType(file) {
            // ÂÑ™ÂÖà‰ΩøÁî®Áî®Êà∂ÈÅ∏ÊìáÁöÑÈ°ûÂûã
            if (selectedDocumentType) {
                console.log('‚úÖ ‰ΩøÁî®Áî®Êà∂ÈÅ∏ÊìáÁöÑÊñáÊ™îÈ°ûÂûã:', selectedDocumentType);
                return selectedDocumentType;
            }
            
            // ÂÇôÁî®ÔºöÂü∫ÊñºÊñá‰ª∂ÂêçËá™ÂãïÊ™¢Ê∏¨
            const fileName = file.name.toLowerCase();
            console.log('üîç Âü∫ÊñºÊñá‰ª∂ÂêçËá™ÂãïÊ™¢Ê∏¨ÊñáÊ™îÈ°ûÂûã:', fileName);
            
            if (fileName.includes('receipt') || fileName.includes('Êî∂Êìö') || 
                fileName.includes('Â∞èÁ•®') || fileName.includes('ÊÜëË≠â')) {
                console.log('   Ê™¢Ê∏¨ÁµêÊûú: receipt');
                return 'receipt';
            } else if (fileName.includes('invoice') || fileName.includes('ÁôºÁ•®') || 
                       fileName.includes('Â∏≥ÂñÆ') || fileName.includes('bill')) {
                console.log('   Ê™¢Ê∏¨ÁµêÊûú: invoice');
                return 'invoice';
            } else if (fileName.includes('statement') || fileName.includes('Â∞çÂ∏≥ÂñÆ') || 
                       fileName.includes('ÊúàÁµêÂñÆ') || fileName.includes('bank') ||
                       fileName.includes('ÈäÄË°å') || fileName.includes('eStatement')) {
                console.log('   Ê™¢Ê∏¨ÁµêÊûú: bank_statement');
                return 'bank_statement';
            } else {
                console.log('   Ê™¢Ê∏¨ÁµêÊûú: general');
                return 'general';
            }
        }
        
        function parseAIResponse(aiResult, file) {
            try {
                logAI('üìã Ëß£Êûê AI ÊèêÂèñÁöÑÊï∏Êìö...', 'info');
                
                const data = aiResult.extractedData || {};
                
                // Á¢∫ÂÆöÊñáÊ™îÈ°ûÂûãÔºàÂÑ™ÂÖà‰ΩøÁî®Áî®Êà∂ÈÅ∏ÊìáÁöÑÈ°ûÂûãÔºâ
                const docType = determineDocumentType(file);
                logAI(`üìÑ ÊñáÊ™îÈ°ûÂûã: ${docType}`, 'info');
                
                // Ê†πÊìöÊñáÊ™îÈ°ûÂûãËøîÂõû‰∏çÂêåÁöÑÊï∏ÊìöÁµêÊßã
                if (docType === 'invoice') {
                    return parseInvoiceData(data, file, aiResult);
                } else if (docType === 'receipt') {
                    return parseReceiptData(data, file, aiResult);
                } else if (docType === 'bank_statement') {
                    return parseBankStatementData(data, file, aiResult);
                } else {
                    return parseGeneralData(data, file, aiResult);
                }
                
            } catch (error) {
                logAI(`‚ùå Êï∏ÊìöËß£ÊûêÂ§±Êïó: ${error.message}`, 'error');
                throw error;
            }
        }
        
        // Ëß£ÊûêÁôºÁ•®Êï∏Êìö
        function parseInvoiceData(data, file, aiResult) {
            const standardizedData = {
                // Âü∫Êú¨‰ø°ÊÅØ
                documentType: 'Invoice',
                fileName: file?.name || 'Êú™ÂëΩÂêçÊñá‰ª∂',
                fileSize: file?.size || 0,
                extractedAt: new Date().toISOString(),
                
                // ÁôºÁ•®‰ø°ÊÅØ
                invoiceNumber: data.invoiceNumber || data.number || data.documentNumber || '',
                issueDate: data.issueDate || data.invoiceDate || data.date || '',
                dueDate: data.dueDate || data.paymentDue || '',
                deliveryDate: data.deliveryDate || data.shippingDate || '',
                
                // ‰æõÊáâÂïÜ‰ø°ÊÅØ
                vendor: {
                    name: data.vendor?.name || data.vendorName || data.supplier || data.from || '',
                    address: data.vendor?.address || data.vendorAddress || '',
                    phone: data.vendor?.phone || data.vendorPhone || '',
                    email: data.vendor?.email || data.vendorEmail || '',
                    taxId: data.vendor?.taxId || data.vendorTaxId || '',
                    companyRegNo: data.vendor?.companyRegNo || ''
                },
                
                // ÂÆ¢Êà∂‰ø°ÊÅØ
                customer: {
                    name: data.customer?.name || data.customerName || data.billTo || data.to || '',
                    address: data.customer?.address || data.customerAddress || data.shippingAddress || '',
                    phone: data.customer?.phone || data.customerPhone || '',
                    email: data.customer?.email || data.customerEmail || ''
                },
                
                // ÂïÜÂìÅÈ†ÖÁõÆ
                lineItems: (data.lineItems || data.items || []).map(item => ({
                    itemCode: item.itemCode || item.code || item.sku || '',
                    description: item.description || item.name || item.product || '',
                    quantity: parseFloat(item.quantity || item.qty || 0),
                    unit: item.unit || item.uom || '‰ª∂',
                    unitPrice: parseFloat(item.unitPrice || item.price || 0),
                    amount: parseFloat(item.amount || item.total || (item.quantity * item.unitPrice) || 0),
                    taxRate: parseFloat(item.taxRate || 0),
                    taxAmount: parseFloat(item.taxAmount || 0)
                })),
                
                // ÈáëÈ°ç‰ø°ÊÅØ
                subtotal: parseFloat(data.subtotal || data.subTotal || 0),
                discount: parseFloat(data.discount || 0),
                discountPercent: parseFloat(data.discountPercent || 0),
                taxAmount: parseFloat(data.taxAmount || data.tax || 0),
                taxRate: parseFloat(data.taxRate || 0),
                totalAmount: parseFloat(data.totalAmount || data.total || data.grandTotal || 0),
                currency: data.currency || 'HKD',
                
                // ‰ªòÊ¨æ‰ø°ÊÅØ
                paymentMethod: data.paymentMethod || data.payment || '',
                paymentTerms: data.paymentTerms || data.terms || '',
                paymentStatus: data.paymentStatus || 'Unpaid',
                paidDate: data.paidDate || '',
                paidAmount: parseFloat(data.paidAmount || 0),
                
                // ÁãÄÊÖã
                status: 'Success',
                reviewStatus: 'Review',
                notes: data.notes || data.remarks || '',
                
                // ÂÖ∂‰ªñ‰ø°ÊÅØ
                rawText: aiResult.text || '',
                confidence: aiResult.confidence || 0
            };
            
            // Ë®àÁÆóÈ†ÖÁõÆÊï∏Èáè
            standardizedData.itemCount = standardizedData.lineItems.length;
            
            // Â¶ÇÊûúÊ≤íÊúâÊòéÁ¢∫ÁöÑÁ∏ΩÈáëÈ°çÔºåË®àÁÆóÂÆÉ
            if (!standardizedData.totalAmount && standardizedData.lineItems.length > 0) {
                const itemsTotal = standardizedData.lineItems.reduce((sum, item) => sum + item.amount, 0);
                standardizedData.subtotal = itemsTotal;
                standardizedData.totalAmount = itemsTotal - standardizedData.discount + standardizedData.taxAmount;
            }
            
            logAI(`üìä ÁôºÁ•®Êï∏ÊìöËß£ÊûêÂÆåÊàê`, 'success');
            logAI(`üìÑ ÁôºÁ•®ËôüÁ¢º: ${standardizedData.invoiceNumber}`, 'info');
            logAI(`üìÖ ÁôºÁ•®Êó•Êúü: ${standardizedData.issueDate}`, 'info');
            logAI(`üè¢ ‰æõÊáâÂïÜ: ${standardizedData.vendor.name}`, 'info');
            logAI(`üë§ ÂÆ¢Êà∂: ${standardizedData.customer.name}`, 'info');
            logAI(`üì¶ È†ÖÁõÆÊï∏Èáè: ${standardizedData.itemCount}`, 'info');
            logAI(`üí∞ Á∏ΩÈáëÈ°ç: ${standardizedData.currency} $${standardizedData.totalAmount.toFixed(2)}`, 'info');
            
            return standardizedData;
        }
        
        // Ëß£ÊûêÊî∂ÊìöÊï∏Êìö
        function parseReceiptData(data, file, aiResult) {
            const standardizedData = {
                // Âü∫Êú¨‰ø°ÊÅØ
                documentType: 'Receipt',
                fileName: file?.name || 'Êú™ÂëΩÂêçÊñá‰ª∂',
                fileSize: file?.size || 0,
                extractedAt: new Date().toISOString(),
                
                // Êî∂Êìö‰ø°ÊÅØ
                receiptNumber: data.receiptNumber || data.number || '',
                receiptDate: data.receiptDate || data.date || '',
                
                // ÂïÜÊà∂‰ø°ÊÅØ
                merchant: {
                    name: data.merchant?.name || data.merchantName || data.store || data.vendor || '',
                    address: data.merchant?.address || data.merchantAddress || data.location || '',
                    phone: data.merchant?.phone || data.merchantPhone || ''
                },
                
                // È†ÖÁõÆÊòéÁ¥∞
                items: (data.items || data.lineItems || []).map(item => ({
                    description: item.description || item.name || item.product || '',
                    quantity: parseFloat(item.quantity || item.qty || 1),
                    unitPrice: parseFloat(item.unitPrice || item.price || 0),
                    amount: parseFloat(item.amount || item.total || 0)
                })),
                
                // ÈáëÈ°ç‰ø°ÊÅØ
                subtotal: parseFloat(data.subtotal || data.subTotal || 0),
                tax: parseFloat(data.tax || data.taxAmount || 0),
                tip: parseFloat(data.tip || 0),
                totalAmount: parseFloat(data.totalAmount || data.total || 0),
                currency: data.currency || 'HKD',
                
                // ‰ªòÊ¨æ‰ø°ÊÅØ
                paymentMethod: data.paymentMethod || data.payment || '',
                cardLastFour: data.cardLastFour || '',
                
                // ÁãÄÊÖã
                status: 'Success',
                reviewStatus: 'Review',
                notes: data.notes || '',
                
                // ÂÖ∂‰ªñ‰ø°ÊÅØ
                rawText: aiResult.text || '',
                confidence: aiResult.confidence || 0
            };
            
            standardizedData.itemCount = standardizedData.items.length;
            
            logAI(`üìä Êî∂ÊìöÊï∏ÊìöËß£ÊûêÂÆåÊàê`, 'success');
            logAI(`üßæ Êî∂ÊìöËôüÁ¢º: ${standardizedData.receiptNumber}`, 'info');
            logAI(`üìÖ Êó•Êúü: ${standardizedData.receiptDate}`, 'info');
            logAI(`üè™ ÂïÜÊà∂: ${standardizedData.merchant.name}`, 'info');
            logAI(`üì¶ È†ÖÁõÆÊï∏Èáè: ${standardizedData.itemCount}`, 'info');
            logAI(`üí∞ Á∏ΩÈáëÈ°ç: ${standardizedData.currency} $${standardizedData.totalAmount.toFixed(2)}`, 'info');
            
            return standardizedData;
        }
        
        // Ëß£ÊûêÈäÄË°åÂ∞çÂ∏≥ÂñÆÊï∏Êìö
        function parseBankStatementData(data, file, aiResult) {
            const standardizedData = {
                // Âü∫Êú¨‰ø°ÊÅØ
                documentType: 'Bank Statement',
                fileName: file?.name || 'Êú™ÂëΩÂêçÊñá‰ª∂',
                fileSize: file?.size || 0,
                extractedAt: new Date().toISOString(),
                
                // ÈäÄË°åË≥¨Êà∂‰ø°ÊÅØ
                accountHolder: data.accountHolder || data.accountName || data.name || '',
                accountNumber: data.accountNumber || data.account || '',
                bankName: data.bankName || data.bank || '',
                
                // Â∞çË≥¨ÂñÆÊúüÈñì
                startDate: data.startDate || data.statementStartDate || data.periodStart || '',
                endDate: data.endDate || data.statementEndDate || data.periodEnd || '',
                
                // È§òÈ°ç‰ø°ÊÅØ
                startBalance: parseFloat(data.startBalance || data.openingBalance || data.beginningBalance || 0),
                endBalance: parseFloat(data.endBalance || data.closingBalance || data.endingBalance || 0),
                
                // ‰∫§Êòì‰ø°ÊÅØ
                transactions: (data.transactions || []).map(tx => ({
                    date: tx.date || '',
                    description: tx.description || tx.memo || '',
                    debit: parseFloat(tx.debit || 0),
                    credit: parseFloat(tx.credit || 0),
                    balance: parseFloat(tx.balance || 0),
                    reference: tx.reference || tx.refNo || '',
                    category: tx.category || ''
                })),
                transactionCount: (data.transactions || []).length || data.transactionCount || 0,
                reconciledTransactions: data.reconciledTransactions || 0,
                
                // ÁãÄÊÖã
                status: 'Success',
                reviewStatus: 'Review',
                notes: data.notes || '',
                
                // ÂÖ∂‰ªñ‰ø°ÊÅØ
                currency: data.currency || 'HKD',
                rawText: aiResult.text || '',
                confidence: aiResult.confidence || 0
            };
            
            logAI(`üìä ÈäÄË°åÂ∞çÂ∏≥ÂñÆÊï∏ÊìöËß£ÊûêÂÆåÊàê`, 'success');
            logAI(`üë§ Ë≥¨Êà∂ÊåÅÊúâ‰∫∫: ${standardizedData.accountHolder}`, 'info');
            logAI(`üè¶ Ë≥¨Ëôü: ${standardizedData.accountNumber}`, 'info');
            logAI(`üìÖ ÊúüÈñì: ${standardizedData.startDate} Ëá≥ ${standardizedData.endDate}`, 'info');
            logAI(`üìã ‰∫§ÊòìÊï∏Èáè: ${standardizedData.transactionCount}`, 'info');
            logAI(`üí∞ Ëµ∑ÂßãÈ§òÈ°ç: $${standardizedData.startBalance.toFixed(2)}`, 'info');
            logAI(`üí∞ ÁµêÊùüÈ§òÈ°ç: $${standardizedData.endBalance.toFixed(2)}`, 'info');
            
            return standardizedData;
        }
        
        // Ëß£ÊûêÈÄöÁî®ÊñáÊ™îÊï∏Êìö
        function parseGeneralData(data, file, aiResult) {
            const standardizedData = {
                // Âü∫Êú¨‰ø°ÊÅØ
                documentType: 'General',
                fileName: file?.name || 'Êú™ÂëΩÂêçÊñá‰ª∂',
                fileSize: file?.size || 0,
                extractedAt: new Date().toISOString(),
                
                // ÈÄöÁî®Â≠óÊÆµ
                date: data.date || new Date().toISOString().split('T')[0],
                title: data.title || data.subject || '',
                description: data.description || data.content || '',
                entities: data.entities || [],
                keywords: data.keywords || [],
                
                // ÁãÄÊÖã
                status: 'Success',
                reviewStatus: 'Review',
                notes: data.notes || '',
                
                // ÂÖ∂‰ªñ‰ø°ÊÅØ
                rawText: aiResult.text || '',
                confidence: aiResult.confidence || 0
            };
            
            logAI(`üìä ÈÄöÁî®ÊñáÊ™îÊï∏ÊìöËß£ÊûêÂÆåÊàê`, 'success');
            logAI(`üìÑ Ê®ôÈ°å: ${standardizedData.title}`, 'info');
            logAI(`üìÖ Êó•Êúü: ${standardizedData.date}`, 'info');
            
            return standardizedData;
        }
        
        function displayAIResults(data) {
            const resultsContainer = document.getElementById('aiResultsContainer');
            const resultsContent = document.getElementById('aiResultsContent');
            
            if (!resultsContainer || !resultsContent) return;
            
            // Ê†πÊìöÊñáÊ™îÈ°ûÂûãÈ°ØÁ§∫‰∏çÂêåÁöÑÂ≠óÊÆµ
            const isBankStatement = data.documentType === 'Bank Statement' || data.accountNumber;
            
            let resultHTML = `
                <div class="ai-result-item" style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #f3f4f6;">
                    <span class="ai-result-label" style="font-weight: 500; color: #6b7280;">üìÑ ÊñáÊ™îÈ°ûÂûã</span>
                    <span class="ai-result-value" style="color: #1f2937; font-weight: 600;">${data.documentType}</span>
                </div>
                <div class="ai-result-item" style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #f3f4f6;">
                    <span class="ai-result-label" style="font-weight: 500; color: #6b7280;">üìÅ Êñá‰ª∂ÂêçÁ®±</span>
                    <span class="ai-result-value" style="color: #1f2937; font-weight: 600;">${data.fileName}</span>
                </div>
            `;
            
            if (isBankStatement) {
                resultHTML += `
                    <div class="ai-result-item" style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #f3f4f6;">
                        <span class="ai-result-label" style="font-weight: 500; color: #6b7280;">üë§ Ë≥¨Êà∂ÊåÅÊúâ‰∫∫</span>
                        <span class="ai-result-value" style="color: #1f2937; font-weight: 600;">${data.accountHolder || '‚Äî'}</span>
                    </div>
                    <div class="ai-result-item" style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #f3f4f6;">
                        <span class="ai-result-label" style="font-weight: 500; color: #6b7280;">üè¶ Ë≥¨Ëôü</span>
                        <span class="ai-result-value" style="color: #1f2937; font-weight: 600;">${data.accountNumber || '‚Äî'}</span>
                    </div>
                    <div class="ai-result-item" style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #f3f4f6;">
                        <span class="ai-result-label" style="font-weight: 500; color: #6b7280;">üèõÔ∏è ÈäÄË°åÂêçÁ®±</span>
                        <span class="ai-result-value" style="color: #1f2937; font-weight: 600;">${data.bankName || '‚Äî'}</span>
                    </div>
                    <div class="ai-result-item" style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #f3f4f6;">
                        <span class="ai-result-label" style="font-weight: 500; color: #6b7280;">üìÖ Â∞çË≥¨ÂñÆÊúüÈñì</span>
                        <span class="ai-result-value" style="color: #1f2937; font-weight: 600;">${data.startDate || '‚Äî'} Ëá≥ ${data.endDate || '‚Äî'}</span>
                    </div>
                    <div class="ai-result-item" style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #f3f4f6;">
                        <span class="ai-result-label" style="font-weight: 500; color: #6b7280;">üí∞ Ëµ∑ÂßãÈ§òÈ°ç</span>
                        <span class="ai-result-value" style="color: #10b981; font-weight: 600;">$${data.startBalance?.toFixed(2) || '0.00'}</span>
                    </div>
                    <div class="ai-result-item" style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #f3f4f6;">
                        <span class="ai-result-label" style="font-weight: 500; color: #6b7280;">üí∞ ÁµêÊùüÈ§òÈ°ç</span>
                        <span class="ai-result-value" style="color: #10b981; font-weight: 600;">$${data.endBalance?.toFixed(2) || '0.00'}</span>
                    </div>
                    <div class="ai-result-item" style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #f3f4f6;">
                        <span class="ai-result-label" style="font-weight: 500; color: #6b7280;">üìä ‰∫§ÊòìÊï∏Èáè</span>
                        <span class="ai-result-value" style="color: #1f2937; font-weight: 600;">${data.transactionCount || 0} Á≠Ü</span>
                    </div>
                `;
            } else {
                // È°ØÁ§∫ÈÄöÁî®Â≠óÊÆµ
                resultHTML += `
                    <div class="ai-result-item" style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #f3f4f6;">
                        <span class="ai-result-label" style="font-weight: 500; color: #6b7280;">üìÖ Êó•Êúü</span>
                        <span class="ai-result-value" style="color: #1f2937; font-weight: 600;">${data.date}</span>
                    </div>
                    <div class="ai-result-item" style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #f3f4f6;">
                        <span class="ai-result-label" style="font-weight: 500; color: #6b7280;">üè¢ ÂïÜÊà∂/ÂÖ¨Âè∏</span>
                        <span class="ai-result-value" style="color: #1f2937; font-weight: 600;">${data.merchant || '‚Äî'}</span>
                    </div>
                    <div class="ai-result-item" style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #f3f4f6;">
                        <span class="ai-result-label" style="font-weight: 500; color: #6b7280;">üí∞ ÈáëÈ°ç</span>
                        <span class="ai-result-value" style="color: #10b981; font-weight: 600;">${data.currency} ${data.amount}</span>
                    </div>
                    <div class="ai-result-item" style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #f3f4f6;">
                        <span class="ai-result-label" style="font-weight: 500; color: #6b7280;">üìù ÊèèËø∞</span>
                        <span class="ai-result-value" style="color: #1f2937; font-weight: 600;">${data.description || 'ÁÑ°'}</span>
                    </div>
                `;
            }
            
            resultsContent.innerHTML = resultHTML;
            resultsContainer.style.display = 'block';
        }
        
        function saveAIResults() {
            if (!aiProcessingResults.extractedData) {
                alert('Ê≤íÊúâÂèØ‰øùÂ≠òÁöÑÊï∏Êìö');
                return;
            }
            
            try {
                // Áç≤ÂèñÁï∂ÂâçÈ†ÖÁõÆ ID
                const projectId = getCurrentProjectId();
                console.log('üíæ Ê∫ñÂÇô‰øùÂ≠òÊñá‰ª∂Âà∞È†ÖÁõÆ:', projectId);
                
                if (!projectId) {
                    alert('ÁÑ°Ê≥ïÁ¢∫ÂÆöÁï∂ÂâçÈ†ÖÁõÆ');
                    return;
                }
                
                // ‰øùÂ≠òÂà∞ localStorage
                const storageKey = `vaultcaddy_project_${projectId}_documents`;
                const existingDocs = JSON.parse(localStorage.getItem(storageKey) || '[]');
                
                console.log('üìÇ ÁèæÊúâÊñáÊ™îÊï∏Èáè:', existingDocs.length);
                
                const newDocument = {
                    id: Date.now().toString(),
                    ...aiProcessingResults.extractedData,
                    projectId: projectId,
                    createdAt: new Date().toISOString()
                };
                
                existingDocs.push(newDocument);
                localStorage.setItem(storageKey, JSON.stringify(existingDocs));
                
                console.log('‚úÖ ÊñáÊ™îÂ∑≤‰øùÂ≠òÔºåÊñ∞ÊñáÊ™îÊï∏Èáè:', existingDocs.length);
                console.log('üíæ Â≠òÂÑ≤Èçµ:', storageKey);
                console.log('üìÑ ÊñáÊ™îË©≥ÊÉÖ:', newDocument);
                
                logAI('‚úÖ Êï∏ÊìöÂ∑≤‰øùÂ≠òÂà∞È†ÖÁõÆ ' + projectId, 'success');
                alert(`ÊñáÊ™îÂ∑≤ÊàêÂäü‰øùÂ≠òÂà∞È†ÖÁõÆ ${projectId}ÔºÅ`);
                
                // ÈóúÈñâÊ®°ÊÖãÊ°Ü‰∏¶Âà∑Êñ∞È†ÅÈù¢
                closeAIUploadModal();
                location.reload();
                
            } catch (error) {
                logAI(`‚ùå ‰øùÂ≠òÂ§±Êïó: ${error.message}`, 'error');
                alert('‰øùÂ≠òÂ§±ÊïóÔºåË´ãÈáçË©¶');
            }
        }
        window.saveAIResults = saveAIResults;
        
        function resetAIUpload() {
            // ÈáçÁΩÆÊâÄÊúâÁãÄÊÖã
            aiCurrentFile = null;
            aiIsProcessing = false;
            aiProcessingResults = {};
            
            // ÈáçÁΩÆ UI
            document.getElementById('aiUploadArea').style.display = 'block';
            document.getElementById('aiProgressContainer').style.display = 'none';
            document.getElementById('aiLogContainer').style.display = 'none';
            document.getElementById('aiResultsContainer').style.display = 'none';
            
            // Ê∏ÖÁ©∫ÂÖßÂÆπ
            document.getElementById('aiLogContent').innerHTML = '';
            document.getElementById('aiResultsContent').innerHTML = '';
            document.getElementById('aiFileInput').value = '';
            
            // ÈáçÁΩÆÈÄ≤Â∫¶
            updateAIProgress(0);
            for (let i = 1; i <= 4; i++) {
                updateAIStep(i, '');
            }
        }
        window.resetAIUpload = resetAIUpload;
        
        function closeUploadModal() {
            const modal = document.getElementById('upload-modal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                // Ê∏ÖÁêÜÊñá‰ª∂Ëº∏ÂÖ•
                const fileInput = document.getElementById('modal-file-input');
                if (fileInput) {
                    fileInput.value = '';
                }
                clearFilePreview();
            }
        }
        
        function clearFilePreview() {
            const preview = document.getElementById('file-preview-area');
            if (preview) {
                preview.innerHTML = '<p>ÊãñÊîæÊñá‰ª∂Âà∞ÈÄôË£°ÊàñÈªûÊìäÈÅ∏ÊìáÊñá‰ª∂</p>';
                preview.className = 'file-drop-area';
            }
        }
        
        function handleModalFileSelect() {
            const fileInput = document.getElementById('modal-file-input');
            if (fileInput) {
                fileInput.click();
            }
        }
        
        function handleFileInputChange(event) {
            const files = event.target.files;
            if (files && files.length > 0) {
                displayFilePreview(files);
            }
        }
        
        function displayFilePreview(files) {
            const preview = document.getElementById('file-preview-area');
            if (!preview) return;
            
            let html = '<div class="file-list"><h4>ÈÅ∏‰∏≠ÁöÑÊñá‰ª∂:</h4>';
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                html += `
                    <div class="file-item">
                        <i class="fas fa-file-pdf"></i>
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${fileSize} MB</div>
                        </div>
                        <button onclick="removeFile(${i})" class="remove-file-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            }
            html += '</div>';
            preview.innerHTML = html;
            preview.className = 'file-drop-area has-files';
        }
        
        async function processSelectedFiles() {
            console.log('üöÄ ÈñãÂßãËôïÁêÜÈÅ∏‰∏≠ÁöÑÊñá‰ª∂...');
            
            const fileInput = document.getElementById('modal-file-input');
            if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
                console.error('‚ùå Ê≤íÊúâÈÅ∏‰∏≠ÁöÑÊñá‰ª∂');
                alert('Ë´ãÂÖàÈÅ∏ÊìáË¶Å‰∏äÂÇ≥ÁöÑÊñá‰ª∂');
                return;
            }
            
            console.log(`üìÅ ÊâæÂà∞ ${fileInput.files.length} ÂÄãÊñá‰ª∂:`, Array.from(fileInput.files).map(f => f.name));
            
            // ËΩâÊèõÁÇ∫Êï∏ÁµÑ‰∏¶Ë®òÈåÑË©≥Á¥∞‰ø°ÊÅØ
            const files = Array.from(fileInput.files);
            console.log('üìÑ Êñá‰ª∂Ë©≥ÊÉÖ:', files.map(f => ({
                name: f.name,
                size: f.size,
                type: f.type,
                lastModified: f.lastModified
            })));
            
            // Áç≤ÂèñÁï∂ÂâçÊñáÊ™îÈ°ûÂûã
            const hash = window.location.hash.substring(1);
            const currentDocType = hash || 'bank-statement';
            
            closeUploadModal();
            showProcessingStatus(files);
            
            try {
                // ‰ΩøÁî®Áµ±‰∏ÄËôïÁêÜÂô®ËôïÁêÜÊñá‰ª∂
                if (window.UnifiedDocumentProcessor) {
                    console.log('üéØ ‰ΩøÁî®Áµ±‰∏ÄËôïÁêÜÂô®ËôïÁêÜÊñá‰ª∂...');
                    
                    const processingResults = await window.UnifiedDocumentProcessor.processUploadedFiles(files, currentDocType);
                    
                    console.log('‚úÖ Áµ±‰∏ÄËôïÁêÜÂô®ËôïÁêÜÂÆåÊàê:', processingResults);
                    
                    // Ê™¢Êü•ÊòØÂê¶ÊúâËôïÁêÜÂ§±ÊïóÁöÑÊñá‰ª∂
                    const failedFiles = processingResults.filter(r => r.status === 'error');
                    if (failedFiles.length > 0) {
                        console.error('‚ùå ÈÉ®ÂàÜÊñá‰ª∂ËôïÁêÜÂ§±Êïó:', failedFiles);
                        alert(`${failedFiles.length} ÂÄãÊñá‰ª∂ËôïÁêÜÂ§±ÊïóÔºö${failedFiles.map(f => f.error).join(', ')}`);
                    }
                    
                    // Âè™Ê∑ªÂä†ÊàêÂäüËôïÁêÜÁöÑÊñá‰ª∂Âà∞Ë°®Ê†º
                    const successfulFiles = files.filter((_, index) => 
                        processingResults[index] && processingResults[index].status === 'success'
                    );
                    
                    if (successfulFiles.length > 0) {
                        addProcessedFilesToTable(successfulFiles);
                        
                        // ‰øùÂ≠òËôïÁêÜÁµêÊûúÂà∞Áµ±‰∏ÄÂ≠òÂÑ≤
                        saveUnifiedProcessingResults(processingResults, currentDocType);
                        
                        showSuccessNotification(successfulFiles.length);
                    }
                } else {
                    // ÂÖúÂ∫ïÔºö‰ΩøÁî®ÂéüÊúâÁöÑÊ®°Êì¨ËôïÁêÜ
                    console.log('‚ö†Ô∏è Áµ±‰∏ÄËôïÁêÜÂô®Êú™ËºâÂÖ•Ôºå‰ΩøÁî®Ê®°Êì¨ËôïÁêÜ');
                    setTimeout(() => {
                        addProcessedFilesToTable(files);
                        showSuccessNotification(files.length);
                        hideProcessingStatus();
                    }, 2000);
                    return;
                }
                
                // Êõ¥Êñ∞Áµ±Ë®à
                updateDocumentStats();
                
            } catch (error) {
                console.error('‚ùå ËôïÁêÜÊñá‰ª∂ÊôÇÂá∫ÈåØ:', error);
                alert(`ËôïÁêÜÊñá‰ª∂ÊôÇÂá∫ÁèæÈåØË™§Ôºö${error.message}`);
            } finally {
                hideProcessingStatus();
            }
        }
        
        // ‰øùÂ≠òËôïÁêÜÁµêÊûúÂà∞localStorageÔºàËàäÁâàÊú¨Ôºå‰øùÁïôÂÖºÂÆπÊÄßÔºâ
        function saveProcessingResults(results, documentType) {
            const storageKey = `vaultcaddy_processing_results_${documentType}`;
            const existingResults = JSON.parse(localStorage.getItem(storageKey) || '[]');
            
            // Ê∑ªÂä†Êñ∞ÁöÑËôïÁêÜÁµêÊûú
            results.forEach(result => {
                if (result.status === 'success') {
                    existingResults.push(result);
                }
            });
            
            localStorage.setItem(storageKey, JSON.stringify(existingResults));
            console.log(`üíæ Â∑≤‰øùÂ≠ò ${results.length} ÂÄãËôïÁêÜÁµêÊûúÂà∞ ${storageKey}`);
        }
        
        // ‰øùÂ≠òÁµ±‰∏ÄËôïÁêÜÂô®ÁµêÊûú
        function saveUnifiedProcessingResults(results, documentType) {
            console.log(`üíæ Áµ±‰∏ÄËôïÁêÜÂô®ÁµêÊûúÂ∑≤Ëá™Âãï‰øùÂ≠òÂà∞Áµ±‰∏ÄÂ≠òÂÑ≤Á≥ªÁµ±`);
            
            // Áµ±‰∏ÄËôïÁêÜÂô®ÊúÉËá™Âãï‰øùÂ≠òÔºåÈÄôË£°Âè™ÈúÄË¶ÅËß∏ÁôºUIÊõ¥Êñ∞
            results.forEach(result => {
                if (result.status === 'success') {
                    // Ëß∏ÁôºUIÊõ¥Êñ∞‰∫ã‰ª∂
                    window.dispatchEvent(new CustomEvent('vaultcaddy:document:added', {
                        detail: { 
                            documentType: documentType,
                            fileName: result.fileName,
                            data: result.data
                        }
                    }));
                }
            });
        }
        
        function showSuccessNotification(fileCount) {
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #10b981; color: white; padding: 1rem; border-radius: 8px; z-index: 1000; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
                    <i class="fas fa-check-circle"></i> ÊàêÂäüËôïÁêÜ ${fileCount} ÂÄãÊñá‰ª∂ÔºÅ
                </div>
            `;
            document.body.appendChild(notification);
            
            // 3ÁßíÂæåËá™ÂãïÁßªÈô§ÈÄöÁü•
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        function showProcessingStatus(files) {
            // ÂèØ‰ª•È°ØÁ§∫‰∏ÄÂÄãËôïÁêÜ‰∏≠ÁöÑÈÄöÁü•
            const notification = document.createElement('div');
            notification.id = 'processing-notification';
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #3b82f6; color: white; padding: 1rem; border-radius: 8px; z-index: 1000;">
                    <i class="fas fa-spinner fa-spin"></i> Ê≠£Âú®ËôïÁêÜ ${files.length} ÂÄãÊñá‰ª∂...
                </div>
            `;
            document.body.appendChild(notification);
        }
        
        function hideProcessingStatus() {
            const notification = document.getElementById('processing-notification');
            if (notification) {
                notification.remove();
            }
        }
        
        function addProcessedFilesToTable(files) {
            console.log('üìã Ê∑ªÂä†Êñá‰ª∂Âà∞Êñá‰ª∂Â§æË¶ñÂúñÔºåÊñá‰ª∂Êï∏Èáè:', files.length);
            
            // Áç≤ÂèñÁï∂ÂâçÊñáÊ™îÈ°ûÂûã
            const hash = window.location.hash.substring(1);
            const currentDocType = hash || 'bank-statement';
            
            console.log('üìä Áï∂ÂâçÊñá‰ª∂Â§æÁãÄÊÖã:', {
                documentType: currentDocType,
                filesToAdd: files.length
            });
            
            // ÂæûlocalStorageÁç≤ÂèñÁï∂ÂâçÊñáÊ™îÈ°ûÂûãÁöÑÊñá‰ª∂ÂàóË°®
            const storageKey = `vaultcaddy_files_${currentDocType}`;
            let existingFiles = JSON.parse(localStorage.getItem(storageKey) || '[]');
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileId = `${currentDocType}_${Date.now()}_${i}`;
                const currentDate = new Date().toLocaleDateString('zh-TW');
                
                console.log(`üìÑ ËôïÁêÜÊñá‰ª∂ ${i + 1}/${files.length}:`, {
                    name: file.name,
                    size: file.size,
                    fileId: fileId,
                    documentType: currentDocType
                });
                
                // ‰øùÂ≠òÊñá‰ª∂‰ø°ÊÅØÂà∞localStorageÔºàÊåâÊñáÊ™îÈ°ûÂûãÂàÜÈõ¢Ôºâ
                const fileInfo = {
                    id: fileId,
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    documentType: currentDocType,
                    uploadDate: currentDate,
                    status: 'processing'
                };
                existingFiles.push(fileInfo);
                
                console.log(`‚úÖ Êñá‰ª∂ ${file.name} Â∑≤Ê∑ªÂä†Âà∞Â≠òÂÑ≤ (${currentDocType})`);
            }
            
            // ‰øùÂ≠òÊõ¥Êñ∞ÂæåÁöÑÊñá‰ª∂ÂàóË°®Âà∞localStorage
            localStorage.setItem(storageKey, JSON.stringify(existingFiles));
            
            console.log(`üéâ ÊâÄÊúâ ${files.length} ÂÄãÊñá‰ª∂Â∑≤ÊàêÂäüÊ∑ªÂä†Âà∞Â≠òÂÑ≤ (${currentDocType})`);
            console.log('üìä Â≠òÂÑ≤ÊúÄÁµÇÁãÄÊÖã:', {
                storageKey: storageKey,
                totalStoredFiles: existingFiles.length
            });
            
            // ÈáçÊñ∞ËºâÂÖ•Êñá‰ª∂Â§æË¶ñÂúñ
            loadFilesForDocumentType(currentDocType);
            
            // Êõ¥Êñ∞Áµ±Ë®à
            updateDocumentStats();
        }
        
        function updateDocumentStats() {
            // Êõ¥Êñ∞ÊñáÊ™îËôïÁêÜÁµ±Ë®à
            const documentRows = document.querySelectorAll('.document-row');
            const processedCount = documentRows.length;
            const statsElement = document.querySelector('[data-stat="processed-docs"]');
            if (statsElement) {
                statsElement.textContent = processedCount;
            }
            
            // Êõ¥Êñ∞ÂÅ¥ÈÇäÊ¨ÑÁµ±Ë®à
            console.log(`üìä Êõ¥Êñ∞ÊñáÊ™îÁµ±Ë®à: ${processedCount} ÂÄãÊñáÊ™î`);
        }
        
        function updateSidebarStats(newFileCount) {
            // Êõ¥Êñ∞ÂÅ¥ÈÇäÊ¨ÑÁöÑËôïÁêÜÊñáÊ™îÊï∏Èáè
            const processedElement = document.querySelector('.stat-value');
            if (processedElement && processedElement.textContent.includes('Processed Documents')) {
                const currentCount = parseInt(processedElement.textContent) || 0;
                processedElement.textContent = currentCount + newFileCount;
                console.log(`üìä ÂÅ¥ÈÇäÊ¨ÑÁµ±Ë®àÂ∑≤Êõ¥Êñ∞: +${newFileCount} ÂÄãÊñáÊ™î`);
            }
        }
        
        function showLoginPromptInDashboard() {
            console.log('üí° Âú® Dashboard ‰∏≠È°ØÁ§∫ÁôªÂÖ•ÊèêÁ§∫ËÄå‰∏çÊòØÈáçÂÆöÂêë');
            
            // Ê™¢Êü•ÊòØÂê¶Â∑≤Á∂ìÂ≠òÂú®ÊèêÁ§∫
            const existing = document.getElementById('dashboard-login-prompt');
            if (existing) return;
            
            // Âú®È†ÅÈù¢È†ÇÈÉ®È°ØÁ§∫‰∏ÄÂÄãÊ∫´ÂíåÁöÑÁôªÂÖ•ÊèêÁ§∫
            const notification = document.createElement('div');
            notification.id = 'dashboard-login-prompt';
            notification.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; background: #fef3c7; border-bottom: 1px solid #f59e0b; padding: 0.75rem; z-index: 1000; text-align: center;">
                    <p style="margin: 0; color: #92400e;">
                        <i class="fas fa-info-circle"></i> 
                        ÁÇ∫‰∫ÜÁç≤ÂæóÂÆåÊï¥ÂäüËÉΩÔºåË´ã <a href="auth.html" style="color: #b45309; text-decoration: underline;">ÈáçÊñ∞ÁôªÂÖ•</a> Êàñ 
                        <button onclick="window.location.reload()" style="background: #f59e0b; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; margin-left: 0.5rem;">ÈáçÊñ∞ËºâÂÖ•È†ÅÈù¢</button>
                        <button onclick="document.getElementById('dashboard-login-prompt').remove(); adjustPageMargin(false);" style="background: transparent; border: none; color: #92400e; margin-left: 1rem;">‚úï</button>
                    </p>
                </div>
            `;
            document.body.insertBefore(notification, document.body.firstChild);
            
            // Ë™øÊï¥È†ÅÈù¢ÂÖßÂÆπÂêë‰∏ãÂÅèÁßª
            adjustPageMargin(true);
        }
        
        function hideLoginPromptInDashboard() {
            const existing = document.getElementById('dashboard-login-prompt');
            if (existing) {
                existing.remove();
                adjustPageMargin(false);
                console.log('‚úÖ Dashboard ÁôªÂÖ•ÊèêÁ§∫Â∑≤ÁßªÈô§');
            }
        }
        
        function adjustPageMargin(hasPrompt) {
            const mainContent = document.querySelector('.dashboard-container');
            if (mainContent) {
                mainContent.style.marginTop = hasPrompt ? '60px' : '0px';
            }
        }
        
        // Êõ¥Êñ∞ Dashboard Ë∫´‰ªΩÈ©óË≠âÁãÄÊÖã
        function updateDashboardAuthState(authState) {
            console.log('üîÑ Êõ¥Êñ∞ Dashboard Ë∫´‰ªΩÈ©óË≠âÁãÄÊÖã:', authState);
            
            if (authState.isAuthenticated) {
                // Áî®Êà∂Â∑≤ÁôªÂÖ•ÔºåÁßªÈô§ÁôªÂÖ•ÊèêÁ§∫
                hideLoginPromptInDashboard();
                
                // Êõ¥Êñ∞Áî®Êà∂‰ø°ÊÅØÈ°ØÁ§∫
                updateUserInfoDisplay(authState);
                
                console.log('‚úÖ Dashboard Ë™çË≠âÁãÄÊÖã: Â∑≤ÁôªÂÖ•');
            } else {
                // Áî®Êà∂Êú™ÁôªÂÖ•ÔºåÈ°ØÁ§∫ÁôªÂÖ•ÊèêÁ§∫
                showLoginPromptInDashboard();
                console.log('‚ö†Ô∏è Dashboard Ë™çË≠âÁãÄÊÖã: Êú™ÁôªÂÖ•');
            }
        }
        
        function updateUserInfoDisplay(authState) {
            // Êõ¥Êñ∞È†ÅÈù¢‰∏≠ÁöÑÁî®Êà∂‰ø°ÊÅØÔºàÂ¶ÇÊûúÈúÄË¶ÅÔºâ
            if (authState.userEmail || authState.credits) {
                console.log('üìä Êõ¥Êñ∞Áî®Êà∂‰ø°ÊÅØÈ°ØÁ§∫:', {
                    email: authState.userEmail,
                    credits: authState.credits
                });
                
                // Ëß∏ÁôºÂ∞éËà™Ê¨ÑÊõ¥Êñ∞
                if (window.VaultCaddyNavbar && window.VaultCaddyNavbar.loadUserState) {
                    window.VaultCaddyNavbar.loadUserState();
                }
            }
        }

        function toggleView() {
            alert('View toggle functionality will be implemented.');
        }

        function showActionMenu(event, documentId) {
            alert(`Action menu for ${documentId} will be shown here.`);
        }

        // Âà™Èô§‰∫§ÊòìË°å
        function deleteTransaction(button) {
            if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÁ≠Ü‰∫§ÊòìÂóéÔºü')) {
                const row = button.closest('tr');
                row.remove();
                
                // ÈáçÊñ∞Ë®àÁÆóÈ§òÈ°ç
                recalculateBalances();
            }
        }
        
        // ÈáçÊñ∞Ë®àÁÆóÊâÄÊúâÈ§òÈ°ç
        function recalculateBalances() {
            const rows = document.querySelectorAll('#transactions-tbody tr');
            let runningBalance = 0;
            
            rows.forEach((row, index) => {
                const amountInput = row.querySelector('.amount-input');
                const balanceInput = row.querySelector('.balance-input');
                
                if (amountInput && balanceInput) {
                    const amount = parseFloat(amountInput.value) || 0;
                    runningBalance += amount;
                    balanceInput.value = runningBalance.toFixed(2);
                }
            });
        }
        
        // Áõ£ËÅΩÈáëÈ°çËÆäÂåñ‰∏¶Ëá™ÂãïÈáçÊñ∞Ë®àÁÆóÈ§òÈ°ç
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('amount-input')) {
                recalculateBalances();
            }
        });
        
        // Ê®ôÁ±§ÂàáÊèõ
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('tab-btn')) {
                // ÁßªÈô§ÊâÄÊúâÊ¥ªË∫çÁãÄÊÖã
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                // Ê∑ªÂä†Ê¥ªË∫çÁãÄÊÖãÂà∞ÈªûÊìäÁöÑÊ®ôÁ±§
                e.target.classList.add('active');
            }
        });
    </script>

    <!-- ÂéüÂßã‰∏äÂÇ≥Ê®°ÊÖãÊ°ÜÂ∑≤ÁßªÈô§ÔºåÁµ±‰∏Ä‰ΩøÁî®LedgerBoxÈ¢®Ê†ºÊ®°ÊÖãÊ°Ü -->

    <style>
        /* ‰∏äÂÇ≥Ê®°ÊÖãÊ°ÜÊ®£Âºè */
        .upload-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .modal-content {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            z-index: 1001;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #1f2937;
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .modal-close-btn {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .modal-close-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .file-drop-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 1.5rem;
            background: #f9fafb;
        }
        
        .file-drop-area:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        .file-drop-area.has-files {
            border-style: solid;
            border-color: #10b981;
            background: #f0fdf4;
        }
        
        .file-list h4 {
            margin: 0 0 1rem 0;
            color: #1f2937;
            text-align: left;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-bottom: 0.5rem;
        }
        
        .file-item i {
            color: #ef4444;
            font-size: 1.25rem;
            margin-right: 0.75rem;
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-name {
            font-weight: 500;
            color: #1f2937;
        }
        
        .file-size {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .remove-file-btn {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .remove-file-btn:hover {
            background: #fef2f2;
            color: #ef4444;
        }
        
        .upload-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        .file-types ul {
            margin: 0.5rem 0 0 0;
            padding-left: 1.5rem;
            color: #6b7280;
        }
        
        .processing-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .processing-options label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #374151;
            cursor: pointer;
        }
        
        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: #ffffff;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        /* ÁãÄÊÖãÂæΩÁ´†Ê®£Âºè */
        .status-badge.processing {
            background: #fef3c7;
            color: #92400e;
        }
        
        .review-badge.pending {
            background: #fee2e2;
            color: #991b1b;
        }
        
        @media (max-width: 768px) {
            .upload-options {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <script>
        // ËºîÂä©ÂáΩÊï∏ÔºöÊ†ºÂºèÂåñÊñá‰ª∂Â§ßÂ∞è
        function formatFileSize(bytes) {
            if (!bytes || bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }
        
        // ÂâµÂª∫ÊñáÊ™îË°®Ê†ºË°å
        function createDocumentRow(tbody, file) {
            const row = document.createElement('tr');
            row.className = 'document-row';
            row.setAttribute('data-file-id', file.id);
            row.style.cssText = 'background: #ffffff; border-bottom: 1px solid #e5e7eb;';
            
            // ÂÆâÂÖ®Âú∞Áç≤ÂèñÊó•ÊúüÔºåÈÅøÂÖç Invalid Date
            let uploadDate = '‚Äî';
            try {
                const dateValue = file.uploadTime || file.uploadDate || file.createdAt;
                if (dateValue) {
                    const date = new Date(dateValue);
                    if (!isNaN(date.getTime())) {
                        uploadDate = date.toLocaleDateString('zh-TW');
                    }
                }
            } catch (e) {
                console.error('Êó•ÊúüËß£ÊûêÈåØË™§:', e);
            }
            
            const fileSize = formatFileSize(file.size || file.fileSize || 0);
            
            // Âæû processedData ‰∏≠ÊèêÂèñÁúüÂØ¶Êï∏ÊìöÔºåÁ¢∫‰øù‰∏çÊúÉÊòØ undefined
            const data = file.processedData || {};
            
            // Ê™¢Êü•ÊòØÂê¶Ê≠£Âú®ËôïÁêÜ‰∏≠
            const isProcessing = file.isProcessing || file.status === 'Processing';
            const processingProgress = file.processingProgress || 0;
            
            // Á¢∫ÂÆöÊñáÊ™îÈ°ûÂûã
            const docType = data.documentType || 'Bank Statement';
            
            // Status
            const status = isProcessing ? 'In Progress' : (data.status || 'Success');
            const statusColor = status === 'Success' || status === 'Completed' ? '#10b981' : '#f59e0b';
            const statusIcon = status === 'Success' || status === 'Completed' ? '‚úì' : '‚óè';
            
            // Review Status
            const reviewStatus = isProcessing ? 'Processing' : (data.reviewStatus || 'Review');
            const reviewColor = reviewStatus === 'Approved' ? '#10b981' : '#f59e0b';
            
            // Ê†πÊìöÊñáÊ™îÈ°ûÂûãÁîüÊàê‰∏çÂêåÁöÑË°åÂÖßÂÆπ
            let rowHTML = '';
            if (docType === 'Invoice') {
                rowHTML = createInvoiceRowHTML(file, data, isProcessing, status, statusColor, statusIcon, reviewStatus, reviewColor, uploadDate);
            } else {
                // ÈäÄË°åÂ∞çÂ∏≥ÂñÆÂíåÂÖ∂‰ªñÈ°ûÂûã‰ΩøÁî®ÂéüÊúâÁöÑÈ°ØÁ§∫Ê†ºÂºè
                // Statement Period
                const startDate = data.startDate || data.statementStartDate || '‚Äî';
                const endDate = data.endDate || data.statementEndDate || '‚Äî';
                const periodText = (startDate !== '‚Äî' && endDate !== '‚Äî') 
                    ? `${startDate} to ${endDate}` 
                    : isProcessing ? 'ËôïÁêÜ‰∏≠...' : '‚Äî';
                const transactionCount = data.transactions?.length || data.transactionCount || 0;
                const transactionsText = transactionCount > 0 
                    ? `${transactionCount} transactions` 
                    : isProcessing ? '' : '‚Äî';
                
                // Reconciliation - Â¶ÇÊûúÊ≠£Âú®ËôïÁêÜÔºåÂè™È°ØÁ§∫ÈÄ≤Â∫¶ÁôæÂàÜÊØî
                let reconciliationHTML;
                if (isProcessing) {
                    reconciliationHTML = `
                        <div>
                            <div style="font-weight: 500; color: #f59e0b; display: flex; align-items: center; gap: 0.5rem;">
                                <span>${processingProgress}%</span>
                            </div>
                            <div style="margin-top: 0.25rem; background: #e5e7eb; height: 6px; border-radius: 3px; overflow: hidden;">
                                <div style="background: #f59e0b; height: 100%; width: ${processingProgress}%; transition: width 0.3s ease;"></div>
                            </div>
                        </div>
                    `;
                } else {
                    const reconciledCount = data.reconciledTransactions || 0;
                    const totalTransactions = transactionCount;
                    const reconciledPercent = totalTransactions > 0 
                        ? Math.round((reconciledCount / totalTransactions) * 100) 
                        : 0;
                    reconciliationHTML = `
                        <div>
                            <div style="font-weight: 500; color: #1f2937;">${reconciledCount}/${totalTransactions}</div>
                            <div style="margin-top: 0.25rem; background: #e5e7eb; height: 6px; border-radius: 3px; overflow: hidden;">
                                <div style="background: #3b82f6; height: 100%; width: ${reconciledPercent}%; transition: width 0.3s ease;"></div>
                            </div>
                        </div>
                    `;
                }
                
                // Balance Info
                const startBalance = data.startBalance || data.openingBalance || data.beginningBalance || 0;
                const endBalance = data.endBalance || data.closingBalance || data.endingBalance || 0;
                const formattedStartBalance = typeof startBalance === 'number' 
                    ? `$${startBalance.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}` 
                    : isProcessing ? '‚Äî' : startBalance;
                const formattedEndBalance = typeof endBalance === 'number' 
                    ? `$${endBalance.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}` 
                    : isProcessing ? '‚Äî' : endBalance;
                
                rowHTML = `
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <input type="checkbox" class="file-checkbox" onchange="updateSelection()">
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-file-pdf" style="color: #ef4444;"></i>
                        <div>
                            <div style="font-weight: 500; color: #1f2937;">
                                <a href="javascript:void(0)" onclick="viewDocument('${file.id}')" style="color: #1f2937; text-decoration: none; cursor: pointer;">
                                    ${file.name || file.fileName || data.fileName || 'Êú™ÂëΩÂêçÊñá‰ª∂'}
                                </a>
                            </div>
                            <div style="font-size: 0.875rem; color: #6b7280;">${data.accountHolder || data.accountName || (isProcessing ? 'ËôïÁêÜ‰∏≠...' : '')}</div>
                            <div style="font-size: 0.75rem; color: #9ca3af;">${data.accountNumber || ''}</div>
                        </div>
                    </div>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <div>
                        <div style="font-weight: 500; color: #1f2937;">üìÖ ${periodText}</div>
                        <div style="font-size: 0.875rem; color: #6b7280;">${transactionsText}</div>
                    </div>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    ${reconciliationHTML}
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <div>
                        <div style="font-size: 0.875rem; color: #6b7280;">Start: ${formattedStartBalance}</div>
                        <div style="font-size: 0.875rem; color: #6b7280;">End: ${formattedEndBalance}</div>
                    </div>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <span style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500; background: ${statusColor}15; color: ${statusColor};">
                        ${statusIcon} ${status}
                    </span>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <span style="display: inline-flex; align-items: center; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500; background: ${reviewColor}15; color: ${reviewColor};">
                        ‚óè ${reviewStatus}
                    </span>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <span style="color: #6b7280; font-size: 0.875rem;">${data.notes || '‚Äî'}</span>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <span style="color: #6b7280; font-size: 0.875rem;">${uploadDate}</span>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="viewDocument('${file.id}')" style="padding: 0.5rem; background: transparent; border: none; color: #6b7280; cursor: pointer; border-radius: 4px; transition: all 0.2s;" onmouseover="this.style.background='#f3f4f6'; this.style.color='#1f2937'" onmouseout="this.style.background='transparent'; this.style.color='#6b7280'" title="Êü•Áúã">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="deleteDocument('${file.id}')" style="padding: 0.5rem; background: transparent; border: none; color: #6b7280; cursor: pointer; border-radius: 4px; transition: all 0.2s;" onmouseover="this.style.background='#fef2f2'; this.style.color='#ef4444'" onmouseout="this.style.background='transparent'; this.style.color='#6b7280'" title="Âà™Èô§">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button onclick="openActionMenu('${file.id}', event)" style="padding: 0.5rem; background: transparent; border: none; color: #6b7280; cursor: pointer; border-radius: 4px; transition: all 0.2s;" onmouseover="this.style.background='#f3f4f6'; this.style.color='#1f2937'" onmouseout="this.style.background='transparent'; this.style.color='#6b7280'" title="Êõ¥Â§ö">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </td>
            `;
            }
            
            row.innerHTML = rowHTML;
            tbody.appendChild(row);
            console.log('‚úÖ Êñá‰ª∂Ë°åÂ∑≤Ê∑ªÂä†Âà∞Ë°®Ê†º:', file.name || file.fileName, 'È°ûÂûã:', docType);
        }
        
        // ÂâµÂª∫ÁôºÁ•®Ë°å
        function createInvoiceRowHTML(file, data, isProcessing, status, statusColor, statusIcon, reviewStatus, reviewColor, uploadDate) {
            const invoiceNumber = data.invoiceNumber || '‚Äî';
            const issueDate = data.issueDate || (isProcessing ? 'ËôïÁêÜ‰∏≠...' : '‚Äî');
            const deliveryDate = data.deliveryDate || '';
            const vendorName = data.vendor?.name || (isProcessing ? 'ËôïÁêÜ‰∏≠...' : '‚Äî');
            const customerName = data.customer?.name || (isProcessing ? 'ËôïÁêÜ‰∏≠...' : '‚Äî');
            const itemCount = data.itemCount || data.lineItems?.length || 0;
            const subtotal = data.subtotal || 0;
            const discount = data.discount || 0;
            const totalAmount = data.totalAmount || 0;
            const currency = data.currency || 'HKD';
            const paymentMethod = data.paymentMethod || '‚Äî';
            
            return `
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <input type="checkbox" class="file-checkbox" onchange="updateSelection()">
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-file-invoice" style="color: #3b82f6;"></i>
                        <div>
                            <div style="font-weight: 500; color: #1f2937;">
                                <a href="javascript:void(0)" onclick="viewDocument('${file.id}')" style="color: #1f2937; text-decoration: none; cursor: pointer;">
                                    üìÑ Invoice ${invoiceNumber}
                                </a>
                            </div>
                            <div style="font-size: 0.875rem; color: #6b7280;">‰æõÊáâÂïÜ: ${vendorName}</div>
                            <div style="font-size: 0.75rem; color: #9ca3af;">ÂÆ¢Êà∂: ${customerName}</div>
                        </div>
                    </div>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <div>
                        <div style="font-weight: 500; color: #1f2937;">üìÖ ${issueDate}</div>
                        ${deliveryDate ? `<div style="font-size: 0.875rem; color: #6b7280;">ÈÄÅË≤®: ${deliveryDate}</div>` : ''}
                    </div>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <div style="font-weight: 500; color: #1f2937;">${itemCount} È†ÖÂïÜÂìÅ</div>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <div>
                        <div style="font-size: 0.875rem; color: #6b7280;">Â∞èË®à: ${currency} $${subtotal.toFixed(2)}</div>
                        ${discount > 0 ? `<div style="font-size: 0.875rem; color: #10b981;">ÊäòÊâ£: -$${discount.toFixed(2)}</div>` : ''}
                        <div style="font-weight: 500; color: #1f2937;">Á∏ΩÈ°ç: ${currency} $${totalAmount.toFixed(2)}</div>
                    </div>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <span style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500; background: ${statusColor}15; color: ${statusColor};">
                        ${statusIcon} ${status}
                    </span>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <span style="display: inline-flex; align-items: center; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500; background: ${reviewColor}15; color: ${reviewColor};">
                        ‚óè ${reviewStatus}
                    </span>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <span style="color: #6b7280; font-size: 0.875rem;">${paymentMethod}</span>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <span style="color: #6b7280; font-size: 0.875rem;">${uploadDate}</span>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="viewDocument('${file.id}')" style="padding: 0.5rem; background: transparent; border: none; color: #6b7280; cursor: pointer; border-radius: 4px; transition: all 0.2s;" onmouseover="this.style.background='#f3f4f6'; this.style.color='#1f2937'" onmouseout="this.style.background='transparent'; this.style.color='#6b7280'" title="Êü•Áúã">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="deleteDocument('${file.id}')" style="padding: 0.5rem; background: transparent; border: none; color: #6b7280; cursor: pointer; border-radius: 4px; transition: all 0.2s;" onmouseover="this.style.background='#fef2f2'; this.style.color='#ef4444'" onmouseout="this.style.background='transparent'; this.style.color='#6b7280'" title="Âà™Èô§">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button onclick="openActionMenu('${file.id}', event)" style="padding: 0.5rem; background: transparent; border: none; color: #6b7280; cursor: pointer; border-radius: 4px; transition: all 0.2s;" onmouseover="this.style.background='#f3f4f6'; this.style.color='#1f2937'" onmouseout="this.style.background='transparent'; this.style.color='#6b7280'" title="Êõ¥Â§ö">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </td>
            `;
        }
        
        // Êõ¥Êñ∞ÂàÜÈ†Å‰ø°ÊÅØ
        function updatePaginationInfo(totalRows) {
            const selectionInfo = document.getElementById('selection-info');
            const pageInfo = document.getElementById('page-info');
            
            if (selectionInfo) {
                selectionInfo.textContent = `0 of ${totalRows} row(s) selected.`;
            }
            
            if (pageInfo) {
                const totalPages = Math.ceil(totalRows / 10);
                pageInfo.textContent = `Page 1 of ${totalPages}`;
            }
        }
        
        // ÂàÜÈ†ÅÊéßÂà∂ÂáΩÊï∏
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('select-all');
            const fileCheckboxes = document.querySelectorAll('.file-checkbox');
            
            fileCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            updateSelection();
        }
        
        function updateSelection() {
            const fileCheckboxes = document.querySelectorAll('.file-checkbox');
            const checkedBoxes = document.querySelectorAll('.file-checkbox:checked');
            const selectionInfo = document.getElementById('selection-info');
            
            if (selectionInfo) {
                selectionInfo.textContent = `${checkedBoxes.length} of ${fileCheckboxes.length} row(s) selected.`;
            }
        }
        
        function changeRowsPerPage() {
            const rowsPerPage = document.getElementById('rows-per-page').value;
            console.log('Êõ¥ÊîπÊØèÈ†ÅË°åÊï∏:', rowsPerPage);
            // ÈáçÊñ∞ËºâÂÖ•Áï∂ÂâçÊñáÊ™îÈ°ûÂûã
            const currentDocType = getCurrentDocumentType();
            loadFilesForDocumentType(currentDocType);
        }
        
        function goToFirstPage() {
            console.log('ÂâçÂæÄÁ¨¨‰∏ÄÈ†Å');
        }
        
        function goToPreviousPage() {
            console.log('ÂâçÂæÄ‰∏ä‰∏ÄÈ†Å');
        }
        
        function goToNextPage() {
            console.log('ÂâçÂæÄ‰∏ã‰∏ÄÈ†Å');
        }
        
        function goToLastPage() {
            console.log('ÂâçÂæÄÊúÄÂæå‰∏ÄÈ†Å');
        }
        
        // ÊñáÊ™îÊìç‰ΩúÂáΩÊï∏
        function viewDocument(fileId) {
            console.log('Êü•ÁúãÊñáÊ™î:', fileId);
            // Ë∑≥ËΩâÂà∞ÊñáÊ™îË©≥ÊÉÖÈ†ÅÈù¢
            const projectId = getCurrentProjectId();
            window.location.href = `document-detail.html?id=${fileId}&project=${projectId}`;
        }
        
        function downloadDocument(fileId) {
            console.log('‰∏ãËºâÊñáÊ™î:', fileId);
            // ÂØ¶Áèæ‰∏ãËºâÂäüËÉΩ
        }
        
        function deleteDocument(fileId) {
            console.log('üóëÔ∏è Ê∫ñÂÇôÂà™Èô§ÊñáÊ™î:', fileId);
            
            if (!confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÂÄãÊñáÊ™îÂóéÔºü')) {
                console.log('‚ùå Áî®Êà∂ÂèñÊ∂àÂà™Èô§');
                return;
            }
            
            try {
                // 1. Áç≤ÂèñÁï∂ÂâçÈ†ÖÁõÆ ID
                const projectId = getCurrentProjectId();
                if (!projectId) {
                    console.error('‚ùå ÁÑ°Ê≥ïÁç≤ÂèñÈ†ÖÁõÆ ID');
                    alert('ÁÑ°Ê≥ïÂà™Èô§ÊñáÊ™îÔºöÊâæ‰∏çÂà∞È†ÖÁõÆ ID');
                    return;
                }
                
                console.log('üìÇ È†ÖÁõÆ ID:', projectId);
                
                // 2. Âæû localStorage ‰∏≠Âà™Èô§ÊñáÊ™î
                const storageKey = `vaultcaddy_project_${projectId}_documents`;
                const documents = JSON.parse(localStorage.getItem(storageKey) || '[]');
                
                console.log('üìÑ Âà™Èô§ÂâçÊñáÊ™îÊï∏Èáè:', documents.length);
                
                // ÊâæÂà∞‰∏¶Âà™Èô§ÊñáÊ™î
                const filteredDocuments = documents.filter(doc => doc.id !== fileId);
                
                if (filteredDocuments.length === documents.length) {
                    console.warn('‚ö†Ô∏è Êú™ÊâæÂà∞Ë¶ÅÂà™Èô§ÁöÑÊñáÊ™î:', fileId);
                    alert('Êâæ‰∏çÂà∞Ë¶ÅÂà™Èô§ÁöÑÊñáÊ™î');
                    return;
                }
                
                // ‰øùÂ≠òÊõ¥Êñ∞ÂæåÁöÑÊñáÊ™îÂàóË°®
                localStorage.setItem(storageKey, JSON.stringify(filteredDocuments));
                console.log('‚úÖ ÊñáÊ™îÂ∑≤ÂæûÂ≠òÂÑ≤‰∏≠Âà™Èô§ÔºåÂâ©È§òÊñáÊ™îÊï∏Èáè:', filteredDocuments.length);
                
                // 3. Âæû DOM ‰∏≠ÁßªÈô§Ë°å
                const row = document.querySelector(`[data-file-id="${fileId}"]`);
                if (row) {
                    row.remove();
                    console.log('‚úÖ ÊñáÊ™îË°åÂ∑≤Âæû DOM ‰∏≠ÁßªÈô§');
                }
                
                // 4. Êõ¥Êñ∞Áµ±Ë®àÂíåÁ©∫ÁãÄÊÖã
                updateDocumentStats();
                updatePaginationInfo(filteredDocuments.length);
                
                // 5. Â¶ÇÊûúÊ≤íÊúâÊñáÊ™î‰∫ÜÔºåÈ°ØÁ§∫Á©∫ÁãÄÊÖã
                if (filteredDocuments.length === 0) {
                    const emptyState = document.getElementById('empty-state');
                    if (emptyState) {
                        emptyState.style.display = 'block';
                        console.log('üì≠ È°ØÁ§∫Á©∫ÁãÄÊÖã');
                    }
                }
                
                console.log('üéâ ÊñáÊ™îÂà™Èô§ÊàêÂäüÔºÅ');
                
            } catch (error) {
                console.error('‚ùå Âà™Èô§ÊñáÊ™îÊôÇÂá∫ÈåØ:', error);
                alert('Âà™Èô§ÊñáÊ™îÂ§±ÊïóÔºö' + error.message);
            }
        }
        
        // Ë™øË©¶ÂáΩÊï∏ÔºöÁ¢∫‰øùÈ†ÅÈù¢ÂÖßÂÆπÂèØË¶ã
        function ensurePageContentVisible() {
            console.log('üîç Ê™¢Êü•È†ÅÈù¢ÂÖßÂÆπÂèØË¶ãÊÄß...');
            
            const mainContent = document.getElementById('main-content');
            const listView = document.getElementById('document-list-view');
            const documentsTable = document.getElementById('documents-table');
            const emptyState = document.getElementById('empty-state');
            
            console.log('‰∏ªÂÖßÂÆπÂçÄÂüü:', mainContent ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®');
            console.log('ÂàóË°®Ë¶ñÂúñ:', listView ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®');
            console.log('ÊñáÊ™îË°®Ê†º:', documentsTable ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®');
            console.log('Á©∫ÁãÄÊÖã:', emptyState ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®');
            
            if (mainContent) {
                mainContent.style.display = 'block';
                mainContent.style.visibility = 'visible';
            }
            
            if (listView) {
                listView.style.display = 'block';
                listView.style.visibility = 'visible';
            }
            
            // Á¢∫‰øùËá≥Â∞ëÈ°ØÁ§∫Á©∫ÁãÄÊÖã
            if (emptyState) {
                emptyState.style.display = 'block';
                emptyState.style.visibility = 'visible';
            }
            
            console.log('‚úÖ È†ÅÈù¢ÂÖßÂÆπÂèØË¶ãÊÄßÊ™¢Êü•ÂÆåÊàê');
        }

        // Â∞éËà™Âà∞Team ProjectË¶ñÂúñ
        function navigateToTeamProject() {
            console.log('üîÑ ÂàáÊèõÂà∞Team ProjectË¶ñÂúñ');
            
            // Èö±ËóèÊâÄÊúâË¶ñÂúñ
            const allViews = document.querySelectorAll('.view-container');
            allViews.forEach(view => {
                view.style.display = 'none';
            });
            
            // È°ØÁ§∫Team ProjectË¶ñÂúñ
            const teamProjectView = document.getElementById('team-project-view');
            if (teamProjectView) {
                teamProjectView.style.display = 'block';
            }
            
            // Êõ¥Êñ∞ÂÅ¥ÈÇäÊ¨ÑÊ¥ªË∫çÁãÄÊÖã
            updateSidebarActiveState('team-project');
            
            // Êõ¥Êñ∞Â∞éËà™Ê¨ÑÊ®ôÈ°å
            updateNavbarTitle('Team Project');
            
            console.log('‚úÖ Â∑≤ÂàáÊèõÂà∞Team ProjectË¶ñÂúñ');
        }
        
        // Â∞éËà™Âà∞ÈäÄË°åÂ∞çÂ∏≥ÂñÆË¶ñÂúñ
        function navigateToBankStatement() {
            console.log('üîÑ ÂàáÊèõÂà∞ÈäÄË°åÂ∞çÂ∏≥ÂñÆË¶ñÂúñ');
            
            // Èö±ËóèÊâÄÊúâË¶ñÂúñ
            const allViews = document.querySelectorAll('.view-container');
            allViews.forEach(view => {
                view.style.display = 'none';
            });
            
            // È°ØÁ§∫ÈäÄË°åÂ∞çÂ∏≥ÂñÆË¶ñÂúñ
            const bankStatementView = document.getElementById('bank-statement-view');
            if (bankStatementView) {
                bankStatementView.style.display = 'block';
            }
            
            // Êõ¥Êñ∞ÂÅ¥ÈÇäÊ¨ÑÊ¥ªË∫çÁãÄÊÖã
            updateSidebarActiveState('bank-statement');
            
            // Êõ¥Êñ∞Â∞éËà™Ê¨ÑÊ®ôÈ°å
            updateNavbarTitle('ÂÑÄË°®Êùø');
            
            console.log('‚úÖ Â∑≤ÂàáÊèõÂà∞ÈäÄË°åÂ∞çÂ∏≥ÂñÆË¶ñÂúñ');
        }
        
        // Êõ¥Êñ∞ÂÅ¥ÈÇäÊ¨ÑÊ¥ªË∫çÁãÄÊÖã
        function updateSidebarActiveState(activeView) {
            // ÁßªÈô§ÊâÄÊúâÊ¥ªË∫çÁãÄÊÖã
            const allItems = document.querySelectorAll('.project-item, .config-item');
            allItems.forEach(item => {
                item.style.background = 'transparent';
                item.style.color = '#6b7280';
            });
            
            // Ë®≠ÁΩÆÁï∂ÂâçÊ¥ªË∫çÈ†ÖÁõÆ
            if (activeView === 'team-project') {
                const teamProjectItem = document.getElementById('team-project-item');
                if (teamProjectItem) {
                    teamProjectItem.style.background = '#eff6ff';
                    teamProjectItem.style.color = '#3b82f6';
                }
            }
        }
        
        // Êõ¥Êñ∞Â∞éËà™Ê¨ÑÊ®ôÈ°å
        function updateNavbarTitle(title) {
            const navbarTitle = document.getElementById('navbar-page-title');
            if (navbarTitle) {
                navbarTitle.textContent = title;
            }
        }
        
    </script>

    <script>
        // Âú®Á™óÂè£ÂÆåÂÖ®ËºâÂÖ•ÂæåÊ™¢Êü•Ê®°ÊÖãÊ°Ü
        window.addEventListener('load', function() {
            console.log('üéØ Window Load ‰∫ã‰ª∂Ëß∏Áôº - È†ÅÈù¢ÂÆåÂÖ®ËºâÂÖ•');
            const modalCheck = document.getElementById('aiUploadModal');
            console.log('üîç Window Load ÊôÇÊ®°ÊÖãÊ°ÜÊ™¢Êü•:', modalCheck ? '‚úÖ Â≠òÂú®' : '‚ùå ‰∏çÂ≠òÂú®');
            
            if (!modalCheck) {
                console.error('‚ùå‚ùå‚ùå Âö¥ÈáçÂïèÈ°åÔºöÁ™óÂè£ÂÆåÂÖ®ËºâÂÖ•ÂæåÊ®°ÊÖãÊ°Ü‰ªç‰∏çÂ≠òÂú®ÔºÅ');
                console.error('üìä DOM ÂÆåÊï¥Áµ±Ë®à:', {
                    Á∏ΩÂÖÉÁ¥†Êï∏: document.getElementsByTagName('*').length,
                    ÊâÄÊúâdivÊï∏Èáè: document.getElementsByTagName('div').length,
                    bodyÂ≠êÂÖÉÁ¥†Êï∏: document.body.children.length
                });
                console.error('üîç ÂòóË©¶Êü•ÊâæÊâÄÊúâ id ÂåÖÂê´ Upload ÁöÑÂÖÉÁ¥†:');
                const allElements = document.querySelectorAll('[id*="pload"], [id*="Upload"]');
                console.error('ÊâæÂà∞ÁöÑÂÖÉÁ¥†:', allElements.length);
                allElements.forEach(el => console.error('  - ID:', el.id, 'Tag:', el.tagName));
                
                // ÂàóÂá∫ body ÁöÑÊúÄÂæå 10 ÂÄãÂ≠êÂÖÉÁ¥†
                console.error('üìã Body ÁöÑÊúÄÂæå 10 ÂÄãÂ≠êÂÖÉÁ¥†:');
                const bodyChildren = Array.from(document.body.children);
                bodyChildren.slice(-10).forEach((el, i) => {
                    console.error(`  ${i}: <${el.tagName}> id="${el.id}" class="${el.className}"`);
                });
            } else {
                console.log('‚úÖ‚úÖ‚úÖ Ê®°ÊÖãÊ°ÜÂú® Window Load ÂæåÁ¢∫Ë™çÂ≠òÂú®ÔºÅ');
                console.log('üìã Ê®°ÊÖãÊ°ÜÂÆåÊï¥‰ø°ÊÅØ:', {
                    id: modalCheck.id,
                    tagName: modalCheck.tagName,
                    className: modalCheck.className,
                    display: window.getComputedStyle(modalCheck).display,
                    visibility: window.getComputedStyle(modalCheck).visibility,
                    zIndex: window.getComputedStyle(modalCheck).zIndex
                });
            }
        });
        
        // ========== ÂâµÂª∫È†ÖÁõÆÊ®°ÊÖãÊ°ÜÂáΩÊï∏ ==========
        
        // ÊâìÈñãÂâµÂª∫È†ÖÁõÆÊ®°ÊÖãÊ°Ü
        function openCreateProjectModal() {
            const modal = document.getElementById('createProjectModal');
            if (!modal) {
                console.error('‚ùå Êâæ‰∏çÂà∞ÂâµÂª∫È†ÖÁõÆÊ®°ÊÖãÊ°Ü');
                // Â¶ÇÊûúÂú® firstproject.htmlÔºåË∑≥ËΩâÂà∞ dashboard.html
                if (window.location.pathname.includes('firstproject.html')) {
                    window.location.href = 'dashboard.html';
                }
                return;
            }
            const input = document.getElementById('projectName');
            modal.classList.add('active');
            if (input) {
                input.value = '';
                input.focus();
            }
        }
        
        // ÈóúÈñâÂâµÂª∫È†ÖÁõÆÊ®°ÊÖãÊ°Ü
        function closeCreateProjectModal() {
            const modal = document.getElementById('createProjectModal');
            if (modal) {
                modal.classList.remove('active');
            }
        }
        
        // ÂâµÂª∫Êñ∞È†ÖÁõÆ
        function createProject() {
            const input = document.getElementById('projectName');
            if (!input) return;
            
            const projectName = input.value.trim();
            
            if (!projectName) {
                alert('Ë´ãËº∏ÂÖ•È†ÖÁõÆÂêçÁ®±');
                return;
            }
            
            // ÂâµÂª∫Êñ∞È†ÖÁõÆÂ∞çË±°
            const newProject = {
                id: 'project-' + Date.now(),
                name: projectName,
                thumbnail: null,
                lastModified: new Date().toISOString(),
                created: new Date().toISOString()
            };
            
            // Áç≤ÂèñÁèæÊúâÈ†ÖÁõÆ
            const projects = JSON.parse(localStorage.getItem('vaultcaddy_projects') || '[]');
            
            // Ê∑ªÂä†Êñ∞È†ÖÁõÆÂà∞ÂàóË°®ÈñãÈ†≠
            projects.unshift(newProject);
            
            // ‰øùÂ≠òÂà∞ localStorage
            localStorage.setItem('vaultcaddy_projects', JSON.stringify(projects));
            
            console.log('‚úÖ Êñ∞È†ÖÁõÆÂ∑≤ÂâµÂª∫:', newProject);
            
            // Ëß∏ÁôºÈ†ÖÁõÆÂâµÂª∫‰∫ã‰ª∂ÔºåËÆìÂÅ¥ÈÇäÊ¨ÑÊõ¥Êñ∞
            window.dispatchEvent(new CustomEvent('projectCreated', { 
                detail: newProject 
            }));
            
            // ÈóúÈñâÊ®°ÊÖãÊ°Ü
            closeCreateProjectModal();
            
            // Ë∑≥ËΩâÂà∞Êñ∞È†ÖÁõÆÈ†ÅÈù¢
            window.location.href = `firstproject.html?project=${newProject.id}`;
        }
        
        // ‰ΩøÂáΩÊï∏ÂÖ®Â±ÄÂèØÁî®
        window.openCreateProjectModal = openCreateProjectModal;
        window.closeCreateProjectModal = closeCreateProjectModal;
        window.createProject = createProject;
    </script>
    
    <!-- ÂâµÂª∫È†ÖÁõÆÊ®°ÊÖãÊ°Ü -->
    <div class="modal-overlay" id="createProjectModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 9999; align-items: center; justify-content: center;">
        <div class="modal-content" style="background: white; border-radius: 12px; padding: 2rem; max-width: 500px; width: 90%; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
            <div class="modal-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
                <h2 style="font-size: 1.5rem; font-weight: 600; color: #1f2937; margin: 0;">Create New Project</h2>
                <button class="modal-close" onclick="closeCreateProjectModal()" style="background: none; border: none; color: #6b7280; cursor: pointer; font-size: 1.5rem; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: background 0.2s;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label class="form-label" for="projectName" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">Project Name</label>
                    <input 
                        type="text" 
                        id="projectName" 
                        class="form-input" 
                        placeholder="Enter project name..."
                        onkeypress="if(event.key === 'Enter') createProject()"
                        style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 1rem; transition: border-color 0.2s;"
                    >
                </div>
                <div class="modal-actions" style="display: flex; gap: 0.75rem; justify-content: flex-end;">
                    <button onclick="closeCreateProjectModal()" style="padding: 0.75rem 1.5rem; background: #f3f4f6; color: #374151; border: none; border-radius: 6px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: background 0.2s;">
                        Cancel
                    </button>
                    <button onclick="createProject()" style="padding: 0.75rem 1.5rem; background: #3b82f6; color: white; border: none; border-radius: 6px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: background 0.2s;">
                        Create
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <style>
        .modal-overlay.active {
            display: flex !important;
        }
        
        .modal-close:hover {
            background: #f3f4f6;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        button:hover {
            opacity: 0.9;
        }
        
        /* Â∞éÂá∫ËèúÂñÆÊ®£Âºè */
        .export-menu-item:hover {
            background: #f9fafb !important;
        }
    </style>
    
    <script>
        // ==================== Â∞éÂá∫ÂäüËÉΩ ====================
        
        /**
         * ÂàáÊèõÂ∞éÂá∫ËèúÂñÆ
         */
        function toggleExportMenu() {
            const menu = document.getElementById('exportMenu');
            if (menu.style.display === 'none') {
                menu.style.display = 'block';
                // ÈªûÊìäÂ§ñÈÉ®ÈóúÈñâËèúÂñÆ
                setTimeout(() => {
                    document.addEventListener('click', closeExportMenuOnClickOutside);
                }, 0);
            } else {
                menu.style.display = 'none';
                document.removeEventListener('click', closeExportMenuOnClickOutside);
            }
        }
        
        /**
         * ÈªûÊìäÂ§ñÈÉ®ÈóúÈñâËèúÂñÆ
         */
        function closeExportMenuOnClickOutside(event) {
            const menu = document.getElementById('exportMenu');
            const button = event.target.closest('button[onclick="toggleExportMenu()"]');
            
            if (!menu.contains(event.target) && !button) {
                menu.style.display = 'none';
                document.removeEventListener('click', closeExportMenuOnClickOutside);
            }
        }
        
        /**
         * Â∞éÂá∫ÊñáÊ™î
         */
        async function exportDocuments(format) {
            console.log(`üì§ ÈñãÂßãÂ∞éÂá∫ (${format})...`);
            
            // ÈóúÈñâËèúÂñÆ
            document.getElementById('exportMenu').style.display = 'none';
            document.removeEventListener('click', closeExportMenuOnClickOutside);
            
            try {
                // Áç≤ÂèñÁï∂ÂâçÈ†ÖÁõÆÁöÑÊâÄÊúâÊñáÊ™î
                const projectId = new URLSearchParams(window.location.search).get('project');
                if (!projectId) {
                    alert('ÁÑ°Ê≥ïÁç≤ÂèñÈ†ÖÁõÆ ID');
                    return;
                }
                
                const storageKey = `vaultcaddy_project_${projectId}_documents`;
                const documents = JSON.parse(localStorage.getItem(storageKey) || '[]');
                
                // ÈÅéÊøæÂá∫ÁôºÁ•®ÂíåÊî∂Êìö
                const invoices = documents.filter(doc => {
                    const docType = doc.processedData?.documentType || '';
                    return docType === 'Invoice' || docType === 'Receipt';
                });
                
                if (invoices.length === 0) {
                    alert('Ê≤íÊúâÂèØÂ∞éÂá∫ÁöÑÁôºÁ•®ÊàñÊî∂Êìö');
                    return;
                }
                
                console.log(`   ÊâæÂà∞ ${invoices.length} ÂºµÁôºÁ•®/Êî∂Êìö`);
                
                // ‰ΩøÁî® ExportManager Â∞éÂá∫
                const blob = await window.exportManager.exportInvoices(invoices, format);
                
                // ÁîüÊàêÊñá‰ª∂Âêç
                const projectName = getProjectName(projectId);
                const timestamp = new Date().toISOString().split('T')[0];
                const filename = `${projectName}_invoices_${timestamp}.${format}`;
                
                // ‰∏ãËºâÊñá‰ª∂
                window.exportManager.downloadFile(blob, filename);
                
                // È°ØÁ§∫ÊàêÂäüÊ∂àÊÅØ
                alert(`‚úÖ ÊàêÂäüÂ∞éÂá∫ ${invoices.length} ÂºµÁôºÁ•®ÔºÅ\n\nÊñá‰ª∂: ${filename}\nÊ†ºÂºè: ${format.toUpperCase()}`);
                
            } catch (error) {
                console.error('‚ùå Â∞éÂá∫Â§±Êïó:', error);
                alert(`Â∞éÂá∫Â§±Êïó: ${error.message}`);
            }
        }
        
        /**
         * Áç≤ÂèñÈ†ÖÁõÆÂêçÁ®±
         */
        function getProjectName(projectId) {
            const projects = JSON.parse(localStorage.getItem('vaultcaddy_projects') || '[]');
            const project = projects.find(p => p.id === projectId);
            return project ? project.name : 'project';
        }
        
        // Á¢∫‰øùÂ∞éÂá∫ÂäüËÉΩÂÖ®Â±ÄÂèØÁî®
        window.toggleExportMenu = toggleExportMenu;
        window.exportDocuments = exportDocuments;
    </script>

</body>
</html>
