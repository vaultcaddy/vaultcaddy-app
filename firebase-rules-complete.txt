rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ç”¨æˆ·æ–‡æ¡£è§„åˆ™
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Credits å†å²è®°å½•
    match /creditsHistory/{historyId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // ç”¨æˆ·é¡¹ç›®è§„åˆ™
    match /projects/{projectId} {
      // âœ… åŸæœ‰çš„è¯»å†™æƒé™
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if request.auth != null && request.auth.uid == userId;
      
      // âœ…âœ…âœ… åœ¨è¿™é‡Œæ·»åŠ åˆ é™¤æƒé™ï¼ˆæ–°å¢ï¼‰
      allow delete: if request.auth != null && request.auth.uid == userId;
      
      // é¡¹ç›®æ–‡æ¡£è§„åˆ™
      match /documents/{documentId} {
        // âœ… åŸæœ‰çš„è¯»å†™æƒé™
        allow read: if request.auth != null && request.auth.uid == userId;
        allow write: if request.auth != null && request.auth.uid == userId;
        
        // âœ…âœ…âœ… åœ¨è¿™é‡Œæ·»åŠ åˆ é™¤æƒé™ï¼ˆæ–°å¢ï¼‰
        allow delete: if request.auth != null && request.auth.uid == userId;
      }
    }
    
    // éªŒè¯ç è§„åˆ™
    match /verificationCodes/{email} {
      allow read: if request.auth != null && request.auth.uid == null;
      allow write: if true; // å…è®¸ä»»ä½•äººå†™å…¥
    }
    
    // ğŸ”’ å®‰å…¨è¯´æ˜ï¼š
    // æ‰€æœ‰é¡¹ç›®å’Œæ–‡æ¡£éƒ½å¿…é¡»åœ¨ users/{userId} è·¯å¾„ä¸‹
    // è¯·ç¡®ä¿æ‚¨çš„æ•°æ®åº“è·¯å¾„æ˜¯ï¼šusers/{userId}/projects/{projectId}/documents/{documentId}
    // è·¯å¾„ç»“æ„ï¼šusers/{userId}/projects/{projectId}/documents/{documentId}
  }
}

