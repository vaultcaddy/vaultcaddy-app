# 📋 Qwen-VL Max 測試頁面使用說明

**創建日期**: 2026-01-06  
**測試頁面**: `qwen-vl-test.html`  
**目的**: 測試 Qwen-VL Max 對銀行對賬單和收據的處理效果，不影響現有系統

---

## 🎯 功能說明

### 測試頁面特點

1. **獨立測試環境**
   - ✅ 完全獨立的測試頁面，不影響現有系統
   - ✅ 不修改任何現有代碼
   - ✅ 可以隨時刪除，不影響生產環境

2. **雙類型測試**
   - ✅ **銀行對賬單測試**: 測試銀行對賬單的 OCR 和數據提取
   - ✅ **收據測試**: 測試收據的 OCR 和數據提取

3. **完整功能**
   - ✅ 文件上傳（點擊或拖放）
   - ✅ 支持 PDF、PNG、JPG 格式
   - ✅ 實時處理狀態顯示
   - ✅ 結果展示（提取的數據 + 處理統計）
   - ✅ 錯誤處理和提示

4. **對比分析**
   - ✅ 顯示與現有系統（Google Vision + DeepSeek）的對比
   - ✅ 處理時間、成本、準確率對比

---

## 🚀 快速開始

### 步驟 1: 獲取 API Key

1. **註冊阿里云賬號**
   - 訪問: https://www.alibabacloud.com/
   - 註冊並完成實名認證

2. **開通百煉服務**
   - 訪問: https://bailian.console.aliyun.com/
   - 開通「通義千問」服務

3. **獲取 API Key**
   - 在百煉控制台 → API-KEY 管理
   - 創建新的 API Key
   - **重要**: 選擇「新加坡地域」（國際版，全球可用）

### 步驟 2: 配置 API Key

1. **打開配置文件**
   ```bash
   # 編輯 qwen-vl-config.js
   ```

2. **填入 API Key**
   ```javascript
   const QWEN_VL_CONFIG = {
       apiKey: 'sk-xxxxxxxxxxxxxxxxxxxxx', // 填入您的 API Key
       // ... 其他配置
   };
   ```

3. **選擇模型**
   - `qwen-vl-max`: 更強能力，稍貴（推薦）
   - `qwen-vl-plus`: 性價比高，能力稍弱

### 步驟 3: 打開測試頁面

1. **本地測試**
   ```bash
   # 使用本地服務器（避免 CORS 問題）
   python3 -m http.server 8000
   # 或
   npx serve .
   ```

2. **訪問測試頁面**
   ```
   http://localhost:8000/qwen-vl-test.html
   ```

3. **上傳測試文件**
   - 選擇「銀行對賬單測試」或「收據測試」
   - 點擊上傳區域或拖放文件
   - 等待處理完成

---

## 📊 測試建議

### 測試文件準備

#### 銀行對賬單測試
- ✅ 準備 1-2 張銀行對賬單 PDF 或圖片
- ✅ 包含交易記錄的對賬單
- ✅ 可以測試不同銀行的對賬單格式

#### 收據測試
- ✅ 準備 1-2 張收據 PDF 或圖片
- ✅ 包含商品列表的收據
- ✅ 可以測試不同商家的收據格式

### 測試重點

1. **準確率測試**
   - ✅ 對比提取的數據與原始文檔
   - ✅ 檢查交易記錄是否完整
   - ✅ 檢查金額、日期是否準確

2. **處理速度測試**
   - ✅ 記錄處理時間
   - ✅ 與現有系統對比（Google Vision + DeepSeek）

3. **成本測試**
   - ✅ 查看 Token 使用量
   - ✅ 計算實際成本
   - ✅ 與現有系統對比

4. **多語言測試**
   - ✅ 測試中文、英文、日文、韓文文檔
   - ✅ 檢查手寫識別準確率

---

## 🔧 技術細節

### API 調用方式

```javascript
// 請求格式
{
    model: 'qwen-vl-max',
    messages: [
        {
            role: 'user',
            content: [
                {
                    type: 'image',
                    image: 'data:image/jpeg;base64,...'
                },
                {
                    type: 'text',
                    text: '提取銀行對賬單數據...'
                }
            ]
        }
    ],
    temperature: 0.1,
    max_tokens: 4000
}
```

### 響應格式

```javascript
{
    choices: [
        {
            message: {
                content: '{"bankName": "...", "transactions": [...]}'
            }
        }
    ],
    usage: {
        prompt_tokens: 11500,
        completion_tokens: 1000,
        total_tokens: 12500
    }
}
```

### 成本計算

根據 `📊_手写单处理能力与成本对比分析_HKD.md`:

- **輸入**: ¥0.003 / 百萬 tokens ≈ HK$0.00324 / 百萬 tokens
- **輸出**: ¥0.009 / 百萬 tokens ≈ HK$0.00972 / 百萬 tokens

**示例**（一頁 5000 字符）:
- 輸入: 11,500 tokens × HK$0.00324 / 1,000,000 = **HK$0.037**
- 輸出: 1,000 tokens × HK$0.00972 / 1,000,000 = **HK$0.001**
- **總計**: **HK$0.038 / 頁**

---

## 📈 預期結果

### 處理時間

- **Qwen-VL Max**: ~6秒/頁（端到端）
- **Google Vision + DeepSeek**: ~12秒/頁（2步處理）
- **速度提升**: 約 **100%**（處理時間減少一半）

### 準確率

- **手寫識別**: 96.5%（vs Google Vision 75-80%）
- **數據提取**: 預期 95%+（需實際測試驗證）

### 成本

- **Qwen-VL Max**: HK$0.038/頁
- **Google Vision + DeepSeek**: HK$0.6255/頁
- **成本節省**: 約 **93.9%**

---

## ⚠️ 注意事項

### 1. API Key 安全

- ⚠️ **不要**將 API Key 提交到 Git 倉庫
- ⚠️ **不要**在前端代碼中硬編碼 API Key（生產環境）
- ✅ 測試頁面僅用於本地測試
- ✅ 生產環境應使用後端代理

### 2. CORS 問題

- ⚠️ 直接打開 HTML 文件可能遇到 CORS 問題
- ✅ 使用本地服務器運行（`python3 -m http.server`）

### 3. 文件大小限制

- ⚠️ 注意 API 的文件大小限制
- ✅ 建議單個文件不超過 10MB
- ✅ 大文件可能需要壓縮或分頁處理

### 4. 錯誤處理

- ✅ 測試頁面包含基本錯誤處理
- ✅ 如果 API 調用失敗，會顯示錯誤信息
- ✅ 檢查瀏覽器控制台獲取詳細錯誤

---

## 🐛 常見問題

### Q1: API Key 無效

**問題**: 提示 "API 錯誤: 401"

**解決**:
1. 檢查 API Key 是否正確
2. 確認 API Key 是否已啟用
3. 確認使用「新加坡地域」的 API Key

### Q2: CORS 錯誤

**問題**: 瀏覽器控制台顯示 CORS 錯誤

**解決**:
1. 使用本地服務器運行（不要直接打開 HTML 文件）
2. 或使用瀏覽器擴展禁用 CORS（僅用於測試）

### Q3: 處理失敗

**問題**: 文件上傳後處理失敗

**解決**:
1. 檢查文件格式是否支持（PDF、PNG、JPG）
2. 檢查文件大小是否超限
3. 查看瀏覽器控制台的詳細錯誤信息

### Q4: JSON 解析失敗

**問題**: 提取的數據無法解析為 JSON

**解決**:
1. 檢查 API 響應是否包含 JSON
2. 查看「提取的數據」中的原始文本
3. 可能需要調整提示詞以確保返回純 JSON

---

## 📝 測試記錄模板

### 測試記錄表

| 測試項目 | 文件類型 | 處理時間 | 準確率 | Token使用 | 成本 | 備註 |
|---------|---------|---------|--------|----------|------|------|
| 銀行對賬單1 | PDF | 6.2s | 98% | 12,500 | HK$0.038 | 完美 |
| 銀行對賬單2 | JPG | 5.8s | 95% | 11,200 | HK$0.036 | 良好 |
| 收據1 | PDF | 5.5s | 97% | 10,800 | HK$0.035 | 完美 |
| 收據2 | PNG | 6.1s | 96% | 12,000 | HK$0.039 | 良好 |

---

## 🎯 下一步

### 測試完成後

1. **分析測試結果**
   - ✅ 對比準確率、速度、成本
   - ✅ 評估是否滿足需求

2. **決定是否遷移**
   - ✅ 如果測試結果良好，考慮遷移到生產環境
   - ✅ 制定遷移計劃

3. **生產環境實施**
   - ✅ 使用後端代理（保護 API Key）
   - ✅ 添加錯誤處理和重試機制
   - ✅ 添加成本監控

---

**報告生成時間**: 2026-01-06  
**狀態**: ✅ Qwen-VL Max 測試頁面創建完成  
**下一步**: 配置 API Key 並開始測試


