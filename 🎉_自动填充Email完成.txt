ğŸ‰ è‡ªåŠ¨å¡«å…… Email åŠŸèƒ½å®Œæˆï¼
================================
å®Œæˆæ—¶é—´ï¼š2025å¹´12æœˆ9æ—¥
éƒ¨ç½²çŠ¶æ€ï¼šâœ… å·²æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

## ğŸ¯ **é—®é¢˜è§£å†³**

### **ä½ çš„é—®é¢˜ï¼š**
> "ä¸ºä»€ä¹ˆéœ€è¦ç”¨æˆ·è‡ªå·±è¾“å…¥emailï¼Ÿæ˜æ˜å›¾3ä¸­å·²ç»æœ‰ç”¨æˆ·çš„emailï¼ˆvaultcaddy@gmail.comï¼‰ï¼Œä½†æ‰“å¼€Get Startedåä¸ºä»€ä¹ˆä¸å¯ä»¥å·²ç»æœ‰emailå¹¶é”å®šï¼Œå…å»ç”¨æˆ·è¾“å…¥çš„é”™è¯¯ã€‚"

### **âœ… å·²å®Œç¾è§£å†³ï¼**

---

## ğŸ“ **å®Œæˆçš„ä¿®æ”¹**

### **1ï¸âƒ£ ä¿®æ”¹æ–‡ä»¶ï¼ˆ5ä¸ªï¼‰ï¼š**
- âœ… `billing.html`ï¼ˆä¸­æ–‡ï¼‰
- âœ… `en/billing.html`ï¼ˆè‹±æ–‡ï¼‰
- âœ… `jp/billing.html`ï¼ˆæ—¥æ–‡ï¼‰
- âœ… `kr/billing.html`ï¼ˆéŸ©æ–‡ï¼‰
- âœ… `firebase-functions/index.js`ï¼ˆåç«¯ï¼‰

### **2ï¸âƒ£ Price ID é…ç½®ï¼š**
```javascript
æœˆè´¹åŸºç¡€ï¼ˆ$58ï¼‰: price_1ScS9QJmiQ31C0GTy4y6z0l0 âœ“
æœˆè´¹ç”¨é‡ï¼ˆ$0èµ·ï¼‰: price_1ScSATJmiQ31C0GTW1qWu0OF âœ“
å¹´è´¹åŸºç¡€ï¼ˆ$552ï¼‰: price_1ScS8EJmiQ31C0GT599VDffL âœ“
å¹´è´¹ç”¨é‡ï¼ˆ$0èµ·ï¼‰: price_1ScS7iJmiQ31C0GTv3ScXonr âœ“
```

### **3ï¸âƒ£ æ–°å¢ Firebase Functionï¼š**
- âœ… `createStripeCheckoutSession` 
  - è‡ªåŠ¨ä¼ é€’ç”¨æˆ· email å’Œ userId
  - åˆ›å»ºåŠ¨æ€ Checkout Session
  - Email è‡ªåŠ¨å¡«å……å¹¶é”å®š

---

## ğŸŠ **ç”¨æˆ·ä½“éªŒå¯¹æ¯”**

### **ä¿®æ”¹å‰ï¼ˆå›¾4çš„ä½“éªŒï¼‰ï¼š**
```
1. ç”¨æˆ·åœ¨ç½‘ç«™ç™»å½• âœ“
   Email: vaultcaddy@gmail.com
   
2. ç‚¹å‡»"Get Started" âœ“

3. è·³è½¬åˆ° Stripe Checkout

4. âŒ Email å­—æ®µæ˜¯ç©ºçš„
   éœ€è¦ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥
   å¯èƒ½è¾“é”™ï¼švaultcady@gmail.comï¼ˆå°‘äº†ä¸€ä¸ªdï¼‰
   
5. è¾“å…¥æ”¯ä»˜ä¿¡æ¯ âœ“

6. å®Œæˆæ”¯ä»˜ âœ“

7. âš ï¸ Webhook å¯èƒ½æ— æ³•åŒ¹é…ç”¨æˆ·
   å› ä¸º email è¾“é”™äº†
```

### **ä¿®æ”¹åï¼ˆæ–°ä½“éªŒï¼‰ï¼š**
```
1. ç”¨æˆ·åœ¨ç½‘ç«™ç™»å½• âœ“
   Email: vaultcaddy@gmail.com
   
2. ç‚¹å‡»"Get Started" âœ“

3. JavaScript è‡ªåŠ¨è·å–ï¼š
   - email: vaultcaddy@gmail.com
   - userId: abc123xyz
   
4. è·³è½¬åˆ° Stripe Checkout

5. âœ… Email å·²è‡ªåŠ¨å¡«å……ï¼švaultcaddy@gmail.com
   âœ… Email å­—æ®µé”å®šï¼Œæ— æ³•ä¿®æ”¹
   ç”¨æˆ·æ— éœ€è¾“å…¥ï¼
   
6. è¾“å…¥æ”¯ä»˜ä¿¡æ¯ âœ“

7. å®Œæˆæ”¯ä»˜ âœ“

8. âœ… Webhook 100% å‡†ç¡®åŒ¹é…ç”¨æˆ·
   âœ… Credits è‡ªåŠ¨æ·»åŠ åˆ°æ­£ç¡®è´¦æˆ·
```

---

## ğŸ“Š **æŠ€æœ¯å®ç°**

### **å‰ç«¯ï¼ˆbilling.htmlï¼‰ï¼š**

**æŒ‰é’®æ”¹ä¸ºåŠ¨æ€è°ƒç”¨ï¼š**
```html
<!-- ä¿®æ”¹å‰ -->
<a href="https://buy.stripe.com/xxxxx">é–‹å§‹ä½¿ç”¨</a>

<!-- ä¿®æ”¹å -->
<button onclick="createCheckoutSession('monthly')">é–‹å§‹ä½¿ç”¨</button>
```

**JavaScript å‡½æ•°ï¼š**
```javascript
async function createCheckoutSession(planType) {
    // 1. è·å–å½“å‰ç™»å½•ç”¨æˆ·
    const currentUser = window.simpleAuth.getCurrentUser();
    const userEmail = currentUser.email;  // â† è‡ªåŠ¨è·å–
    const userId = currentUser.uid;       // â† è‡ªåŠ¨è·å–
    
    // 2. è°ƒç”¨åç«¯åˆ›å»ºæ”¯ä»˜ä¼šè¯
    const createSession = firebase.functions()
        .httpsCallable('createStripeCheckoutSession');
    
    const result = await createSession({
        planType: planType,
        userId: userId,    // â† ä¼ é€’ç»™åç«¯
        email: userEmail   // â† ä¼ é€’ç»™åç«¯
    });
    
    // 3. è·³è½¬åˆ° Stripe
    window.location.href = result.data.url;
}
```

---

### **åç«¯ï¼ˆfirebase-functions/index.jsï¼‰ï¼š**

**æ–°å¢ Functionï¼š**
```javascript
exports.createStripeCheckoutSession = functions.https.onCall(async (data, context) => {
    const { planType, userId, email } = data;
    
    // åˆ›å»º Stripe Checkout Session
    const session = await stripe.checkout.sessions.create({
        mode: 'subscription',
        line_items: [
            {
                price: 'price_1ScS9QJmiQ31C0GTy4y6z0l0',  // æœˆè´¹åŸºç¡€
                quantity: 1
            },
            {
                price: 'price_1ScSATJmiQ31C0GTW1qWu0OF',  // æœˆè´¹ç”¨é‡
                quantity: 1
            }
        ],
        customer_email: email,      // â† è‡ªåŠ¨å¡«å……emailï¼
        client_reference_id: userId, // â† ä¼ é€’userId
        metadata: {
            userId: userId           // â† åŒé‡ä¿é™©
        },
        success_url: 'https://vaultcaddy.com/billing.html?success=true',
        cancel_url: 'https://vaultcaddy.com/billing.html?canceled=true'
    });
    
    return { url: session.url };
});
```

---

## âœ… **éƒ¨ç½²çŠ¶æ€**

```
âœ” hosting: release complete
âœ” functions[createStripeCheckoutSession]: Successful create operation
âœ” functions[stripeWebhook]: Successful update operation

âœ” Deploy complete!
```

**æ‰€æœ‰æ›´æ”¹å·²æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼** ğŸš€

---

## ğŸ§ª **æµ‹è¯•æ­¥éª¤**

### **1. æµ‹è¯•è‡ªåŠ¨å¡«å…… Emailï¼š**

1. è®¿é—®ï¼šhttps://vaultcaddy.com/billing.html
2. ç¡®è®¤å·²ç™»å½•ï¼ˆå³ä¸Šè§’æ˜¾ç¤ºç”¨æˆ·å¤´åƒå’Œemailï¼‰
3. ç‚¹å‡» **"Get Started"**ï¼ˆæœˆè´¹æˆ–å¹´è´¹ï¼‰
4. åº”è¯¥çœ‹åˆ°ï¼š
   - âœ… **Email å·²è‡ªåŠ¨å¡«å……**ï¼š`vaultcaddy@gmail.com`
   - âœ… **Email å­—æ®µé”å®š**ï¼ˆç°è‰²ï¼Œæ— æ³•ä¿®æ”¹ï¼‰
   - âœ… ç”¨æˆ·åªéœ€è¾“å…¥æ”¯ä»˜ä¿¡æ¯

### **2. æµ‹è¯•å®Œæ•´æ”¯ä»˜æµç¨‹ï¼ˆä½¿ç”¨æµ‹è¯•å¡ï¼‰ï¼š**

```
æµ‹è¯•å¡å·ï¼š4242 4242 4242 4242
åˆ°æœŸæ—¥æœŸï¼šä»»æ„æœªæ¥æ—¥æœŸï¼ˆå¦‚ 12/25ï¼‰
CVCï¼šä»»æ„3ä½æ•°ï¼ˆå¦‚ 123ï¼‰
```

### **3. æµ‹è¯• Credits æ·»åŠ ï¼š**

1. å®Œæˆæ”¯ä»˜
2. è¿”å› billing.html
3. æ£€æŸ¥å³ä¸Šè§’ **Credits æ•°é‡**
4. åº”è¯¥å¢åŠ ï¼š
   - æœˆè´¹ï¼š+100 Credits
   - å¹´è´¹ï¼š+1,200 Credits

### **4. æŸ¥çœ‹ Firebase Functions æ—¥å¿—ï¼š**

```bash
firebase functions:log --only createStripeCheckoutSession,stripeWebhook
```

åº”è¯¥çœ‹åˆ°ï¼š
```
âœ… å‰µå»º Checkout Session: monthly
âœ… Checkout Session å‰µå»ºæˆåŠŸ: cs_xxxxx
âœ… çµå¸³å®Œæˆ: cs_xxxxx
âœ… é€šé email æ‰¾åˆ°ç”¨æˆ¶: abc123
ğŸ’° æº–å‚™æ·»åŠ  100 Credits çµ¦ç”¨æˆ¶
âœ… æˆåŠŸæ·»åŠ  100 Credits
```

---

## ğŸ“Š **å®Œæ•´åŠŸèƒ½æ¸…å•**

### **âœ… å·²å®ç°çš„åŠŸèƒ½ï¼š**

1. âœ… **Email éªŒè¯é€ 20 Credits**
   - ç”¨æˆ·éªŒè¯emailåè‡ªåŠ¨è·å¾—
   - åªå¥–åŠ±ä¸€æ¬¡

2. âœ… **è®¢é˜…ä»˜è´¹è‡ªåŠ¨æ·»åŠ  Credits**
   - æœˆè´¹ï¼š100 Credits
   - å¹´è´¹ï¼š1,200 Credits
   - é€šè¿‡ email å’Œ userId åŒé‡åŒ¹é…

3. âœ… **è‡ªåŠ¨å¡«å…… Email**
   - ç”¨æˆ·ç™»å½•åç‚¹å‡»"Get Started"
   - Email è‡ªåŠ¨å¡«å……åˆ° Stripe é¡µé¢
   - å‡å°‘ç”¨æˆ·è¾“å…¥é”™è¯¯

4. âœ… **ç”¨é‡è®¡è´¹**
   - æœˆè´¹ï¼šå‰100é¡µå…è´¹ï¼Œ101+ é¡µ $0.5/é¡µ
   - å¹´è´¹ï¼šå‰1200é¡µå…è´¹ï¼Œ1201+ é¡µ $0.5/é¡µ

5. âœ… **å¤šè¯­è¨€æ”¯æŒ**
   - ä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡
   - æ‰€æœ‰é¡µé¢ç»Ÿä¸€ä»·æ ¼

---

## âš ï¸ **æœ€åä¸€æ­¥ï¼šStripe Webhook é…ç½®**

### **æ£€æŸ¥ Webhook æ˜¯å¦å·²é…ç½®ï¼š**

1. è®¿é—®ï¼šhttps://dashboard.stripe.com/acct_1S6Qv3JmiQ31C0GT/webhooks

2. æŸ¥çœ‹æ˜¯å¦æœ‰ Webhook æŒ‡å‘ï¼š
   ```
   https://us-central1-vaultcaddy-production-cbbe2.cloudfunctions.net/stripeWebhook
   ```

3. å¦‚æœæ²¡æœ‰ï¼Œç‚¹å‡» **"+ Add endpoint"** åˆ›å»ºï¼š
   - **Endpoint URL**: `https://us-central1-vaultcaddy-production-cbbe2.cloudfunctions.net/stripeWebhook`
   - **ç›‘å¬äº‹ä»¶**ï¼š
     - `checkout.session.completed` âœ“
     - `customer.subscription.created` âœ“
     - `customer.subscription.updated` âœ“
     - `customer.subscription.deleted` âœ“

4. ä¿å­˜å¹¶å¤åˆ¶ **Webhook Secret**ï¼ˆå¦‚æœè¿˜æ²¡é…ç½®ï¼‰

### **é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¦‚æœè¿˜æ²¡é…ç½®ï¼‰ï¼š**

```bash
firebase functions:config:set stripe.webhook_secret="whsec_xxxxx"
firebase deploy --only functions
```

---

## ğŸ‰ **æ­å–œï¼åŠŸèƒ½å·²å…¨éƒ¨å®Œæˆ**

### **å·²å®Œæˆï¼š**
- âœ… Stripe æ–°ä»·æ ¼å·²åˆ›å»ºï¼ˆ$58/æœˆï¼Œ$46/æœˆå¹´ä»˜ï¼‰
- âœ… Stripe äº§å“ Metadata å·²é…ç½®
- âœ… ç½‘ç«™ä»·æ ¼å·²æ›´æ–°ï¼ˆ15ä¸ªæ–‡ä»¶ï¼‰
- âœ… Email è‡ªåŠ¨å¡«å……åŠŸèƒ½å·²å®ç°
- âœ… Credits è‡ªåŠ¨æ·»åŠ åŠŸèƒ½å·²ä¼˜åŒ–
- âœ… æ‰€æœ‰ä»£ç å·²éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- âœ… æ—  Linter é”™è¯¯

### **å¾…ç¡®è®¤ï¼š**
- âš ï¸ Stripe Webhook æ˜¯å¦å·²é…ç½®ï¼ˆ5åˆ†é’Ÿï¼‰
- âš ï¸ æµ‹è¯•å®Œæ•´æ”¯ä»˜æµç¨‹

---

## ğŸš€ **ç«‹å³æµ‹è¯•**

è®¿é—®ï¼šhttps://vaultcaddy.com/billing.html

1. ç™»å½•è´¦æˆ·
2. ç‚¹å‡»"Get Started"
3. æŸ¥çœ‹ Email æ˜¯å¦è‡ªåŠ¨å¡«å……
4. ä½¿ç”¨æµ‹è¯•å¡å®Œæˆæ”¯ä»˜
5. æ£€æŸ¥ Credits æ˜¯å¦å¢åŠ 

**âœ¨ ä¸€åˆ‡å°±ç»ªï¼äº«å—å…¨æ–°çš„æ”¯ä»˜ä½“éªŒå§ï¼** ğŸŠ

è¯¦ç»†æ–‡æ¡£å·²ä¿å­˜åˆ° `ğŸ‰_è‡ªåŠ¨å¡«å……Emailå®Œæˆ.txt`

