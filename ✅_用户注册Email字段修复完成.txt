# âœ… ç”¨æˆ·æ³¨å†Œ Email å­—æ®µä¿®å¤å®Œæˆ

## ğŸ“‹ **ä¿®æ”¹æ‘˜è¦**

å·²ç¡®ä¿åœ¨ `users` é›†åˆä¸­åˆ›å»ºç”¨æˆ·æ—¶**å¿…é¡»**åŒ…å«ç”¨æˆ·çš„ email å­—æ®µã€‚

---

## ğŸ”§ **ä¿®æ”¹çš„æ–‡ä»¶**

### **æ–‡ä»¶ï¼š`simple-auth.js`**

#### **1. Email æ³¨å†Œï¼ˆregisterWithEmailï¼‰**

**ä¿®æ”¹å†…å®¹**ï¼š
- âœ… æ·»åŠ  `email` å­—æ®µåˆ° Firestore ç”¨æˆ·æ–‡æ¡£
- âœ… Email ç»Ÿä¸€è½¬æ¢ä¸ºå°å†™ï¼ˆé¿å…å¤§å°å†™åŒ¹é…é—®é¢˜ï¼‰
- âœ… åˆ›å»ºæ–‡æ¡£åç«‹å³éªŒè¯ `email` å­—æ®µæ˜¯å¦å­˜åœ¨
- âœ… å¦‚æœåˆ›å»ºå¤±è´¥ï¼Œè‡ªåŠ¨åˆ é™¤ Firebase Auth ç”¨æˆ·ï¼ˆä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼‰

**ä»£ç ä½ç½®**ï¼šç¬¬ 205-268 è¡Œ

**å…³é”®ä»£ç **ï¼š
```javascript
// åˆ›å»º Firestore ç”¨æˆ·æ–‡æ¡£
const normalizedEmail = email.toLowerCase().trim();

const userDoc = {
    email: normalizedEmail,  // âœ… å¿…é¡»åŒ…å« email
    displayName: displayName || '',
    credits: 0,
    currentCredits: 0,
    emailVerified: false,
    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
};

await db.collection('users').doc(result.user.uid).set(userDoc);

// éªŒè¯æ–‡æ¡£åˆ›å»ºæˆåŠŸ
const docSnapshot = await db.collection('users').doc(result.user.uid).get();
if (!docSnapshot.exists) {
    throw new Error('æ–‡æª”å‰µå»ºå¾Œç„¡æ³•è®€å–ï¼Œå¯èƒ½å‰µå»ºå¤±æ•—');
}
const docData = docSnapshot.data();
if (!docData.email) {
    throw new Error('æ–‡æª”å‰µå»ºæˆåŠŸä½†ç¼ºå°‘ email å­—æ®µ');
}
console.log('âœ… ç”¨æˆ¶æ–‡æª”é©—è­‰æˆåŠŸï¼Œemail å­—æ®µ:', docData.email);
```

---

#### **2. Google ç™»å½•ï¼ˆloginWithGoogleï¼‰**

**æ–°å¢åŠŸèƒ½**ï¼š
- âœ… é¦–æ¬¡ Google ç™»å½•æ—¶è‡ªåŠ¨åˆ›å»º Firestore ç”¨æˆ·æ–‡æ¡£
- âœ… åŒ…å« `email` å­—æ®µï¼ˆç»Ÿä¸€å°å†™ï¼‰
- âœ… åŒ…å« Google è´¦æˆ·çš„å…¶ä»–ä¿¡æ¯ï¼ˆdisplayName, photoURLï¼‰
- âœ… æ ‡è®° `provider: 'google'`
- âœ… åˆ›å»ºåéªŒè¯ `email` å­—æ®µæ˜¯å¦å­˜åœ¨

**ä»£ç ä½ç½®**ï¼šç¬¬ 190-241 è¡Œ

**å…³é”®ä»£ç **ï¼š
```javascript
// æ£€æŸ¥å¹¶åˆ›å»º Firestore ç”¨æˆ·æ–‡æ¡£ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
if (result.user) {
    const db = firebase.firestore();
    const userRef = db.collection('users').doc(result.user.uid);
    const userDoc = await userRef.get();
    
    if (!userDoc.exists) {
        console.log('ğŸ“ é¦–æ¬¡ Google ç™»å…¥ï¼Œå‰µå»º Firestore ç”¨æˆ¶æ–‡æª”...');
        const normalizedEmail = result.user.email.toLowerCase().trim();
        
        const userData = {
            email: normalizedEmail,  // âœ… å¿…é¡»åŒ…å« email
            displayName: result.user.displayName || '',
            credits: 0,
            currentCredits: 0,
            emailVerified: result.user.emailVerified,
            photoURL: result.user.photoURL || '',
            provider: 'google',
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        await userRef.set(userData);
        console.log('âœ… Firestore ç”¨æˆ¶æ–‡æª”å·²å‰µå»ºï¼ˆGoogleï¼‰');
        
        // éªŒè¯æ–‡æª”å‰µå»ºæˆåŠŸ
        const verifyDoc = await userRef.get();
        if (!verifyDoc.exists || !verifyDoc.data().email) {
            console.error('âŒ Google ç™»å…¥æ–‡æª”å‰µå»ºé©—è­‰å¤±æ•—');
        } else {
            console.log('âœ… Google ç™»å…¥ç”¨æˆ¶æ–‡æª”é©—è­‰æˆåŠŸ');
        }
    }
}
```

---

## ğŸ§ª **æµ‹è¯•æ­¥éª¤**

### **æµ‹è¯• 1ï¼šEmail æ³¨å†Œ**

1. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜**
   - æŒ‰ `Ctrl+Shift+Delete`ï¼ˆWindowsï¼‰æˆ– `Cmd+Shift+Delete`ï¼ˆMacï¼‰
   - é€‰æ‹© **"ç¼“å­˜çš„å›¾ç‰‡å’Œæ–‡ä»¶"**
   - æ¸…é™¤

2. **å¼ºåˆ¶åˆ·æ–°é¡µé¢**
   - è®¿é—® https://vaultcaddy.com/auth.html
   - æŒ‰ `Ctrl+F5`ï¼ˆWindowsï¼‰æˆ– `Cmd+Shift+R`ï¼ˆMacï¼‰

3. **æ³¨å†Œæ–°ç”¨æˆ·**
   - ä½¿ç”¨ä¸€ä¸ªæ–°çš„ emailï¼ˆå¦‚ `test123@gmail.com`ï¼‰
   - å¡«å†™è¡¨å•å¹¶æäº¤

4. **æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°**ï¼ˆæŒ‰ F12ï¼‰
   
   **é¢„æœŸæ—¥å¿—**ï¼š
   ```
   ğŸ“ æ­£åœ¨è¨»å†Š... test123@gmail.com
   ğŸ“ æ­£åœ¨å‰µå»º Firestore ç”¨æˆ¶æ–‡æª”...
      ç”¨æˆ¶ ID: xxxxx
      Email: test123@gmail.com
   âœ… Firestore ç”¨æˆ¶æ–‡æª”å·²å‰µå»º
   âœ… ç”¨æˆ¶æ–‡æª”é©—è­‰æˆåŠŸï¼Œemail å­—æ®µ: test123@gmail.com
   âœ… è¨»å†ŠæˆåŠŸ
   ```

5. **åœ¨ Firebase Console ä¸­éªŒè¯**
   - æ‰“é–‹ Firestore Database
   - é€²å…¥ `users` é›†åˆ
   - æŸ¥æ‰¾æ–°å‰µå»ºçš„ç”¨æˆ¶
   - **ç¢ºèªå­—æ®µ**ï¼š
     - âœ… `email`: "test123@gmail.com"
     - âœ… `credits`: 0
     - âœ… `currentCredits`: 0
     - âœ… `emailVerified`: false

---

### **æµ‹è¯• 2ï¼šGoogle ç™»å½•**

1. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜**ï¼ˆåŒä¸Šï¼‰

2. **å¼ºåˆ¶åˆ·æ–°é¡µé¢**
   - è®¿é—® https://vaultcaddy.com/auth.html
   - æŒ‰ `Ctrl+F5`

3. **ä½¿ç”¨ Google è´¦æˆ·ç™»å½•**
   - ç‚¹å‡» **"ä½¿ç”¨ Google ç™»å…¥"** æŒ‰é’®
   - é€‰æ‹©ä¸€ä¸ª**ä»æœªåœ¨è¯¥åº”ç”¨ç™»å½•è¿‡**çš„ Google è´¦æˆ·

4. **æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°**ï¼ˆæŒ‰ F12ï¼‰
   
   **é¢„æœŸæ—¥å¿—**ï¼š
   ```
   ğŸ” æ­£åœ¨ä½¿ç”¨ Google ç™»å…¥...
   âœ… Google ç™»å…¥æˆåŠŸ
   ğŸ“ é¦–æ¬¡ Google ç™»å…¥ï¼Œå‰µå»º Firestore ç”¨æˆ¶æ–‡æª”...
   âœ… Firestore ç”¨æˆ¶æ–‡æª”å·²å‰µå»ºï¼ˆGoogleï¼‰
      Email: your.google.email@gmail.com
      UID: xxxxx
   âœ… Google ç™»å…¥ç”¨æˆ¶æ–‡æª”é©—è­‰æˆåŠŸ
   ```

5. **åœ¨ Firebase Console ä¸­éªŒè¯**
   - æ‰“é–‹ Firestore Database
   - é€²å…¥ `users` é›†åˆ
   - æŸ¥æ‰¾æ–°å‰µå»ºçš„ç”¨æˆ¶
   - **ç¢ºèªå­—æ®µ**ï¼š
     - âœ… `email`: "your.google.email@gmail.com"
     - âœ… `displayName`: "Your Name"
     - âœ… `photoURL`: "https://..."
     - âœ… `provider`: "google"
     - âœ… `credits`: 0
     - âœ… `currentCredits`: 0
     - âœ… `emailVerified`: trueï¼ˆGoogle è´¦æˆ·å·²éªŒè¯ï¼‰

---

### **æµ‹è¯• 3ï¼šEmail éªŒè¯ + Credits å¢åŠ **

1. **ä½¿ç”¨æµ‹è¯• 1 ä¸­æ³¨å†Œçš„è´¦æˆ·**

2. **éªŒè¯ Email**
   - æ£€æŸ¥æ”¶ä»¶ç®±ï¼Œè·å–éªŒè¯ç 
   - è®¿é—® https://vaultcaddy.com/verify-email.html
   - è¾“å…¥éªŒè¯ç 

3. **ç¡®è®¤ Credits å¢åŠ **
   - åˆ·æ–° Firebase Console
   - æŸ¥çœ‹ç”¨æˆ·æ–‡æ¡£
   - **ç¡®è®¤**ï¼š
     - âœ… `credits`: 20
     - âœ… `currentCredits`: 20
     - âœ… `emailVerified`: true

---

### **æµ‹è¯• 4ï¼šStripe æ”¯ä»˜ + Credits å¢åŠ **

1. **ä½¿ç”¨å·²éªŒè¯ Email çš„è´¦æˆ·**

2. **è®¿é—® billing é¡µé¢**
   - https://vaultcaddy.com/billing.html

3. **ç‚¹å‡»æµ‹è¯•æŒ‰é’®**
   - ç‚¹å‡» **"ğŸ§ª æ¸¬è©¦ Get Started"**
   - ä½¿ç”¨æµ‹è¯•å¡ï¼š`4242 4242 4242 4242`
   - å®Œæˆæ”¯ä»˜

4. **ç¡®è®¤ Credits å¢åŠ **
   - åˆ·æ–° Firebase Console
   - æŸ¥çœ‹ç”¨æˆ·æ–‡æ¡£
   - **ç¡®è®¤**ï¼š
     - âœ… `credits`: 120ï¼ˆ20 + 100ï¼‰
     - âœ… `currentCredits`: 120
   
5. **ç¡®è®¤å‰ç«¯æ˜¾ç¤ºæ­£ç¡®**
   - åˆ·æ–° billing é¡µé¢
   - åº”è¯¥æ˜¾ç¤ºï¼š`Credits: 120`

---

## ğŸ“Š **ä¿®æ”¹å‰ vs ä¿®æ”¹å**

### **ä¿®æ”¹å‰**

**Email æ³¨å†Œ**ï¼š
- âŒ æŸäº›æƒ…å†µä¸‹ `email` å­—æ®µæœªæ·»åŠ 
- âŒ æ— éªŒè¯æœºåˆ¶
- âŒ å¦‚æœ Firestore åˆ›å»ºå¤±è´¥ï¼ŒAuth ç”¨æˆ·ä»ç„¶å­˜åœ¨ï¼ˆæ•°æ®ä¸ä¸€è‡´ï¼‰

**Google ç™»å½•**ï¼š
- âŒ ä¸åˆ›å»º Firestore ç”¨æˆ·æ–‡æ¡£
- âŒ å¯¼è‡´æ— æ³•ä½¿ç”¨ Credits åŠŸèƒ½

---

### **ä¿®æ”¹å**

**Email æ³¨å†Œ**ï¼š
- âœ… `email` å­—æ®µ**å¿…é¡»**æ·»åŠ åˆ° Firestore æ–‡æ¡£
- âœ… Email ç»Ÿä¸€è½¬æ¢ä¸ºå°å†™
- âœ… åˆ›å»ºåç«‹å³éªŒè¯
- âœ… å¦‚æœå¤±è´¥ï¼Œè‡ªåŠ¨åˆ é™¤ Auth ç”¨æˆ·ï¼ˆä¿æŒä¸€è‡´æ€§ï¼‰
- âœ… è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—

**Google ç™»å½•**ï¼š
- âœ… é¦–æ¬¡ç™»å½•æ—¶è‡ªåŠ¨åˆ›å»º Firestore ç”¨æˆ·æ–‡æ¡£
- âœ… åŒ…å« `email` å­—æ®µï¼ˆå°å†™ï¼‰
- âœ… åŒ…å« Google è´¦æˆ·ä¿¡æ¯
- âœ… åˆ›å»ºåéªŒè¯
- âœ… è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—

---

## ğŸ”‘ **å…³é”®è¦ç‚¹**

1. âœ… **æ‰€æœ‰æ³¨å†Œæ–¹å¼**éƒ½ä¼šåœ¨ Firestore ä¸­åˆ›å»ºåŒ…å« `email` å­—æ®µçš„ç”¨æˆ·æ–‡æ¡£
2. âœ… **Email ç»Ÿä¸€å°å†™**ï¼Œé¿å…å¤§å°å†™åŒ¹é…é—®é¢˜
3. âœ… **åˆ›å»ºåéªŒè¯**ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§
4. âœ… **è¯¦ç»†æ—¥å¿—**ï¼Œæ–¹ä¾¿è°ƒè¯•
5. âœ… **é”™è¯¯å¤„ç†**ï¼Œä¿æŒ Auth å’Œ Firestore æ•°æ®ä¸€è‡´æ€§

---

## ğŸ“ **ä¸‹ä¸€æ­¥**

### **æ–¹æ¡ˆ 1ï¼šæµ‹è¯•æ–°ç”¨æˆ·æ³¨å†Œï¼ˆæ¨èï¼‰**

1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
2. æ³¨å†Œä¸€ä¸ªæ–°ç”¨æˆ·
3. éªŒè¯ Email
4. æµ‹è¯•æ”¯ä»˜
5. ç¡®è®¤æ‰€æœ‰åŠŸèƒ½æ­£å¸¸

### **æ–¹æ¡ˆ 2ï¼šä¿®å¤ç°æœ‰ç”¨æˆ·**

å¯¹äºå·²ç»å­˜åœ¨ä½†ç¼ºå°‘ `email` å­—æ®µçš„ç”¨æˆ·ï¼ˆå¦‚ `m39fmLndIzdpHrHja1OXypGlQSe2`ï¼‰ï¼š

1. åœ¨ Firebase Console ä¸­æ‰‹åŠ¨æ·»åŠ  `email` å­—æ®µ
2. é‡æ–°éªŒè¯ Email
3. æµ‹è¯•æ”¯ä»˜

**å®Œæˆæµ‹è¯•åå‘Šè¯‰æˆ‘ç»“æœï¼** ğŸ™

