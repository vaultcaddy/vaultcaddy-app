# 四種文檔類型提取邏輯指南

## 📋 概述

VaultCaddy 支持四種文檔類型，每種都針對不同的用戶需求進行了優化。

---

## 1. 🏦 Bank Statements（銀行對帳單）

### 用戶需求
- 會計對帳
- 核對交易記錄
- 財務報表編制

### 提取內容
```json
{
  "bank_name": "銀行名稱",
  "account_holder": "戶主名稱",
  "account_number": "賬戶號碼",
  "statement_period": {
    "from": "2025-10-01",
    "to": "2025-10-31"
  },
  "opening_balance": 10000.00,
  "closing_balance": 15000.00,
  "transactions": [
    {
      "date": "2025-10-05",
      "description": "工資收入",
      "debit": 0,
      "credit": 50000.00,
      "balance": 60000.00
    },
    {
      "date": "2025-10-10",
      "description": "HW海運達(香港)有限公司",
      "debit": 278.30,
      "credit": 0,
      "balance": 59721.70
    }
  ],
  "total_debit": 5000.00,
  "total_credit": 10000.00
}
```

### 典型使用場景
- 月末對帳
- 核對供應商付款
- 確認客戶收款
- 編制銀行存款餘額調節表

---

## 2. 📄 Invoices（發票）

### 用戶需求
- 客戶開單
- 應收賬款管理
- 銷售記錄

### 提取內容
```json
{
  "invoice_number": "INV-2025-001",
  "invoice_date": "2025-10-15",
  "due_date": "2025-11-15",
  "seller": {
    "name": "ABC 公司",
    "address": "香港中環...",
    "tax_id": "12345678"
  },
  "customer": {
    "name": "客戶公司",
    "address": "九龍...",
    "contact": "張先生"
  },
  "items": [
    {
      "description": "網頁設計服務",
      "quantity": 1,
      "unit_price": 50000.00,
      "amount": 50000.00
    }
  ],
  "subtotal": 50000.00,
  "tax": 0.00,
  "total": 50000.00
}
```

### 典型使用場景
- 向客戶開具發票
- 記錄銷售收入
- 管理應收賬款
- 生成銷售報表

---

## 3. 🧾 Receipts（收據）

### 用戶需求
- 個人財務管理
- 日常開支記錄
- 報銷憑證
- 報稅準備

### 提取內容（優化後）
```json
{
  "merchant": "星巴克",
  "date": "2025-10-20",
  "time": "14:30:00",
  "items": [
    {
      "description": "美式咖啡 大杯",
      "quantity": 2,
      "unit_price": 35.00,
      "amount": 70.00,
      "category": "食品"  // 🆕 自動分類
    },
    {
      "description": "芝士蛋糕",
      "quantity": 1,
      "unit_price": 45.00,
      "amount": 45.00,
      "category": "食品"
    }
  ],
  "subtotal": 115.00,
  "service_charge": 11.50,  // 🆕 服務費
  "tax": 0.00,
  "total": 126.50,
  "payment_method": "CARD",
  "card_last_4_digits": "1234",  // 🆕 卡號後4位
  "currency": "HKD"
}
```

### 🆕 新增功能
1. **自動分類**
   - 食品：餐廳、咖啡店、超市
   - 交通：的士、地鐵、巴士
   - 辦公：文具、印刷、設備
   - 其他：娛樂、購物等

2. **報銷友好**
   - 商家稅號（如果有）
   - 詳細地址和電話
   - 服務費單獨列出
   - 稅率和稅額

3. **個人財務管理**
   - 卡號後4位（追蹤哪張卡）
   - 時間記錄（分析消費習慣）
   - 項目分類（月度預算管理）

### 典型使用場景
- 記錄每日開支
- 準備報銷單
- 個人預算管理
- 年度報稅整理

---

## 4. 📑 General（通用文檔）

### 用戶需求
- 提取文本內容
- 識別表格數據
- 提取關鍵信息
- 存檔和搜索

### 提取內容（全新設計）
```json
{
  "document_type": "合同",  // 🆕 自動識別
  "title": "軟件開發服務合同",
  "document_number": "Contract-2025-001",
  "dates": [
    {
      "label": "簽署日期",
      "value": "2025-10-01"
    },
    {
      "label": "生效日期",
      "value": "2025-10-15"
    },
    {
      "label": "到期日期",
      "value": "2026-10-15"
    }
  ],
  "entities": {  // 🆕 實體識別
    "people": ["張三", "李四"],
    "organizations": ["ABC科技有限公司", "XYZ企業"],
    "addresses": ["香港中環...", "九龍尖沙咀..."],
    "emails": ["info@abc.com", "contact@xyz.com"],
    "phones": ["+852 1234 5678", "+852 8765 4321"]
  },
  "amounts": [  // 🆕 金額提取
    {
      "label": "合同總額",
      "value": 500000.00,
      "currency": "HKD"
    },
    {
      "label": "首期付款",
      "value": 200000.00,
      "currency": "HKD"
    }
  ],
  "tables": [  // 🆕 表格提取
    {
      "title": "付款時間表",
      "headers": ["階段", "交付內容", "金額", "日期"],
      "rows": [
        ["第一階段", "需求分析", "200000", "2025-11-01"],
        ["第二階段", "系統開發", "200000", "2026-01-01"],
        ["第三階段", "測試上線", "100000", "2026-03-01"]
      ]
    }
  ],
  "full_text": "完整的合同文本內容...",  // 🆕 全文
  "sections": [  // 🆕 章節結構
    {
      "heading": "第一條 合同目的",
      "content": "甲乙雙方就軟件開發服務達成如下協議..."
    },
    {
      "heading": "第二條 服務範圍",
      "content": "..."
    }
  ],
  "key_terms": [  // 🆕 關鍵術語
    "知識產權", "保密條款", "違約責任", "爭議解決"
  ],
  "language": "中文",
  "summary": "這是一份為期一年的軟件開發服務合同，合同總額50萬港幣，分三期付款。"
}
```

### 🆕 新增功能
1. **智能識別文檔類型**
   - 合同
   - 報告
   - 表單
   - 證明文件
   - 申請書
   - 通知信

2. **實體提取**
   - 人名（張三、李四）
   - 公司名（識別「有限公司」等）
   - 地址（完整地址字符串）
   - 郵箱（正則表達式識別）
   - 電話（多種格式）

3. **表格識別**
   - 自動識別表格結構
   - 提取列標題
   - 提取每行數據
   - 保留表格標題

4. **結構化處理**
   - 識別章節（第一條、一、1.）
   - 提取標題和內容
   - 保留文檔層次結構

5. **智能摘要**
   - AI 生成 1-2 句摘要
   - 幫助用戶快速理解文檔
   - 方便搜索和分類

### 典型使用場景
- 合同管理和存檔
- 報告文檔數字化
- 證明文件整理
- 表單數據提取
- 文檔內容搜索

---

## 🎯 如何選擇文檔類型

### 決策樹
```
是銀行對帳單嗎？
├─ 是 → Bank Statements
└─ 否 → 是發票嗎？
    ├─ 是 → Invoices
    └─ 否 → 是收據嗎？
        ├─ 是 → Receipts
        └─ 否 → General
```

### 快速識別
- **Bank Statements**：看到「銀行」、「對帳單」、「交易記錄」
- **Invoices**：看到「發票」、「Invoice」、「發票號」、「客戶名稱」
- **Receipts**：看到「收據」、「Receipt」、商家名稱在頂部、小額消費
- **General**：合同、報告、表單、證明文件等

---

## 💡 使用技巧

### 1. 收據（Receipts）最佳實踐
- **拍照技巧**：確保收據平整、光線充足、字體清晰
- **自動分類**：AI 會自動識別類別，但可以後續手動調整
- **月度整理**：按月份整理收據，方便預算管理
- **報銷準備**：確保提取了商家名稱、日期、金額

### 2. 通用文檔（General）最佳實踐
- **合同管理**：提取關鍵日期（簽署、生效、到期）
- **表格數據**：AI 會自動識別表格，可導出為 CSV
- **搜索功能**：提取的全文可用於後續搜索
- **文檔摘要**：利用 AI 生成的摘要快速了解內容

### 3. 銀行對帳單（Bank Statements）最佳實踐
- **多頁處理**：支持多頁 PDF，會提取所有交易
- **交易核對**：自動計算總支出和總收入
- **餘額驗證**：對比期初和期末餘額

### 4. 發票（Invoices）最佳實踐
- **項目明細**：確保每個項目都被正確提取
- **稅額計算**：驗證稅額和總額是否正確
- **客戶信息**：確保客戶名稱和地址完整

---

## 📊 提取準確度

| 文檔類型 | 預期準確度 | 關鍵欄位準確度 |
|---------|-----------|---------------|
| Bank Statements | 85-90% | 95%（日期、金額） |
| Invoices | 90-95% | 98%（發票號、總額） |
| Receipts | 80-85% | 90%（商家、日期、總額） |
| General | 75-85% | 85%（標題、日期、金額） |

---

## 🚀 未來改進

1. **Receipts**
   - 更精準的自動分類（機器學習）
   - 商家識別（根據歷史數據）
   - 消費趨勢分析

2. **General**
   - 更智能的文檔類型識別
   - 多語言支持（英文、簡體中文）
   - OCR 後編輯功能

3. **All Types**
   - 提高 OCR 準確度（升級 Vision API）
   - 支持手寫文字識別
   - 批量處理優化

---

**現在請根據您的需求選擇合適的文檔類型進行處理！** ✅
