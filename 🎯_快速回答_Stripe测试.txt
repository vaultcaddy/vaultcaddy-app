# 🧪 VaultCaddy Stripe 测试完整指南

## ✅ 已完成配置

### 1️⃣ 测试模式 Price IDs（已配置）

**月费产品**：
- 基础价格 ($58/月): `price_1Scj13JmiQ31C0GT4TJsWzFg`
- 用量计费 ($0 起步): `price_1Scj1UJmiQ31C0GTXDsN6TFh`
- Payment Link: https://buy.stripe.com/test_9B67sM9LK50SbdsdEKf7i00

**年费产品**：
- ⚠️ 尚未创建（需要时再创建）

### 2️⃣ 测试模式切换按钮（已添加）

在 `billing.html` 页面顶部添加了：
- ✅ 测试模式切换开关
- ✅ 自动显示测试卡号提示
- ✅ 响应式设计（手机端友好）

---

## 🎯 如何测试（3 个简单步骤）

### 步骤 1：访问 Billing 页面
```
https://vaultcaddy.com/billing.html
```

### 步骤 2：启用测试模式
1. 在页面标题下方找到 "🧪 测试模式" 切换开关
2. 勾选复选框
3. 会显示测试卡号信息：`4242 4242 4242 4242`

### 步骤 3：点击 "开始使用" 按钮
1. 选择月费方案，点击 "开始使用"
2. 会自动打开 Stripe 测试 Payment Link
3. 使用测试卡号完成支付

---

## 💳 Stripe 测试卡号

### ✅ 成功测试卡
- **卡号**: `4242 4242 4242 4242`
- **有效期**: 任意未来日期（如 `12/34`）
- **CVC**: 任意 3 位数字（如 `123`）
- **郵編**: 任意邮编（如 `12345`）

### ❌ 失败测试卡（用于测试错误处理）
- **卡被拒绝**: `4000 0000 0000 0002`
- **资金不足**: `4000 0000 0000 9995`
- **需要 3D 验证**: `4000 0025 0000 3155`

更多测试卡：https://stripe.com/docs/testing

---

## 🔍 测试检查清单

### 支付流程测试
- [ ] 测试模式切换开关工作正常
- [ ] 点击 "开始使用" 打开 Payment Link
- [ ] 使用测试卡号完成支付
- [ ] 支付成功后跳转回 Dashboard

### Webhook 测试（需要 Stripe Dashboard 查看）
- [ ] `checkout.session.completed` 事件被触发
- [ ] Webhook 成功接收并处理
- [ ] 用户 Credits 正确添加
- [ ] 订阅信息正确保存

### Firebase 数据测试
- [ ] Firestore 中用户订阅信息正确
- [ ] Credits 余额正确
- [ ] Credits 历史记录正确

---

## ⚠️ 重要提醒

### 测试模式 vs 生产模式

#### 🧪 测试模式（TEST MODE）
- ✅ **不涉及真实金钱**
- ✅ 使用测试卡号（4242...）
- ✅ 无限次测试
- ✅ 用于开发和测试
- ⚠️ 需要在 Stripe 测试模式下创建产品

#### 💰 生产模式（LIVE MODE）
- ❌ **需要真实支付**
- ❌ 使用真实信用卡
- ❌ 会产生实际费用
- ✅ 用于真实用户

---

## 📝 如果需要创建年费测试产品

### 1️⃣ 切换到 Stripe 测试模式
```
https://dashboard.stripe.com/test/products
```

### 2️⃣ 创建年费基础产品
- 名称: VaultCaddy 年費 test
- 价格: HKD $552/年
- 计费周期: 每年

### 3️⃣ 创建年费用量计费
- 产品: VaultCaddy 年費 test
- 价格模式: 用量计费
- 单价: HKD $0/单位
- 计费周期: 每年

### 4️⃣ 更新代码
将新的 Price IDs 添加到 `billing.html` 的 `TEST_PRICE_IDS.yearly` 中。

---

## 🚀 测试完成后

### 下一步
1. ✅ 确认测试模式所有功能正常
2. ✅ 在生产模式下进行最终验证
3. ✅ 监控 Stripe Webhook 日志
4. ✅ 监控 Firebase Functions 日志

### 生产环境检查
- [ ] 生产模式 Price IDs 正确
- [ ] Webhook Secret 已配置
- [ ] Firebase Functions 已部署
- [ ] 所有价格显示正确

---

## 💡 快速参考

### 关键链接
- **Billing 页面**: https://vaultcaddy.com/billing.html
- **测试 Payment Link**: https://buy.stripe.com/test_9B67sM9LK50SbdsdEKf7i00
- **Stripe 测试模式**: https://dashboard.stripe.com/test/dashboard
- **Stripe Webhook**: https://dashboard.stripe.com/test/webhooks

### 测试卡号（记住这个就够了）
```
4242 4242 4242 4242
任意未来日期 / 任意 CVC / 任意郵編
```

---

## ❓ 常见问题

### Q: 测试模式下支付会扣钱吗？
A: **不会！** 测试模式完全免费，不涉及真实金钱。

### Q: 年费方案显示尚未创建？
A: 目前只配置了月费测试产品。如需测试年费，需先在 Stripe 测试模式下创建。

### Q: 测试成功后如何切换到生产模式？
A: 取消勾选 "🧪 测试模式" 复选框即可。

### Q: 如何查看测试支付记录？
A: 前往 Stripe Dashboard > 测试模式 > Payments 查看。

---

## 📊 测试报告模板

```
测试日期: _____________
测试人员: _____________

✅ 功能测试
- [ ] 测试模式切换
- [ ] 月费 Payment Link
- [ ] 支付流程完成
- [ ] Webhook 触发
- [ ] Credits 添加

❌ 发现问题
1. _______________
2. _______________

📝 备注
_______________
```

---

**记住**：测试模式是您的朋友！尽情测试，无需担心费用！ 🎉
