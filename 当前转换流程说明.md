# ğŸ“– å½“å‰é“¶è¡Œå¯¹è´¦å•è½¬æ¢æµç¨‹è¯´æ˜

> **å›ç­”æ‚¨çš„é—®é¢˜ï¼š"è®²è§£ä¸€ä¸‹ç°åœ¨çš„è½¬æ¢çš„å·¥ä½œæµç¨‹"**  
> **æœ€åæ›´æ–°ï¼š** 2026-02-03

---

## ğŸ”„ å®Œæ•´æµç¨‹ï¼ˆ9æ­¥ï¼‰

```
ç”¨æˆ·ä¸Šä¼ PDF â†’ è½¬æ¢ä¸ºå›¾ç‰‡ â†’ ä¸Šä¼ Storage â†’ æ‰£é™¤Credits â†’ 
è°ƒç”¨åƒé—®AI â†’ è§£æå“åº” â†’ å‰ç«¯åå¤„ç†(å¡«å……ç©ºç™½æ—¥æœŸ) â†’ 
ä¿å­˜Firestore â†’ æ˜¾ç¤ºç»“æœ
```

---

## è¯¦ç»†æ­¥éª¤

### 1ï¸âƒ£ ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
- **ä½ç½®ï¼š** `firstproject.html`
- **æ”¯æŒæ ¼å¼ï¼š** PDFã€JPGã€PNG
- **è§¦å‘ï¼š** ç”¨æˆ·ç‚¹å‡»"Upload files"æˆ–æ‹–æ‹½æ–‡ä»¶

### 2ï¸âƒ£ PDFè½¬å›¾ç‰‡ï¼ˆå¦‚æœæ˜¯PDFï¼‰
- **å·¥å…·ï¼š** `pdf-to-image-converter.js`
- **åº“ï¼š** pdf.js
- **è®¾ç½®ï¼š** 300 DPIï¼ˆé«˜æ¸…ï¼‰
- **è¾“å‡ºï¼š** 1å¼ æˆ–å¤šå¼ å›¾ç‰‡æ–‡ä»¶

### 3ï¸âƒ£ ä¸Šä¼ åˆ°Firebase Storage
- **è·¯å¾„ï¼š** `projects/{projectId}/documents/{docId}/page_1.jpg`
- **ä½œç”¨ï¼š** è·å–å…¬å¼€URLï¼Œä¾›AIè®¿é—®

### 4ï¸âƒ£ æ‰£é™¤Credits
- **å·¥å…·ï¼š** `credits-manager.js`
- **è§„åˆ™ï¼š** æ¯é¡µæ‰£1 Credit
- **æ£€æŸ¥ï¼š** ä½™é¢ä¸è¶³åˆ™åœæ­¢

### 5ï¸âƒ£ è°ƒç”¨åƒé—®AIï¼ˆæ ¸å¿ƒæ­¥éª¤ï¼‰
**æ–‡ä»¶ï¼š** `qwen-vl-max-processor.js`

```javascript
// 1. æ–‡ä»¶â†’Base64
const base64 = await fileToBase64(file);

// 2. ç”ŸæˆPrompt
const prompt = generatePrompt('bank_statement');

// 3. æ„å»ºè¯·æ±‚
{
  model: "qwen3-vl-plus-2025-12-19",
  messages: [{
    role: "user",
    content: [
      {type: "image_url", image_url: {url: "data:image/jpeg;base64,..."}},
      {type: "text", text: prompt}
    ]
  }],
  temperature: 0.1,
  max_tokens: 4000
}

// 4. é€šè¿‡Workerè½¬å‘
POST â†’ deepseek-proxy.vaultcaddy.workers.dev

// 5. ç­‰å¾…8-15ç§’
// 6. æ¥æ”¶å“åº”
```

**Promptæ ¸å¿ƒå†…å®¹ï¼š**
```
ä½ æ˜¯OCRå¤å°æœºï¼Œåªå¤åˆ¶å¯è§æ–‡æœ¬ï¼Œä¸è¦è®¡ç®—ã€‚

å­—æ®µè§„åˆ™ï¼š
â€¢ date: å¦‚æœä¸ºç©º â†’ è¾“å‡º "" (ç©ºå­—ç¬¦ä¸²)
â€¢ debit: å€Ÿé¡¹é‡‘é¢
â€¢ credit: è´·é¡¹é‡‘é¢
â€¢ balance: ä½™é¢

è¾“å‡ºçº¯JSONï¼Œä¸è¦markdownã€‚
```

### 6ï¸âƒ£ è§£æå“åº”
- **æ¸…ç†ï¼š** ç§»é™¤markdownæ ‡è®°ï¼ˆ```jsonï¼‰
- **è§£æï¼š** JSON.parse()
- **éªŒè¯ï¼š** æ£€æŸ¥å¿…éœ€å­—æ®µ

### 7ï¸âƒ£ **å‰ç«¯åå¤„ç†ï¼ˆå…³é”®æ­¥éª¤ï¼‰**
**å‡½æ•°ï¼š** `postProcessTransactions()`

**ä½œç”¨ï¼š** å¡«å……æ’ç”Ÿé“¶è¡Œçš„ç©ºç™½æ—¥æœŸ

**é€»è¾‘ï¼š**
```javascript
lastValidDate = null

for each transaction:
    if (dateä¸ºç©º):
        transaction.date = lastValidDate  // ä½¿ç”¨ä¸Šä¸€ç¬”çš„æ—¥æœŸ
    else:
        lastValidDate = transaction.date  // æ›´æ–°æœ‰æ•ˆæ—¥æœŸ
```

**ç¤ºä¾‹ï¼š**
```
è¾“å…¥ï¼ˆAIæå–ï¼‰ï¼š
[
  {date: "10 Mar", desc: "ATM", debit: 500},
  {date: "",       desc: "è½¬è´¦", debit: 200},  â† ç©ºç™½
  {date: "",       desc: "POS", debit: 150}   â† ç©ºç™½
]

è¾“å‡ºï¼ˆå‰ç«¯å¤„ç†åï¼‰ï¼š
[
  {date: "10 Mar", desc: "ATM", debit: 500},
  {date: "10 Mar", desc: "è½¬è´¦", debit: 200},  â† å·²å¡«å……
  {date: "10 Mar", desc: "POS", debit: 150}   â† å·²å¡«å……
]
```

### 8ï¸âƒ£ ä¿å­˜åˆ°Firestore
**è·¯å¾„ï¼š** `projects/{projectId}/documents/{docId}`

**ä¿å­˜å†…å®¹ï¼š**
```javascript
{
  name: "æ–‡æ¡£åç§°",
  status: "completed",
  processedData: {å¤„ç†åçš„å®Œæ•´æ•°æ®},
  rawText: {AIåŸå§‹å“åº”},
  processingTime: 12345,
  processor: "qwen-vl-max",
  model: "qwen3-vl-plus-2025-12-19",
  createdAt: Timestamp
}
```

### 9ï¸âƒ£ åˆ·æ–°UIæ˜¾ç¤º
- ä»Firestoreè¯»å–æœ€æ–°æ•°æ®
- æ¸²æŸ“è¡¨æ ¼
- è®¡ç®—æ±‡æ€»ï¼ˆæ€»æ”¶å…¥ã€æ€»æ”¯å‡ºï¼‰

---

## ğŸ¯ å…³é”®æŠ€æœ¯ç‚¹

### 1. åŒé‡ç­–ç•¥ï¼ˆPrompt + åå¤„ç†ï¼‰

**Promptå‘Šè¯‰AIï¼š**
- "å¦‚æœæ—¥æœŸä¸ºç©ºï¼Œè¾“å‡ºç©ºå­—ç¬¦ä¸²''"
- "ä¸è¦è‡ªå·±å¡«å……æ—¥æœŸ"

**å‰ç«¯å¤„ç†ï¼š**
- æ£€æµ‹ç©ºå­—ç¬¦ä¸²
- ç”¨ç¡®å®šæ€§ç®—æ³•å¡«å……
- 100%å¯é 

### 2. ä¸ºä»€ä¹ˆä¸è®©AIç›´æ¥å¡«å……ï¼Ÿ

**é—®é¢˜ï¼š** AIè§†è§‰ç†è§£ä¸ç¨³å®š
- å¯èƒ½æŠŠ"10 Mar"å¤åˆ¶åˆ°é”™è¯¯çš„è¡Œ
- å¯èƒ½è¯†åˆ«é”™è¯¯çš„æ—¥æœŸæ–‡æœ¬
- å‡†ç¡®ç‡åªæœ‰60-70%

**è§£å†³ï¼š** å‰ç«¯JavaScriptç®—æ³•
- ç¡®å®šæ€§é€»è¾‘ï¼Œ100%å¯é 
- ä¸ä¾èµ–AIçš„è§†è§‰ç†è§£
- å‡†ç¡®ç‡98%+

---

## ğŸ“Š å¤šé¡µæ–‡æ¡£å¤„ç†

**æ–¹å¼ï¼š** æ‰¹é‡æ¨¡å¼

```
[å›¾1, å›¾2, å›¾3] â†’ å…¨éƒ¨Base64 â†’ ä¸€æ¬¡æ€§å‘ç»™AI â†’ 
AIçœ‹å®Œæ•´ä¸Šä¸‹æ–‡ â†’ è¿”å›åˆå¹¶ç»“æœ
```

**ä¼˜åŠ¿ï¼š**
- âœ… åªéœ€1æ¬¡APIè°ƒç”¨ï¼ˆçœé’±ï¼‰
- âœ… AIå¯ä»¥çœ‹åˆ°å®Œæ•´ä¿¡æ¯ï¼ˆæ›´å‡†ç¡®ï¼‰
- âœ… é€Ÿåº¦æ›´å¿«

---

## âš ï¸ æ’ç”Ÿé“¶è¡Œé—®é¢˜

æ‚¨æåˆ°"é—®é¢˜æ— æ³•è§£å†³"ï¼Œè®©æˆ‘è¯Šæ–­ï¼š

### å¯èƒ½æ€§1ï¼šAIå®Œå…¨ä¸è¯†åˆ«æ—¥æœŸï¼Ÿ
**æ£€æŸ¥ï¼š** æ‰“å¼€æ§åˆ¶å°ï¼ŒæŸ¥çœ‹AIåŸå§‹å“åº”
```javascript
// æŸ¥çœ‹æœ€æ–°æ–‡æ¡£
const docs = await window.simpleDataManager.getDocuments(currentProjectId);
console.log('AIåŸå§‹å“åº”:', docs[0].rawText);
```

**å¦‚æœç¬¬ä¸€ç¬”çš„æ—¥æœŸä¹Ÿæ˜¯ç©ºï¼Œè¯´æ˜AIè¯†åˆ«å¤±è´¥ã€‚**

### å¯èƒ½æ€§2ï¼šåå¤„ç†æ²¡æ‰§è¡Œï¼Ÿ
**æ£€æŸ¥ï¼š** åœ¨ `qwen-vl-max-processor.js` ç¬¬107è¡Œæ·»åŠ æ—¥å¿—
```javascript
console.log('ğŸ” åå¤„ç†å‰:', extractedData.transactions);
const processedData = this.postProcessTransactions(extractedData);
console.log('âœ… åå¤„ç†å:', processedData.transactions);
```

### å¯èƒ½æ€§3ï¼šUIä¸æ˜¾ç¤ºï¼Ÿ
**æ£€æŸ¥ï¼š** `firstproject.html` è¡¨æ ¼æ¸²æŸ“ä»£ç 

---

## ğŸ’¡ è§£å†³æ–¹æ¡ˆå»ºè®®

### å¦‚æœAIè¯†åˆ«å¤±è´¥
**æ–¹æ¡ˆAï¼š** å¢å¼ºPrompt
- æ·»åŠ æ›´å¤šç¤ºä¾‹
- æ˜ç¡®è¯´æ˜è¡¨æ ¼ç»“æ„

**æ–¹æ¡ˆBï¼š** OCRé¢„å¤„ç†
- ä½¿ç”¨Tesseract.jså…ˆè¯†åˆ«æ–‡æœ¬
- è·å–åæ ‡ä¿¡æ¯
- ç”¨è§„åˆ™å¼•æ“å¯¹é½å­—æ®µ

### å¦‚æœåå¤„ç†æœ‰bug
- æ£€æŸ¥ç©ºç™½æ—¥æœŸçš„åˆ¤æ–­æ¡ä»¶
- æ£€æŸ¥lastValidDateçš„æ›´æ–°é€»è¾‘

---

## ğŸ“ æ€»ç»“

**å½“å‰æµç¨‹ï¼š**
1. âœ… ç”¨æˆ·ä¸Šä¼  â†’ PDF/å›¾ç‰‡
2. âœ… æ–‡ä»¶å¤„ç† â†’ è½¬å›¾ç‰‡ï¼ˆå¦‚éœ€ï¼‰
3. âœ… ä¸Šä¼ Storage
4. âœ… æ‰£Credits
5. âœ… **AIæå–** â†’ åƒé—®VL-Maxï¼ˆ8-15ç§’ï¼‰
6. âœ… è§£æå“åº”
7. âœ… **å‰ç«¯åå¤„ç†** â†’ **å¡«å……ç©ºç™½æ—¥æœŸ**ï¼ˆæ ¸å¿ƒï¼‰
8. âœ… ä¿å­˜æ•°æ®
9. âœ… æ˜¾ç¤ºç»“æœ

**æ ¸å¿ƒåˆ›æ–°ï¼š**
- âœ… Promptå‘Šè¯‰AI"ç©ºç™½å°±è¾“å‡ºç©ºå­—ç¬¦ä¸²"
- âœ… å‰ç«¯ç”¨ç¡®å®šæ€§ç®—æ³•å¡«å……
- âœ… ä¸ä¾èµ–AIçš„å®Œç¾ç†è§£

**ä¸‹ä¸€æ­¥ï¼š**
è¯·å‘Šè¯‰æˆ‘å…·ä½“å“ªä¸€æ­¥æœ‰é—®é¢˜ï¼Œæˆ‘å¯ä»¥é’ˆå¯¹æ€§è§£å†³ï¼

---

**åˆ›å»ºæ—¶é—´ï¼š** 2026-02-03  
**å›ç­”é—®é¢˜ï¼š** "è®²è§£ä¸€ä¸‹ç°åœ¨çš„è½¬æ¢çš„å·¥ä½œæµç¨‹"

